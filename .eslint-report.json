[{"filePath":"C:\\sneaker-eco\\rdk\\app\\account\\error.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\account\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\admin\\analytics\\financials\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":91,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2640,2643],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2640,2643],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// app/admin/analytics/financials/page.tsx\n\"use client\";\n\nimport { useEffect, useMemo, useRef, useState } from \"react\";\nimport { DollarSign, TrendingUp, ShoppingCart } from \"lucide-react\";\n\nimport { logError } from \"@/lib/log\";\nimport { SalesChart } from \"@/components/admin/charts/SalesChart\";\nimport { RdkSelect } from \"@/components/ui/Select\";\n\ntype Range = \"today\" | \"7d\" | \"30d\" | \"90d\";\nconst DEFAULT_RANGE: Range = \"30d\";\nconst POLL_MS = 30_000;\n\nfunction rangeToDays(range: Range): number {\n  if (range === \"today\") {\n    return 1;\n  }\n  return Number(range.replace(\"d\", \"\")) || 30;\n}\n\nfunction toISODate(d: Date) {\n  return d.toISOString().slice(0, 10);\n}\n\ntype DailySeriesPoint<K extends string> = { date: string } & Record<K, number>;\n\nfunction normalizeDailySeries<K extends string>(\n  range: Range,\n  raw: Array<{ date: string } & Partial<Record<K, number>>>,\n  valueKey: K,\n): DailySeriesPoint<K>[] {\n  const days = rangeToDays(range);\n\n  // Build a map from YYYY-MM-DD -> value\n  const map = new Map<string, number>();\n  for (const row of raw || []) {\n    const date = typeof row.date === \"string\" ? row.date.slice(0, 10) : \"\";\n    const v = Number(row[valueKey] ?? 0);\n    if (!date) {\n      continue;\n    }\n    map.set(date, (map.get(date) ?? 0) + (Number.isFinite(v) ? v : 0));\n  }\n\n  // End at \"today\" (UTC day). Start is (days-1) days back.\n  const end = new Date();\n  const start = new Date(end);\n  start.setUTCDate(start.getUTCDate() - (days - 1));\n\n  const out: DailySeriesPoint<K>[] = [];\n  for (let i = 0; i < days; i++) {\n    const cur = new Date(start);\n    cur.setUTCDate(start.getUTCDate() + i);\n    const key = toISODate(cur);\n\n    out.push({\n      date: key,\n      [valueKey]: map.get(key) ?? 0,\n    } as DailySeriesPoint<K>);\n  }\n\n  return out;\n}\n\nexport default function AnalyticsFinancialsPage() {\n  const [range, setRange] = useState<Range>(DEFAULT_RANGE);\n  const [summary, setSummary] = useState({ revenue: 0, profit: 0, orders: 0 });\n  const [salesTrendRaw, setSalesTrendRaw] = useState<\n    Array<{ date: string; revenue: number }>\n  >([]);\n\n  const abortRef = useRef<AbortController | null>(null);\n\n  const load = async () => {\n    try {\n      abortRef.current?.abort();\n      const ac = new AbortController();\n      abortRef.current = ac;\n\n      const response = await fetch(`/api/admin/analytics?range=${range}`, {\n        cache: \"no-store\",\n        signal: ac.signal,\n      });\n      const data = await response.json();\n\n      if (response.ok) {\n        setSummary(data.summary || { revenue: 0, profit: 0, orders: 0 });\n        setSalesTrendRaw(data.salesTrend || []);\n      }\n    } catch (error: any) {\n      // Ignore abort noise\n      if (error?.name === \"AbortError\") {\n        return;\n      }\n      logError(error, { layer: \"frontend\", event: \"admin_load_analytics_financials\" });\n    }\n  };\n\n  useEffect(() => {\n    load();\n\n    const interval = setInterval(() => {\n      // Only poll when tab is visible (keeps it snappy and cheaper)\n      if (document.visibilityState === \"visible\") {\n        load();\n      }\n    }, POLL_MS);\n\n    const onVisibility = () => {\n      if (document.visibilityState === \"visible\") {\n        load();\n      }\n    };\n    document.addEventListener(\"visibilitychange\", onVisibility);\n\n    return () => {\n      clearInterval(interval);\n      document.removeEventListener(\"visibilitychange\", onVisibility);\n      abortRef.current?.abort();\n    };\n  }, [range]);\n\n  const salesTrend = useMemo(() => {\n    // Normalize to match the selected range window so the chart always\n    // has the same amount of days as traffic (unless the filter changes).\n    return normalizeDailySeries(range, salesTrendRaw, \"revenue\");\n  }, [range, salesTrendRaw]);\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <h1 className=\"text-3xl font-bold text-white mb-2\">Analytics</h1>\n        <p className=\"text-gray-400\">Financial performance</p>\n      </div>\n\n      <div className=\"flex items-center gap-4\">\n        <div className=\"w-48\">\n          <RdkSelect\n            value={range}\n            onChange={(value) => setRange(value as Range)}\n            options={[\n              { value: \"today\", label: \"Today\" },\n              { value: \"7d\", label: \"Last 7 days\" },\n              { value: \"30d\", label: \"Last 30 days\" },\n              { value: \"90d\", label: \"Last 90 days\" },\n            ]}\n          />\n        </div>\n      </div>\n\n      <div>\n        <h2 className=\"text-2xl font-semibold text-white mb-4\">Financials</h2>\n\n        <div className=\"grid grid-cols-3 md:grid-cols-3 gap-2 sm:gap-6 mb-6\">\n          <div className=\"bg-zinc-900 border border-zinc-800/70 rounded-lg p-3 sm:p-6 flex flex-col h-full\">\n            <div className=\"flex items-center justify-between mb-2\">\n              <span className=\"text-gray-400 text-[10px] sm:text-sm\">Revenue</span>\n              <DollarSign className=\"w-4 h-4 sm:w-5 sm:h-5 text-gray-400\" />\n            </div>\n            <div className=\"mt-auto space-y-1\">\n              <div className=\"text-base sm:text-3xl font-bold text-white\">\n                ${summary.revenue.toFixed(2)}\n              </div>\n              <div className=\"text-gray-500 text-[10px] sm:text-sm\">\n                {range === \"today\" ? \"Today\" : `Last ${range.replace(\"d\", \"\")} days`}\n              </div>\n            </div>\n          </div>\n\n          <div className=\"bg-zinc-900 border border-zinc-800/70 rounded-lg p-3 sm:p-6 flex flex-col h-full\">\n            <div className=\"flex items-center justify-between mb-2\">\n              <span className=\"text-gray-400 text-[10px] sm:text-sm\">Profit</span>\n              <TrendingUp className=\"w-4 h-4 sm:w-5 sm:h-5 text-gray-400\" />\n            </div>\n            <div className=\"mt-auto space-y-1\">\n              <div className=\"text-base sm:text-3xl font-bold text-white\">\n                ${summary.profit.toFixed(2)}\n              </div>\n              <div className=\"text-gray-500 text-[10px] sm:text-sm\">\n                {range === \"today\" ? \"Today\" : `Last ${range.replace(\"d\", \"\")} days`}\n              </div>\n            </div>\n          </div>\n\n          <div className=\"bg-zinc-900 border border-zinc-800/70 rounded-lg p-3 sm:p-6 flex flex-col h-full\">\n            <div className=\"flex items-center justify-between mb-2\">\n              <span className=\"text-gray-400 text-[10px] sm:text-sm\">Orders</span>\n              <ShoppingCart className=\"w-4 h-4 sm:w-5 sm:h-5 text-gray-400\" />\n            </div>\n            <div className=\"mt-auto space-y-1\">\n              <div className=\"text-base sm:text-3xl font-bold text-white\">\n                {summary.orders}\n              </div>\n              <div className=\"text-gray-500 text-[10px] sm:text-sm\">\n                {range === \"today\" ? \"Today\" : `Last ${range.replace(\"d\", \"\")} days`}\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"bg-zinc-900 border border-zinc-800/70 rounded-lg p-6\">\n          <h3 className=\"text-xl font-semibold text-white mb-4\">Revenue Trend</h3>\n          <SalesChart data={salesTrend} />\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\admin\\analytics\\traffic\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":96,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":96,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2663,2666],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2663,2666],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useEffect, useMemo, useRef, useState } from \"react\";\nimport { Users, Eye } from \"lucide-react\";\n\nimport { logError } from \"@/lib/log\";\nimport { TrafficChart } from \"@/components/admin/charts/TrafficChart\";\nimport { RdkSelect } from \"@/components/ui/Select\";\n\ntype Range = \"today\" | \"7d\" | \"30d\" | \"90d\";\nconst DEFAULT_RANGE: Range = \"30d\";\nconst POLL_MS = 30_000;\n\nfunction rangeToDays(range: Range): number {\n  if (range === \"today\") {\n    return 1;\n  }\n  return Number(range.replace(\"d\", \"\")) || 30;\n}\n\nfunction toISODate(d: Date) {\n  return d.toISOString().slice(0, 10);\n}\n\ntype DailySeriesPoint<K extends string> = { date: string } & Record<K, number>;\n\nfunction normalizeDailySeries<K extends string>(\n  range: Range,\n  raw: Array<{ date: string } & Partial<Record<K, number>>>,\n  valueKey: K,\n): DailySeriesPoint<K>[] {\n  const days = rangeToDays(range);\n\n  // Build a map from YYYY-MM-DD -> value\n  const map = new Map<string, number>();\n  for (const row of raw || []) {\n    const date = typeof row.date === \"string\" ? row.date.slice(0, 10) : \"\";\n    const v = Number(row[valueKey] ?? 0);\n    if (!date) {\n      continue;\n    }\n    map.set(date, (map.get(date) ?? 0) + (Number.isFinite(v) ? v : 0));\n  }\n\n  // End at \"today\" (UTC day). Start is (days-1) days back.\n  const end = new Date();\n  const start = new Date(end);\n  start.setUTCDate(start.getUTCDate() - (days - 1));\n\n  const out: DailySeriesPoint<K>[] = [];\n  for (let i = 0; i < days; i++) {\n    const cur = new Date(start);\n    cur.setUTCDate(start.getUTCDate() + i);\n    const key = toISODate(cur);\n\n    out.push({\n      date: key,\n      [valueKey]: map.get(key) ?? 0,\n    } as DailySeriesPoint<K>);\n  }\n\n  return out;\n}\n\nexport default function AnalyticsTrafficPage() {\n  const [range, setRange] = useState<Range>(DEFAULT_RANGE);\n  const [trafficSummary, setTrafficSummary] = useState({\n    visits: 0,\n    uniqueVisitors: 0,\n    pageViews: 0,\n  });\n  const [trafficTrendRaw, setTrafficTrendRaw] = useState<\n    Array<{ date: string; visits: number }>\n  >([]);\n\n  const abortRef = useRef<AbortController | null>(null);\n\n  const load = async () => {\n    try {\n      abortRef.current?.abort();\n      const ac = new AbortController();\n      abortRef.current = ac;\n\n      const response = await fetch(`/api/admin/analytics?range=${range}`, {\n        cache: \"no-store\",\n        signal: ac.signal,\n      });\n      const data = await response.json();\n\n      if (response.ok) {\n        setTrafficSummary(\n          data.trafficSummary || { visits: 0, uniqueVisitors: 0, pageViews: 0 },\n        );\n        setTrafficTrendRaw(data.trafficTrend || []);\n      }\n    } catch (error: any) {\n      if (error?.name === \"AbortError\") {\n        return;\n      }\n      logError(error, { layer: \"frontend\", event: \"admin_load_analytics_traffic\" });\n    }\n  };\n\n  useEffect(() => {\n    load();\n\n    const interval = setInterval(() => {\n      if (document.visibilityState === \"visible\") {\n        load();\n      }\n    }, POLL_MS);\n\n    const onVisibility = () => {\n      if (document.visibilityState === \"visible\") {\n        load();\n      }\n    };\n    document.addEventListener(\"visibilitychange\", onVisibility);\n\n    return () => {\n      clearInterval(interval);\n      document.removeEventListener(\"visibilitychange\", onVisibility);\n      abortRef.current?.abort();\n    };\n  }, [range]);\n\n  const trafficTrend = useMemo(() => {\n    return normalizeDailySeries(range, trafficTrendRaw, \"visits\");\n  }, [range, trafficTrendRaw]);\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <h1 className=\"text-3xl font-bold text-white mb-2\">Analytics</h1>\n        <p className=\"text-gray-400\">Traffic performance</p>\n      </div>\n\n      <div className=\"flex items-center gap-4\">\n        <div className=\"w-48\">\n          <RdkSelect\n            value={range}\n            onChange={(value) => setRange(value as Range)}\n            options={[\n              { value: \"today\", label: \"Today\" },\n              { value: \"7d\", label: \"Last 7 days\" },\n              { value: \"30d\", label: \"Last 30 days\" },\n              { value: \"90d\", label: \"Last 90 days\" },\n            ]}\n          />\n        </div>\n      </div>\n\n      <div>\n        <h2 className=\"text-2xl font-semibold text-white mb-4\">Traffic</h2>\n\n        <div className=\"grid grid-cols-3 md:grid-cols-3 gap-2 sm:gap-6 mb-6\">\n          <div className=\"bg-zinc-900 border border-zinc-800/70 rounded-lg p-3 sm:p-6 flex flex-col h-full\">\n            <div className=\"flex items-center justify-between mb-2\">\n              <span className=\"text-gray-400 text-[10px] sm:text-sm\">Total Visits</span>\n              <Users className=\"w-4 h-4 sm:w-5 sm:h-5 text-gray-400\" />\n            </div>\n            <div className=\"mt-auto space-y-1\">\n              <div className=\"text-base sm:text-3xl font-bold text-white\">\n                {trafficSummary.visits}\n              </div>\n              <div className=\"text-gray-500 text-[10px] sm:text-sm\">\n                {range === \"today\" ? \"Today\" : `Last ${range.replace(\"d\", \"\")} days`}\n              </div>\n            </div>\n          </div>\n\n          <div className=\"bg-zinc-900 border border-zinc-800/70 rounded-lg p-3 sm:p-6 flex flex-col h-full\">\n            <div className=\"flex items-center justify-between mb-2\">\n              <span className=\"text-gray-400 text-[10px] sm:text-sm\">\n                Unique Visitors\n              </span>\n              <Eye className=\"w-4 h-4 sm:w-5 sm:h-5 text-gray-400\" />\n            </div>\n            <div className=\"mt-auto space-y-1\">\n              <div className=\"text-base sm:text-3xl font-bold text-white\">\n                {trafficSummary.uniqueVisitors}\n              </div>\n              <div className=\"text-gray-500 text-[10px] sm:text-sm\">\n                {range === \"today\" ? \"Today\" : `Last ${range.replace(\"d\", \"\")} days`}\n              </div>\n            </div>\n          </div>\n\n          <div className=\"bg-zinc-900 border border-zinc-800/70 rounded-lg p-3 sm:p-6 flex flex-col h-full\">\n            <div className=\"flex items-center justify-between mb-2\">\n              <span className=\"text-gray-400 text-[10px] sm:text-sm\">Page Views</span>\n              <Eye className=\"w-4 h-4 sm:w-5 sm:h-5 text-gray-400\" />\n            </div>\n            <div className=\"mt-auto space-y-1\">\n              <div className=\"text-base sm:text-3xl font-bold text-white\">\n                {trafficSummary.pageViews}\n              </div>\n              <div className=\"text-gray-500 text-[10px] sm:text-sm\">\n                {range === \"today\" ? \"Today\" : `Last ${range.replace(\"d\", \"\")} days`}\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"bg-zinc-900 border border-zinc-800/70 rounded-lg p-6\">\n          <h3 className=\"text-xl font-semibold text-white mb-4\">Daily Traffic</h3>\n          <TrafficChart data={trafficTrend} />\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\admin\\bank\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\admin\\bank\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\admin\\bank\\transfers\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\admin\\catalog\\components\\TagModals.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[238,241],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[238,241],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[800,803],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[800,803],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { Dispatch, SetStateAction } from \"react\";\n\nimport type { Brand, EditTarget } from \"../types\";\n\ntype TagModalsProps = {\n  showAddBrandModal: boolean;\n  showAddModelModal: boolean;\n  editTarget: EditTarget | null;\n  editDraft: any;\n  confirmTarget: EditTarget | null;\n  isSaving: boolean;\n  brands: Brand[];\n  modelTargetBrand: Brand | null;\n  newBrand: { label: string };\n  newModel: { brandId: string; label: string };\n  setNewBrand: Dispatch<SetStateAction<{ label: string }>>;\n  setNewModel: Dispatch<SetStateAction<{ brandId: string; label: string }>>;\n  setShowAddBrandModal: (value: boolean) => void;\n  setShowAddModelModal: (value: boolean) => void;\n  setModelTargetBrand: (value: Brand | null) => void;\n  setEditTarget: (value: EditTarget | null) => void;\n  setEditDraft: (value: any) => void;\n  setConfirmTarget: (value: EditTarget | null) => void;\n  onCreateBrand: () => void;\n  onCreateModel: () => void;\n  onSaveEdit: () => void;\n  onConfirmDelete: () => void;\n  toTitleCase: (value: string) => string;\n};\n\nexport function TagModals({\n  showAddBrandModal,\n  showAddModelModal,\n  editTarget,\n  editDraft,\n  confirmTarget,\n  isSaving,\n  brands,\n  modelTargetBrand,\n  newBrand,\n  newModel,\n  setNewBrand,\n  setNewModel,\n  setShowAddBrandModal,\n  setShowAddModelModal,\n  setModelTargetBrand,\n  setEditTarget,\n  setEditDraft,\n  setConfirmTarget,\n  onCreateBrand,\n  onCreateModel,\n  onSaveEdit,\n  onConfirmDelete,\n  toTitleCase,\n}: TagModalsProps) {\n  return (\n    <>\n      {showAddBrandModal && (\n        <div\n          className=\"fixed inset-0 bg-black/70 z-50 flex items-center justify-center px-4\"\n          onClick={() => setShowAddBrandModal(false)}\n        >\n          <div\n            className=\"bg-zinc-900 border border-zinc-800/70 rounded-lg w-full max-w-lg p-6 space-y-4\"\n            onClick={(event) => event.stopPropagation()}\n          >\n            <div className=\"flex items-center justify-between\">\n              <h3 className=\"text-lg font-semibold text-white\">Add brand</h3>\n              <button\n                onClick={() => setShowAddBrandModal(false)}\n                className=\"text-gray-400 hover:text-white\"\n              >\n                Close\n              </button>\n            </div>\n\n            <div className=\"space-y-3\">\n              <input\n                value={newBrand.label}\n                onChange={(e) =>\n                  setNewBrand((prev) => ({ ...prev, label: e.target.value }))\n                }\n                onBlur={(e) =>\n                  setNewBrand((prev) => ({ ...prev, label: toTitleCase(e.target.value) }))\n                }\n                placeholder=\"Brand label (e.g., Air Jordan)\"\n                className=\"w-full bg-zinc-900 border border-zinc-800/70 text-white px-3 py-2\"\n              />\n            </div>\n\n            <div className=\"flex items-center justify-end gap-3\">\n              <button\n                onClick={() => setShowAddBrandModal(false)}\n                className=\"bg-zinc-800 hover:bg-zinc-700 text-white rounded px-4 py-2\"\n              >\n                Cancel\n              </button>\n              <button\n                onClick={onCreateBrand}\n                className=\"bg-red-600 hover:bg-red-700 text-white rounded px-4 py-2\"\n              >\n                Add Brand\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {showAddModelModal && modelTargetBrand && (\n        <div\n          className=\"fixed inset-0 bg-black/70 z-50 flex items-center justify-center px-4\"\n          onClick={() => {\n            setShowAddModelModal(false);\n            setModelTargetBrand(null);\n          }}\n        >\n          <div\n            className=\"bg-zinc-900 border border-zinc-800/70 rounded-lg w-full max-w-lg p-6 space-y-4\"\n            onClick={(event) => event.stopPropagation()}\n          >\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <h3 className=\"text-lg font-semibold text-white\">Add Model</h3>\n                <p className=\"text-xs text-gray-500\">\n                  Brand: {modelTargetBrand.canonical_label}\n                </p>\n              </div>\n              <button\n                onClick={() => {\n                  setShowAddModelModal(false);\n                  setModelTargetBrand(null);\n                }}\n                className=\"text-gray-400 hover:text-white\"\n              >\n                Close\n              </button>\n            </div>\n\n            <div className=\"space-y-3\">\n              <input\n                value={newModel.label}\n                onChange={(e) =>\n                  setNewModel((prev) => ({ ...prev, label: e.target.value }))\n                }\n                onBlur={(e) =>\n                  setNewModel((prev) => ({ ...prev, label: toTitleCase(e.target.value) }))\n                }\n                placeholder=\"Model label (e.g., Retro 3)\"\n                className=\"w-full bg-zinc-900 border border-zinc-800/70 text-white px-3 py-2\"\n              />\n            </div>\n\n            <div className=\"flex items-center justify-end gap-3\">\n              <button\n                onClick={() => {\n                  setShowAddModelModal(false);\n                  setModelTargetBrand(null);\n                }}\n                className=\"bg-zinc-800 hover:bg-zinc-700 text-white rounded px-4 py-2\"\n              >\n                Cancel\n              </button>\n              <button\n                onClick={onCreateModel}\n                className=\"bg-red-600 hover:bg-red-700 text-white rounded px-4 py-2\"\n              >\n                Add Model\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {editTarget && editDraft && (\n        <div className=\"fixed inset-0 bg-black/70 z-50 flex items-center justify-center px-4\">\n          <div\n            className=\"bg-zinc-900 border border-zinc-800/70 rounded-lg w-full max-w-lg p-6 space-y-4\"\n            onClick={(event) => event.stopPropagation()}\n          >\n            <div className=\"flex items-center justify-between\">\n              <h3 className=\"text-lg font-semibold text-white\">Edit {editTarget.type}</h3>\n              <button\n                onClick={() => setEditTarget(null)}\n                className=\"text-gray-400 hover:text-white\"\n              >\n                Close\n              </button>\n            </div>\n\n            {editTarget.type === \"brand\" && (\n              <div className=\"space-y-3\">\n                <input\n                  value={editDraft.canonical_label}\n                  onChange={(e) =>\n                    setEditDraft({ ...editDraft, canonical_label: e.target.value })\n                  }\n                  placeholder=\"Brand label\"\n                  className=\"w-full bg-zinc-800 text-white px-3 py-2 rounded\"\n                />\n                <div className=\"flex flex-wrap gap-4 text-sm text-gray-300\">\n                  <label className=\"flex items-center gap-2\">\n                    <input\n                      type=\"checkbox\"\n                      className=\"rdk-checkbox\"\n                      checked={editDraft.is_active}\n                      onChange={(e) =>\n                        setEditDraft({ ...editDraft, is_active: e.target.checked })\n                      }\n                    />\n                    Active\n                  </label>\n                  <label className=\"flex items-center gap-2\">\n                    <input\n                      type=\"checkbox\"\n                      className=\"rdk-checkbox\"\n                      checked={editDraft.is_verified}\n                      onChange={(e) =>\n                        setEditDraft({ ...editDraft, is_verified: e.target.checked })\n                      }\n                    />\n                    Verified\n                  </label>\n                </div>\n              </div>\n            )}\n\n            {editTarget.type === \"model\" && (\n              <div className=\"space-y-3\">\n                <select\n                  value={editDraft.brand_id}\n                  onChange={(e) =>\n                    setEditDraft({ ...editDraft, brand_id: e.target.value })\n                  }\n                  className=\"w-full bg-zinc-800 text-white px-3 py-2 rounded\"\n                >\n                  {brands.map((brand) => (\n                    <option key={brand.id} value={brand.id}>\n                      {brand.canonical_label}\n                    </option>\n                  ))}\n                </select>\n                <input\n                  value={editDraft.canonical_label}\n                  onChange={(e) =>\n                    setEditDraft({ ...editDraft, canonical_label: e.target.value })\n                  }\n                  placeholder=\"Model label\"\n                  className=\"w-full bg-zinc-800 text-white px-3 py-2 rounded\"\n                />\n                <div className=\"flex flex-wrap gap-4 text-sm text-gray-300\">\n                  <label className=\"flex items-center gap-2\">\n                    <input\n                      type=\"checkbox\"\n                      className=\"rdk-checkbox\"\n                      checked={editDraft.is_active}\n                      onChange={(e) =>\n                        setEditDraft({ ...editDraft, is_active: e.target.checked })\n                      }\n                    />\n                    Active\n                  </label>\n                  <label className=\"flex items-center gap-2\">\n                    <input\n                      type=\"checkbox\"\n                      className=\"rdk-checkbox\"\n                      checked={editDraft.is_verified}\n                      onChange={(e) =>\n                        setEditDraft({ ...editDraft, is_verified: e.target.checked })\n                      }\n                    />\n                    Verified\n                  </label>\n                </div>\n              </div>\n            )}\n\n            {editTarget.type === \"alias\" && (\n              <div className=\"space-y-3\">\n                <input\n                  value={editDraft.alias_label}\n                  onChange={(e) =>\n                    setEditDraft({ ...editDraft, alias_label: e.target.value })\n                  }\n                  placeholder=\"Alias\"\n                  className=\"w-full bg-zinc-800 text-white px-3 py-2 rounded\"\n                />\n                <input\n                  value={editDraft.priority ?? 0}\n                  onChange={(e) =>\n                    setEditDraft({ ...editDraft, priority: Number(e.target.value) })\n                  }\n                  placeholder=\"Priority\"\n                  className=\"w-full bg-zinc-800 text-white px-3 py-2 rounded\"\n                />\n                <label className=\"flex items-center gap-2 text-sm text-gray-300\">\n                  <input\n                    type=\"checkbox\"\n                    className=\"rdk-checkbox\"\n                    checked={editDraft.is_active}\n                    onChange={(e) =>\n                      setEditDraft({ ...editDraft, is_active: e.target.checked })\n                    }\n                  />\n                  Active\n                </label>\n              </div>\n            )}\n\n            <div className=\"flex items-center justify-end gap-3\">\n              <button\n                onClick={() => setEditTarget(null)}\n                className=\"bg-zinc-800 hover:bg-zinc-700 text-white rounded px-4 py-2\"\n              >\n                Cancel\n              </button>\n              <button\n                onClick={onSaveEdit}\n                disabled={isSaving}\n                className=\"bg-red-600 hover:bg-red-700 text-white rounded px-4 py-2 disabled:bg-gray-600\"\n              >\n                {isSaving ? \"Saving...\" : \"Save\"}\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {confirmTarget && (\n        <div className=\"fixed inset-0 bg-black/70 z-50 flex items-center justify-center px-4\">\n          <div\n            className=\"bg-zinc-900 border border-zinc-800/70 rounded-lg w-full max-w-md p-6 space-y-4\"\n            onClick={(event) => event.stopPropagation()}\n          >\n            <h3 className=\"text-lg font-semibold text-white\">\n              Delete {confirmTarget.type}\n            </h3>\n            <p className=\"text-sm text-gray-400\">\n              This will disable the item (soft delete). You can re-enable it later by\n              editing the record.\n            </p>\n            <div className=\"flex items-center justify-end gap-3\">\n              <button\n                onClick={() => setConfirmTarget(null)}\n                className=\"bg-zinc-800 hover:bg-zinc-700 text-white rounded px-4 py-2\"\n              >\n                Cancel\n              </button>\n              <button\n                onClick={onConfirmDelete}\n                disabled={isSaving}\n                className=\"bg-red-600 hover:bg-red-700 text-white rounded px-4 py-2 disabled:bg-gray-600\"\n              >\n                {isSaving ? \"Deleting...\" : \"Delete\"}\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\admin\\catalog\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":99,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3015,3018],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3015,3018],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { Fragment, useEffect, useMemo, useState } from \"react\";\nimport { ChevronDown, MoreVertical, Search } from \"lucide-react\";\n\nimport { logError } from \"@/lib/log\";\nimport { RdkSelect } from \"@/components/ui/Select\";\n\nimport type {\n  ActiveTab,\n  Alias,\n  Brand,\n  BrandGroup,\n  Candidate,\n  EditTarget,\n  Model,\n} from \"./types\";\nimport { TagModals } from \"./components/TagModals\";\n\nconst tabs: Array<{ key: ActiveTab; label: string }> = [\n  { key: \"brands\", label: \"Tags\" },\n  { key: \"aliases\", label: \"Aliases\" },\n  { key: \"candidates\", label: \"Candidates\" },\n];\n\nconst emptyDraft = {\n  brand: { label: \"\" },\n  model: { brandId: \"\", label: \"\" },\n  alias: {\n    entityType: \"brand\" as \"brand\" | \"model\",\n    entityId: \"\",\n    label: \"\",\n    priority: \"0\",\n  },\n};\n\nconst normalizeWhitespace = (value: string) => value.trim().replace(/\\s+/g, \" \");\n\nconst toTitleCase = (value: string) =>\n  normalizeWhitespace(value)\n    .split(\" \")\n    .map((word) => {\n      if (word.toUpperCase() === word) {\n        return word;\n      }\n      if (word.toLowerCase() === word) {\n        return word.charAt(0).toUpperCase() + word.slice(1);\n      }\n      return word;\n    })\n    .join(\" \");\n\nconst normalizeLabel = (value: string) => normalizeWhitespace(value).toLowerCase();\n\nfunction StatusPill({ active }: { active: boolean }) {\n  return (\n    <span\n      className={`inline-flex items-center px-1.5 py-0.5 rounded-full text-[10px] sm:text-xs whitespace-nowrap ${\n        active ? \"bg-emerald-500/10 text-emerald-200\" : \"bg-zinc-800 text-gray-400\"\n      }`}\n    >\n      {active ? \"Active\" : \"Inactive\"}\n    </span>\n  );\n}\n\nfunction VerifiedPill({ verified }: { verified: boolean }) {\n  return (\n    <span\n      className={`inline-flex items-center px-1.5 py-0.5 rounded-full text-[10px] sm:text-xs whitespace-nowrap ${\n        verified ? \"bg-blue-500/10 text-blue-200\" : \"bg-zinc-800 text-gray-400\"\n      }`}\n    >\n      {verified ? \"Verified\" : \"Unverified\"}\n    </span>\n  );\n}\n\nexport default function TagsPage() {\n  const [groups, setGroups] = useState<BrandGroup[]>([]);\n  const [brands, setBrands] = useState<Brand[]>([]);\n  const [models, setModels] = useState<Model[]>([]);\n  const [aliases, setAliases] = useState<Alias[]>([]);\n  const [candidates, setCandidates] = useState<Candidate[]>([]);\n  const [message, setMessage] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(true);\n\n  const [activeTab, setActiveTab] = useState<ActiveTab>(\"brands\");\n  const [query, setQuery] = useState(\"\");\n  const [showInactive, setShowInactive] = useState(false);\n  const [showUnverified, setShowUnverified] = useState(true);\n  const [openMenuKey, setOpenMenuKey] = useState<string | null>(null);\n\n  const [newBrand, setNewBrand] = useState(emptyDraft.brand);\n  const [newModel, setNewModel] = useState(emptyDraft.model);\n  const [newAlias, setNewAlias] = useState(emptyDraft.alias);\n\n  const [editTarget, setEditTarget] = useState<EditTarget | null>(null);\n  const [editDraft, setEditDraft] = useState<any>(null);\n  const [confirmTarget, setConfirmTarget] = useState<EditTarget | null>(null);\n  const [isSaving, setIsSaving] = useState(false);\n  const [showAddBrandModal, setShowAddBrandModal] = useState(false);\n  const [showAddModelModal, setShowAddModelModal] = useState(false);\n  const [modelTargetBrand, setModelTargetBrand] = useState<Brand | null>(null);\n  const [expandedBrands, setExpandedBrands] = useState<Record<string, boolean>>({});\n\n  const normalizedQuery = query.trim().toLowerCase();\n  const matchesQuery = (value: string) =>\n    normalizedQuery.length === 0 || value.toLowerCase().includes(normalizedQuery);\n\n  const brandMap = useMemo(\n    () => new Map(brands.map((brand) => [brand.id, brand])),\n    [brands],\n  );\n  const modelMap = useMemo(\n    () => new Map(models.map((model) => [model.id, model])),\n    [models],\n  );\n\n  const defaultGroupId = useMemo(() => {\n    if (groups.length === 0) {\n      return null;\n    }\n    const activeGroups = groups.filter((group) => group.is_active);\n    const preferred =\n      activeGroups.find((group) => group.key === \"other\") ?? activeGroups[0];\n    return preferred?.id ?? groups[0]?.id ?? null;\n  }, [groups]);\n\n  const filteredModels = useMemo(\n    () =>\n      models.filter((model) => {\n        if (!showInactive && !model.is_active) {\n          return false;\n        }\n        if (!showUnverified && !model.is_verified) {\n          return false;\n        }\n        const brandLabel = brandMap.get(model.brand_id)?.canonical_label ?? \"\";\n        if (!matchesQuery(model.canonical_label) && !matchesQuery(brandLabel)) {\n          return false;\n        }\n        return true;\n      }),\n    [models, showInactive, showUnverified, normalizedQuery, brandMap],\n  );\n\n  const filteredModelsByBrandId = useMemo(() => {\n    const map: Record<string, Model[]> = {};\n    filteredModels.forEach((model) => {\n      if (!map[model.brand_id]) {\n        map[model.brand_id] = [];\n      }\n      map[model.brand_id].push(model);\n    });\n    Object.keys(map).forEach((brandId) => {\n      map[brandId].sort((a, b) => a.canonical_label.localeCompare(b.canonical_label));\n    });\n    return map;\n  }, [filteredModels]);\n\n  const filteredBrands = useMemo(\n    () =>\n      brands.filter((brand) => {\n        if (!showInactive && !brand.is_active) {\n          return false;\n        }\n        if (!showUnverified && !brand.is_verified) {\n          return false;\n        }\n        const matchesBrand = matchesQuery(brand.canonical_label);\n        const matchesModel = (filteredModelsByBrandId[brand.id]?.length ?? 0) > 0;\n        if (!matchesBrand && !matchesModel) {\n          return false;\n        }\n        return true;\n      }),\n    [brands, showInactive, showUnverified, normalizedQuery, filteredModelsByBrandId],\n  );\n\n  const filteredAliases = useMemo(\n    () =>\n      aliases.filter((alias) => {\n        if (!showInactive && !alias.is_active) {\n          return false;\n        }\n        const targetLabel =\n          alias.entity_type === \"brand\"\n            ? (brandMap.get(alias.brand_id ?? \"\")?.canonical_label ?? \"\")\n            : (modelMap.get(alias.model_id ?? \"\")?.canonical_label ?? \"\");\n        if (!matchesQuery(alias.alias_label) && !matchesQuery(targetLabel)) {\n          return false;\n        }\n        return true;\n      }),\n    [aliases, showInactive, normalizedQuery, brandMap, modelMap],\n  );\n\n  const filteredCandidates = useMemo(\n    () =>\n      candidates.filter((candidate) => {\n        const brandLabel =\n          brandMap.get(candidate.parent_brand_id ?? \"\")?.canonical_label ?? \"\";\n        if (!matchesQuery(candidate.raw_text) && !matchesQuery(brandLabel)) {\n          return false;\n        }\n        return true;\n      }),\n    [candidates, normalizedQuery, brandMap],\n  );\n\n  const loadAll = async () => {\n    setIsLoading(true);\n    setMessage(\"\");\n    try {\n      const [groupsRes, brandsRes, modelsRes, aliasesRes, candidatesRes] =\n        await Promise.all([\n          fetch(\"/api/admin/catalog/brand-groups?includeInactive=1\"),\n          fetch(\"/api/admin/catalog/brands?includeInactive=1\"),\n          fetch(\"/api/admin/catalog/models?includeInactive=1\"),\n          fetch(\"/api/admin/catalog/aliases?includeInactive=1\"),\n          fetch(\"/api/admin/catalog/candidates?status=new\"),\n        ]);\n\n      const groupsData = await groupsRes.json();\n      const brandsData = await brandsRes.json();\n      const modelsData = await modelsRes.json();\n      const aliasesData = await aliasesRes.json();\n      const candidatesData = await candidatesRes.json();\n\n      setGroups(groupsData.groups || []);\n      setBrands(brandsData.brands || []);\n      setModels(modelsData.models || []);\n      setAliases(aliasesData.aliases || []);\n      setCandidates(candidatesData.candidates || []);\n    } catch (error) {\n      logError(error, { layer: \"frontend\", event: \"admin_load_catalog\" });\n      setMessage(\"Failed to load tag data.\");\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    loadAll();\n  }, []);\n\n  useEffect(() => {\n    if (!editTarget) {\n      setEditDraft(null);\n      return;\n    }\n\n    if (editTarget.type === \"brand\") {\n      setEditDraft({\n        canonical_label: editTarget.item.canonical_label,\n        is_active: editTarget.item.is_active,\n        is_verified: editTarget.item.is_verified,\n      });\n    }\n    if (editTarget.type === \"model\") {\n      setEditDraft({\n        canonical_label: editTarget.item.canonical_label,\n        brand_id: editTarget.item.brand_id,\n        is_active: editTarget.item.is_active,\n        is_verified: editTarget.item.is_verified,\n      });\n    }\n    if (editTarget.type === \"alias\") {\n      setEditDraft({\n        alias_label: editTarget.item.alias_label,\n        priority: editTarget.item.priority ?? 0,\n        is_active: editTarget.item.is_active,\n      });\n    }\n  }, [editTarget]);\n\n  const toggleMenu = (key: string) => {\n    setOpenMenuKey((prev) => (prev === key ? null : key));\n  };\n\n  const toggleBrandExpansion = (brandId: string) => {\n    setExpandedBrands((prev) => ({ ...prev, [brandId]: !prev[brandId] }));\n  };\n\n  const openAddBrandModal = () => {\n    setNewBrand(emptyDraft.brand);\n    setShowAddBrandModal(true);\n  };\n\n  const openAddModelModal = (brand: Brand) => {\n    setModelTargetBrand(brand);\n    setNewModel({ ...emptyDraft.model, brandId: brand.id });\n    setShowAddModelModal(true);\n  };\n\n  const handleCreateBrand = async () => {\n    if (!newBrand.label.trim()) {\n      setMessage(\"Brand label is required.\");\n      return;\n    }\n    if (!defaultGroupId) {\n      setMessage(\"Unable to create brand: missing default configuration.\");\n      return;\n    }\n    const formattedLabel = toTitleCase(newBrand.label);\n    const normalizedLabel = normalizeLabel(formattedLabel);\n    const isDuplicate = brands.some(\n      (brand) => normalizeLabel(brand.canonical_label) === normalizedLabel,\n    );\n    if (isDuplicate) {\n      setMessage(\"Brand already exists.\");\n      return;\n    }\n    const response = await fetch(\"/api/admin/catalog/brands\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ groupId: defaultGroupId, canonicalLabel: formattedLabel }),\n    });\n    if (response.ok) {\n      setNewBrand(emptyDraft.brand);\n      setShowAddBrandModal(false);\n      await loadAll();\n    } else {\n      setMessage(\"Failed to create brand.\");\n    }\n  };\n\n  const handleCreateModel = async () => {\n    if (!newModel.brandId || !newModel.label.trim()) {\n      setMessage(\"Brand and model label are required.\");\n      return;\n    }\n    const formattedLabel = toTitleCase(newModel.label);\n    const normalizedLabel = normalizeLabel(formattedLabel);\n    const isDuplicate = models.some(\n      (model) =>\n        model.brand_id === newModel.brandId &&\n        normalizeLabel(model.canonical_label) === normalizedLabel,\n    );\n    if (isDuplicate) {\n      setMessage(\"Model already exists for this brand.\");\n      return;\n    }\n    const response = await fetch(\"/api/admin/catalog/models\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ brandId: newModel.brandId, canonicalLabel: formattedLabel }),\n    });\n    if (response.ok) {\n      setNewModel(emptyDraft.model);\n      setShowAddModelModal(false);\n      setModelTargetBrand(null);\n      await loadAll();\n    } else {\n      setMessage(\"Failed to create model.\");\n    }\n  };\n\n  const handleCreateAlias = async () => {\n    if (!newAlias.label.trim() || !newAlias.entityId) {\n      setMessage(\"Alias label and entity are required.\");\n      return;\n    }\n    const normalizedLabel = normalizeLabel(newAlias.label);\n    const isDuplicate = aliases.some((alias) => {\n      const targetId = alias.entity_type === \"brand\" ? alias.brand_id : alias.model_id;\n      return (\n        alias.entity_type === newAlias.entityType &&\n        targetId === newAlias.entityId &&\n        normalizeLabel(alias.alias_label) === normalizedLabel\n      );\n    });\n    if (isDuplicate) {\n      setMessage(\"Alias already exists for that item.\");\n      return;\n    }\n    const response = await fetch(\"/api/admin/catalog/aliases\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({\n        entityType: newAlias.entityType,\n        brandId: newAlias.entityType === \"brand\" ? newAlias.entityId : null,\n        modelId: newAlias.entityType === \"model\" ? newAlias.entityId : null,\n        aliasLabel: newAlias.label.trim(),\n        priority: Number(newAlias.priority || 0),\n      }),\n    });\n    if (response.ok) {\n      setNewAlias(emptyDraft.alias);\n      await loadAll();\n    } else {\n      setMessage(\"Failed to create alias.\");\n    }\n  };\n\n  const handleAcceptCandidate = async (candidate: Candidate) => {\n    if (candidate.entity_type === \"brand\" && !defaultGroupId) {\n      setMessage(\"Unable to accept brand candidate: missing default configuration.\");\n      return;\n    }\n    const payload =\n      candidate.entity_type === \"brand\" && defaultGroupId\n        ? { groupId: defaultGroupId }\n        : {};\n    const response = await fetch(`/api/admin/catalog/candidates/${candidate.id}/accept`, {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify(payload),\n    });\n    if (response.ok) {\n      await loadAll();\n    } else {\n      setMessage(\"Failed to accept candidate.\");\n    }\n  };\n\n  const handleRejectCandidate = async (candidate: Candidate) => {\n    const response = await fetch(`/api/admin/catalog/candidates/${candidate.id}/reject`, {\n      method: \"POST\",\n    });\n    if (response.ok) {\n      await loadAll();\n    } else {\n      setMessage(\"Failed to reject candidate.\");\n    }\n  };\n\n  const handleSaveEdit = async () => {\n    if (!editTarget || !editDraft) {\n      return;\n    }\n    setMessage(\"\");\n    if (editTarget.type === \"brand\") {\n      const normalizedLabel = normalizeLabel(editDraft.canonical_label ?? \"\");\n      if (!normalizedLabel) {\n        setMessage(\"Brand label is required.\");\n        return;\n      }\n      const isDuplicate = brands.some(\n        (brand) =>\n          brand.id !== editTarget.item.id &&\n          normalizeLabel(brand.canonical_label) === normalizedLabel,\n      );\n      if (isDuplicate) {\n        setMessage(\"Brand already exists.\");\n        return;\n      }\n    }\n\n    if (editTarget.type === \"model\") {\n      const normalizedLabel = normalizeLabel(editDraft.canonical_label ?? \"\");\n      if (!normalizedLabel || !editDraft.brand_id) {\n        setMessage(\"Brand and model label are required.\");\n        return;\n      }\n      const isDuplicate = models.some(\n        (model) =>\n          model.id !== editTarget.item.id &&\n          model.brand_id === editDraft.brand_id &&\n          normalizeLabel(model.canonical_label) === normalizedLabel,\n      );\n      if (isDuplicate) {\n        setMessage(\"Model already exists for this brand.\");\n        return;\n      }\n    }\n\n    if (editTarget.type === \"alias\") {\n      const normalizedLabel = normalizeLabel(editDraft.alias_label ?? \"\");\n      if (!normalizedLabel) {\n        setMessage(\"Alias label is required.\");\n        return;\n      }\n      const targetId =\n        editTarget.item.entity_type === \"brand\"\n          ? editTarget.item.brand_id\n          : editTarget.item.model_id;\n      const isDuplicate = aliases.some((alias) => {\n        const aliasTargetId =\n          alias.entity_type === \"brand\" ? alias.brand_id : alias.model_id;\n        return (\n          alias.id !== editTarget.item.id &&\n          alias.entity_type === editTarget.item.entity_type &&\n          aliasTargetId === targetId &&\n          normalizeLabel(alias.alias_label) === normalizedLabel\n        );\n      });\n      if (isDuplicate) {\n        setMessage(\"Alias already exists for that item.\");\n        return;\n      }\n    }\n\n    setIsSaving(true);\n    try {\n      if (editTarget.type === \"brand\") {\n        await fetch(`/api/admin/catalog/brands/${editTarget.item.id}`, {\n          method: \"PATCH\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({\n            canonicalLabel: editDraft.canonical_label,\n            isActive: editDraft.is_active,\n            isVerified: editDraft.is_verified,\n          }),\n        });\n      }\n\n      if (editTarget.type === \"model\") {\n        await fetch(`/api/admin/catalog/models/${editTarget.item.id}`, {\n          method: \"PATCH\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({\n            brandId: editDraft.brand_id,\n            canonicalLabel: editDraft.canonical_label,\n            isActive: editDraft.is_active,\n            isVerified: editDraft.is_verified,\n          }),\n        });\n      }\n\n      if (editTarget.type === \"alias\") {\n        await fetch(`/api/admin/catalog/aliases/${editTarget.item.id}`, {\n          method: \"PATCH\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({\n            aliasLabel: editDraft.alias_label,\n            priority: editDraft.priority ?? 0,\n            isActive: editDraft.is_active,\n          }),\n        });\n      }\n\n      await loadAll();\n      setEditTarget(null);\n    } catch (error) {\n      logError(error, { layer: \"frontend\", event: \"admin_save_catalog_edit\" });\n      setMessage(\"Failed to update tag entry.\");\n    } finally {\n      setIsSaving(false);\n    }\n  };\n\n  const handleConfirmDelete = async () => {\n    if (!confirmTarget) {\n      return;\n    }\n    setIsSaving(true);\n    setMessage(\"\");\n    try {\n      if (confirmTarget.type === \"brand\") {\n        await fetch(`/api/admin/catalog/brands/${confirmTarget.item.id}`, {\n          method: \"PATCH\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({ isActive: false }),\n        });\n      }\n      if (confirmTarget.type === \"model\") {\n        await fetch(`/api/admin/catalog/models/${confirmTarget.item.id}`, {\n          method: \"PATCH\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({ isActive: false }),\n        });\n      }\n      if (confirmTarget.type === \"alias\") {\n        await fetch(`/api/admin/catalog/aliases/${confirmTarget.item.id}`, {\n          method: \"PATCH\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({ isActive: false }),\n        });\n      }\n      await loadAll();\n      setConfirmTarget(null);\n    } catch (error) {\n      logError(error, { layer: \"frontend\", event: \"admin_delete_catalog\" });\n      setMessage(\"Failed to delete tag entry.\");\n    } finally {\n      setIsSaving(false);\n    }\n  };\n\n  const resolveBrandLabel = (brandId?: string | null) =>\n    brandMap.get(brandId ?? \"\")?.canonical_label || \"Unknown\";\n\n  const resolveModelLabel = (modelId?: string | null) =>\n    modelMap.get(modelId ?? \"\")?.canonical_label || \"Unknown\";\n\n  const renderMenu = (key: string, onEdit: () => void, onDelete: () => void) => (\n    <div\n      className=\"relative\"\n      onClick={(event) => {\n        event.stopPropagation();\n      }}\n    >\n      <button\n        type=\"button\"\n        onClick={() => toggleMenu(key)}\n        className=\"text-gray-400 hover:text-white p-1\"\n        aria-label=\"Open actions\"\n      >\n        <MoreVertical className=\"w-4 h-4\" />\n      </button>\n      {openMenuKey === key && (\n        <div className=\"absolute right-0 mt-2 w-40 bg-zinc-950 border border-zinc-800/70 shadow-xl z-30\">\n          <button\n            type=\"button\"\n            onClick={() => {\n              setOpenMenuKey(null);\n              onEdit();\n            }}\n            className=\"w-full text-left px-3 py-2 text-sm text-gray-200 hover:bg-zinc-800\"\n          >\n            Edit\n          </button>\n          <button\n            type=\"button\"\n            onClick={() => {\n              setOpenMenuKey(null);\n              onDelete();\n            }}\n            className=\"w-full text-left px-3 py-2 text-sm text-red-400 hover:bg-zinc-800\"\n          >\n            Delete\n          </button>\n        </div>\n      )}\n    </div>\n  );\n\n  return (\n    <div\n      className=\"space-y-6\"\n      onClick={() => {\n        setOpenMenuKey(null);\n      }}\n    >\n      <div className=\"flex flex-wrap items-start justify-between gap-4\">\n        <div>\n          <h1 className=\"text-2xl sm:text-3xl font-bold text-white\">Tags Manager</h1>\n          <p className=\"text-sm sm:text-base text-gray-400\">\n            Verified means the brand or model is confirmed and trusted for storefront\n            filters. Unverified entries are allowed but treated as provisional.\n          </p>\n        </div>\n      </div>\n\n      {message && <div className=\"text-sm text-gray-400\">{message}</div>}\n\n      <div className=\"bg-zinc-900 border border-zinc-800/70 p-4 sm:p-5\">\n        <details className=\"group\">\n          <summary className=\"cursor-pointer list-none text-xs sm:text-sm text-gray-200 font-semibold flex items-center justify-between bg-zinc-950/60 border border-zinc-800/70 px-3 sm:px-4 py-2.5 sm:py-3\">\n            <span>Info key: how the tags system works</span>\n            <span className=\"text-xs text-gray-500 group-open:hidden\">Show</span>\n            <span className=\"text-xs text-gray-500 hidden group-open:inline\">Hide</span>\n          </summary>\n          <div className=\"mt-4 grid grid-cols-1 lg:grid-cols-2 gap-3 text-[12px] sm:text-sm text-gray-300\">\n            <div className=\"bg-zinc-950/50 border border-zinc-800/70 border-l-2 border-l-red-600 p-2.5 sm:p-3\">\n              <div className=\"text-[10px] sm:text-xs uppercase tracking-wide text-gray-500\">\n                Brands\n              </div>\n              <div>Canonical brand labels used for products, filters, and parsing.</div>\n            </div>\n            <div className=\"bg-zinc-950/50 border border-zinc-800/70 border-l-2 border-l-red-600 p-2.5 sm:p-3\">\n              <div className=\"text-[10px] sm:text-xs uppercase tracking-wide text-gray-500\">\n                Models\n              </div>\n              <div>\n                Canonical sneaker model labels tied to a brand. Only used when category is\n                sneakers.\n              </div>\n            </div>\n            <div className=\"bg-zinc-950/50 border border-zinc-800/70 border-l-2 border-l-red-600 p-2.5 sm:p-3\">\n              <div className=\"text-[10px] sm:text-xs uppercase tracking-wide text-gray-500\">\n                Aliases\n              </div>\n              <div>\n                Alternate spellings or shorthand that map to brands/models. Used by the\n                parser.\n              </div>\n            </div>\n            <div className=\"bg-zinc-950/50 border border-zinc-800/70 border-l-2 border-l-red-600 p-2.5 sm:p-3\">\n              <div className=\"text-[10px] sm:text-xs uppercase tracking-wide text-gray-500\">\n                Alias Priority\n              </div>\n              <div>\n                When multiple aliases match, higher priority wins over shorter or\n                lower-priority matches.\n              </div>\n            </div>\n            <div className=\"bg-zinc-950/50 border border-zinc-800/70 border-l-2 border-l-red-600 p-2.5 sm:p-3\">\n              <div className=\"text-[10px] sm:text-xs uppercase tracking-wide text-gray-500\">\n                Candidates\n              </div>\n              <div>\n                Unknown brands/models created during product entry. Review and accept to\n                add them.\n              </div>\n            </div>\n            <div className=\"bg-zinc-950/50 border border-zinc-800/70 border-l-2 border-l-red-600 p-2.5 sm:p-3\">\n              <div className=\"text-[10px] sm:text-xs uppercase tracking-wide text-gray-500\">\n                Verified\n              </div>\n              <div>\n                Trusted entries that appear cleanly in storefront filters. Unverified is\n                provisional.\n              </div>\n            </div>\n            <div className=\"bg-zinc-950/50 border border-zinc-800/70 border-l-2 border-l-red-600 p-2.5 sm:p-3\">\n              <div className=\"text-[10px] sm:text-xs uppercase tracking-wide text-gray-500\">\n                Active\n              </div>\n              <div>\n                Active entries are used by the parser and UI. Inactive hides them without\n                deleting.\n              </div>\n            </div>\n            <div className=\"bg-zinc-950/50 border border-zinc-800/70 border-l-2 border-l-red-600 p-2.5 sm:p-3\">\n              <div className=\"text-[10px] sm:text-xs uppercase tracking-wide text-gray-500\">\n                Title Parsing\n              </div>\n              <div>\n                Full titles are parsed into brand, model, and name. Brand is found first,\n                then model (sneakers only), and the remainder becomes the name.\n              </div>\n            </div>\n          </div>\n        </details>\n      </div>\n\n      <div className=\"flex flex-col gap-4\">\n        <div className=\"flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between\">\n          <div className=\"flex items-center gap-2 bg-zinc-900 border border-zinc-800/70 px-2.5 sm:px-3 py-1.5 sm:py-2 w-full lg:max-w-md\">\n            <Search className=\"w-3.5 h-3.5 sm:w-4 sm:h-4 text-gray-500\" />\n            <input\n              value={query}\n              onChange={(e) => setQuery(e.target.value)}\n              placeholder=\"Search tags...\"\n              className=\"w-full bg-transparent text-[12px] sm:text-sm text-white placeholder:text-gray-500 outline-none\"\n            />\n          </div>\n          <div className=\"flex flex-wrap gap-3 text-[12px] sm:text-sm text-gray-300\">\n            <label className=\"flex items-center gap-1.5\">\n              <input\n                type=\"checkbox\"\n                className=\"rdk-checkbox scale-90\"\n                checked={showInactive}\n                onChange={(e) => setShowInactive(e.target.checked)}\n              />\n              Show inactive\n            </label>\n            <label className=\"flex items-center gap-1.5\">\n              <input\n                type=\"checkbox\"\n                className=\"rdk-checkbox scale-90\"\n                checked={showUnverified}\n                onChange={(e) => setShowUnverified(e.target.checked)}\n              />\n              Show unverified\n            </label>\n          </div>\n        </div>\n\n        <div className=\"border-b border-zinc-800/70 flex flex-wrap gap-4 sm:gap-6\">\n          {tabs.map((tab) => (\n            <button\n              key={tab.key}\n              onClick={() => setActiveTab(tab.key)}\n              className={`py-2 sm:py-3 text-xs sm:text-sm font-medium transition-colors border-b-2 ${\n                activeTab === tab.key\n                  ? \"text-white border-red-600\"\n                  : \"text-gray-400 hover:text-white border-transparent\"\n              }`}\n            >\n              {tab.label}\n            </button>\n          ))}\n        </div>\n      </div>\n\n      {activeTab === \"brands\" && (\n        <section className=\"space-y-4\">\n          <div className=\"flex flex-wrap items-center justify-between gap-3\">\n            <h2 className=\"text-lg sm:text-xl font-semibold text-white\">Tags</h2>\n            <div className=\"flex items-center gap-3\">\n              <span className=\"text-[11px] sm:text-xs text-gray-500\">\n                {filteredBrands.length} brands\n              </span>\n              <button\n                type=\"button\"\n                onClick={openAddBrandModal}\n                className=\"bg-red-600 hover:bg-red-700 text-white font-semibold px-3 py-1.5 sm:px-4 sm:py-2 rounded text-[12px] sm:text-sm\"\n              >\n                Add Brands\n              </button>\n            </div>\n          </div>\n\n          <div className=\"bg-zinc-900 border border-zinc-800/70 rounded overflow-x-auto\">\n            {isLoading ? (\n              <div className=\"text-center py-12 text-gray-400\">Loading...</div>\n            ) : filteredBrands.length === 0 ? (\n              <div className=\"text-center py-12 text-gray-500\">No tags found.</div>\n            ) : (\n              <table className=\"w-full text-[12px] sm:text-sm\">\n                <thead>\n                  <tr className=\"border-b border-zinc-800/70 bg-zinc-800\">\n                    <th className=\"text-left text-gray-400 font-semibold p-3 sm:p-4\">\n                      Brand\n                    </th>\n                    <th className=\"hidden sm:table-cell p-3 sm:p-4\">\n                      <span className=\"sr-only\">Actions</span>\n                    </th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {filteredBrands.map((brand) => {\n                    const visibleModels = filteredModelsByBrandId[brand.id] ?? [];\n                    const isExpanded = expandedBrands[brand.id] ?? false;\n                    return (\n                      <Fragment key={brand.id}>\n                        <tr className=\"border-b border-zinc-800/70 hover:bg-zinc-800/60\">\n                          <td className=\"p-3 sm:p-4\">\n                            <div className=\"flex items-start sm:items-center gap-2\">\n                              <button\n                                type=\"button\"\n                                onClick={() => toggleBrandExpansion(brand.id)}\n                                className=\"text-gray-400 hover:text-white\"\n                                aria-label={`Toggle ${brand.canonical_label} models`}\n                              >\n                                <ChevronDown\n                                  className={`w-3.5 h-3.5 sm:w-4 sm:h-4 transition-transform ${\n                                    isExpanded ? \"rotate-180\" : \"\"\n                                  }`}\n                                />\n                              </button>\n                              <div className=\"flex-1 min-w-0\">\n                                <div className=\"flex items-start justify-between gap-2\">\n                                  <div className=\"min-w-0\">\n                                    <div className=\"flex items-center gap-1.5 min-w-0\">\n                                      <div className=\"text-white font-semibold truncate min-w-0\">\n                                        {brand.canonical_label}\n                                      </div>\n                                      <div className=\"hidden sm:flex items-center gap-1.5 shrink-0\">\n                                        <StatusPill active={brand.is_active} />\n                                        <VerifiedPill verified={brand.is_verified} />\n                                      </div>\n                                    </div>\n                                    <div className=\"mt-1 flex items-center gap-1.5 sm:hidden\">\n                                      <StatusPill active={brand.is_active} />\n                                      <VerifiedPill verified={brand.is_verified} />\n                                    </div>\n                                    <div className=\"text-xs text-gray-500\">\n                                      {visibleModels.length} model\n                                      {visibleModels.length === 1 ? \"\" : \"s\"}\n                                    </div>\n                                  </div>\n                                  <div className=\"flex items-center gap-2 sm:hidden shrink-0\">\n                                    <button\n                                      type=\"button\"\n                                      onClick={() => openAddModelModal(brand)}\n                                      className=\"bg-zinc-800 hover:bg-zinc-700 text-white text-[10px] font-semibold px-2.5 py-1.5 rounded whitespace-nowrap\"\n                                    >\n                                      Add Model\n                                    </button>\n                                    {renderMenu(\n                                      `brand-mobile-${brand.id}`,\n                                      () => setEditTarget({ type: \"brand\", item: brand }),\n                                      () =>\n                                        setConfirmTarget({ type: \"brand\", item: brand }),\n                                    )}\n                                  </div>\n                                </div>\n                              </div>\n                            </div>\n                          </td>\n                          <td className=\"hidden sm:table-cell p-3 sm:p-4\">\n                            <div className=\"flex items-center justify-end gap-2\">\n                              <button\n                                type=\"button\"\n                                onClick={() => openAddModelModal(brand)}\n                                className=\"bg-zinc-800 hover:bg-zinc-700 text-white text-[10px] sm:text-xs font-semibold px-2.5 py-1.5 sm:px-3 sm:py-2 rounded whitespace-nowrap\"\n                              >\n                                Add Model\n                              </button>\n                              {renderMenu(\n                                `brand-${brand.id}`,\n                                () => setEditTarget({ type: \"brand\", item: brand }),\n                                () => setConfirmTarget({ type: \"brand\", item: brand }),\n                              )}\n                            </div>\n                          </td>\n                        </tr>\n                        {isExpanded && (\n                          <tr className=\"border-b border-zinc-800/70 bg-zinc-900/40\">\n                            <td className=\"p-3 sm:p-4\" colSpan={2}>\n                              <div className=\"text-xs uppercase tracking-wide text-gray-500 mb-2\">\n                                Models\n                              </div>\n                              {visibleModels.length === 0 ? (\n                                <div className=\"text-xs text-gray-500\">\n                                  No models found.\n                                </div>\n                              ) : (\n                                <div className=\"space-y-2\">\n                                  {visibleModels.map((model) => (\n                                    <div\n                                      key={model.id}\n                                      className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 border border-zinc-800/70 rounded px-3 py-2 bg-zinc-900/60\"\n                                    >\n                                      <div className=\"text-white text-[12px] sm:text-sm\">\n                                        {model.canonical_label}\n                                      </div>\n                                      <div className=\"flex items-center justify-end gap-2 flex-wrap\">\n                                        <StatusPill active={model.is_active} />\n                                        <VerifiedPill verified={model.is_verified} />\n                                        {renderMenu(\n                                          `model-${model.id}`,\n                                          () =>\n                                            setEditTarget({ type: \"model\", item: model }),\n                                          () =>\n                                            setConfirmTarget({\n                                              type: \"model\",\n                                              item: model,\n                                            }),\n                                        )}\n                                      </div>\n                                    </div>\n                                  ))}\n                                </div>\n                              )}\n                            </td>\n                          </tr>\n                        )}\n                      </Fragment>\n                    );\n                  })}\n                </tbody>\n              </table>\n            )}\n          </div>\n        </section>\n      )}\n\n      {activeTab === \"aliases\" && (\n        <section className=\"space-y-4\">\n          <div className=\"flex items-center justify-between\">\n            <h2 className=\"text-lg sm:text-xl font-semibold text-white\">Aliases</h2>\n            <span className=\"text-[11px] sm:text-xs text-gray-500\">\n              {filteredAliases.length} aliases\n            </span>\n          </div>\n          <div className=\"bg-zinc-900 border border-zinc-800/70 rounded p-3 sm:p-4\">\n            <div className=\"grid grid-cols-1 md:grid-cols-4 gap-2 sm:gap-3\">\n              <RdkSelect\n                value={newAlias.entityType}\n                onChange={(value) =>\n                  setNewAlias((prev) => ({\n                    ...prev,\n                    entityType: value as \"brand\" | \"model\",\n                    entityId: \"\",\n                  }))\n                }\n                options={[\n                  { value: \"brand\", label: \"Brand\" },\n                  { value: \"model\", label: \"Model\" },\n                ]}\n                buttonClassName=\"px-2.5 py-1.5 text-[12px] sm:text-sm\"\n                menuClassName=\"text-[12px] sm:text-sm\"\n              />\n              <RdkSelect\n                value={newAlias.entityId}\n                onChange={(value) =>\n                  setNewAlias((prev) => ({ ...prev, entityId: value }))\n                }\n                options={[\n                  {\n                    value: \"\",\n                    label: `Select ${newAlias.entityType}`,\n                    disabled: true,\n                  },\n                  ...(newAlias.entityType === \"brand\"\n                    ? brands.map((brand) => ({\n                        value: brand.id,\n                        label: brand.canonical_label,\n                      }))\n                    : models.map((model) => ({\n                        value: model.id,\n                        label: model.canonical_label,\n                      }))),\n                ]}\n                buttonClassName=\"px-2.5 py-1.5 text-[12px] sm:text-sm\"\n                menuClassName=\"text-[12px] sm:text-sm\"\n                placeholder={`Select ${newAlias.entityType}`}\n              />\n              <input\n                value={newAlias.label}\n                onChange={(e) =>\n                  setNewAlias((prev) => ({ ...prev, label: e.target.value }))\n                }\n                placeholder=\"Alias\"\n                className=\"bg-zinc-900 border border-zinc-800/70 text-white px-2.5 py-1.5 text-[12px] sm:text-sm\"\n              />\n              <div className=\"flex flex-col sm:flex-row gap-2\">\n                <input\n                  value={newAlias.priority}\n                  onChange={(e) =>\n                    setNewAlias((prev) => ({ ...prev, priority: e.target.value }))\n                  }\n                  placeholder=\"Priority (higher wins)\"\n                  className=\"bg-zinc-900 border border-zinc-800/70 text-white px-2.5 py-1.5 text-[12px] sm:text-sm w-full sm:w-28\"\n                />\n                <button\n                  onClick={() => {\n                    void handleCreateAlias();\n                  }}\n                  className=\"bg-red-600 hover:bg-red-700 text-white font-semibold px-3 py-1.5 sm:px-4 sm:py-2 rounded text-[12px] sm:text-sm\"\n                >\n                  Add Alias\n                </button>\n              </div>\n            </div>\n          </div>\n          <div className=\"bg-zinc-900 border border-zinc-800/70 rounded overflow-x-auto\">\n            {isLoading ? (\n              <div className=\"text-center py-12 text-gray-400\">Loading...</div>\n            ) : filteredAliases.length === 0 ? (\n              <div className=\"text-center py-12 text-gray-500\">No aliases found.</div>\n            ) : (\n              <table className=\"w-full text-[12px] sm:text-sm\">\n                <thead>\n                  <tr className=\"border-b border-zinc-800/70 bg-zinc-800\">\n                    <th className=\"text-left text-gray-400 font-semibold p-3 sm:p-4\">\n                      Alias\n                    </th>\n                    <th className=\"hidden sm:table-cell text-left text-gray-400 font-semibold p-3 sm:p-4\">\n                      Type\n                    </th>\n                    <th className=\"hidden sm:table-cell text-left text-gray-400 font-semibold p-3 sm:p-4\">\n                      Priority\n                    </th>\n                    <th className=\"p-3 sm:p-4\">\n                      <span className=\"sr-only\">Actions</span>\n                    </th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {filteredAliases.map((alias) => (\n                    <tr\n                      key={alias.id}\n                      className=\"border-b border-zinc-800/70 hover:bg-zinc-800/60\"\n                    >\n                      <td className=\"p-3 sm:p-4\">\n                        <div className=\"flex items-center gap-2\">\n                          <div className=\"text-white font-semibold\">\n                            {alias.alias_label}\n                          </div>\n                          <StatusPill active={alias.is_active} />\n                        </div>\n                        <div className=\"text-xs text-gray-500\">\n                          {alias.entity_type === \"brand\"\n                            ? resolveBrandLabel(alias.brand_id)\n                            : resolveModelLabel(alias.model_id)}\n                        </div>\n                        <div className=\"text-[11px] text-gray-500 sm:hidden\">\n                          {alias.entity_type}  Priority {alias.priority ?? 0}\n                        </div>\n                      </td>\n                      <td className=\"hidden sm:table-cell p-3 sm:p-4 text-xs uppercase text-gray-400\">\n                        {alias.entity_type}\n                      </td>\n                      <td className=\"hidden sm:table-cell p-3 sm:p-4 text-gray-400\">\n                        {alias.priority ?? 0}\n                      </td>\n                      <td className=\"p-3 sm:p-4\">\n                        <div className=\"flex items-center justify-end\">\n                          {renderMenu(\n                            `alias-${alias.id}`,\n                            () => setEditTarget({ type: \"alias\", item: alias }),\n                            () => setConfirmTarget({ type: \"alias\", item: alias }),\n                          )}\n                        </div>\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            )}\n          </div>\n        </section>\n      )}\n\n      {activeTab === \"candidates\" && (\n        <section className=\"space-y-4\">\n          <div className=\"flex items-center justify-between\">\n            <h2 className=\"text-lg sm:text-xl font-semibold text-white\">Candidates</h2>\n            <span className=\"text-[11px] sm:text-xs text-gray-500\">\n              {filteredCandidates.length} pending\n            </span>\n          </div>\n          <div className=\"bg-zinc-900 border border-zinc-800/70 rounded overflow-x-auto\">\n            {isLoading ? (\n              <div className=\"text-center py-12 text-gray-400\">Loading...</div>\n            ) : filteredCandidates.length === 0 ? (\n              <div className=\"text-center py-12 text-gray-500\">\n                No pending candidates.\n              </div>\n            ) : (\n              <table className=\"w-full text-[12px] sm:text-sm\">\n                <thead>\n                  <tr className=\"border-b border-zinc-800/70 bg-zinc-800\">\n                    <th className=\"text-left text-gray-400 font-semibold p-3 sm:p-4\">\n                      Candidate\n                    </th>\n                    <th className=\"hidden sm:table-cell text-left text-gray-400 font-semibold p-3 sm:p-4\">\n                      Brand\n                    </th>\n                    <th className=\"p-3 sm:p-4\">\n                      <span className=\"sr-only\">Actions</span>\n                    </th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {filteredCandidates.map((candidate) => (\n                    <tr\n                      key={candidate.id}\n                      className=\"border-b border-zinc-800/70 hover:bg-zinc-800/60\"\n                    >\n                      <td className=\"p-3 sm:p-4\">\n                        <div className=\"flex items-center gap-2\">\n                          <div className=\"text-white font-semibold\">\n                            {candidate.raw_text}\n                          </div>\n                          <span className=\"inline-flex items-center px-2 py-1 rounded-full text-xs bg-zinc-800 text-gray-400 uppercase\">\n                            {candidate.entity_type}\n                          </span>\n                        </div>\n                        {candidate.entity_type === \"model\" && (\n                          <div className=\"text-[11px] text-gray-500 sm:hidden\">\n                            {resolveBrandLabel(candidate.parent_brand_id)}\n                          </div>\n                        )}\n                      </td>\n                      <td className=\"hidden sm:table-cell p-3 sm:p-4 text-gray-400\">\n                        {candidate.entity_type === \"model\"\n                          ? resolveBrandLabel(candidate.parent_brand_id)\n                          : \"-\"}\n                      </td>\n                      <td className=\"p-3 sm:p-4\">\n                        <div className=\"flex flex-col sm:flex-row items-stretch sm:items-center justify-end gap-2\">\n                          <button\n                            onClick={() => {\n                              void handleAcceptCandidate(candidate);\n                            }}\n                            className=\"bg-emerald-600 hover:bg-emerald-700 text-white rounded px-3 py-1.5 sm:px-3 sm:py-2 text-[11px] sm:text-xs font-semibold\"\n                          >\n                            Accept\n                          </button>\n                          <button\n                            onClick={() => {\n                              void handleRejectCandidate(candidate);\n                            }}\n                            className=\"bg-zinc-800 hover:bg-zinc-700 text-white rounded px-3 py-1.5 sm:px-3 sm:py-2 text-[11px] sm:text-xs font-semibold\"\n                          >\n                            Reject\n                          </button>\n                        </div>\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            )}\n          </div>\n        </section>\n      )}\n\n      <TagModals\n        showAddBrandModal={showAddBrandModal}\n        showAddModelModal={showAddModelModal}\n        editTarget={editTarget}\n        editDraft={editDraft}\n        confirmTarget={confirmTarget}\n        isSaving={isSaving}\n        brands={brands}\n        modelTargetBrand={modelTargetBrand}\n        newBrand={newBrand}\n        newModel={newModel}\n        setNewBrand={setNewBrand}\n        setNewModel={setNewModel}\n        setShowAddBrandModal={setShowAddBrandModal}\n        setShowAddModelModal={setShowAddModelModal}\n        setModelTargetBrand={setModelTargetBrand}\n        setEditTarget={setEditTarget}\n        setEditDraft={setEditDraft}\n        setConfirmTarget={setConfirmTarget}\n        onCreateBrand={() => {\n          void handleCreateBrand();\n        }}\n        onCreateModel={() => {\n          void handleCreateModel();\n        }}\n        onSaveEdit={() => {\n          void handleSaveEdit();\n        }}\n        onConfirmDelete={() => {\n          void handleConfirmDelete();\n        }}\n        toTitleCase={toTitleCase}\n      />\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\admin\\catalog\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\admin\\chats\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\admin\\dashboard\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[973,976],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[973,976],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// app/admin/dashboard/page.tsx\n\"use client\";\n\nimport { createElement, useEffect, useState } from \"react\";\nimport {\n  TrendingUp,\n  TrendingDown,\n  DollarSign,\n  ShoppingCart,\n  Package,\n  Users,\n} from \"lucide-react\";\nimport Link from \"next/link\";\n\nimport { logError } from \"@/lib/log\";\nimport { SalesChart } from \"@/components/admin/charts/SalesChart\";\nimport { TrafficChart } from \"@/components/admin/charts/TrafficChart\";\n\nexport default function DashboardPage() {\n  const [summary, setSummary] = useState({ revenue: 0, orders: 0 });\n  const [salesTrend, setSalesTrend] = useState<Array<{ date: string; revenue: number }>>(\n    [],\n  );\n  const [trafficSummary, setTrafficSummary] = useState({\n    visits: 0,\n    uniqueVisitors: 0,\n    pageViews: 0,\n  });\n  const [trafficTrend, setTrafficTrend] = useState<\n    Array<{ date: string; visits: number }>\n  >([]);\n  const [productsCount, setProductsCount] = useState(0);\n  const [recentOrders, setRecentOrders] = useState<any[]>([]);\n\n  useEffect(() => {\n    const loadDashboard = async () => {\n      try {\n        const [analyticsResponse, productsResponse, ordersResponse] = await Promise.all([\n          fetch(\"/api/admin/analytics?range=7d\"),\n          fetch(\"/api/store/products?limit=1\"),\n          fetch(\"/api/admin/orders?status=paid&status=shipped\"),\n        ]);\n\n        const analyticsData = await analyticsResponse.json();\n        if (analyticsResponse.ok) {\n          setSummary({\n            revenue: analyticsData.summary?.revenue ?? 0,\n            orders: analyticsData.summary?.orders ?? 0,\n          });\n          setSalesTrend(analyticsData.salesTrend || []);\n          setTrafficSummary(\n            analyticsData.trafficSummary || {\n              visits: 0,\n              uniqueVisitors: 0,\n              pageViews: 0,\n            },\n          );\n          setTrafficTrend(analyticsData.trafficTrend || []);\n        }\n\n        const productsData = await productsResponse.json();\n        setProductsCount(productsData.total ?? 0);\n\n        const ordersData = await ordersResponse.json();\n        setRecentOrders((ordersData.orders || []).slice(0, 3));\n      } catch (error) {\n        logError(error, { layer: \"frontend\", event: \"admin_load_dashboard\" });\n      }\n    };\n\n    loadDashboard();\n  }, []);\n\n  const stats = [\n    {\n      title: \"Revenue\",\n      value: `$${summary.revenue.toFixed(2)}`,\n      change: \"-\",\n      trend: summary.revenue > 0 ? \"up\" : \"down\",\n      icon: DollarSign,\n    },\n    {\n      title: \"Orders\",\n      value: `${summary.orders}`,\n      change: \"-\",\n      trend: summary.orders > 0 ? \"up\" : \"down\",\n      icon: ShoppingCart,\n    },\n    {\n      title: \"Products\",\n      value: `${productsCount}`,\n      change: \"-\",\n      trend: productsCount > 0 ? \"up\" : \"down\",\n      icon: Package,\n    },\n    {\n      title: \"Visitors\",\n      value: `${trafficSummary.uniqueVisitors}`,\n      change: \"-\",\n      trend: trafficSummary.uniqueVisitors > 0 ? \"up\" : \"down\",\n      icon: Users,\n    },\n  ];\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <h1 className=\"text-3xl font-bold text-white mb-2\">Dashboard</h1>\n        <p className=\"text-gray-400\">Welcome back! Here's what's happening.</p>\n      </div>\n\n      {/* Stats */}\n      <div className=\"grid grid-cols-2 md:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-6\">\n        {stats.map((stat) => {\n          const icon = stat.icon;\n          return (\n            <div\n              key={stat.title}\n              className=\"bg-zinc-900 border border-zinc-800/70 rounded p-6\"\n            >\n              <div className=\"flex items-center justify-between mb-4\">\n                <span className=\"text-gray-400 text-sm\">{stat.title}</span>\n                {createElement(icon, { className: \"w-5 h-5 text-gray-400\" })}\n              </div>\n              <div className=\"flex items-end justify-between\">\n                <span className=\"text-xl sm:text-3xl font-bold text-white\">\n                  {stat.value}\n                </span>\n                <span\n                  className={`flex items-center gap-1 text-sm font-semibold ${\n                    stat.trend === \"up\" ? \"text-green-400\" : \"text-red-400\"\n                  }`}\n                >\n                  {stat.trend === \"up\" ? (\n                    <TrendingUp className=\"w-4 h-4\" />\n                  ) : (\n                    <TrendingDown className=\"w-4 h-4\" />\n                  )}\n                  {stat.change}\n                </span>\n              </div>\n            </div>\n          );\n        })}\n      </div>\n\n      {/* Recent Sales */}\n      <div className=\"bg-zinc-900 border border-zinc-800/70 rounded p-6\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <h2 className=\"text-xl font-semibold text-white\">Recent Sales</h2>\n          <Link href=\"/admin/sales\" className=\"text-red-500 hover:underline text-sm\">\n            View all \n          </Link>\n        </div>\n        <div className=\"overflow-x-auto\">\n          <table className=\"w-full\">\n            <thead>\n              <tr className=\"border-b border-zinc-800/70\">\n                <th className=\"text-left text-gray-400 font-semibold py-3\">Order</th>\n                <th className=\"hidden sm:table-cell text-left text-gray-400 font-semibold py-3\">\n                  Customer\n                </th>\n                <th className=\"text-right text-gray-400 font-semibold py-3\">Amount</th>\n                <th className=\"hidden sm:table-cell text-right text-gray-400 font-semibold py-3\">\n                  Subtotal\n                </th>\n              </tr>\n            </thead>\n            <tbody>\n              {recentOrders.map((order) => (\n                <tr key={order.id} className=\"border-b border-zinc-800/70\">\n                  <td className=\"py-3 text-white\">#{order.id.slice(0, 8)}</td>\n                  <td className=\"hidden sm:table-cell py-3 text-gray-400\">\n                    {order.user_id ? order.user_id.slice(0, 6) : \"Guest\"}\n                  </td>\n                  <td className=\"py-3 text-right text-white\">\n                    ${Number(order.total ?? 0).toFixed(2)}\n                  </td>\n                  <td className=\"hidden sm:table-cell py-3 text-right text-green-400\">\n                    +${Number(order.subtotal ?? 0).toFixed(2)}\n                  </td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n      </div>\n\n      {/* Charts */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <div className=\"bg-zinc-900 border border-zinc-800/70 rounded p-4 sm:p-6\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <h2 className=\"text-xl font-semibold text-white\">Financials</h2>\n            <span className=\"text-sm text-gray-400\">7d</span>\n          </div>\n          <SalesChart data={salesTrend} />\n        </div>\n\n        <div className=\"bg-zinc-900 border border-zinc-800/70 rounded p-4 sm:p-6\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <h2 className=\"text-xl font-semibold text-white\">Traffic</h2>\n            <span className=\"text-sm text-gray-400\">7d</span>\n          </div>\n          <TrafficChart data={trafficTrend} />\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\admin\\error.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\admin\\inventory\\[id]\\edit\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\admin\\inventory\\create\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\admin\\inventory\\page.tsx","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@next/next/no-img-element').","line":462,"column":29,"severity":1,"nodeType":null,"fix":{"range":[16108,16161],"text":" "}},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@next/next/no-img-element').","line":567,"column":25,"severity":1,"nodeType":null,"fix":{"range":[21122,21175],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":2,"source":"// app/admin/inventory/page.tsx\n\"use client\";\n\nimport { useState, useEffect, useCallback, useRef } from \"react\";\nimport Link from \"next/link\";\nimport { Plus, Trash2, MoreVertical, Search } from \"lucide-react\";\n\nimport type { ProductWithDetails, Category, Condition } from \"@/types/domain/product\";\nimport { logError } from \"@/lib/log\";\nimport { ConfirmDialog } from \"@/components/ui/ConfirmDialog\";\nimport { Toast } from \"@/components/ui/Toast\";\nimport { RdkSelect } from \"@/components/ui/Select\";\nimport { createSupabaseBrowserClient } from \"@/lib/supabase/client\";\n\ntype StockStatus = \"in_stock\" | \"out_of_stock\";\n\nexport default function InventoryPage() {\n  const [products, setProducts] = useState<ProductWithDetails[]>([]);\n  const [isLoading, setIsLoading] = useState(true);\n  const [selectedIds, setSelectedIds] = useState<string[]>([]);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [categoryFilter, setCategoryFilter] = useState<Category | \"all\">(\"all\");\n  const [conditionFilter, setConditionFilter] = useState<Condition | \"all\">(\"all\");\n  const [stockStatusFilter, setStockStatusFilter] = useState<StockStatus>(\"in_stock\");\n  const [openMenuId, setOpenMenuId] = useState<string | null>(null);\n  const [pendingDelete, setPendingDelete] = useState<{\n    id: string;\n    label: string;\n  } | null>(null);\n  const [pendingMassDelete, setPendingMassDelete] = useState(false);\n  const [toast, setToast] = useState<{\n    message: string;\n    tone: \"success\" | \"error\" | \"info\";\n  } | null>(null);\n  const filtersRef = useRef<{\n    q?: string;\n    category?: Category | \"all\";\n    condition?: Condition | \"all\";\n    stockStatus?: StockStatus;\n  }>({});\n  const refreshTimerRef = useRef<number | null>(null);\n\n  const loadProducts = useCallback(\n    async (\n      filters?: {\n        q?: string;\n        category?: Category | \"all\";\n        condition?: Condition | \"all\";\n        stockStatus?: StockStatus;\n      },\n      showLoading = true,\n    ) => {\n      if (showLoading) {\n        setIsLoading(true);\n      }\n      try {\n        // Admin list must include out-of-stock so the admin tabs can display them.\n        const params = new URLSearchParams({ limit: \"100\", includeOutOfStock: \"1\" });\n\n        if (filters?.q) {\n          params.set(\"q\", filters.q.trim());\n        }\n        if (filters?.category && filters.category !== \"all\") {\n          params.append(\"category\", filters.category);\n        }\n        if (filters?.condition && filters.condition !== \"all\") {\n          params.append(\"condition\", filters.condition);\n        }\n\n        const response = await fetch(`/api/admin/products?${params.toString()}`);\n        const data = await response.json();\n\n        const loaded: ProductWithDetails[] = data.products || [];\n\n        // Client-side tab filter based on actual variant stock (authoritative for admin UI)\n        const filtered = filters?.stockStatus\n          ? loaded.filter((product: ProductWithDetails) => {\n              const totalStock = product.variants.reduce(\n                (sum, v) => sum + (v.stock ?? 0),\n                0,\n              );\n              if (filters.stockStatus === \"out_of_stock\") {\n                return totalStock <= 0;\n              }\n              return totalStock > 0;\n            })\n          : loaded;\n\n        setProducts(filtered);\n      } catch (error) {\n        logError(error, { layer: \"frontend\", event: \"admin_load_inventory_products\" });\n      } finally {\n        if (showLoading) {\n          setIsLoading(false);\n        }\n      }\n    },\n    [],\n  );\n\n  useEffect(() => {\n    filtersRef.current = {\n      q: searchQuery,\n      category: categoryFilter,\n      condition: conditionFilter,\n      stockStatus: stockStatusFilter,\n    };\n\n    const timeout = setTimeout(() => {\n      loadProducts(filtersRef.current);\n    }, 250);\n\n    return () => clearTimeout(timeout);\n  }, [searchQuery, categoryFilter, conditionFilter, stockStatusFilter, loadProducts]);\n\n  useEffect(() => {\n    if (!openMenuId) {\n      return;\n    }\n    const handleClick = (event: MouseEvent) => {\n      const target = event.target as HTMLElement | null;\n      const activeMenus = Array.from(\n        document.querySelectorAll(`[data-menu-id=\"${openMenuId}\"]`),\n      );\n      if (target && activeMenus.some((menu) => menu.contains(target))) {\n        return;\n      }\n      setOpenMenuId(null);\n    };\n    document.addEventListener(\"mousedown\", handleClick);\n    return () => document.removeEventListener(\"mousedown\", handleClick);\n  }, [openMenuId]);\n\n  useEffect(() => {\n    const supabase = createSupabaseBrowserClient();\n    const scheduleRefresh = () => {\n      if (refreshTimerRef.current) {\n        window.clearTimeout(refreshTimerRef.current);\n      }\n      refreshTimerRef.current = window.setTimeout(() => {\n        loadProducts(filtersRef.current, false);\n      }, 300);\n    };\n\n    const channel = supabase\n      .channel(\"admin-inventory\")\n      .on(\n        \"postgres_changes\",\n        { event: \"*\", schema: \"public\", table: \"product_variants\" },\n        scheduleRefresh,\n      )\n      .on(\n        \"postgres_changes\",\n        { event: \"*\", schema: \"public\", table: \"products\" },\n        scheduleRefresh,\n      )\n      .subscribe();\n\n    return () => {\n      if (refreshTimerRef.current) {\n        window.clearTimeout(refreshTimerRef.current);\n      }\n      supabase.removeChannel(channel);\n    };\n  }, [loadProducts]);\n\n  const showToast = (message: string, tone: \"success\" | \"error\" | \"info\" = \"info\") => {\n    setToast({ message, tone });\n  };\n\n  const requestDelete = (product: ProductWithDetails) => {\n    setOpenMenuId(null);\n    const label = product.title_display ?? `${product.brand} ${product.name}`.trim();\n    setPendingDelete({ id: product.id, label: label || \"this product\" });\n  };\n\n  const confirmDelete = async () => {\n    if (!pendingDelete) {\n      return;\n    }\n    const { id, label } = pendingDelete;\n    setPendingDelete(null);\n\n    try {\n      const response = await fetch(`/api/admin/products/${id}`, { method: \"DELETE\" });\n      if (response.ok) {\n        showToast(`Deleted ${label}.`, \"success\");\n        await loadProducts({\n          q: searchQuery,\n          category: categoryFilter,\n          condition: conditionFilter,\n          stockStatus: stockStatusFilter,\n        });\n      } else {\n        showToast(\"Failed to delete product.\", \"error\");\n      }\n    } catch {\n      showToast(\"Error deleting product.\", \"error\");\n    }\n  };\n\n  const confirmMassDelete = async () => {\n    setPendingMassDelete(false);\n    if (selectedIds.length === 0) {\n      return;\n    }\n\n    try {\n      const results = await Promise.all(\n        selectedIds.map((id) => fetch(`/api/admin/products/${id}`, { method: \"DELETE\" })),\n      );\n      const failed = results.filter((res) => !res.ok).length;\n\n      if (failed > 0) {\n        showToast(\n          `Deleted ${selectedIds.length - failed} items, ${failed} failed.`,\n          \"error\",\n        );\n      } else {\n        showToast(`Deleted ${selectedIds.length} items.`, \"success\");\n      }\n\n      setSelectedIds([]);\n      await loadProducts({\n        q: searchQuery,\n        category: categoryFilter,\n        condition: conditionFilter,\n        stockStatus: stockStatusFilter,\n      });\n    } catch {\n      showToast(\"Error deleting selected items.\", \"error\");\n    }\n  };\n\n  const handleDuplicate = async (id: string) => {\n    setOpenMenuId(null);\n    try {\n      const response = await fetch(`/api/admin/products/${id}/duplicate`, {\n        method: \"POST\",\n      });\n      if (response.ok) {\n        showToast(\"Product duplicated.\", \"success\");\n        await loadProducts({\n          q: searchQuery,\n          category: categoryFilter,\n          condition: conditionFilter,\n          stockStatus: stockStatusFilter,\n        });\n      } else {\n        showToast(\"Failed to duplicate product.\", \"error\");\n      }\n    } catch {\n      showToast(\"Error duplicating product.\", \"error\");\n    }\n  };\n\n  const toggleSelection = (id: string) => {\n    setSelectedIds((prev) =>\n      prev.includes(id) ? prev.filter((i) => i !== id) : [...prev, id],\n    );\n  };\n\n  const handleMassDelete = () => {\n    if (selectedIds.length === 0) {\n      return;\n    }\n    setPendingMassDelete(true);\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex flex-col gap-2\">\n        <div className=\"flex items-center justify-between gap-3\">\n          <h1 className=\"text-2xl sm:text-3xl font-bold text-white\">Inventory</h1>\n          <div className=\"flex items-center gap-3\">\n            <Link\n              href=\"/admin/inventory/create\"\n              className=\"flex items-center gap-2 bg-red-600 hover:bg-red-700 text-white font-bold px-2 py-1 text-xs sm:px-4 sm:py-2 sm:text-base transition cursor-pointer rounded\"\n            >\n              <Plus className=\"w-3 h-3 sm:w-5 sm:h-5\" />\n              Create Product\n            </Link>\n          </div>\n        </div>\n        <p className=\"text-gray-400\">{products.length} products</p>\n      </div>\n\n      <div className=\"border-b border-zinc-800/70 flex space-x-6\">\n        <button\n          onClick={() => setStockStatusFilter(\"in_stock\")}\n          className={`py-3 text-sm font-medium transition-colors ${\n            stockStatusFilter === \"in_stock\"\n              ? \"text-white border-b-2 border-red-600\"\n              : \"text-gray-400 hover:text-white\"\n          }`}\n          data-testid=\"inventory-filter-in-stock\"\n        >\n          In Stock\n        </button>\n        <button\n          onClick={() => setStockStatusFilter(\"out_of_stock\")}\n          className={`py-3 text-sm font-medium transition-colors ${\n            stockStatusFilter === \"out_of_stock\"\n              ? \"text-white border-b-2 border-red-600\"\n              : \"text-gray-400 hover:text-white\"\n          }`}\n          data-testid=\"inventory-filter-out-of-stock\"\n        >\n          Out of Stock\n        </button>\n      </div>\n\n      <div className=\"flex flex-col lg:flex-row lg:items-center gap-3\">\n        <div\n          className=\"flex items-center gap-2 bg-zinc-900 border border-zinc-800/70 px-3 py-2 w-full lg:max-w-md rounded\n                        focus-within:border-zinc-700 focus-within:ring-2 focus-within:ring-zinc-700/40\"\n        >\n          <Search className=\"w-4 h-4 text-gray-500\" />\n          <input\n            type=\"text\"\n            value={searchQuery}\n            onChange={(event) => setSearchQuery(event.target.value)}\n            placeholder=\"Search products\"\n            className=\"w-full bg-transparent text-sm text-white placeholder:text-gray-500 outline-none\n                       focus:outline-none focus-visible:outline-none focus-visible:ring-0\"\n          />\n        </div>\n\n        {/* Red-highlight custom dropdowns */}\n        <div className=\"flex flex-1 flex-col sm:flex-row gap-3\">\n          <div className=\"w-full sm:w-56\">\n            <RdkSelect\n              value={categoryFilter}\n              onChange={(v) => setCategoryFilter(v as Category | \"all\")}\n              options={[\n                { value: \"all\", label: \"All categories\" },\n                { value: \"sneakers\", label: \"Sneakers\" },\n                { value: \"clothing\", label: \"Clothing\" },\n                { value: \"accessories\", label: \"Accessories\" },\n                { value: \"electronics\", label: \"Electronics\" },\n              ]}\n            />\n          </div>\n\n          <div className=\"w-full sm:w-48\">\n            <RdkSelect\n              value={conditionFilter}\n              onChange={(v) => setConditionFilter(v as Condition | \"all\")}\n              options={[\n                { value: \"all\", label: \"All conditions\" },\n                { value: \"new\", label: \"New\" },\n                { value: \"used\", label: \"Used\" },\n              ]}\n            />\n          </div>\n        </div>\n      </div>\n\n      {selectedIds.length > 0 && (\n        <div className=\"bg-zinc-900 border border-zinc-800/70 rounded p-4 flex items-center justify-between\">\n          <span className=\"text-white\">{selectedIds.length} selected</span>\n          <button\n            onClick={handleMassDelete}\n            className=\"flex items-center gap-2 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded text-sm transition cursor-pointer\"\n          >\n            <Trash2 className=\"w-4 h-4\" />\n            Delete Selected\n          </button>\n        </div>\n      )}\n\n      {isLoading ? (\n        <div className=\"text-center py-12 text-gray-400\">Loading...</div>\n      ) : (\n        <>\n          {/* Desktop Table */}\n          <div className=\"hidden md:block bg-zinc-900 border border-zinc-800/70 rounded overflow-visible relative\">\n            <table className=\"w-full table-fixed\">\n              <colgroup>\n                <col className=\"w-12\" />\n                <col className=\"w-20\" />\n                <col />\n                <col className=\"w-36\" />\n                <col className=\"w-44\" />\n                <col className=\"w-20\" />\n                <col className=\"w-20\" />\n              </colgroup>\n\n              <thead>\n                <tr className=\"border-b border-zinc-800/70 bg-zinc-800\">\n                  <th className=\"text-left px-4 py-3\">\n                    <input\n                      type=\"checkbox\"\n                      className=\"rdk-checkbox\"\n                      onChange={(e) => {\n                        if (e.target.checked) {\n                          setSelectedIds(products.map((p) => p.id));\n                        } else {\n                          setSelectedIds([]);\n                        }\n                      }}\n                      checked={\n                        selectedIds.length === products.length && products.length > 0\n                      }\n                    />\n                  </th>\n                  <th className=\"text-left text-gray-400 font-semibold px-4 py-3\">\n                    Image\n                  </th>\n                  <th className=\"text-left text-gray-400 font-semibold px-4 py-3\">\n                    Product\n                  </th>\n                  <th className=\"text-left text-gray-400 font-semibold px-4 py-3\">\n                    Category\n                  </th>\n                  <th className=\"text-left text-gray-400 font-semibold px-4 py-3\">\n                    Price\n                  </th>\n                  <th className=\"text-left text-gray-400 font-semibold px-4 py-3\">\n                    Stock\n                  </th>\n                  <th className=\"text-right text-gray-400 font-semibold px-4 py-3\">\n                    Actions\n                  </th>\n                </tr>\n              </thead>\n\n              <tbody>\n                {products.map((product) => {\n                  const minPrice = Math.min(\n                    ...product.variants.map((v) => v.price_cents),\n                  );\n                  const maxPrice = Math.max(\n                    ...product.variants.map((v) => v.price_cents),\n                  );\n                  const totalStock = product.variants.reduce(\n                    (sum, v) => sum + (v.stock ?? 0),\n                    0,\n                  );\n                  const primaryImage =\n                    product.images.find((image) => image.is_primary) ?? product.images[0];\n\n                  return (\n                    <tr\n                      key={product.id}\n                      className=\"border-b border-zinc-800/70 hover:bg-zinc-800\"\n                      data-testid=\"inventory-row\"\n                      data-product-id={product.id}\n                    >\n                      <td className=\"px-4 py-3\">\n                        <input\n                          type=\"checkbox\"\n                          className=\"rdk-checkbox\"\n                          checked={selectedIds.includes(product.id)}\n                          onChange={() => toggleSelection(product.id)}\n                        />\n                      </td>\n\n                      <td className=\"px-4 py-3\">\n                        <div className=\"w-12 h-12 rounded bg-zinc-800 border border-zinc-800/70 overflow-hidden flex items-center justify-center\">\n                          {primaryImage?.url ? (\n                            // eslint-disable-next-line @next/next/no-img-element\n                            <img\n                              src={primaryImage.url}\n                              alt={product.title_display ?? product.name}\n                              className=\"w-full h-full object-cover\"\n                            />\n                          ) : (\n                            <span className=\"text-[10px] text-gray-500\">No image</span>\n                          )}\n                        </div>\n                      </td>\n\n                      <td className=\"px-4 py-3 min-w-0\">\n                        <div className=\"text-white font-semibold truncate\">\n                          {product.title_display ??\n                            `${product.brand} ${product.name}`.trim()}\n                        </div>\n                      </td>\n\n                      <td className=\"px-4 py-3 text-gray-400 capitalize truncate\">\n                        {product.category}\n                      </td>\n\n                      <td className=\"px-4 py-3 text-white whitespace-nowrap\">\n                        {minPrice === maxPrice\n                          ? `$${(minPrice / 100).toFixed(2)}`\n                          : `$${(minPrice / 100).toFixed(2)} - $${(maxPrice / 100).toFixed(2)}`}\n                      </td>\n\n                      <td className=\"px-4 py-3 text-gray-400 whitespace-nowrap\">\n                        {totalStock}\n                      </td>\n\n                      <td className=\"px-4 py-3\">\n                        <div className=\"flex items-center justify-end\">\n                          <div className=\"relative\" data-menu-id={product.id}>\n                            <button\n                              type=\"button\"\n                              onClick={() =>\n                                setOpenMenuId((prev) =>\n                                  prev === product.id ? null : product.id,\n                                )\n                              }\n                              className=\"text-gray-400 hover:text-white p-2 rounded hover:bg-zinc-900 cursor-pointer\"\n                              aria-label=\"Open actions\"\n                            >\n                              <MoreVertical className=\"w-4 h-4\" />\n                            </button>\n\n                            {openMenuId === product.id && (\n                              <div className=\"absolute right-0 mt-2 w-44 bg-zinc-950 border border-zinc-800/70 shadow-xl z-30 rounded overflow-hidden\">\n                                <Link\n                                  href={`/admin/inventory/${product.id}/edit`}\n                                  onClick={() => setOpenMenuId(null)}\n                                  className=\"block px-3 py-2 text-sm text-gray-200 hover:bg-zinc-800\"\n                                >\n                                  Edit\n                                </Link>\n                                <button\n                                  type=\"button\"\n                                  onClick={() => {\n                                    void handleDuplicate(product.id);\n                                  }}\n                                  className=\"w-full text-left px-3 py-2 text-sm text-gray-200 hover:bg-zinc-800 cursor-pointer\"\n                                >\n                                  Duplicate\n                                </button>\n                                <div className=\"h-px bg-zinc-800/70\" />\n                                <button\n                                  type=\"button\"\n                                  onClick={() => requestDelete(product)}\n                                  className=\"w-full text-left px-3 py-2 text-sm text-red-400 hover:bg-zinc-800 cursor-pointer\"\n                                >\n                                  Delete\n                                </button>\n                              </div>\n                            )}\n                          </div>\n                        </div>\n                      </td>\n                    </tr>\n                  );\n                })}\n              </tbody>\n            </table>\n          </div>\n\n          {/* Mobile Cards (unchanged layout) */}\n          <div className=\"md:hidden space-y-4\">\n            {products.map((product) => {\n              const primaryImage =\n                product.images.find((image) => image.is_primary) ?? product.images[0];\n              const totalStock = product.variants.reduce(\n                (sum, v) => sum + (v.stock ?? 0),\n                0,\n              );\n\n              return (\n                <div\n                  key={product.id}\n                  className=\"bg-zinc-900 border border-zinc-800/70 rounded p-4\"\n                >\n                  <div className=\"flex items-start gap-3\">\n                    <div className=\"w-14 h-14 rounded bg-zinc-800 border border-zinc-800/70 overflow-hidden flex items-center justify-center\">\n                      {primaryImage?.url ? (\n                        // eslint-disable-next-line @next/next/no-img-element\n                        <img\n                          src={primaryImage.url}\n                          alt={product.title_display ?? product.name}\n                          className=\"w-full h-full object-cover\"\n                        />\n                      ) : (\n                        <span className=\"text-[10px] text-gray-500\">No image</span>\n                      )}\n                    </div>\n\n                    <div className=\"flex-1\">\n                      <h3 className=\"text-white font-semibold\">\n                        {product.title_display ??\n                          `${product.brand} ${product.name}`.trim()}\n                      </h3>\n                      <div className=\"mt-1 flex items-center gap-2\">\n                        <span className=\"text-gray-400 text-xs capitalize\">\n                          {product.category}\n                        </span>\n                        <span className=\"text-gray-500 text-xs\"></span>\n                        <span className=\"text-gray-400 text-xs\">Stock: {totalStock}</span>\n                      </div>\n                    </div>\n\n                    <div className=\"flex items-center gap-2 self-center\">\n                      <input\n                        type=\"checkbox\"\n                        className=\"rdk-checkbox\"\n                        checked={selectedIds.includes(product.id)}\n                        onChange={() => toggleSelection(product.id)}\n                      />\n\n                      <div className=\"relative\" data-menu-id={product.id}>\n                        <button\n                          type=\"button\"\n                          onClick={() =>\n                            setOpenMenuId((prev) =>\n                              prev === product.id ? null : product.id,\n                            )\n                          }\n                          className=\"text-gray-400 hover:text-white p-2 rounded hover:bg-zinc-800 cursor-pointer\"\n                          aria-label=\"Open actions\"\n                        >\n                          <MoreVertical className=\"w-4 h-4\" />\n                        </button>\n\n                        {openMenuId === product.id && (\n                          <div className=\"absolute right-0 mt-2 w-44 bg-zinc-950 border border-zinc-800/70 shadow-xl z-30 rounded overflow-hidden\">\n                            <Link\n                              href={`/admin/inventory/${product.id}/edit`}\n                              onClick={() => setOpenMenuId(null)}\n                              className=\"block px-3 py-2 text-sm text-gray-200 hover:bg-zinc-800\"\n                            >\n                              Edit\n                            </Link>\n                            <button\n                              type=\"button\"\n                              onClick={() => {\n                                void handleDuplicate(product.id);\n                              }}\n                              className=\"w-full text-left px-3 py-2 text-sm text-gray-200 hover:bg-zinc-800 cursor-pointer\"\n                            >\n                              Duplicate\n                            </button>\n                            <div className=\"h-px bg-zinc-800/70\" />\n                            <button\n                              type=\"button\"\n                              onClick={() => requestDelete(product)}\n                              className=\"w-full text-left px-3 py-2 text-sm text-red-400 hover:bg-zinc-800 cursor-pointer\"\n                            >\n                              Delete\n                            </button>\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        </>\n      )}\n\n      <ConfirmDialog\n        isOpen={Boolean(pendingDelete)}\n        title=\"Delete product?\"\n        description={\n          pendingDelete\n            ? `This will permanently remove ${pendingDelete.label} and its variants.`\n            : undefined\n        }\n        confirmLabel=\"Delete\"\n        onConfirm={() => {\n          void confirmDelete();\n        }}\n        onCancel={() => setPendingDelete(null)}\n      />\n\n      <ConfirmDialog\n        isOpen={pendingMassDelete}\n        title=\"Delete selected products?\"\n        description={`This will permanently remove ${selectedIds.length} products and their variants.`}\n        confirmLabel=\"Delete all\"\n        onConfirm={() => {\n          void confirmMassDelete();\n        }}\n        onCancel={() => setPendingMassDelete(false)}\n      />\n\n      <Toast\n        open={Boolean(toast)}\n        message={toast?.message ?? \"\"}\n        tone={toast?.tone ?? \"info\"}\n        onClose={() => setToast(null)}\n      />\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\admin\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\admin\\nexus\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\admin\\notifications\\page.tsx","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react-hooks/exhaustive-deps').","line":109,"column":5,"severity":1,"nodeType":null,"fix":{"range":[2883,2938],"text":" "}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":188,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":188,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4899,4902],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4899,4902],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":225,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":225,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5990,5993],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5990,5993],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":1,"source":"\"use client\";\n\nimport { useEffect, useRef, useState } from \"react\";\nimport Link from \"next/link\";\nimport { MoreVertical, Trash2, X } from \"lucide-react\";\n\nimport { logError } from \"@/lib/log\";\n\ntype AdminNotification = {\n  id: string;\n  type: \"order_placed\" | \"chat_message\";\n  message: string;\n  created_at: string;\n  read_at: string | null;\n  order_id?: string | null;\n  chat_id?: string | null;\n};\n\nconst formatTime = (value: string) => {\n  const date = new Date(value);\n  if (Number.isNaN(date.getTime())) {\n    return \"\";\n  }\n  return date.toLocaleString(undefined, { dateStyle: \"medium\", timeStyle: \"short\" });\n};\n\nconst getNotificationHref = (n: AdminNotification) => {\n  if (n.type === \"order_placed\" && n.order_id) {\n    return \"/admin/sales\";\n  }\n  if (n.chat_id) {\n    return `/admin/chats?chatId=${n.chat_id}`;\n  }\n  return \"/admin/dashboard\";\n};\n\nconst cap9 = (n: number) => (n > 9 ? \"9+\" : String(n));\n\nfunction emitUnreadCountUpdated(count: number) {\n  window.dispatchEvent(\n    new CustomEvent(\"adminNotificationsUpdated\", { detail: { unreadCount: count } }),\n  );\n}\n\ntype ListResponse = {\n  notifications: AdminNotification[];\n  hasMore: boolean;\n  unreadCount: number;\n  page: number;\n  limit: number;\n};\n\nexport default function AdminNotificationsPage() {\n  const limit = 20;\n\n  const [page, setPage] = useState(1);\n  const [data, setData] = useState<ListResponse | null>(null);\n  const [isLoading, setIsLoading] = useState(false);\n\n  // per-row 3-dot menu\n  const [menuOpenFor, setMenuOpenFor] = useState<string | null>(null);\n\n  // bulk delete mode\n  const [selectMode, setSelectMode] = useState(false);\n  const [selectedIds, setSelectedIds] = useState<Set<string>>(new Set());\n\n  // header delete hover menu (now click-to-open)\n  const [deleteMenuOpen, setDeleteMenuOpen] = useState(false);\n\n  // confirm modal\n  const [confirmDeleteAllOpen, setConfirmDeleteAllOpen] = useState(false);\n  const [isDeletingAll, setIsDeletingAll] = useState(false);\n\n  const notifications = data?.notifications ?? [];\n  const unreadCount = data?.unreadCount ?? 0;\n  const selectedCount = selectedIds.size;\n\n  // click-outside refs\n  const headerDeleteRef = useRef<HTMLDivElement | null>(null);\n  const rowMenuRef = useRef<HTMLDivElement | null>(null);\n\n  const load = async (nextPage = page) => {\n    setIsLoading(true);\n    try {\n      const res = await fetch(\n        `/api/admin/notifications?limit=${limit}&page=${nextPage}`,\n        {\n          cache: \"no-store\",\n        },\n      );\n      if (!res.ok) {\n        return;\n      }\n\n      const json = (await res.json()) as ListResponse;\n      setData(json);\n      setPage(json.page);\n\n      emitUnreadCountUpdated(json.unreadCount);\n    } catch (e) {\n      logError(e, { layer: \"frontend\", event: \"admin_notifications_center_load\" });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    load(1);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  // Close popups on outside click + Esc\n  useEffect(() => {\n    const onPointerDown = (e: PointerEvent) => {\n      const target = e.target as Node | null;\n      if (!target) {\n        return;\n      }\n\n      if (\n        deleteMenuOpen &&\n        headerDeleteRef.current &&\n        !headerDeleteRef.current.contains(target)\n      ) {\n        setDeleteMenuOpen(false);\n      }\n\n      if (menuOpenFor && rowMenuRef.current && !rowMenuRef.current.contains(target)) {\n        setMenuOpenFor(null);\n      }\n    };\n\n    const onKeyDown = (e: KeyboardEvent) => {\n      if (e.key === \"Escape\") {\n        setDeleteMenuOpen(false);\n        setMenuOpenFor(null);\n      }\n    };\n\n    document.addEventListener(\"pointerdown\", onPointerDown);\n    document.addEventListener(\"keydown\", onKeyDown);\n\n    return () => {\n      document.removeEventListener(\"pointerdown\", onPointerDown);\n      document.removeEventListener(\"keydown\", onKeyDown);\n    };\n  }, [deleteMenuOpen, menuOpenFor]);\n\n  const toggleSelected = (id: string) => {\n    setSelectedIds((prev) => {\n      const next = new Set(prev);\n      if (next.has(id)) {\n        next.delete(id);\n      } else {\n        next.add(id);\n      }\n      return next;\n    });\n  };\n\n  const enterSelectMode = (initialSelected?: string[]) => {\n    setSelectMode(true);\n    setMenuOpenFor(null);\n    setDeleteMenuOpen(false);\n    setSelectedIds(new Set(initialSelected ?? []));\n  };\n\n  const cancelSelectMode = () => {\n    setSelectMode(false);\n    setSelectedIds(new Set());\n    setMenuOpenFor(null);\n    setDeleteMenuOpen(false);\n  };\n\n  const deleteSelected = async () => {\n    const ids = Array.from(selectedIds);\n    if (ids.length === 0) {\n      return;\n    }\n\n    try {\n      const res = await fetch(\"/api/admin/notifications\", {\n        method: \"DELETE\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ ids }),\n      });\n\n      const json = await res.json().catch(() => ({}) as any);\n      if (!res.ok) {\n        return;\n      }\n\n      if (typeof json?.deletedCount === \"number\" && json.deletedCount === 0) {\n        // No-op: nothing deleted (already gone / none matched). This is NOT an error.\n        cancelSelectMode();\n        await load(page);\n        const afterCount = data?.notifications?.length ?? 0;\n        if (afterCount === 0 && page > 1) {\n          await load(page - 1);\n        }\n        return;\n      }\n\n      cancelSelectMode();\n\n      await load(page);\n      const afterCount = data?.notifications?.length ?? 0;\n      if (afterCount === 0 && page > 1) {\n        await load(page - 1);\n      }\n    } catch (e) {\n      logError(e, { layer: \"frontend\", event: \"admin_notifications_center_delete\" });\n    }\n  };\n\n  const confirmDeleteAll = async () => {\n    setIsDeletingAll(true);\n    try {\n      const res = await fetch(\"/api/admin/notifications\", {\n        method: \"DELETE\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ delete_all: true }),\n      });\n\n      const json = await res.json().catch(() => ({}) as any);\n      if (!res.ok) {\n        return;\n      }\n\n      if (typeof json?.deletedCount === \"number\" && json.deletedCount === 0) {\n        // No-op: nothing to delete. Not an error.\n        setConfirmDeleteAllOpen(false);\n        cancelSelectMode();\n        await load(1);\n        return;\n      }\n\n      setConfirmDeleteAllOpen(false);\n      cancelSelectMode();\n      await load(1);\n    } catch (e) {\n      logError(e, { layer: \"frontend\", event: \"admin_notifications_center_delete_all\" });\n    } finally {\n      setIsDeletingAll(false);\n    }\n  };\n\n  const markRead = async (id: string) => {\n    try {\n      await fetch(\"/api/admin/notifications\", {\n        method: \"PATCH\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ ids: [id] }),\n      });\n\n      setData((prev) =>\n        prev\n          ? {\n              ...prev,\n              unreadCount: Math.max(0, prev.unreadCount - 1),\n              notifications: prev.notifications.map((n) =>\n                n.id === id ? { ...n, read_at: new Date().toISOString() } : n,\n              ),\n            }\n          : prev,\n      );\n\n      emitUnreadCountUpdated(Math.max(0, unreadCount - 1));\n    } catch (e) {\n      logError(e, { layer: \"frontend\", event: \"admin_notifications_center_mark_read\" });\n    }\n  };\n\n  const markAllRead = async () => {\n    try {\n      await fetch(\"/api/admin/notifications\", {\n        method: \"PATCH\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ mark_all: true }),\n      });\n\n      setData((prev) =>\n        prev\n          ? {\n              ...prev,\n              unreadCount: 0,\n              notifications: prev.notifications.map((n) => ({\n                ...n,\n                read_at: n.read_at ?? new Date().toISOString(),\n              })),\n            }\n          : prev,\n      );\n      emitUnreadCountUpdated(0);\n    } catch (e) {\n      logError(e, { layer: \"frontend\", event: \"admin_notifications_center_mark_all\" });\n    }\n  };\n\n  return (\n    <div className=\"max-w-3xl mx-auto px-3 sm:px-4 py-6 sm:py-8\">\n      {/* Delete All Confirmation Modal */}\n      {confirmDeleteAllOpen && (\n        <div className=\"fixed inset-0 z-[100]\">\n          <div\n            className=\"absolute inset-0 bg-black/70\"\n            onClick={() => {\n              if (!isDeletingAll) {\n                setConfirmDeleteAllOpen(false);\n              }\n            }}\n          />\n          <div className=\"absolute inset-0 flex items-center justify-center p-4\">\n            <div className=\"w-full max-w-md bg-zinc-950 border border-zinc-800/70 shadow-2xl rounded-sm p-5\">\n              <div className=\"flex items-start justify-between gap-4\">\n                <div>\n                  <h3 className=\"text-white font-semibold text-base sm:text-lg\">\n                    Delete all notifications?\n                  </h3>\n                  <p className=\"text-zinc-400 text-[12px] sm:text-sm mt-1\">\n                    This will permanently delete your entire notification history.\n                  </p>\n                </div>\n                <button\n                  className=\"text-zinc-400 hover:text-white\"\n                  onClick={() => {\n                    if (!isDeletingAll) {\n                      setConfirmDeleteAllOpen(false);\n                    }\n                  }}\n                  aria-label=\"Close\"\n                >\n                  <X className=\"w-5 h-5\" />\n                </button>\n              </div>\n\n              <div className=\"mt-5 flex items-center justify-end gap-3\">\n                <button\n                  className=\"text-[11px] sm:text-xs text-zinc-400 hover:text-white\"\n                  onClick={() => setConfirmDeleteAllOpen(false)}\n                  disabled={isDeletingAll}\n                >\n                  Cancel\n                </button>\n                <button\n                  className=\"text-[11px] sm:text-xs font-semibold text-white bg-red-600 hover:bg-red-500 rounded-sm px-4 py-2 disabled:opacity-60\"\n                  onClick={() => {\n                    void confirmDeleteAll();\n                  }}\n                  disabled={isDeletingAll}\n                >\n                  {isDeletingAll ? \"Deleting...\" : \"Delete all\"}\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row sm:items-start justify-between gap-3 mb-6\">\n        <div>\n          <h1 className=\"text-xl sm:text-2xl font-bold text-white\">\n            Notification Center\n          </h1>\n          <p className=\"text-[11px] sm:text-xs text-zinc-500 mt-1\">\n            Unread: {unreadCount > 0 ? cap9(unreadCount) : \"0\"}\n          </p>\n        </div>\n\n        {selectMode ? (\n          <button\n            onClick={cancelSelectMode}\n            className=\"text-zinc-400 hover:text-white flex items-center gap-2 text-[11px] sm:text-xs\"\n          >\n            <X className=\"w-3.5 h-3.5 sm:w-4 sm:h-4\" />\n            Cancel\n          </button>\n        ) : (\n          <div className=\"flex flex-wrap items-center gap-3 text-[11px] sm:text-xs\">\n            <button\n              onClick={() => {\n                void load(page);\n              }}\n              className=\"text-zinc-400 hover:text-white\"\n            >\n              Refresh\n            </button>\n\n            <button\n              onClick={() => {\n                void markAllRead();\n              }}\n              className=\"text-zinc-400 hover:text-white\"\n            >\n              Mark all as read\n            </button>\n\n            {/* Header Delete (click-to-open + click-outside-to-close) */}\n            <div ref={headerDeleteRef} className=\"relative\">\n              <button\n                type=\"button\"\n                className=\"text-red-400 hover:text-red-300 flex items-center gap-2\"\n                aria-label=\"Delete menu\"\n                onClick={() => {\n                  setMenuOpenFor(null);\n                  setDeleteMenuOpen((v) => !v);\n                }}\n              >\n                <Trash2 className=\"w-3.5 h-3.5 sm:w-4 sm:h-4\" />\n                Delete\n              </button>\n\n              {deleteMenuOpen && (\n                <div className=\"absolute right-0 top-full mt-2 w-56 bg-zinc-950 border border-zinc-800/70 shadow-xl rounded-sm overflow-hidden z-50\">\n                  <button\n                    className=\"w-full text-left px-3 py-2 text-[12px] sm:text-sm hover:bg-zinc-900 text-white\"\n                    onClick={() => {\n                      setDeleteMenuOpen(false);\n                      enterSelectMode([]);\n                    }}\n                  >\n                    Select delete\n                  </button>\n\n                  <button\n                    className=\"w-full text-left px-3 py-2 text-[12px] sm:text-sm hover:bg-zinc-900 text-red-400\"\n                    onClick={() => {\n                      setDeleteMenuOpen(false);\n                      setConfirmDeleteAllOpen(true);\n                    }}\n                  >\n                    Delete all\n                  </button>\n                </div>\n              )}\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Selected banner */}\n      {selectMode && (\n        <div className=\"mb-4 flex items-center justify-between border border-zinc-800/70 bg-zinc-950 px-3 sm:px-4 py-2.5 sm:py-3 rounded-sm\">\n          <div className=\"text-[12px] sm:text-sm text-white\">\n            Selected: <span className=\"font-semibold\">{selectedCount}</span>\n          </div>\n\n          <button\n            onClick={() => {\n              void deleteSelected();\n            }}\n            disabled={selectedCount === 0}\n            className=\"text-[11px] sm:text-xs text-red-400 hover:text-red-300 disabled:opacity-50 flex items-center gap-2\"\n          >\n            <Trash2 className=\"w-3.5 h-3.5 sm:w-4 sm:h-4\" />\n            Delete selected\n          </button>\n        </div>\n      )}\n\n      {/* Body */}\n      {isLoading ? (\n        <div className=\"text-[12px] sm:text-sm text-zinc-500 py-10 text-center\">\n          Loading...\n        </div>\n      ) : notifications.length === 0 ? (\n        <div className=\"text-[12px] sm:text-sm text-zinc-500 py-10 text-center\">\n          No notifications yet.\n        </div>\n      ) : (\n        <div className=\"space-y-2\">\n          {notifications.map((n) => {\n            const isSelected = selectedIds.has(n.id);\n\n            return (\n              <div\n                key={n.id}\n                className=\"relative border border-zinc-800/70 bg-zinc-950 rounded-sm\"\n              >\n                {/* group hover makes entire row change bg (including 3-dot area) */}\n                <div className=\"group flex items-stretch\">\n                  {selectMode && (\n                    <div className=\"flex items-center px-2 sm:px-3 transition group-hover:bg-zinc-900\">\n                      <input\n                        type=\"checkbox\"\n                        checked={isSelected}\n                        onChange={() => toggleSelected(n.id)}\n                        className=\"rdk-checkbox\"\n                        aria-label=\"Select notification\"\n                      />\n                    </div>\n                  )}\n\n                  {/* Row click behavior:\n                      - normal mode: navigate + mark read\n                      - select mode: toggle selection (no navigation)\n                   */}\n                  <Link\n                    href={getNotificationHref(n)}\n                    onClick={(e) => {\n                      if (selectMode) {\n                        e.preventDefault();\n                        toggleSelected(n.id);\n                        return;\n                      }\n                      if (!n.read_at) {\n                        markRead(n.id);\n                      }\n                    }}\n                    className={`block flex-1 min-w-0 px-3 sm:px-4 py-2.5 sm:py-3 transition group-hover:bg-zinc-900 ${\n                      n.read_at ? \"text-zinc-400\" : \"text-white\"\n                    }`}\n                  >\n                    <div className=\"text-[12px] sm:text-sm font-medium break-words whitespace-pre-wrap\">\n                      {n.message}\n                    </div>\n                    <div className=\"text-[11px] sm:text-xs text-zinc-500 mt-1\">\n                      {formatTime(n.created_at)}\n                    </div>\n                  </Link>\n\n                  {/* 3-dot menu (click-to-open + click-outside-to-close) */}\n                  <div\n                    ref={menuOpenFor === n.id ? rowMenuRef : null}\n                    className=\"relative flex items-center pr-2 transition group-hover:bg-zinc-900\"\n                  >\n                    <button\n                      type=\"button\"\n                      onClick={(e) => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        if (selectMode) {\n                          return;\n                        }\n                        setDeleteMenuOpen(false);\n                        setMenuOpenFor((prev) => (prev === n.id ? null : n.id));\n                      }}\n                      className=\"text-zinc-500 hover:text-white px-2\"\n                      aria-label=\"More actions\"\n                    >\n                      <MoreVertical className=\"w-3.5 h-3.5 sm:w-4 sm:h-4\" />\n                    </button>\n\n                    {menuOpenFor === n.id && !selectMode && (\n                      <div className=\"absolute right-2 top-10 z-50 w-40 bg-zinc-950 border border-zinc-800/70 shadow-xl rounded-sm overflow-hidden\">\n                        <button\n                          className=\"w-full text-left text-[12px] sm:text-sm px-3 py-2 hover:bg-zinc-900 text-red-400\"\n                          onClick={(e) => {\n                            e.preventDefault();\n                            e.stopPropagation();\n                            setMenuOpenFor(null);\n                            enterSelectMode([n.id]); // auto-select clicked\n                          }}\n                        >\n                          Delete...\n                        </button>\n                      </div>\n                    )}\n                  </div>\n                </div>\n              </div>\n            );\n          })}\n        </div>\n      )}\n\n      {/* Pagination */}\n      <div className=\"mt-6 flex items-center justify-between\">\n        <button\n          type=\"button\"\n          onClick={() => {\n            void load(page - 1);\n          }}\n          disabled={page <= 1 || isLoading}\n          className=\"text-[11px] sm:text-xs text-zinc-400 hover:text-white disabled:opacity-50\"\n        >\n          Prev\n        </button>\n\n        <div className=\"text-[11px] sm:text-xs text-zinc-600\">Page {page}</div>\n\n        <button\n          type=\"button\"\n          onClick={() => {\n            void load(page + 1);\n          }}\n          disabled={!data?.hasMore || isLoading}\n          className=\"text-[11px] sm:text-xs text-zinc-400 hover:text-white disabled:opacity-50\"\n        >\n          Next\n        </button>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\admin\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\admin\\profile\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\admin\\sales\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[687,690],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[687,690],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react-hooks/exhaustive-deps').","line":104,"column":5,"severity":1,"nodeType":null,"fix":{"range":[3675,3730],"text":" "}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":113,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":113,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3899,3902],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3899,3902],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":121,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4143,4146],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4143,4146],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":124,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":124,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4238,4241],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4238,4241],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":146,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":146,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4889,4892],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4889,4892],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":453,"column":81,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":453,"endColumn":84,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16207,16210],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16207,16210],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":550,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":550,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21460,21463],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21460,21463],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":610,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":610,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24994,24997],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24994,24997],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":1,"source":"// app/admin/sales/page.tsx\n\"use client\";\n\nimport { Fragment, useEffect, useMemo, useState } from \"react\";\nimport { ChevronDown, Search } from \"lucide-react\";\n\nimport { logError } from \"@/lib/log\";\nimport { ConfirmDialog } from \"@/components/ui/ConfirmDialog\";\nimport { Toast } from \"@/components/ui/Toast\";\n\ntype TabKey = \"paid\" | \"refunded\";\n\nconst SALES_TABS: Array<{ key: TabKey; label: string; statuses: string[] }> = [\n  { key: \"paid\", label: \"Paid\", statuses: [\"paid\", \"shipped\"] },\n  {\n    key: \"refunded\",\n    label: \"Refunded\",\n    statuses: [\"refunded\", \"refund_pending\", \"refund_failed\"],\n  },\n];\n\nexport default function SalesPage() {\n  const [orders, setOrders] = useState<any[]>([]);\n  const [activeTab, setActiveTab] = useState<TabKey>(\"paid\");\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(true);\n  const [isRefundMode, setIsRefundMode] = useState(false);\n  const [page, setPage] = useState(1);\n  const [totalCount, setTotalCount] = useState(0);\n  const [counts, setCounts] = useState<Record<TabKey, number>>({ paid: 0, refunded: 0 });\n  const [refreshToken, setRefreshToken] = useState(0);\n  const [pendingRefundId, setPendingRefundId] = useState<string | null>(null);\n  const [selectedOrderId, setSelectedOrderId] = useState<string | null>(null);\n  const [expandedOrders, setExpandedOrders] = useState<Record<string, boolean>>({});\n  const [expandedDetails, setExpandedDetails] = useState<Record<string, boolean>>({});\n  const [toast, setToast] = useState<{\n    message: string;\n    tone: \"success\" | \"error\" | \"info\";\n  } | null>(null);\n\n  const PAGE_SIZE = 20;\n  const totalPages = Math.max(1, Math.ceil(totalCount / PAGE_SIZE));\n\n  useEffect(() => {\n    setPage(1);\n    setSelectedOrderId(null);\n    setIsRefundMode(false);\n  }, [activeTab]);\n\n  useEffect(() => {\n    setSelectedOrderId(null);\n    setIsRefundMode(false);\n  }, [page]);\n\n  useEffect(() => {\n    const loadOrders = async () => {\n      setIsLoading(true);\n      try {\n        const tab = SALES_TABS.find((entry) => entry.key === activeTab) ?? SALES_TABS[0];\n        const params = new URLSearchParams();\n        tab.statuses.forEach((status) => params.append(\"status\", status));\n        params.set(\"limit\", String(PAGE_SIZE));\n        params.set(\"page\", String(page));\n        const response = await fetch(`/api/admin/orders?${params.toString()}`);\n        const data = await response.json();\n        setOrders(data.orders || []);\n        setTotalCount(Number(data.count ?? 0));\n      } catch (error) {\n        logError(error, { layer: \"frontend\", event: \"admin_load_orders\" });\n      } finally {\n        setIsLoading(false);\n      }\n    };\n\n    loadOrders();\n  }, [activeTab, refreshToken, page]);\n\n  useEffect(() => {\n    const loadCounts = async () => {\n      try {\n        const results = await Promise.all(\n          SALES_TABS.map(async (tab) => {\n            const params = new URLSearchParams();\n            tab.statuses.forEach((status) => params.append(\"status\", status));\n            params.set(\"limit\", \"1\");\n            params.set(\"page\", \"1\");\n            const response = await fetch(`/api/admin/orders?${params.toString()}`);\n            const data = await response.json();\n            return { key: tab.key, count: Number(data.count ?? 0) };\n          }),\n        );\n\n        const nextCounts: Record<TabKey, number> = { paid: 0, refunded: 0 };\n        results.forEach((result) => {\n          nextCounts[result.key] = result.count;\n        });\n        setCounts(nextCounts);\n      } catch (error) {\n        logError(error, { layer: \"frontend\", event: \"admin_load_sales_counts\" });\n      }\n    };\n\n    loadCounts();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [refreshToken]);\n\n  useEffect(() => {\n    if (page > totalPages) {\n      setPage(totalPages);\n    }\n  }, [page, totalPages]);\n\n  const getCustomerHandle = (order: any) => {\n    const email = order.customer?.email ?? null;\n    if (email && email.includes(\"@\")) {\n      return email.split(\"@\")[0];\n    }\n    return order.user_id ? order.user_id.slice(0, 6) : \"Guest\";\n  };\n\n  const getCustomerEmail = (order: any) =>\n    order.customer?.email ?? order.guest_email ?? \"-\";\n\n  const getOrderTitle = (item: any) =>\n    (item.product?.title_display ??\n      `${item.product?.brand ?? \"\"} ${item.product?.name ?? \"\"}`.trim()) ||\n    \"Item\";\n\n  const summary = useMemo(() => {\n    let revenue = 0;\n    let profit = 0;\n    let totalSales = 0;\n\n    orders.forEach((order) => {\n      if (\n        order.status === \"paid\" ||\n        order.status === \"shipped\" ||\n        order.status === \"refunded\"\n      ) {\n        totalSales += 1;\n      }\n      const total = Number(order.total ?? 0);\n      const refundAmount = Number(order.refund_amount ?? 0) / 100;\n      revenue += total - refundAmount;\n\n      const itemCost = (order.items || []).reduce((sum: number, item: any) => {\n        const unitCost = Number(item.unit_cost ?? (item.variant?.cost_cents ?? 0) / 100);\n        return sum + unitCost * Number(item.quantity ?? 0);\n      }, 0);\n      profit += Number(order.subtotal ?? 0) - itemCost - refundAmount;\n    });\n\n    return { revenue, profit, totalSales };\n  }, [orders]);\n\n  const compactNumber = useMemo(\n    () =>\n      new Intl.NumberFormat(\"en-US\", { notation: \"compact\", maximumFractionDigits: 1 }),\n    [],\n  );\n\n  const compactMoney = (value: number) => `$${compactNumber.format(value)}`;\n\n  const filteredOrders = useMemo(() => {\n    const query = searchQuery.trim().toLowerCase();\n    if (!query) {\n      return orders;\n    }\n\n    return orders.filter((order) => {\n      const handle = getCustomerHandle(order).toLowerCase();\n      const email = getCustomerEmail(order).toLowerCase();\n      const createdAt = order.created_at ? new Date(order.created_at) : null;\n      const dateString = createdAt ? createdAt.toLocaleDateString().toLowerCase() : \"\";\n      const timeString = createdAt ? createdAt.toLocaleTimeString().toLowerCase() : \"\";\n      const isoString = createdAt ? createdAt.toISOString().slice(0, 10) : \"\";\n      const orderId = order.id ? String(order.id).toLowerCase() : \"\";\n      const fulfillment = (order.fulfillment ?? \"\").toString().toLowerCase();\n\n      return (\n        handle.includes(query) ||\n        email.includes(query) ||\n        dateString.includes(query) ||\n        timeString.includes(query) ||\n        isoString.includes(query) ||\n        orderId.includes(query) ||\n        fulfillment.includes(query)\n      );\n    });\n  }, [orders, searchQuery]);\n\n  const requestSelectedRefund = () => {\n    if (!selectedOrderId) {\n      return;\n    }\n    setPendingRefundId(selectedOrderId);\n  };\n\n  const confirmRefund = async () => {\n    if (!pendingRefundId) {\n      return;\n    }\n    const orderId = pendingRefundId;\n    setPendingRefundId(null);\n\n    try {\n      const response = await fetch(`/api/admin/orders/${orderId}/refund`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({}),\n      });\n\n      const data = await response.json().catch(() => ({}));\n\n      if (response.ok && data?.success !== false) {\n        setToast({ message: \"Order refunded.\", tone: \"success\" });\n        setRefreshToken((prev) => prev + 1);\n      } else {\n        setToast({ message: data?.error ?? \"Refund failed.\", tone: \"error\" });\n      }\n    } catch {\n      setToast({ message: \"Refund failed.\", tone: \"error\" });\n    }\n  };\n\n  const toggleOrderItems = (orderId: string) => {\n    setExpandedOrders((prev) => ({ ...prev, [orderId]: !prev[orderId] }));\n  };\n\n  const toggleOrderDetails = (orderId: string) => {\n    setExpandedDetails((prev) => ({ ...prev, [orderId]: !prev[orderId] }));\n  };\n\n  const cancelRefundMode = () => {\n    setIsRefundMode(false);\n    setSelectedOrderId(null);\n  };\n\n  const hasRefundableOrders =\n    activeTab === \"paid\" &&\n    orders.some((order) => order.status === \"paid\" || order.status === \"shipped\");\n\n  const renderPagination = () => {\n    if (totalPages <= 1) {\n      return null;\n    }\n\n    const pages: number[] = [];\n    const start = Math.max(1, page - 2);\n    const end = Math.min(totalPages, page + 2);\n\n    for (let p = start; p <= end; p += 1) {\n      pages.push(p);\n    }\n\n    return (\n      <div className=\"flex flex-wrap items-center gap-2\">\n        <button\n          type=\"button\"\n          onClick={() => setPage(Math.max(1, page - 1))}\n          disabled={page === 1}\n          className=\"px-3 py-2 rounded-sm border border-zinc-800/70 text-sm text-gray-300 disabled:text-zinc-600 disabled:border-zinc-900\"\n        >\n          Previous\n        </button>\n\n        {start > 1 && (\n          <button\n            type=\"button\"\n            onClick={() => setPage(1)}\n            className=\"px-3 py-2 rounded-sm border border-zinc-800/70 text-sm text-gray-300\"\n          >\n            1\n          </button>\n        )}\n        {start > 2 && <span className=\"text-gray-500\">...</span>}\n\n        {pages.map((p) => (\n          <button\n            key={p}\n            type=\"button\"\n            onClick={() => setPage(p)}\n            className={`px-3 py-2 rounded-sm border text-sm ${\n              p === page\n                ? \"border-red-600 text-white\"\n                : \"border-zinc-800/70 text-gray-300\"\n            }`}\n          >\n            {p}\n          </button>\n        ))}\n\n        {end < totalPages - 1 && <span className=\"text-gray-500\">...</span>}\n        {end < totalPages && (\n          <button\n            type=\"button\"\n            onClick={() => setPage(totalPages)}\n            className=\"px-3 py-2 rounded-sm border border-zinc-800/70 text-sm text-gray-300\"\n          >\n            {totalPages}\n          </button>\n        )}\n\n        <button\n          type=\"button\"\n          onClick={() => setPage(Math.min(totalPages, page + 1))}\n          disabled={page === totalPages}\n          className=\"px-3 py-2 rounded-sm border border-zinc-800/70 text-sm text-gray-300 disabled:text-zinc-600 disabled:border-zinc-900\"\n        >\n          Next\n        </button>\n      </div>\n    );\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex flex-wrap items-center justify-between gap-4\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-white mb-2\">Sales</h1>\n          <p className=\"text-gray-400\">Track orders and profit</p>\n        </div>\n\n        <div className=\"flex flex-wrap items-center gap-3\">\n          {isRefundMode ? (\n            <>\n              <button\n                type=\"button\"\n                onClick={requestSelectedRefund}\n                disabled={!selectedOrderId}\n                className=\"bg-red-600 hover:bg-red-700 disabled:bg-zinc-800 disabled:text-zinc-500 text-white px-4 py-2 rounded-sm text-sm transition\"\n              >\n                Refund selected\n              </button>\n              <button\n                type=\"button\"\n                onClick={cancelRefundMode}\n                className=\"bg-zinc-900 text-white px-4 py-2 rounded-sm text-sm border border-zinc-800/70\"\n              >\n                Cancel\n              </button>\n            </>\n          ) : (\n            <button\n              type=\"button\"\n              onClick={() => setIsRefundMode(true)}\n              disabled={!hasRefundableOrders}\n              className=\"bg-red-600 hover:bg-red-700 disabled:bg-zinc-800 disabled:text-zinc-500 text-white px-4 py-2 rounded-sm text-sm transition\"\n            >\n              Refund\n            </button>\n          )}\n        </div>\n      </div>\n\n      {/* Summary */}\n      <div className=\"grid grid-cols-3 md:grid-cols-3 gap-2 sm:gap-6\">\n        <div className=\"bg-zinc-900 border border-zinc-800/70 rounded p-3 sm:p-6\">\n          <span className=\"text-gray-400 text-[11px] sm:text-sm\">Total Sales</span>\n          <div className=\"text-lg sm:text-3xl font-bold text-white mt-1 sm:mt-2\">\n            <span className=\"sm:hidden\">{compactNumber.format(summary.totalSales)}</span>\n            <span className=\"hidden sm:inline\">{summary.totalSales}</span>\n          </div>\n        </div>\n        <div className=\"bg-zinc-900 border border-zinc-800/70 rounded p-3 sm:p-6\">\n          <span className=\"text-gray-400 text-[11px] sm:text-sm\">Revenue</span>\n          <div className=\"text-lg sm:text-3xl font-bold text-white mt-1 sm:mt-2\">\n            <span className=\"sm:hidden\">{compactMoney(summary.revenue)}</span>\n            <span className=\"hidden sm:inline\">${summary.revenue.toFixed(2)}</span>\n          </div>\n        </div>\n        <div className=\"bg-zinc-900 border border-zinc-800/70 rounded p-3 sm:p-6\">\n          <span className=\"text-gray-400 text-[11px] sm:text-sm\">Profit</span>\n          <div className=\"text-lg sm:text-3xl font-bold text-green-400 mt-1 sm:mt-2\">\n            <span className=\"sm:hidden\">{compactMoney(summary.profit)}</span>\n            <span className=\"hidden sm:inline\">${summary.profit.toFixed(2)}</span>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"border-b border-zinc-800/70 flex flex-wrap gap-6\">\n        {SALES_TABS.map((tab) => (\n          <button\n            key={tab.key}\n            onClick={() => setActiveTab(tab.key)}\n            className={`py-3 text-sm font-medium transition-colors flex items-center gap-2 ${\n              activeTab === tab.key\n                ? \"text-white border-b-2 border-red-600\"\n                : \"text-gray-400 hover:text-white border-b-2 border-transparent\"\n            }`}\n          >\n            {tab.label}\n            <span className=\"text-[11px] px-2 py-0.5 rounded-sm bg-zinc-900 border border-zinc-800/70 text-gray-300\">\n              {counts[tab.key] > 99 ? \"99+\" : counts[tab.key]}\n            </span>\n          </button>\n        ))}\n      </div>\n\n      <div className=\"flex items-center gap-2 bg-zinc-900 border border-zinc-800/70 px-3 py-2 max-w-md\">\n        <Search className=\"w-4 h-4 text-gray-500\" />\n        <input\n          type=\"text\"\n          value={searchQuery}\n          onChange={(event) => setSearchQuery(event.target.value)}\n          placeholder=\"Search by date, customer, email, or order\"\n          className=\"w-full bg-transparent text-sm text-white placeholder:text-gray-500 outline-none\"\n        />\n      </div>\n\n      {/* Sales List */}\n      <div className=\"bg-zinc-900 border border-zinc-800/70 rounded overflow-hidden\">\n        {isLoading ? (\n          <div className=\"text-center py-12 text-gray-400\">Loading...</div>\n        ) : (\n          <table className=\"w-full text-[12px] sm:text-sm\">\n            <thead>\n              <tr className=\"border-b border-zinc-800/70 bg-zinc-800\">\n                {isRefundMode && (\n                  <th className=\"text-left text-gray-400 font-semibold p-3 sm:p-4\">\n                    <span className=\"sr-only\">Select</span>\n                  </th>\n                )}\n                <th className=\"text-left text-gray-400 font-semibold p-3 sm:p-4\">\n                  Placed At\n                </th>\n                <th className=\"text-left text-gray-400 font-semibold p-3 sm:p-4\">\n                  Order\n                </th>\n                <th className=\"hidden md:table-cell text-left text-gray-400 font-semibold p-3 sm:p-4\">\n                  Customer\n                </th>\n                <th className=\"hidden md:table-cell text-left text-gray-400 font-semibold p-3 sm:p-4\">\n                  Email\n                </th>\n                <th className=\"hidden md:table-cell text-left text-gray-400 font-semibold p-3 sm:p-4\">\n                  Fulfillment\n                </th>\n                <th className=\"text-right text-gray-400 font-semibold p-3 sm:p-4\">\n                  Amount\n                </th>\n                <th className=\"hidden md:table-cell text-right text-gray-400 font-semibold p-3 sm:p-4\">\n                  Profit\n                </th>\n                <th className=\"text-left md:text-right text-gray-400 font-semibold p-3 sm:p-4\">\n                  <span className=\"hidden md:inline\">Items</span>\n                  <span className=\"md:hidden\">Details</span>\n                </th>\n              </tr>\n            </thead>\n            <tbody>\n              {filteredOrders.map((order) => {\n                const itemCost = (order.items || []).reduce((sum: number, item: any) => {\n                  const unitCost = Number(\n                    item.unit_cost ?? (item.variant?.cost_cents ?? 0) / 100,\n                  );\n                  return sum + unitCost * Number(item.quantity ?? 0);\n                }, 0);\n                const refundAmount = Number(order.refund_amount ?? 0) / 100;\n                const profit = Number(order.subtotal ?? 0) - itemCost - refundAmount;\n                const status = order.status ?? \"paid\";\n                const canRefund = status === \"paid\" || status === \"shipped\";\n                const createdAt = order.created_at ? new Date(order.created_at) : null;\n                const customerHandle = getCustomerHandle(order);\n                const customerEmail = getCustomerEmail(order);\n                const fulfillmentLabel =\n                  order.fulfillment === \"pickup\" ? \"Pickup\" : \"Ship\";\n                const itemsExpanded = expandedOrders[order.id] ?? false;\n                const detailsExpanded = expandedDetails[order.id] ?? false;\n                const colSpan = isRefundMode ? 9 : 8;\n\n                return (\n                  <Fragment key={order.id}>\n                    <tr className=\"border-b border-zinc-800/70 hover:bg-zinc-800\">\n                      {isRefundMode && (\n                        <td className=\"p-3 sm:p-4\">\n                          <input\n                            type=\"checkbox\"\n                            name=\"refundOrder\"\n                            className=\"rdk-checkbox\"\n                            checked={selectedOrderId === order.id}\n                            onChange={() =>\n                              setSelectedOrderId((prev) =>\n                                prev === order.id ? null : order.id,\n                              )\n                            }\n                            aria-label={`Select order ${order.id}`}\n                            disabled={!canRefund}\n                          />\n                        </td>\n                      )}\n                      <td className=\"p-3 sm:p-4 text-gray-400\">\n                        {createdAt ? (\n                          <div className=\"space-y-1\">\n                            <div>{createdAt.toLocaleDateString()}</div>\n                            <div className=\"text-xs text-gray-500\">\n                              {createdAt.toLocaleTimeString([], {\n                                hour: \"2-digit\",\n                                minute: \"2-digit\",\n                              })}\n                            </div>\n                          </div>\n                        ) : (\n                          \"-\"\n                        )}\n                      </td>\n                      <td className=\"p-3 sm:p-4 text-white\">#{order.id.slice(0, 8)}</td>\n                      <td className=\"hidden md:table-cell p-3 sm:p-4 text-gray-400\">\n                        {customerHandle}\n                      </td>\n                      <td className=\"hidden md:table-cell p-3 sm:p-4 text-gray-400\">\n                        {customerEmail}\n                      </td>\n                      <td className=\"hidden md:table-cell p-3 sm:p-4 text-gray-400\">\n                        {fulfillmentLabel}\n                      </td>\n                      <td className=\"p-3 sm:p-4 text-right text-white\">\n                        ${Number(order.total ?? 0).toFixed(2)}\n                      </td>\n                      <td className=\"hidden md:table-cell p-3 sm:p-4 text-right text-green-400\">\n                        +${profit.toFixed(2)}\n                      </td>\n                      <td className=\"p-3 sm:p-4 text-left md:text-right\">\n                        <button\n                          type=\"button\"\n                          onClick={() => toggleOrderItems(order.id)}\n                          className=\"hidden md:inline-flex text-sm text-red-400 hover:text-red-300 items-center gap-2\"\n                        >\n                          {itemsExpanded ? \"Hide items\" : \"View items\"}\n                          <ChevronDown\n                            className={`w-4 h-4 transition-transform ${itemsExpanded ? \"rotate-180\" : \"\"}`}\n                          />\n                        </button>\n                        <button\n                          type=\"button\"\n                          onClick={() => toggleOrderDetails(order.id)}\n                          className=\"md:hidden w-full text-[12px] text-red-400 hover:text-red-300 inline-flex items-center justify-start gap-1 leading-none whitespace-nowrap\"\n                        >\n                          {detailsExpanded ? \"Hide details\" : \"View details\"}\n                          <ChevronDown\n                            className={`w-4 h-4 transition-transform ${detailsExpanded ? \"rotate-180\" : \"\"}`}\n                          />\n                        </button>\n                      </td>\n                    </tr>\n                    {itemsExpanded && (\n                      <tr className=\"hidden md:table-row border-b border-zinc-800/70 bg-zinc-900/40\">\n                        <td colSpan={colSpan} className=\"px-3 pb-3 pt-2 sm:px-4 sm:pb-4\">\n                          <div className=\"grid gap-3 sm:grid-cols-2\">\n                            {(order.items ?? []).map((item: any) => (\n                              <div\n                                key={item.id}\n                                className=\"flex items-center justify-between text-sm text-gray-400\"\n                              >\n                                <div className=\"min-w-0\">\n                                  <div className=\"text-white truncate\">\n                                    {getOrderTitle(item)}\n                                  </div>\n                                  <div className=\"text-xs text-gray-500\">\n                                    Size {item.variant?.size_label ?? \"N/A\"} - Qty{\" \"}\n                                    {item.quantity}\n                                  </div>\n                                </div>\n                                <div className=\"text-white\">\n                                  ${Number(item.line_total ?? 0).toFixed(2)}\n                                </div>\n                              </div>\n                            ))}\n                          </div>\n                        </td>\n                      </tr>\n                    )}\n                    {detailsExpanded && (\n                      <tr className=\"md:hidden border-b border-zinc-800/70 bg-zinc-900/40\">\n                        <td colSpan={colSpan} className=\"px-3 pb-3 pt-3 sm:px-4 sm:pb-4\">\n                          <div className=\"space-y-3 text-sm\">\n                            <div className=\"flex items-center justify-between gap-4\">\n                              <span className=\"text-gray-500\">Placed</span>\n                              <span className=\"text-white\">\n                                {createdAt\n                                  ? `${createdAt.toLocaleDateString()} ${createdAt.toLocaleTimeString([], { hour: \"2-digit\", minute: \"2-digit\" })}`\n                                  : \"-\"}\n                              </span>\n                            </div>\n                            <div className=\"flex items-center justify-between gap-4\">\n                              <span className=\"text-gray-500\">Customer</span>\n                              <span className=\"text-white\">{customerHandle}</span>\n                            </div>\n                            <div className=\"flex items-center justify-between gap-4\">\n                              <span className=\"text-gray-500\">Email</span>\n                              <span className=\"text-white truncate\">{customerEmail}</span>\n                            </div>\n                            <div className=\"flex items-center justify-between gap-4\">\n                              <span className=\"text-gray-500\">Fulfillment</span>\n                              <span className=\"text-white\">{fulfillmentLabel}</span>\n                            </div>\n                            <div className=\"flex items-center justify-between gap-4\">\n                              <span className=\"text-gray-500\">Profit</span>\n                              <span className=\"text-green-400\">\n                                +${profit.toFixed(2)}\n                              </span>\n                            </div>\n                          </div>\n\n                          <div className=\"mt-4 border-t border-zinc-800/70 pt-4\">\n                            <div className=\"text-[11px] uppercase tracking-wide text-gray-500 mb-2\">\n                              Items\n                            </div>\n                            <div className=\"space-y-2\">\n                              {(order.items ?? []).map((item: any) => (\n                                <div\n                                  key={item.id}\n                                  className=\"flex items-start justify-between gap-3 text-sm\"\n                                >\n                                  <div className=\"min-w-0\">\n                                    <div className=\"text-white truncate\">\n                                      {getOrderTitle(item)}\n                                    </div>\n                                    <div className=\"text-xs text-gray-500\">\n                                      Size {item.variant?.size_label ?? \"N/A\"} - Qty{\" \"}\n                                      {item.quantity}\n                                    </div>\n                                  </div>\n                                  <div className=\"text-white\">\n                                    ${Number(item.line_total ?? 0).toFixed(2)}\n                                  </div>\n                                </div>\n                              ))}\n                            </div>\n                          </div>\n                        </td>\n                      </tr>\n                    )}\n                  </Fragment>\n                );\n              })}\n            </tbody>\n          </table>\n        )}\n      </div>\n\n      {renderPagination()}\n\n      <ConfirmDialog\n        isOpen={Boolean(pendingRefundId)}\n        title=\"Refund order?\"\n        description={\n          pendingRefundId\n            ? `This will refund order #${pendingRefundId.slice(0, 8)} in full.`\n            : undefined\n        }\n        confirmLabel=\"Refund\"\n        onConfirm={() => {\n          void confirmRefund();\n        }}\n        onCancel={() => setPendingRefundId(null)}\n      />\n      <Toast\n        open={Boolean(toast)}\n        message={toast?.message ?? \"\"}\n        tone={toast?.tone ?? \"info\"}\n        onClose={() => setToast(null)}\n      />\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\admin\\settings\\shipping\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\admin\\settings\\taxes\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\admin\\settings\\transfers\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\admin\\settings\\transfers\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":79,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2815,2818],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2815,2818],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":200,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":200,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6583,6586],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6583,6586],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":220,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":220,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7302,7305],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7302,7305],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// app/admin/settings/transfers/page.tsx\n\"use client\";\n\nimport { useEffect, useMemo, useState } from \"react\";\nimport { AlertCircle, Loader2, Save } from \"lucide-react\";\n\nimport { logError } from \"@/lib/log\";\nimport { Toast } from \"@/components/ui/Toast\";\nimport { RdkSelect } from \"@/components/ui/Select\";\nimport { BankAccountManagementModal } from \"@/components/admin/stripe/BankAccountManagementModal\";\n\ntype BankAccount = {\n  id: string;\n  bank_name: string | null;\n  last4: string | null;\n  currency: string | null;\n  account_holder_name: string | null;\n  default_for_currency: boolean;\n};\n\nconst WEEKLY_ANCHORS = [\n  { value: \"sunday\", label: \"Sunday\" },\n  { value: \"monday\", label: \"Monday\" },\n  { value: \"tuesday\", label: \"Tuesday\" },\n  { value: \"wednesday\", label: \"Wednesday\" },\n  { value: \"thursday\", label: \"Thursday\" },\n  { value: \"friday\", label: \"Friday\" },\n  { value: \"saturday\", label: \"Saturday\" },\n] as const;\n\nconst PAYOUT_INTERVAL_OPTIONS = [\n  { value: \"manual\", label: \"Manual - Payout when I choose\" },\n  { value: \"daily\", label: \"Automatic - Every day\" },\n  { value: \"weekly\", label: \"Automatic - Once per week\" },\n  { value: \"monthly\", label: \"Automatic - Once per month\" },\n];\n\nexport default function TransferSettingsPage() {\n  const publishableKey = process.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY ?? \"\";\n\n  const [isLoading, setIsLoading] = useState(true);\n  const [isSaving, setIsSaving] = useState(false);\n  const [errorMessage, setErrorMessage] = useState(\"\");\n  const [bankAccounts, setBankAccounts] = useState<BankAccount[]>([]);\n  const [toast, setToast] = useState<{\n    message: string;\n    tone: \"success\" | \"error\";\n  } | null>(null);\n\n  const [bankModalOpen, setBankModalOpen] = useState(false);\n\n  const [scheduleForm, setScheduleForm] = useState<{\n    interval: \"manual\" | \"daily\" | \"weekly\" | \"monthly\";\n    weekly_anchor: (typeof WEEKLY_ANCHORS)[number][\"value\"];\n    monthly_anchor: number;\n  }>({ interval: \"daily\", weekly_anchor: \"monday\", monthly_anchor: 1 });\n\n  const fetchData = async () => {\n    setIsLoading(true);\n    try {\n      const response = await fetch(\"/api/admin/stripe/account\", { cache: \"no-store\" });\n      if (!response.ok) {\n        throw new Error(\"Failed to fetch account data\");\n      }\n      const data = await response.json();\n\n      setBankAccounts(data.bank_accounts ?? []);\n\n      const interval = data.payout_schedule?.interval || \"daily\";\n      const validInterval = [\"manual\", \"daily\", \"weekly\", \"monthly\"].includes(interval)\n        ? interval\n        : \"daily\";\n      const weeklyAnchor =\n        WEEKLY_ANCHORS.find((a) => a.value === data.payout_schedule?.weekly_anchor)\n          ?.value ?? \"monday\";\n      const monthlyAnchor = data.payout_schedule?.monthly_anchor ?? 1;\n\n      setScheduleForm({\n        interval: validInterval as any,\n        weekly_anchor: weeklyAnchor,\n        monthly_anchor: monthlyAnchor,\n      });\n\n      setErrorMessage(\"\");\n    } catch (error) {\n      logError(error, { layer: \"frontend\", event: \"fetch_transfer_settings\" });\n      setErrorMessage(\"Could not load bank settings.\");\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    fetchData();\n  }, []);\n\n  const handleSaveSchedule = async () => {\n    setIsSaving(true);\n    try {\n      const response = await fetch(\"/api/admin/stripe/payout-schedule\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(scheduleForm),\n      });\n\n      if (!response.ok) {\n        const data = await response.json().catch(() => ({}));\n        throw new Error(data?.error ?? \"Failed to update schedule\");\n      }\n\n      setToast({ message: \"Bank settings saved successfully\", tone: \"success\" });\n    } catch (error) {\n      logError(error, { layer: \"frontend\", event: \"save_payout_schedule\" });\n      setToast({ message: \"Failed to save bank settings\", tone: \"error\" });\n    } finally {\n      setIsSaving(false);\n    }\n  };\n\n  const primaryBank = useMemo(() => {\n    return bankAccounts.find((b) => b.default_for_currency) ?? bankAccounts[0] ?? null;\n  }, [bankAccounts]);\n\n  const monthlyOptions = useMemo(\n    () =>\n      Array.from({ length: 31 }, (_, i) => ({\n        value: String(i + 1),\n        label: `Day ${i + 1}`,\n      })),\n    [],\n  );\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center gap-3 mb-8\">\n          <div>\n            <h1 className=\"text-2xl sm:text-3xl font-bold text-white\">Bank Settings</h1>\n            <p className=\"text-zinc-400 text-sm sm:text-base mt-1\">\n              Configure your payout preferences\n            </p>\n          </div>\n        </div>\n        <div className=\"flex items-center justify-center py-20\">\n          <Loader2 className=\"w-6 h-6 animate-spin text-red-500\" />\n        </div>\n      </div>\n    );\n  }\n\n  if (errorMessage) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center gap-3 mb-8\">\n          <div>\n            <h1 className=\"text-2xl sm:text-3xl font-bold text-white\">Bank Settings</h1>\n          </div>\n        </div>\n        <div className=\"rounded-sm bg-zinc-900 border border-red-900/70 p-6\">\n          <div className=\"flex items-center gap-3\">\n            <AlertCircle className=\"w-5 h-5 text-red-500\" />\n            <p className=\"text-red-400 text-[12px] sm:text-sm\">{errorMessage}</p>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-8\">\n      {/* Header */}\n      <div className=\"flex items-center gap-3\">\n        <div>\n          <h1 className=\"text-2xl sm:text-3xl font-bold text-white\">Bank Settings</h1>\n          <p className=\"text-zinc-400 text-sm sm:text-base mt-1\">\n            Configure your payout preferences\n          </p>\n        </div>\n      </div>\n\n      {/* Payout Mode */}\n      <section className=\"rounded-sm bg-zinc-900 border border-zinc-800/70 p-4 sm:p-6\">\n        <h2 className=\"text-base sm:text-lg font-semibold text-white mb-4\">\n          Payout Mode\n        </h2>\n        <p className=\"text-xs sm:text-sm text-zinc-400 mb-6\">\n          Choose between automatic scheduled payouts or manual payouts when you need them.\n        </p>\n\n        <div className=\"space-y-4\">\n          <div>\n            <label className=\"block text-[12px] sm:text-sm text-zinc-300 mb-2\">\n              Mode\n            </label>\n            <RdkSelect\n              value={scheduleForm.interval}\n              onChange={(value) =>\n                setScheduleForm((prev) => ({\n                  ...prev,\n                  interval: value as any,\n                }))\n              }\n              options={PAYOUT_INTERVAL_OPTIONS}\n              className=\"w-full max-w-md\"\n              buttonClassName=\"px-3 py-1.5 text-[12px] sm:text-sm\"\n              menuClassName=\"text-[12px] sm:text-sm\"\n            />\n          </div>\n\n          {scheduleForm.interval === \"weekly\" && (\n            <div>\n              <label className=\"block text-[12px] sm:text-sm text-zinc-300 mb-2\">\n                Day of week\n              </label>\n              <RdkSelect\n                value={scheduleForm.weekly_anchor}\n                onChange={(value) =>\n                  setScheduleForm((prev) => ({\n                    ...prev,\n                    weekly_anchor: value as any,\n                  }))\n                }\n                options={WEEKLY_ANCHORS.map((anchor) => ({\n                  value: anchor.value,\n                  label: anchor.label,\n                }))}\n                className=\"w-full max-w-md\"\n                buttonClassName=\"px-3 py-1.5 text-[12px] sm:text-sm\"\n                menuClassName=\"text-[12px] sm:text-sm\"\n              />\n            </div>\n          )}\n\n          {scheduleForm.interval === \"monthly\" && (\n            <div>\n              <label className=\"block text-[12px] sm:text-sm text-zinc-300 mb-2\">\n                Day of month\n              </label>\n              <RdkSelect\n                value={String(scheduleForm.monthly_anchor)}\n                onChange={(value) =>\n                  setScheduleForm((prev) => ({\n                    ...prev,\n                    monthly_anchor: Number(value),\n                  }))\n                }\n                options={monthlyOptions}\n                className=\"w-full max-w-md\"\n                buttonClassName=\"px-3 py-1.5 text-[12px] sm:text-sm\"\n                menuClassName=\"text-[12px] sm:text-sm\"\n              />\n            </div>\n          )}\n\n          {scheduleForm.interval === \"manual\" ? (\n            <div className=\"rounded-sm bg-zinc-950 border border-zinc-800/70 p-3 sm:p-4 text-[12px] sm:text-sm text-zinc-400\">\n              Manual mode is enabled. Create payouts from the{\" \"}\n              <span className=\"text-zinc-200\">Bank</span> page.\n            </div>\n          ) : null}\n\n          <div className=\"pt-4\">\n            <button\n              type=\"button\"\n              onClick={() => {\n                void handleSaveSchedule();\n              }}\n              disabled={isSaving}\n              className=\"inline-flex items-center gap-2 px-6 py-2.5 bg-red-600 text-white text-[12px] sm:text-sm hover:bg-red-500 disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              {isSaving ? (\n                <>\n                  <Loader2 className=\"w-4 h-4 animate-spin\" />\n                  Saving...\n                </>\n              ) : (\n                <>\n                  <Save className=\"w-4 h-4\" />\n                  Save Settings\n                </>\n              )}\n            </button>\n          </div>\n        </div>\n      </section>\n\n      {/* Linked Bank Account */}\n      <section className=\"rounded-sm bg-zinc-900 border border-zinc-800/70 p-4 sm:p-6\">\n        <div className=\"flex items-start justify-between gap-4\">\n          <div>\n            <h2 className=\"text-base sm:text-lg font-semibold text-white mb-2\">\n              Linked Bank Account\n            </h2>\n            <p className=\"text-xs sm:text-sm text-zinc-400\">\n              Your payouts will be sent to this bank account.\n            </p>\n          </div>\n\n          <button\n            type=\"button\"\n            onClick={() => {\n              if (!publishableKey) {\n                setToast({\n                  message: \"Missing NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY.\",\n                  tone: \"error\",\n                });\n                return;\n              }\n              setBankModalOpen(true);\n            }}\n            className=\"px-3 py-1.5 sm:px-4 sm:py-2 bg-red-600 text-white text-[12px] sm:text-sm hover:bg-red-500 whitespace-nowrap\"\n          >\n            Manage bank accounts\n          </button>\n        </div>\n\n        <div className=\"mt-6\">\n          {primaryBank ? (\n            <div className=\"rounded-sm bg-zinc-950 border border-zinc-800/70 p-4 sm:p-5\">\n              <div className=\"flex items-start justify-between gap-4\">\n                <div className=\"space-y-2\">\n                  <div>\n                    <p className=\"text-white font-medium text-base sm:text-lg\">\n                      {primaryBank.bank_name ?? \"Bank Account\"}\n                    </p>\n                    <span className=\"inline-block mt-1 px-2 py-0.5 text-[10px] uppercase tracking-wider bg-green-500/10 text-green-400 border border-green-500/20 rounded-sm\">\n                      Default\n                    </span>\n                  </div>\n\n                  <div className=\"space-y-1 text-[12px] sm:text-sm\">\n                    {primaryBank.account_holder_name && (\n                      <p className=\"text-zinc-400\">\n                        <span className=\"text-zinc-500\">Account holder:</span>{\" \"}\n                        {primaryBank.account_holder_name}\n                      </p>\n                    )}\n                    {primaryBank.last4 && (\n                      <p className=\"text-zinc-400\">\n                        <span className=\"text-zinc-500\">Account ending:</span> {\" \"}\n                        {primaryBank.last4}\n                      </p>\n                    )}\n                    {primaryBank.currency && (\n                      <p className=\"text-zinc-400\">\n                        <span className=\"text-zinc-500\">Currency:</span>{\" \"}\n                        {primaryBank.currency.toUpperCase()}\n                      </p>\n                    )}\n                  </div>\n                </div>\n              </div>\n            </div>\n          ) : (\n            <div className=\"rounded-sm bg-zinc-950 border border-zinc-800/70 p-6 text-center\">\n              <p className=\"text-zinc-400 text-[12px] sm:text-sm mb-2\">\n                No bank account connected yet.\n              </p>\n              <p className=\"text-zinc-600 text-[11px] sm:text-xs\">\n                Click Manage bank accounts to add one.\n              </p>\n            </div>\n          )}\n\n          <div className=\"mt-4 p-3 sm:p-4 rounded-sm bg-zinc-950 border border-zinc-800/70\">\n            <p className=\"text-[11px] sm:text-xs text-zinc-500\">\n              <strong className=\"text-zinc-400\">Note:</strong> Bank account management is\n              handled through embedded Stripe tools. Your app never receives bank account\n              numbers.\n            </p>\n          </div>\n        </div>\n      </section>\n\n      <BankAccountManagementModal\n        open={bankModalOpen}\n        onClose={() => setBankModalOpen(false)}\n        publishableKey={publishableKey}\n        onUpdated={fetchData}\n      />\n\n      <Toast\n        open={Boolean(toast)}\n        message={toast?.message ?? \"\"}\n        tone={toast?.tone ?? \"info\"}\n        onClose={() => setToast(null)}\n      />\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\admin\\shipping\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":121,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3668,3671],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3668,3671],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":134,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":134,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4041,4044],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4041,4044],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":136,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":136,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4132,4135],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4132,4135],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":142,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":142,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4363,4366],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4363,4366],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":163,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5173,5176],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5173,5176],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":170,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":170,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5559,5562],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5559,5562],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react-hooks/exhaustive-deps').","line":235,"column":5,"severity":1,"nodeType":null,"fix":{"range":[7724,7779],"text":" "}},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react-hooks/exhaustive-deps').","line":241,"column":5,"severity":1,"nodeType":null,"fix":{"range":[7880,7935],"text":" "}},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react-hooks/exhaustive-deps').","line":251,"column":5,"severity":1,"nodeType":null,"fix":{"range":[8094,8149],"text":" "}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":302,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":302,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9744,9747],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9744,9747],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":320,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":320,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10172,10175],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10172,10175],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":346,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":346,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11353,11356],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11353,11356],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":391,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":391,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12889,12892],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12889,12892],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":405,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":405,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13225,13228],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13225,13228],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":496,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":496,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15999,16002],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15999,16002],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":498,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":498,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16085,16088],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16085,16088],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":625,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":625,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21145,21148],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21145,21148],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":714,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":714,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25161,25164],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25161,25164],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react-hooks/exhaustive-deps').","line":753,"column":5,"severity":1,"nodeType":null,"fix":{"range":[26596,26651],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":19,"fixableErrorCount":0,"fixableWarningCount":4,"source":"// app/admin/shipping/page.tsx\n\"use client\";\n\nimport { Fragment, useEffect, useMemo, useState } from \"react\";\nimport { ChevronDown, ExternalLink, AlertCircle } from \"lucide-react\";\n\nimport { logError } from \"@/lib/log\";\nimport { CreateLabelForm } from \"@/components/admin/shipping/CreateLabelForm\";\nimport { ConfirmDialog } from \"@/components/ui/ConfirmDialog\";\n\nimport { OriginModal } from \"../../../src/components/admin/shipping/OriginModal\";\nimport type {\n  ShippingAddress,\n  ShippingDefault,\n  ShippingOrigin,\n  TabKey,\n} from \"../../../src/types/domain/shipping\";\n\nconst PAGE_SIZE = 8;\nconst DEFAULT_PACKAGE = { weight: 16, length: 12, width: 12, height: 12 };\nconst EMPTY_ORIGIN: ShippingOrigin = {\n  name: \"\",\n  company: \"\",\n  phone: \"\",\n  line1: \"\",\n  line2: \"\",\n  city: \"\",\n  state: \"\",\n  postal_code: \"\",\n  country: \"US\",\n};\n\nconst TABS: Array<{ key: TabKey; label: string; status: string }> = [\n  { key: \"label\", label: \"Review & Create Label\", status: \"unfulfilled\" },\n  { key: \"ready\", label: \"Need to Ship\", status: \"ready_to_ship\" },\n  { key: \"shipped\", label: \"Shipped\", status: \"shipped\" },\n  { key: \"delivered\", label: \"Delivered\", status: \"delivered\" },\n];\n\nconst getTrackingUrl = (carrier?: string | null, trackingNumber?: string | null) => {\n  if (!trackingNumber) {\n    return null;\n  }\n  const normalized = (carrier ?? \"\").toLowerCase();\n  const encodedTracking = encodeURIComponent(trackingNumber);\n\n  if (normalized.includes(\"ups\")) {\n    return `https://www.ups.com/track?loc=en_US&tracknum=${encodedTracking}`;\n  }\n  if (normalized.includes(\"usps\")) {\n    return `https://tools.usps.com/go/TrackConfirmAction?tLabels=${encodedTracking}`;\n  }\n  if (normalized.includes(\"fedex\") || normalized.includes(\"fed ex\")) {\n    return `https://www.fedex.com/fedextrack/?trknbr=${encodedTracking}`;\n  }\n  if (normalized.includes(\"dhl\")) {\n    return `https://www.dhl.com/us-en/home/tracking/tracking-express.html?submit=1&tracking-id=${encodedTracking}`;\n  }\n\n  return null;\n};\n\nconst resolveShippingAddress = (value: unknown): ShippingAddress | null => {\n  if (!value) {\n    return null;\n  }\n  if (Array.isArray(value)) {\n    return (value[0] ?? null) as ShippingAddress | null;\n  }\n  if (typeof value === \"object\") {\n    return value as ShippingAddress;\n  }\n  return null;\n};\n\nconst formatAddress = (address: ShippingAddress | null) => {\n  if (!address) {\n    return null;\n  }\n  const clean = (value?: string | null) => (value ?? \"\").trim();\n  const line1 = [clean(address.line1), clean(address.line2)].filter(Boolean).join(\", \");\n  const line2 = [clean(address.city), clean(address.state), clean(address.postal_code)]\n    .filter(Boolean)\n    .join(\", \");\n  const parts = [clean(address.name), line1, line2, clean(address.country)].filter(\n    Boolean,\n  );\n  return parts.join(\" - \");\n};\n\nconst formatOriginAddress = (origin: ShippingOrigin | null) => {\n  if (!origin) {\n    return null;\n  }\n  const clean = (value?: string | null) => (value ?? \"\").trim();\n  const line1 = [clean(origin.line1), clean(origin.line2)].filter(Boolean).join(\", \");\n  const line2 = [clean(origin.city), clean(origin.state), clean(origin.postal_code)]\n    .filter(Boolean)\n    .join(\", \");\n  const parts = [\n    clean(origin.name),\n    clean(origin.company),\n    line1,\n    line2,\n    clean(origin.country),\n  ].filter(Boolean);\n  return parts.join(\" - \");\n};\n\nconst formatPlacedAt = (value?: string | null) => {\n  if (!value) {\n    return { date: \"-\", time: \"\" };\n  }\n  const date = new Date(value);\n  return {\n    date: date.toLocaleDateString(),\n    time: date.toLocaleTimeString([], { hour: \"2-digit\", minute: \"2-digit\" }),\n  };\n};\n\nconst getCustomerHandle = (order: any) => {\n  const email = order.profiles?.email ?? null;\n  if (email && email.includes(\"@\")) {\n    return email.split(\"@\")[0];\n  }\n  const address = resolveShippingAddress(order.shipping);\n  const name = address?.name?.trim();\n  if (name) {\n    return name.split(\" \")[0];\n  }\n  return order.user_id ? order.user_id.slice(0, 6) : \"Guest\";\n};\n\nconst getPrimaryImage = (item: any) => {\n  const images = item.product?.images ?? [];\n  const primary = images.find((img: any) => img.is_primary) ?? images[0];\n  return primary?.url ?? \"/images/boxes.png\";\n};\n\nexport default function ShippingPage() {\n  const [activeTab, setActiveTab] = useState<TabKey>(\"label\");\n  const [orders, setOrders] = useState<any[]>([]);\n  const [isLoading, setIsLoading] = useState(true);\n  const [expandedItems, setExpandedItems] = useState<Record<string, boolean>>({});\n  const [expandedDetails, setExpandedDetails] = useState<Record<string, boolean>>({});\n  const [shippingDefaults, setShippingDefaults] = useState<\n    Record<string, ShippingDefault>\n  >({});\n  const [pageByTab, setPageByTab] = useState<Record<TabKey, number>>({\n    label: 1,\n    ready: 1,\n    shipped: 1,\n    delivered: 1,\n  });\n  const [counts, setCounts] = useState<Record<TabKey, number>>({\n    label: 0,\n    ready: 0,\n    shipped: 0,\n    delivered: 0,\n  });\n  const [refreshToken, setRefreshToken] = useState(0);\n  const [markingShippedId, setMarkingShippedId] = useState<string | null>(null);\n  const [confirmMarkShipped, setConfirmMarkShipped] = useState<any | null>(null);\n  const [originAddress, setOriginAddress] = useState<ShippingOrigin | null>(null);\n  const [originModalOpen, setOriginModalOpen] = useState(false);\n  const [originMessage, setOriginMessage] = useState(\"\");\n  const [originError, setOriginError] = useState(\"\");\n  const [savingOrigin, setSavingOrigin] = useState(false);\n\n  const [labelOrder, setLabelOrder] = useState<any | null>(null);\n\n  const currentPage = pageByTab[activeTab];\n  const activeCount = counts[activeTab] ?? 0;\n  const totalPages = Math.max(1, Math.ceil(activeCount / PAGE_SIZE));\n\n  const loadShippingDefaults = async () => {\n    try {\n      const response = await fetch(\"/api/admin/shipping/defaults\", { cache: \"no-store\" });\n      if (!response.ok) {\n        throw new Error(\"Failed to load shipping defaults\");\n      }\n      const data = await response.json();\n      const defaultsMap: Record<string, ShippingDefault> = {};\n      (data.defaults ?? []).forEach((entry: ShippingDefault) => {\n        defaultsMap[entry.category] = entry;\n      });\n      setShippingDefaults(defaultsMap);\n    } catch (error) {\n      logError(error, { layer: \"frontend\", event: \"admin_load_shipping_defaults\" });\n    }\n  };\n\n  const loadOriginAddress = async () => {\n    try {\n      const response = await fetch(\"/api/admin/shipping/origin\", { cache: \"no-store\" });\n      if (!response.ok) {\n        throw new Error(\"Failed to load shipping origin\");\n      }\n      const data = await response.json();\n      setOriginAddress(data.origin ?? null);\n    } catch (error) {\n      logError(error, { layer: \"frontend\", event: \"admin_load_shipping_origin\" });\n      setOriginAddress(null);\n    }\n  };\n\n  useEffect(() => {\n    const loadCounts = async () => {\n      try {\n        const results = await Promise.all(\n          TABS.map(async (tab) => {\n            const params = new URLSearchParams({\n              fulfillment: \"ship\",\n              fulfillmentStatus: tab.status,\n              limit: \"1\",\n              page: \"1\",\n            });\n            const response = await fetch(`/api/admin/orders?${params.toString()}`);\n            const data = await response.json();\n            return { key: tab.key, count: Number(data.count ?? 0) };\n          }),\n        );\n\n        const nextCounts = { ...counts };\n        results.forEach((result) => {\n          nextCounts[result.key] = result.count;\n        });\n        setCounts(nextCounts);\n      } catch (error) {\n        logError(error, { layer: \"frontend\", event: \"admin_load_shipping_counts\" });\n      }\n    };\n\n    loadCounts();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [refreshToken]);\n\n  useEffect(() => {\n    loadShippingDefaults();\n    loadOriginAddress();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  useEffect(() => {\n    if (!originModalOpen) {\n      return;\n    }\n    setOriginError(\"\");\n    setOriginMessage(\"\");\n    loadOriginAddress();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [originModalOpen]);\n\n  useEffect(() => {\n    const loadOrders = async () => {\n      setIsLoading(true);\n      try {\n        const tab = TABS.find((entry) => entry.key === activeTab) ?? TABS[0];\n        const params = new URLSearchParams({\n          fulfillment: \"ship\",\n          fulfillmentStatus: tab.status,\n          limit: String(PAGE_SIZE),\n          page: String(currentPage),\n        });\n        const response = await fetch(`/api/admin/orders?${params.toString()}`);\n\n        if (!response.ok) {\n          const errorText = await response.text();\n          throw new Error(`Failed to fetch orders: ${response.status} ${errorText}`);\n        }\n\n        const data = await response.json();\n        setOrders(data.orders || []);\n        if (typeof data.count === \"number\") {\n          setCounts((prev) => ({ ...prev, [activeTab]: data.count }));\n        }\n      } catch (error) {\n        logError(error, { layer: \"frontend\", event: \"admin_load_shipping_orders\" });\n        setOrders([]);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n\n    loadOrders();\n  }, [activeTab, currentPage, refreshToken]);\n\n  useEffect(() => {\n    if (currentPage > totalPages) {\n      setPageByTab((prev) => ({ ...prev, [activeTab]: totalPages }));\n    }\n  }, [currentPage, totalPages, activeTab]);\n\n  const toggleItems = (orderId: string) => {\n    setExpandedItems((prev) => ({ ...prev, [orderId]: !prev[orderId] }));\n  };\n\n  const toggleDetails = (orderId: string) => {\n    setExpandedDetails((prev) => ({ ...prev, [orderId]: !prev[orderId] }));\n  };\n\n  const getPackageProfile = (order: any) => {\n    const items = order.items ?? [];\n    if (items.length === 0) {\n      return {\n        weight: DEFAULT_PACKAGE.weight,\n        length: DEFAULT_PACKAGE.length,\n        width: DEFAULT_PACKAGE.width,\n        height: DEFAULT_PACKAGE.height,\n        costCents: 0,\n      };\n    }\n\n    let totalWeight = 0;\n    let maxLength = 0;\n    let maxWidth = 0;\n    let maxHeight = 0;\n    let maxCost = 0;\n\n    items.forEach((item: any) => {\n      const quantity = Math.max(1, Number(item.quantity ?? 0));\n      const category = item.product?.category ?? null;\n      const defaults = category ? shippingDefaults[category] : null;\n      const weight = Number(defaults?.default_weight_oz ?? DEFAULT_PACKAGE.weight);\n      const length = Number(defaults?.default_length_in ?? DEFAULT_PACKAGE.length);\n      const width = Number(defaults?.default_width_in ?? DEFAULT_PACKAGE.width);\n      const height = Number(defaults?.default_height_in ?? DEFAULT_PACKAGE.height);\n      const cost = Number(defaults?.shipping_cost_cents ?? 0);\n\n      totalWeight += weight * quantity;\n      maxLength = Math.max(maxLength, length);\n      maxWidth = Math.max(maxWidth, width);\n      maxHeight = Math.max(maxHeight, height);\n      maxCost = Math.max(maxCost, cost);\n    });\n\n    return {\n      weight: totalWeight > 0 ? totalWeight : DEFAULT_PACKAGE.weight,\n      length: maxLength > 0 ? maxLength : DEFAULT_PACKAGE.length,\n      width: maxWidth > 0 ? maxWidth : DEFAULT_PACKAGE.width,\n      height: maxHeight > 0 ? maxHeight : DEFAULT_PACKAGE.height,\n      costCents: maxCost,\n    };\n  };\n\n  const handleMarkShipped = async (order: any) => {\n    setMarkingShippedId(order.id);\n    try {\n      const response = await fetch(`/api/admin/orders/${order.id}/fulfill`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          carrier: order.shipping_carrier ?? null,\n          trackingNumber: order.tracking_number ?? null,\n        }),\n      });\n      if (!response.ok) {\n        throw new Error(\"Failed to mark as shipped\");\n      }\n      setRefreshToken((token) => token + 1);\n      setConfirmMarkShipped(null);\n    } catch (error) {\n      logError(error, { layer: \"frontend\", event: \"admin_mark_shipped\" });\n    } finally {\n      setMarkingShippedId(null);\n    }\n  };\n\n  const handleOriginChange = (field: keyof ShippingOrigin, value: string) => {\n    setOriginAddress((prev) => ({ ...(prev ?? EMPTY_ORIGIN), [field]: value }));\n  };\n\n  const handleSaveOrigin = async () => {\n    const payload = originAddress ?? EMPTY_ORIGIN;\n    setSavingOrigin(true);\n    setOriginError(\"\");\n    setOriginMessage(\"\");\n    try {\n      const response = await fetch(\"/api/admin/shipping/origin\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(payload),\n      });\n      const data = await response.json();\n      if (!response.ok) {\n        throw new Error(data?.error || \"Failed to save origin\");\n      }\n      setOriginAddress(data.origin ?? payload);\n      setOriginMessage(\"Origin address updated.\");\n      setOriginModalOpen(false);\n    } catch (error: any) {\n      setOriginError(error?.message || \"Failed to save origin.\");\n    } finally {\n      setSavingOrigin(false);\n    }\n  };\n\n  const handleLabelSuccess = () => {\n    setLabelOrder(null);\n    setRefreshToken((t) => t + 1);\n    // Optionally switch to \"Need to Ship\" tab\n    setActiveTab(\"ready\");\n  };\n\n  const viewLabel = (order: any) => {\n    // Get label URL - you'll need to add this to your order model\n    const labelUrl = order.label_url ?? null;\n    if (labelUrl) {\n      window.open(labelUrl, \"_blank\", \"noopener,noreferrer\");\n    }\n  };\n\n  const renderPagination = () => {\n    if (totalPages <= 1) {\n      return null;\n    }\n\n    const pages: number[] = [];\n    const start = Math.max(1, currentPage - 2);\n    const end = Math.min(totalPages, currentPage + 2);\n\n    for (let page = start; page <= end; page += 1) {\n      pages.push(page);\n    }\n\n    return (\n      <div className=\"flex flex-wrap items-center gap-2\">\n        <button\n          type=\"button\"\n          onClick={() =>\n            setPageByTab((prev) => ({\n              ...prev,\n              [activeTab]: Math.max(1, currentPage - 1),\n            }))\n          }\n          disabled={currentPage === 1}\n          className=\"px-3 py-2 rounded-sm border border-zinc-800/70 text-sm text-gray-300 disabled:text-zinc-600 disabled:border-zinc-900\"\n        >\n          Previous\n        </button>\n\n        {start > 1 && (\n          <button\n            type=\"button\"\n            onClick={() => setPageByTab((prev) => ({ ...prev, [activeTab]: 1 }))}\n            className=\"px-3 py-2 rounded-sm border border-zinc-800/70 text-sm text-gray-300\"\n          >\n            1\n          </button>\n        )}\n        {start > 2 && <span className=\"text-gray-500\">...</span>}\n\n        {pages.map((page) => (\n          <button\n            key={page}\n            type=\"button\"\n            onClick={() => setPageByTab((prev) => ({ ...prev, [activeTab]: page }))}\n            className={`px-3 py-2 rounded-sm border text-sm ${\n              page === currentPage\n                ? \"border-red-600 text-white\"\n                : \"border-zinc-800/70 text-gray-300\"\n            }`}\n          >\n            {page}\n          </button>\n        ))}\n\n        {end < totalPages - 1 && <span className=\"text-gray-500\">...</span>}\n        {end < totalPages && (\n          <button\n            type=\"button\"\n            onClick={() => setPageByTab((prev) => ({ ...prev, [activeTab]: totalPages }))}\n            className=\"px-3 py-2 rounded-sm border border-zinc-800/70 text-sm text-gray-300\"\n          >\n            {totalPages}\n          </button>\n        )}\n\n        <button\n          type=\"button\"\n          onClick={() =>\n            setPageByTab((prev) => ({\n              ...prev,\n              [activeTab]: Math.min(totalPages, currentPage + 1),\n            }))\n          }\n          disabled={currentPage === totalPages}\n          className=\"px-3 py-2 rounded-sm border border-zinc-800/70 text-sm text-gray-300 disabled:text-zinc-600 disabled:border-zinc-900\"\n        >\n          Next\n        </button>\n      </div>\n    );\n  };\n\n  const renderOrderRow = (order: any) => {\n    const itemCount = (order.items ?? []).reduce(\n      (sum: number, item: any) => sum + Number(item.quantity ?? 0),\n      0,\n    );\n    const address = resolveShippingAddress(order.shipping);\n    const addressLine = formatAddress(address);\n    const trackingUrl = getTrackingUrl(order.shipping_carrier, order.tracking_number);\n    const placedAt = formatPlacedAt(order.created_at);\n    const customerHandle = getCustomerHandle(order);\n    const itemsExpanded = expandedItems[order.id] ?? false;\n    const detailsExpanded = expandedDetails[order.id] ?? false;\n    const colSpan = 8; // FIX: table has 8 columns\n    const labelUrl = order.label_url ?? null; // Add this field to your order model\n\n    const actionNode =\n      activeTab === \"label\" ? (\n        <button\n          type=\"button\"\n          onClick={() => setLabelOrder(order)}\n          className=\"text-sm text-red-400 hover:text-red-300\"\n        >\n          Create label\n        </button>\n      ) : activeTab === \"ready\" ? (\n        <button\n          type=\"button\"\n          onClick={() => setConfirmMarkShipped(order)}\n          disabled={markingShippedId === order.id}\n          className=\"text-sm text-zinc-400 hover:text-zinc-300 disabled:text-zinc-600\"\n        >\n          {markingShippedId === order.id ? \"Marking...\" : \"Mark shipped\"}\n        </button>\n      ) : (\n        <span className=\"text-zinc-500\">-</span>\n      );\n\n    return (\n      <Fragment key={order.id}>\n        <tr className=\"border-b border-zinc-800/70 hover:bg-zinc-800/60\">\n          <td className=\"p-3 sm:p-4 text-gray-400\">\n            {placedAt.date !== \"-\" ? (\n              <div className=\"space-y-1\">\n                <div>{placedAt.date}</div>\n                {placedAt.time && (\n                  <div className=\"text-xs text-gray-500\">{placedAt.time}</div>\n                )}\n              </div>\n            ) : (\n              \"-\"\n            )}\n          </td>\n          <td className=\"p-3 sm:p-4 text-white\">#{order.id.slice(0, 8)}</td>\n          <td className=\"hidden md:table-cell p-3 sm:p-4 text-gray-400\">\n            {customerHandle}\n          </td>\n          <td className=\"hidden md:table-cell p-3 sm:p-4 text-gray-400 max-w-[320px] truncate\">\n            {addressLine ? (\n              addressLine\n            ) : (\n              <span className=\"text-red-400\">Missing address</span>\n            )}\n          </td>\n\n          {/* SWAPPED: Tracking column now comes before Label */}\n          <td className=\"hidden md:table-cell p-3 sm:p-4 text-gray-400\">\n            {order.tracking_number ? (\n              <div className=\"space-y-1\">\n                {trackingUrl ? (\n                  <a\n                    href={trackingUrl}\n                    target=\"_blank\"\n                    rel=\"noopener noreferrer\"\n                    className=\"text-red-400 hover:text-red-300 flex items-center gap-1\"\n                  >\n                    {order.tracking_number}\n                    <ExternalLink className=\"w-3 h-3\" />\n                  </a>\n                ) : (\n                  <span className=\"text-zinc-300\">{order.tracking_number}</span>\n                )}\n              </div>\n            ) : (\n              <span className=\"text-zinc-500\">No tracking yet</span>\n            )}\n          </td>\n\n          <td className=\"hidden md:table-cell p-3 sm:p-4 text-gray-400\">\n            {labelUrl ? (\n              <button\n                onClick={() => viewLabel(order)}\n                className=\"text-sm text-red-400 hover:text-red-300\"\n              >\n                Print Label\n              </button>\n            ) : (\n              <span className=\"text-zinc-500\">No label yet</span>\n            )}\n          </td>\n\n          <td className=\"p-3 sm:p-4 text-left md:text-right\">\n            <button\n              type=\"button\"\n              onClick={() => toggleItems(order.id)}\n              className=\"hidden md:inline-flex text-sm text-red-400 hover:text-red-300 items-center gap-2\"\n            >\n              {itemsExpanded ? \"Hide items\" : `View items (${itemCount})`}\n              <ChevronDown\n                className={`h-4 w-4 transition-transform ${itemsExpanded ? \"rotate-180\" : \"\"}`}\n              />\n            </button>\n            <button\n              type=\"button\"\n              onClick={() => toggleDetails(order.id)}\n              className=\"md:hidden w-full text-[12px] text-red-400 hover:text-red-300 inline-flex items-center justify-start gap-1 leading-none whitespace-nowrap\"\n            >\n              {detailsExpanded ? \"Hide label info\" : \"Label info\"}\n              <ChevronDown\n                className={`h-4 w-4 transition-transform ${detailsExpanded ? \"rotate-180\" : \"\"}`}\n              />\n            </button>\n          </td>\n          <td className=\"hidden md:table-cell p-3 sm:p-4 text-right\">{actionNode}</td>\n        </tr>\n\n        {itemsExpanded && (\n          <tr className=\"hidden md:table-row border-b border-zinc-800/70 bg-zinc-900/40\">\n            <td colSpan={colSpan} className=\"px-3 pb-3 pt-2 sm:px-4 sm:pb-4\">\n              <div className=\"grid gap-3 sm:grid-cols-2\">\n                {(order.items ?? []).map((item: any) => {\n                  const imageUrl = getPrimaryImage(item);\n                  const title =\n                    (item.product?.title_display ??\n                      `${item.product?.brand ?? \"\"} ${item.product?.name ?? \"\"}`.trim()) ||\n                    \"Item\";\n                  return (\n                    <div key={item.id} className=\"flex items-center gap-3\">\n                      <img\n                        src={imageUrl}\n                        alt={title}\n                        className=\"h-10 w-10 object-cover border border-zinc-800/70 bg-black\"\n                      />\n                      <div className=\"min-w-0\">\n                        <div className=\"text-sm text-white truncate\">{title}</div>\n                        <div className=\"text-xs text-zinc-500\">\n                          Size {item.variant?.size_label ?? \"N/A\"} - Qty {item.quantity}\n                        </div>\n                      </div>\n                    </div>\n                  );\n                })}\n              </div>\n            </td>\n          </tr>\n        )}\n\n        {detailsExpanded && (\n          <tr className=\"md:hidden border-b border-zinc-800/70 bg-zinc-900/40\">\n            <td colSpan={colSpan} className=\"px-3 pb-3 pt-3 sm:px-4 sm:pb-4\">\n              <div className=\"space-y-3 text-sm\">\n                <div className=\"flex items-center justify-between gap-4\">\n                  <span className=\"text-gray-500\">Customer</span>\n                  <span className=\"text-white\">{customerHandle}</span>\n                </div>\n                <div className=\"flex flex-col gap-1\">\n                  <span className=\"text-gray-500\">Destination</span>\n                  <span className=\"text-white break-words\">\n                    {addressLine ? addressLine : \"Missing address\"}\n                  </span>\n                </div>\n                <div className=\"flex items-center justify-between gap-4\">\n                  <span className=\"text-gray-500\">Tracking</span>\n                  <span className=\"text-white\">\n                    {order.tracking_number ? (\n                      trackingUrl ? (\n                        <a\n                          href={trackingUrl}\n                          target=\"_blank\"\n                          rel=\"noopener noreferrer\"\n                          className=\"text-red-400 hover:text-red-300 inline-flex items-center gap-1\"\n                        >\n                          {order.tracking_number}\n                          <ExternalLink className=\"w-3 h-3\" />\n                        </a>\n                      ) : (\n                        order.tracking_number\n                      )\n                    ) : (\n                      <span className=\"text-zinc-500\">No tracking yet</span>\n                    )}\n                  </span>\n                </div>\n                <div className=\"flex items-center justify-between gap-4\">\n                  <span className=\"text-gray-500\">Label</span>\n                  <span className=\"text-white\">\n                    {labelUrl ? (\n                      <button\n                        onClick={() => viewLabel(order)}\n                        className=\"text-red-400 hover:text-red-300\"\n                      >\n                        Print label\n                      </button>\n                    ) : (\n                      <span className=\"text-zinc-500\">No label yet</span>\n                    )}\n                  </span>\n                </div>\n                <div className=\"flex items-center justify-between gap-4\">\n                  <span className=\"text-gray-500\">Action</span>\n                  <span className=\"text-white\">{actionNode}</span>\n                </div>\n              </div>\n\n              <div className=\"mt-4 border-t border-zinc-800/70 pt-4\">\n                <div className=\"text-[11px] uppercase tracking-wide text-gray-500 mb-2\">\n                  Items\n                </div>\n                <div className=\"space-y-2\">\n                  {(order.items ?? []).map((item: any) => {\n                    const imageUrl = getPrimaryImage(item);\n                    const title =\n                      (item.product?.title_display ??\n                        `${item.product?.brand ?? \"\"} ${item.product?.name ?? \"\"}`.trim()) ||\n                      \"Item\";\n                    return (\n                      <div key={item.id} className=\"flex items-center gap-3\">\n                        <img\n                          src={imageUrl}\n                          alt={title}\n                          className=\"h-10 w-10 object-cover border border-zinc-800/70 bg-black\"\n                        />\n                        <div className=\"min-w-0\">\n                          <div className=\"text-white truncate\">{title}</div>\n                          <div className=\"text-xs text-zinc-500\">\n                            Size {item.variant?.size_label ?? \"N/A\"} - Qty {item.quantity}\n                          </div>\n                        </div>\n                      </div>\n                    );\n                  })}\n                </div>\n              </div>\n            </td>\n          </tr>\n        )}\n      </Fragment>\n    );\n  };\n\n  const tabBadge = (count: number) => (count > 99 ? \"99+\" : String(count));\n  const originLine = formatOriginAddress(originAddress);\n\n  const labelModalDefaults = useMemo(() => {\n    if (!labelOrder) {\n      return null;\n    }\n    return getPackageProfile(labelOrder);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [labelOrder, shippingDefaults]);\n\n  return (\n    <div className=\"space-y-8\">\n      <div>\n        <h1 className=\"text-3xl font-bold text-white mb-2\">Shipping</h1>\n        <p className=\"text-gray-400\">Review, label, and ship your orders.</p>\n      </div>\n\n      {activeTab === \"ready\" && (\n        <div className=\"rounded-sm border border-blue-400/20 bg-blue-400/10 p-3 sm:p-4\">\n          <div className=\"flex items-start gap-3\">\n            <AlertCircle className=\"w-4 h-4 sm:w-5 sm:h-5 text-blue-400 flex-shrink-0 mt-0.5\" />\n            <div className=\"text-[12px] sm:text-sm text-blue-300\">\n              <strong>Automatic tracking:</strong> Once you ship packages, Shippo will\n              automatically update tracking status and send customer emails. The \"Mark\n              shipped\" button should only be used if the carrier hasn't scanned the\n              package yet.\n            </div>\n          </div>\n        </div>\n      )}\n\n      <div className=\"border-b border-zinc-800/70 flex flex-nowrap gap-2 sm:gap-6\">\n        {TABS.map((tab) => (\n          <button\n            key={tab.key}\n            onClick={() => setActiveTab(tab.key)}\n            className={`py-2.5 text-[10px] sm:text-sm font-medium transition-colors flex items-center gap-1 sm:gap-2 whitespace-nowrap ${\n              activeTab === tab.key\n                ? \"text-white border-b-2 border-red-600\"\n                : \"text-gray-400 hover:text-white border-b-2 border-transparent\"\n            }`}\n          >\n            {tab.label}\n            <span className=\"text-[9px] sm:text-[11px] px-1 sm:px-2 py-0.5 rounded-sm bg-zinc-900 border border-zinc-800/70 text-gray-300\">\n              {tabBadge(counts[tab.key] ?? 0)}\n            </span>\n          </button>\n        ))}\n      </div>\n\n      <div className=\"flex flex-wrap items-center justify-between gap-3 text-sm\">\n        <div className=\"text-gray-400\">\n          <span className=\"text-gray-500\">Origin:</span>{\" \"}\n          {originLine ? originLine : \"Not set\"}\n        </div>\n        <button\n          type=\"button\"\n          onClick={() => setOriginModalOpen(true)}\n          className=\"px-4 py-2 bg-zinc-900 text-white text-sm border border-zinc-800/70 hover:border-zinc-700\"\n        >\n          Change origin address\n        </button>\n      </div>\n\n      {isLoading ? (\n        <div className=\"text-center py-12 text-gray-400\">Loading...</div>\n      ) : orders.length === 0 ? (\n        <div className=\"rounded-sm border border-zinc-800/70 bg-zinc-900 p-6 text-sm text-zinc-500\">\n          No orders in this queue.\n        </div>\n      ) : (\n        <div className=\"rounded-sm border border-zinc-800/70 bg-zinc-900 overflow-x-hidden md:overflow-x-auto overflow-y-visible\">\n          <table className=\"w-full text-[12px] sm:text-sm\">\n            <thead>\n              <tr className=\"bg-zinc-800\">\n                <th className=\"sticky top-0 z-10 bg-zinc-800 text-left text-gray-400 font-semibold p-3 sm:p-4\">\n                  Placed At\n                </th>\n                <th className=\"sticky top-0 z-10 bg-zinc-800 text-left text-gray-400 font-semibold p-3 sm:p-4\">\n                  Order\n                </th>\n                <th className=\"hidden md:table-cell sticky top-0 z-10 bg-zinc-800 text-left text-gray-400 font-semibold p-3 sm:p-4\">\n                  Customer\n                </th>\n                <th className=\"hidden md:table-cell sticky top-0 z-10 bg-zinc-800 text-left text-gray-400 font-semibold p-3 sm:p-4\">\n                  Destination\n                </th>\n\n                {/* SWAPPED: Tracking header now before Label */}\n                <th className=\"hidden md:table-cell sticky top-0 z-10 bg-zinc-800 text-left text-gray-400 font-semibold p-3 sm:p-4\">\n                  Tracking\n                </th>\n                <th className=\"hidden md:table-cell sticky top-0 z-10 bg-zinc-800 text-left text-gray-400 font-semibold p-3 sm:p-4\">\n                  Label\n                </th>\n\n                <th className=\"sticky top-0 z-10 bg-zinc-800 text-left md:text-right text-gray-400 font-semibold p-3 sm:p-4\">\n                  <span className=\"hidden md:inline\">Items</span>\n                  <span className=\"md:hidden\">Actions</span>\n                </th>\n                <th className=\"hidden md:table-cell sticky top-0 z-10 bg-zinc-800 text-right text-gray-400 font-semibold p-3 sm:p-4\">\n                  Action\n                </th>\n              </tr>\n            </thead>\n            <tbody>{orders.map((order) => renderOrderRow(order))}</tbody>\n          </table>\n        </div>\n      )}\n\n      {renderPagination()}\n\n      <CreateLabelForm\n        open={!!labelOrder}\n        order={labelOrder}\n        originLine={originLine}\n        initialPackage={\n          labelModalDefaults\n            ? {\n                weight: labelModalDefaults.weight,\n                length: labelModalDefaults.length,\n                width: labelModalDefaults.width,\n                height: labelModalDefaults.height,\n              }\n            : null\n        }\n        onClose={() => setLabelOrder(null)}\n        onSuccess={handleLabelSuccess}\n      />\n\n      <ConfirmDialog\n        isOpen={!!confirmMarkShipped}\n        title=\"Mark as shipped manually?\"\n        description=\"Important: This should only be used if the carrier hasn't scanned the package yet. Normally, Shippo automatically updates tracking status and sends customer emails when the carrier scans the package. Using this button will manually update the status without waiting for carrier confirmation.\"\n        confirmLabel=\"Mark shipped anyway\"\n        onConfirm={() => {\n          if (confirmMarkShipped) {\n            void handleMarkShipped(confirmMarkShipped);\n          }\n        }}\n        onCancel={() => setConfirmMarkShipped(null)}\n      />\n\n      <OriginModal\n        open={originModalOpen}\n        originAddress={originAddress}\n        emptyOrigin={EMPTY_ORIGIN}\n        originError={originError}\n        originMessage={originMessage}\n        savingOrigin={savingOrigin}\n        onClose={() => setOriginModalOpen(false)}\n        onChange={handleOriginChange}\n        onSave={() => {\n          void handleSaveOrigin();\n        }}\n      />\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\account\\addresses\\[addressId]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\account\\addresses\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\account\\notifications\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":31,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1056,1059],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1056,1059],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":66,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2162,2165],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2162,2165],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\nimport { z } from \"zod\";\n\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { requireUserApi } from \"@/lib/auth/session\";\nimport { ProfileRepository } from \"@/repositories/profile-repo\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { logError } from \"@/lib/log\";\n\nconst chatNotificationSchema = z\n  .object({\n    chat_notifications_enabled: z.boolean(),\n  })\n  .strict();\n\nexport async function GET(request: NextRequest) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n\n  try {\n    const session = await requireUserApi();\n    const supabase = await createSupabaseServerClient();\n    const profileRepo = new ProfileRepository(supabase);\n\n    const profile = await profileRepo.getByUserId(session.user.id);\n\n    return NextResponse.json(\n      { chat_notifications_enabled: profile?.chat_notifications_enabled ?? true },\n      { headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  } catch (error: any) {\n    logError(error, {\n      layer: \"api\",\n      requestId,\n      route: \"/api/account/notifications\",\n    });\n\n    return NextResponse.json(\n      { error: \"Failed to load notifications\", requestId },\n      { status: 500, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n}\n\nexport async function PATCH(request: NextRequest) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n\n  try {\n    const session = await requireUserApi();\n    const body = await request.json().catch(() => null);\n    const parsed = chatNotificationSchema.safeParse(body ?? {});\n\n    if (!parsed.success) {\n      return NextResponse.json(\n        { error: \"Invalid payload\", issues: parsed.error.format(), requestId },\n        { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const supabase = await createSupabaseServerClient();\n    const profileRepo = new ProfileRepository(supabase);\n\n    await profileRepo.updateNotificationPreferences(session.user.id, parsed.data);\n\n    return NextResponse.json({ ok: true }, { headers: { \"Cache-Control\": \"no-store\" } });\n  } catch (error: any) {\n    logError(error, {\n      layer: \"api\",\n      requestId,\n      route: \"/api/account/notifications\",\n    });\n\n    return NextResponse.json(\n      { error: \"Failed to update notifications\", requestId },\n      { status: 500, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\account\\orders\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\account\\password\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\account\\shipping\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\analytics\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\catalog\\aliases\\[id]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\catalog\\aliases\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\catalog\\brand-groups\\[id]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\catalog\\brand-groups\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\catalog\\brands\\[id]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\catalog\\brands\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\catalog\\candidates\\[id]\\accept\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\catalog\\candidates\\[id]\\reject\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\catalog\\candidates\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\catalog\\models\\[id]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\catalog\\models\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\catalog\\parse-title\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\invites\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":43,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1629,1632],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1629,1632],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\n\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { createSupabaseAdminClient } from \"@/lib/supabase/service-role\";\nimport { requireAdminApi } from \"@/lib/auth/session\";\nimport { AdminInviteService } from \"@/services/admin-invite-service\";\nimport { adminInviteCreateSchema } from \"@/lib/validation/admin\";\nimport { env } from \"@/config/env\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { logError } from \"@/lib/log\";\n\nexport async function POST(request: NextRequest) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n\n  try {\n    const session = await requireAdminApi();\n    const body = await request.json().catch(() => null);\n    const parsed = adminInviteCreateSchema.safeParse(body ?? {});\n\n    if (!parsed.success) {\n      return NextResponse.json(\n        { error: \"Invalid payload\", issues: parsed.error.format(), requestId },\n        { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const supabase = await createSupabaseServerClient();\n    const adminSupabase = createSupabaseAdminClient();\n    const inviteService = new AdminInviteService(supabase, adminSupabase);\n\n    const result = await inviteService.createInvite({\n      userId: session.user.id,\n      role: parsed.data.role,\n    });\n\n    const inviteUrl = `${env.NEXT_PUBLIC_SITE_URL}/invite/admin?token=${result.token}`;\n\n    return NextResponse.json(\n      { invite: result.invite, inviteUrl },\n      { headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  } catch (error: any) {\n    logError(error, {\n      layer: \"api\",\n      requestId,\n      route: \"/api/admin/invites\",\n    });\n\n    const status = error?.message === \"Forbidden\" ? 403 : 500;\n\n    return NextResponse.json(\n      { error: error?.message ?? \"Failed to create invite\", requestId },\n      { status, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\nexus\\head-office-address\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1077,1080],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1077,1080],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// app/api/admin/nexus/head-office-address/route.ts\nimport type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\n\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { requireAdminApi } from \"@/lib/auth/session\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { logError } from \"@/lib/log\";\nimport { TenantContextService } from \"@/services/tenant-context-service\";\nimport { StripeTaxService } from \"@/services/stripe-tax-service\";\n\nexport async function GET(request: NextRequest) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n\n  try {\n    const session = await requireAdminApi();\n    const supabase = await createSupabaseServerClient();\n\n    const contextService = new TenantContextService(supabase);\n    const context = await contextService.getAdminContext(session.user.id);\n\n    const taxService = new StripeTaxService(supabase, context.stripeAccountId);\n    const address = await taxService.getHeadOfficeAddress();\n\n    return NextResponse.json({ address });\n  } catch (error: any) {\n    logError(error, {\n      layer: \"api\",\n      requestId,\n      route: \"/api/admin/nexus/head-office-address\",\n    });\n    return NextResponse.json(\n      { error: error.message || \"Failed to fetch head office address\", requestId },\n      { status: error.message?.includes(\"not configured\") ? 400 : 500 },\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\nexus\\home-office-status\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1100,1103],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1100,1103],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// app/api/admin/nexus/home-office-status/route.ts\nimport type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\n\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { requireAdminApi } from \"@/lib/auth/session\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { logError } from \"@/lib/log\";\nimport { TenantContextService } from \"@/services/tenant-context-service\";\nimport { StripeTaxService } from \"@/services/stripe-tax-service\";\n\nexport async function GET(request: NextRequest) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n\n  try {\n    const session = await requireAdminApi();\n    const supabase = await createSupabaseServerClient();\n\n    const contextService = new TenantContextService(supabase);\n    const context = await contextService.getAdminContext(session.user.id);\n\n    const taxService = new StripeTaxService(supabase, context.stripeAccountId);\n    const isConfigured = await taxService.isHeadOfficeConfigured();\n\n    return NextResponse.json({ configured: isConfigured });\n  } catch (error: any) {\n    logError(error, {\n      layer: \"api\",\n      requestId,\n      route: \"/api/admin/nexus/home-office-status\",\n    });\n    return NextResponse.json(\n      { error: error.message || \"Failed to check home office status\", requestId },\n      { status: error.message?.includes(\"not configured\") ? 400 : 500 },\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\nexus\\home-state\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":44,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1476,1479],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1476,1479],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// app/api/admin/nexus/home-state/route.ts\nimport type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\nimport { z } from \"zod\";\n\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { requireAdminApi } from \"@/lib/auth/session\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { logError } from \"@/lib/log\";\nimport { TenantContextService } from \"@/services/tenant-context-service\";\nimport { StripeTaxService } from \"@/services/stripe-tax-service\";\n\nconst homeStateSchema = z.object({\n  stateCode: z.string().length(2),\n});\n\nexport async function POST(request: NextRequest) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n\n  try {\n    const session = await requireAdminApi();\n    const supabase = await createSupabaseServerClient();\n\n    const contextService = new TenantContextService(supabase);\n    const tenantId = await contextService.getTenantId(session.user.id);\n\n    const body = await request.json().catch(() => null);\n    const parsed = homeStateSchema.safeParse(body);\n\n    if (!parsed.success) {\n      return NextResponse.json(\n        { error: \"Invalid payload\", issues: parsed.error.format(), requestId },\n        { status: 400 },\n      );\n    }\n\n    const taxService = new StripeTaxService(supabase);\n    await taxService.setHomeState({\n      tenantId,\n      stateCode: parsed.data.stateCode,\n    });\n\n    return NextResponse.json({ success: true });\n  } catch (error: any) {\n    logError(error, { layer: \"api\", requestId, route: \"/api/admin/nexus/home-state\" });\n    return NextResponse.json(\n      { error: error.message || \"Failed to update home state\", requestId },\n      { status: 500 },\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\nexus\\nexus-type\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":51,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1833,1836],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1833,1836],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// app/api/admin/nexus/nexus-type/route.ts\nimport type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\nimport { z } from \"zod\";\n\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { requireAdminApi } from \"@/lib/auth/session\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { logError } from \"@/lib/log\";\nimport { TenantContextService } from \"@/services/tenant-context-service\";\nimport { NexusRepository } from \"@/repositories/nexus-repo\";\n\nconst nexusTypeSchema = z.object({\n  stateCode: z.string().length(2),\n  nexusType: z.enum([\"physical\", \"economic\"]),\n});\n\nexport async function POST(request: NextRequest) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n\n  try {\n    const session = await requireAdminApi();\n    const supabase = await createSupabaseServerClient();\n\n    const contextService = new TenantContextService(supabase);\n    const tenantId = await contextService.getTenantId(session.user.id);\n\n    const body = await request.json().catch(() => null);\n    const parsed = nexusTypeSchema.safeParse(body);\n\n    if (!parsed.success) {\n      return NextResponse.json(\n        { error: \"Invalid payload\", issues: parsed.error.format(), requestId },\n        { status: 400 },\n      );\n    }\n\n    const nexusRepo = new NexusRepository(supabase);\n    const existing = await nexusRepo.getRegistration(tenantId, parsed.data.stateCode);\n\n    await nexusRepo.upsertRegistration({\n      tenantId,\n      stateCode: parsed.data.stateCode,\n      registrationType: parsed.data.nexusType,\n      isRegistered: existing?.is_registered ?? false,\n      registeredAt: existing?.registered_at ?? null,\n      stripeRegistrationId: existing?.stripe_registration_id ?? null,\n    });\n\n    return NextResponse.json({ success: true });\n  } catch (error: any) {\n    logError(error, { layer: \"api\", requestId, route: \"/api/admin/nexus/nexus-type\" });\n    return NextResponse.json(\n      { error: error.message || \"Failed to update nexus type\", requestId },\n      { status: 500 },\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\nexus\\register\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":55,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1851,1854],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1851,1854],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// app/api/admin/nexus/register/route.ts\nimport type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\nimport { z } from \"zod\";\n\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { requireAdminApi } from \"@/lib/auth/session\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { logError } from \"@/lib/log\";\nimport { TenantContextService } from \"@/services/tenant-context-service\";\nimport { StripeTaxService } from \"@/services/stripe-tax-service\";\n\nconst registerSchema = z.object({\n  stateCode: z.string().length(2),\n  registrationType: z.enum([\"physical\", \"economic\"]),\n  isRegistered: z.boolean(),\n});\n\nexport async function POST(request: NextRequest) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n\n  try {\n    const session = await requireAdminApi();\n    const supabase = await createSupabaseServerClient();\n\n    const contextService = new TenantContextService(supabase);\n    const context = await contextService.getAdminContext(session.user.id);\n\n    const body = await request.json().catch(() => null);\n    const parsed = registerSchema.safeParse(body);\n\n    if (!parsed.success) {\n      return NextResponse.json(\n        { error: \"Invalid payload\", issues: parsed.error.format(), requestId },\n        { status: 400 },\n      );\n    }\n\n    const taxService = new StripeTaxService(supabase, context.stripeAccountId);\n\n    if (parsed.data.isRegistered) {\n      await taxService.registerState({\n        tenantId: context.tenantId,\n        stateCode: parsed.data.stateCode,\n        registrationType: parsed.data.registrationType,\n      });\n    } else {\n      await taxService.unregisterState({\n        tenantId: context.tenantId,\n        stateCode: parsed.data.stateCode,\n      });\n    }\n\n    return NextResponse.json({ success: true });\n  } catch (error: any) {\n    logError(error, { layer: \"api\", requestId, route: \"/api/admin/nexus/register\" });\n    return NextResponse.json(\n      { error: error.message || \"Failed to update registration\", requestId },\n      { status: 500 },\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\nexus\\sales-log\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":52,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1864,1867],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1864,1867],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// app/api/admin/nexus/sales-log/route.ts\nimport type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\nimport { z } from \"zod\";\n\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { requireAdminApi } from \"@/lib/auth/session\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { logError } from \"@/lib/log\";\nimport { TenantContextService } from \"@/services/tenant-context-service\";\nimport { NexusRepository } from \"@/repositories/nexus-repo\";\n\nconst salesLogSchema = z.object({\n  stateCode: z.string().length(2),\n  limit: z.number().int().min(1).max(100).optional(),\n  offset: z.number().int().min(0).optional(),\n});\n\nexport async function GET(request: NextRequest) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n\n  try {\n    const session = await requireAdminApi();\n    const supabase = await createSupabaseServerClient();\n\n    const contextService = new TenantContextService(supabase);\n    const tenantId = await contextService.getTenantId(session.user.id);\n\n    const searchParams = request.nextUrl.searchParams;\n    const parsed = salesLogSchema.safeParse({\n      stateCode: searchParams.get(\"stateCode\"),\n      limit: searchParams.get(\"limit\") ? Number(searchParams.get(\"limit\")) : undefined,\n      offset: searchParams.get(\"offset\") ? Number(searchParams.get(\"offset\")) : undefined,\n    });\n\n    if (!parsed.success) {\n      return NextResponse.json(\n        { error: \"Invalid query\", issues: parsed.error.format(), requestId },\n        { status: 400 },\n      );\n    }\n\n    const nexusRepo = new NexusRepository(supabase);\n    const result = await nexusRepo.getStateSalesLog({\n      tenantId,\n      stateCode: parsed.data.stateCode,\n      limit: parsed.data.limit,\n      offset: parsed.data.offset,\n    });\n\n    return NextResponse.json(result);\n  } catch (error: any) {\n    logError(error, { layer: \"api\", requestId, route: \"/api/admin/nexus/sales-log\" });\n    return NextResponse.json(\n      { error: error.message || \"Failed to fetch sales log\", requestId },\n      { status: 500 },\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\nexus\\setup-home\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":85,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2789,2792],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2789,2792],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// app/api/admin/nexus/setup-home/route.ts\nimport type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\nimport { z } from \"zod\";\n\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { requireAdminApi } from \"@/lib/auth/session\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { logError } from \"@/lib/log\";\nimport { TenantContextService } from \"@/services/tenant-context-service\";\nimport { StripeTaxService } from \"@/services/stripe-tax-service\";\n\nconst setupHomeSchema = z.object({\n  stateCode: z.string().length(2),\n  businessName: z.string().optional(),\n  address: z.object({\n    line1: z.string().min(1),\n    line2: z.string().optional(),\n    city: z.string().min(1),\n    state: z.string().length(2),\n    postalCode: z.string().min(5),\n    country: z.string().length(2),\n  }),\n  oldHomeState: z.string().length(2).optional(),\n  oldHomeAction: z\n    .object({\n      hasPhysicalNexus: z.boolean(),\n      continueCollecting: z.boolean(),\n    })\n    .optional(),\n});\n\nexport async function POST(request: NextRequest) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n\n  try {\n    const session = await requireAdminApi();\n    const supabase = await createSupabaseServerClient();\n\n    const contextService = new TenantContextService(supabase);\n    const context = await contextService.getAdminContext(session.user.id);\n\n    const body = await request.json().catch(() => null);\n    const parsed = setupHomeSchema.safeParse(body);\n\n    if (!parsed.success) {\n      return NextResponse.json(\n        { error: \"Invalid payload\", issues: parsed.error.format(), requestId },\n        { status: 400 },\n      );\n    }\n\n    const taxService = new StripeTaxService(supabase, context.stripeAccountId);\n\n    // Set head office for tenant's Stripe Connect account\n    await taxService.setHeadOfficeAddress({\n      tenantId: context.tenantId,\n      stateCode: parsed.data.stateCode,\n      businessName: parsed.data.businessName,\n      address: parsed.data.address,\n      skipAutoRegister: true,\n    });\n\n    // Handle old home state if changing\n    if (parsed.data.oldHomeState && parsed.data.oldHomeAction) {\n      const { oldHomeState, oldHomeAction } = parsed.data;\n      const registrationType = oldHomeAction.hasPhysicalNexus ? \"physical\" : \"economic\";\n\n      if (!oldHomeAction.continueCollecting) {\n        await taxService.unregisterState({\n          tenantId: context.tenantId,\n          stateCode: oldHomeState,\n          registrationType,\n        });\n      } else {\n        await taxService.registerState({\n          tenantId: context.tenantId,\n          stateCode: oldHomeState,\n          registrationType,\n        });\n      }\n    }\n\n    return NextResponse.json({ success: true });\n  } catch (error: any) {\n    logError(error, { layer: \"api\", requestId, route: \"/api/admin/nexus/setup-home\" });\n    return NextResponse.json(\n      { error: error.message || \"Failed to setup home state\", requestId },\n      { status: 500 },\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\nexus\\summary\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1481,1484],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1481,1484],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// app/api/admin/nexus/summary/route.ts\nimport type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\n\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { requireAdminApi } from \"@/lib/auth/session\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { logError } from \"@/lib/log\";\nimport { TenantContextService } from \"@/services/tenant-context-service\";\nimport { NexusRepository } from \"@/repositories/nexus-repo\";\nimport { TaxSettingsRepository } from \"@/repositories/tax-settings-repo\";\nimport { StripeTaxService } from \"@/services/stripe-tax-service\";\nimport { NexusSummaryService } from \"@/services/nexus-service\";\n\nexport async function GET(request: NextRequest) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n\n  try {\n    const session = await requireAdminApi();\n    const supabase = await createSupabaseServerClient();\n\n    const contextService = new TenantContextService(supabase);\n    const context = await contextService.getAdminContext(session.user.id);\n\n    const nexusRepo = new NexusRepository(supabase);\n    const taxSettingsRepo = new TaxSettingsRepository(supabase);\n    const stripeTax = new StripeTaxService(supabase, context.stripeAccountId);\n\n    const summaryService = new NexusSummaryService(nexusRepo, taxSettingsRepo, stripeTax);\n    const summary = await summaryService.buildSummary(context.tenantId);\n\n    return NextResponse.json(summary);\n  } catch (error: any) {\n    logError(error, { layer: \"api\", requestId, route: \"/api/admin/nexus/summary\" });\n    return NextResponse.json(\n      { error: error.message || \"Failed to fetch nexus summary\", requestId },\n      { status: error.message?.includes(\"not found\") ? 404 : 500 },\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\nexus\\tax-documents\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":52,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1771,1774],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1771,1774],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// app/api/admin/nexus/tax-documents/route.ts\nimport type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\nimport { z } from \"zod\";\n\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { requireAdminApi } from \"@/lib/auth/session\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { logError } from \"@/lib/log\";\nimport { TenantContextService } from \"@/services/tenant-context-service\";\nimport { StripeTaxService } from \"@/services/stripe-tax-service\";\n\nconst taxDocsSchema = z.object({\n  year: z.number().int().min(2020).max(2100),\n  month: z.number().int().min(1).max(12).optional(),\n});\n\nexport async function POST(request: NextRequest) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n\n  try {\n    const session = await requireAdminApi();\n    const supabase = await createSupabaseServerClient();\n\n    const contextService = new TenantContextService(supabase);\n    const context = await contextService.getAdminContext(session.user.id);\n\n    const body = await request.json().catch(() => null);\n    const parsed = taxDocsSchema.safeParse(body);\n\n    if (!parsed.success) {\n      return NextResponse.json(\n        { error: \"Invalid payload\", issues: parsed.error.format(), requestId },\n        { status: 400 },\n      );\n    }\n\n    const taxService = new StripeTaxService(supabase, context.stripeAccountId);\n    const result = await taxService.downloadTaxDocuments({\n      year: parsed.data.year,\n      month: parsed.data.month,\n    });\n\n    if (!result) {\n      return NextResponse.json({\n        message:\n          \"Tax documents are automatically available in your Stripe Dashboard under Tax > Reports\",\n      });\n    }\n\n    return NextResponse.json(result);\n  } catch (error: any) {\n    logError(error, { layer: \"api\", requestId, route: \"/api/admin/nexus/tax-documents\" });\n    return NextResponse.json(\n      { error: error.message || \"Failed to download tax documents\", requestId },\n      { status: 500 },\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\notifications\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1872,1875],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1872,1875],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":89,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":89,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3065,3068],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3065,3068],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":129,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4417,4420],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4417,4420],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\nimport { z } from \"zod\";\n\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { requireAdminApi } from \"@/lib/auth/session\";\nimport { AdminNotificationService } from \"@/services/admin-notification-service\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { logError } from \"@/lib/log\";\nimport {\n  adminNotificationUpdateSchema,\n  adminNotificationsQuerySchema,\n} from \"@/lib/validation/admin\";\n\nconst deleteSchema = z.union([\n  z.object({ ids: z.array(z.string().uuid()).min(1) }),\n  z.object({ delete_all: z.literal(true) }),\n]);\n\nexport async function GET(request: NextRequest) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n\n  try {\n    const session = await requireAdminApi();\n    const supabase = await createSupabaseServerClient();\n    const svc = new AdminNotificationService(supabase);\n\n    const limitParam = request.nextUrl.searchParams.get(\"limit\") ?? undefined;\n    const pageParam = request.nextUrl.searchParams.get(\"page\") ?? undefined;\n    const unreadParam = request.nextUrl.searchParams.get(\"unread\") ?? undefined;\n\n    const parsedQuery = adminNotificationsQuerySchema.safeParse({\n      limit: limitParam,\n      page: pageParam,\n      unread: unreadParam,\n    });\n\n    if (!parsedQuery.success) {\n      return NextResponse.json(\n        {\n          error: \"Invalid query parameters\",\n          issues: parsedQuery.error.format(),\n          requestId,\n        },\n        { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const { limit, page, unread: unreadOnly } = parsedQuery.data;\n\n    const data = await svc.listCenter(session.user.id, { limit, page, unreadOnly });\n\n    return NextResponse.json(data, { headers: { \"Cache-Control\": \"no-store\" } });\n  } catch (error: any) {\n    logError(error, { layer: \"api\", requestId, route: \"/api/admin/notifications\" });\n    return NextResponse.json(\n      { error: \"Failed to load notifications\", requestId },\n      { status: 500, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n}\n\nexport async function PATCH(request: NextRequest) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n\n  try {\n    const session = await requireAdminApi();\n    const body = await request.json().catch(() => null);\n    const parsed = adminNotificationUpdateSchema.safeParse(body ?? {});\n\n    if (!parsed.success) {\n      return NextResponse.json(\n        { error: \"Invalid payload\", issues: parsed.error.format(), requestId },\n        { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const supabase = await createSupabaseServerClient();\n    const svc = new AdminNotificationService(supabase);\n\n    const updated = parsed.data.mark_all\n      ? await svc.markAllRead(session.user.id)\n      : await svc.markRead(session.user.id, parsed.data.ids ?? []);\n\n    return NextResponse.json(\n      { notifications: updated },\n      { headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  } catch (error: any) {\n    logError(error, { layer: \"api\", requestId, route: \"/api/admin/notifications\" });\n    return NextResponse.json(\n      { error: \"Failed to update notifications\", requestId },\n      { status: 500, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n}\n\nexport async function DELETE(request: NextRequest) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n\n  try {\n    const session = await requireAdminApi();\n    const body = await request.json().catch(() => null);\n    const parsed = deleteSchema.safeParse(body ?? {});\n\n    if (!parsed.success) {\n      return NextResponse.json(\n        { error: \"Invalid payload\", issues: parsed.error.format(), requestId },\n        { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const supabase = await createSupabaseServerClient();\n    const svc = new AdminNotificationService(supabase);\n\n    const deletedIds =\n      \"delete_all\" in parsed.data\n        ? await svc.deleteAll(session.user.id)\n        : await svc.deleteMany(session.user.id, parsed.data.ids);\n\n    const deletedCount = deletedIds.length;\n\n    return NextResponse.json(\n      deletedCount === 0\n        ? { deletedCount: 0, noop: true, message: \"No notifications to delete.\" }\n        : { deletedCount, noop: false },\n      { headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  } catch (error: any) {\n    logError(error, { layer: \"api\", requestId, route: \"/api/admin/notifications\" });\n\n    return NextResponse.json(\n      { error: \"Failed to delete notifications\", requestId },\n      { status: 500, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\notifications\\unread-count\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[876,879],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[876,879],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\n\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { requireAdminApi } from \"@/lib/auth/session\";\nimport { AdminNotificationService } from \"@/services/admin-notification-service\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { logError } from \"@/lib/log\";\n\nexport async function GET(request: NextRequest) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n\n  try {\n    const session = await requireAdminApi();\n    const supabase = await createSupabaseServerClient();\n    const svc = new AdminNotificationService(supabase);\n\n    const unreadCount = await svc.unreadCount(session.user.id);\n\n    return NextResponse.json(\n      { unreadCount },\n      { headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  } catch (error: any) {\n    logError(error, {\n      layer: \"api\",\n      requestId,\n      route: \"/api/admin/notifications/unread-count\",\n    });\n    return NextResponse.json(\n      { error: \"Failed to load unread count\", requestId },\n      { status: 500, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\orders\\[orderId]\\fulfill\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\orders\\[orderId]\\refund\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":97,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3101,3104],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3101,3104],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":106,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":106,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3462,3465],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3462,3465],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":238,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":238,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7349,7352],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7349,7352],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// app/api/admin/orders/[orderId]/refund/route.ts\nimport type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\nimport Stripe from \"stripe\";\n\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { requireAdminApi } from \"@/lib/auth/session\";\nimport { OrdersRepository } from \"@/repositories/orders-repo\";\nimport { ProfileRepository } from \"@/repositories/profile-repo\";\nimport { OrderEmailService } from \"@/services/order-email-service\";\nimport { env } from \"@/config/env\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { log, logError } from \"@/lib/log\";\n\nconst stripe = new Stripe(env.STRIPE_SECRET_KEY, {\n  apiVersion: \"2025-10-29.clover\",\n});\n\nfunction toExpandedCharge(\n  latestCharge: Stripe.PaymentIntent[\"latest_charge\"],\n): Stripe.Charge | null {\n  if (!latestCharge) {\n    return null;\n  }\n  if (typeof latestCharge === \"string\") {\n    return null;\n  }\n  return latestCharge;\n}\n\nexport async function POST(\n  request: NextRequest,\n  { params }: { params: Promise<{ orderId: string }> },\n) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n  const { orderId } = await params;\n\n  try {\n    await requireAdminApi();\n    const supabase = await createSupabaseServerClient();\n    const ordersRepo = new OrdersRepository(supabase);\n    const profilesRepo = new ProfileRepository(supabase);\n\n    const order = await ordersRepo.getOrderWithTenant(orderId);\n\n    if (!order) {\n      return NextResponse.json(\n        { error: \"Order not found\", requestId },\n        { status: 404, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    if (order.status === \"refunded\") {\n      return NextResponse.json(\n        { error: \"Order has already been refunded\", requestId },\n        { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    if (!order.stripe_payment_intent_id) {\n      return NextResponse.json(\n        { error: \"Cannot refund order: Missing payment information\", requestId },\n        { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const tenantId = order.tenant_id;\n    if (!tenantId) {\n      return NextResponse.json(\n        { error: \"Cannot refund: Tenant not found for order\", requestId },\n        { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const stripeAccountId = await profilesRepo.getStripeAccountIdForTenant(tenantId);\n\n    log({\n      level: \"info\",\n      layer: \"api\",\n      message: \"refund_initiated\",\n      orderId,\n      tenantId,\n      stripeAccountId: stripeAccountId ?? \"not_configured\",\n      paymentIntentId: order.stripe_payment_intent_id,\n    });\n\n    // Retrieve payment intent with expanded charge and transfer data\n    let paymentIntent: Stripe.PaymentIntent;\n    let retrievedOnAccount: \"platform\" | \"connect\" = \"platform\";\n\n    try {\n      paymentIntent = await stripe.paymentIntents.retrieve(\n        order.stripe_payment_intent_id,\n        { expand: [\"latest_charge\", \"latest_charge.transfer\"] },\n      );\n      retrievedOnAccount = \"platform\";\n    } catch (platformError: any) {\n      if (stripeAccountId) {\n        try {\n          paymentIntent = await stripe.paymentIntents.retrieve(\n            order.stripe_payment_intent_id,\n            { expand: [\"latest_charge\", \"latest_charge.transfer\"] },\n            { stripeAccount: stripeAccountId },\n          );\n          retrievedOnAccount = \"connect\";\n        } catch (connectError: any) {\n          logError(new Error(\"Payment intent not found on either account\"), {\n            layer: \"api\",\n            requestId,\n            orderId,\n            platformError: platformError.message,\n            connectError: connectError.message,\n          });\n\n          return NextResponse.json(\n            {\n              error: \"Payment intent not found\",\n              requestId,\n            },\n            { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n          );\n        }\n      } else {\n        throw platformError;\n      }\n    }\n\n    // Get charge (fallback to charges.list if not expanded)\n    let charge: Stripe.Charge | null = toExpandedCharge(paymentIntent.latest_charge);\n\n    if (!charge) {\n      const chargesResp = await stripe.charges.list(\n        {\n          payment_intent: paymentIntent.id,\n          limit: 1,\n          expand: [\"data.transfer\"],\n        },\n        retrievedOnAccount === \"connect\" && stripeAccountId\n          ? { stripeAccount: stripeAccountId }\n          : undefined,\n      );\n      charge = chargesResp.data[0] ?? null;\n    }\n\n    // Determine payment structure and refund strategy\n    const isDestinationCharge = !!paymentIntent.on_behalf_of;\n    const isSeparateCharge = !!paymentIntent.transfer_data?.destination;\n    const hasActualTransfer = !!charge?.transfer;\n\n    // Validate transfer exists if configured\n    if (!hasActualTransfer && paymentIntent.transfer_data) {\n      logError(new Error(\"Transfer configured but not created\"), {\n        layer: \"api\",\n        requestId,\n        orderId,\n        paymentIntentId: paymentIntent.id,\n      });\n\n      return NextResponse.json(\n        {\n          error: \"Cannot refund: Transfer to seller account was not completed\",\n          requestId,\n        },\n        { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    // Create refund with appropriate strategy\n    let refund: Stripe.Refund;\n\n    if (isDestinationCharge) {\n      refund = await stripe.refunds.create({\n        payment_intent: paymentIntent.id,\n        reason: \"requested_by_customer\",\n      });\n    } else if (isSeparateCharge && hasActualTransfer) {\n      refund = await stripe.refunds.create({\n        payment_intent: paymentIntent.id,\n        reason: \"requested_by_customer\",\n        reverse_transfer: true,\n      });\n    } else {\n      refund = await stripe.refunds.create({\n        payment_intent: paymentIntent.id,\n        reason: \"requested_by_customer\",\n      });\n    }\n\n    if (refund.status === \"failed\") {\n      throw new Error(`Stripe refund failed: ${refund.failure_reason}`);\n    }\n\n    await ordersRepo.markRefunded(orderId, refund.amount);\n\n    log({\n      level: \"info\",\n      layer: \"api\",\n      message: \"refund_completed\",\n      orderId,\n      refundId: refund.id,\n      amount: refund.amount,\n      reversedTransfer: isSeparateCharge && hasActualTransfer,\n    });\n\n    // Send refund confirmation email\n    try {\n      if (order.user_id) {\n        const profile = await profilesRepo.getByUserId(order.user_id);\n        if (profile?.email) {\n          const emailService = new OrderEmailService();\n          await emailService.sendOrderRefunded({\n            to: profile.email,\n            orderId: order.id,\n            refundAmount: refund.amount,\n          });\n        }\n      } else if (order.guest_email) {\n        const emailService = new OrderEmailService();\n        await emailService.sendOrderRefunded({\n          to: order.guest_email,\n          orderId: order.id,\n          refundAmount: refund.amount,\n        });\n      }\n    } catch (emailError) {\n      logError(emailError, {\n        layer: \"api\",\n        requestId,\n        message: \"refund_email_failed\",\n        orderId,\n      });\n    }\n\n    return NextResponse.json(\n      { success: true, refundId: refund.id },\n      { headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  } catch (error: any) {\n    logError(error, {\n      layer: \"api\",\n      requestId,\n      route: `/api/admin/orders/${orderId}/refund`,\n      message: \"refund_failed\",\n    });\n\n    const errorMessage =\n      error.raw?.message || error.message || \"Failed to process refund\";\n\n    return NextResponse.json(\n      { error: errorMessage, requestId },\n      { status: 500, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\orders\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\payout\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":52,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1847,1850],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1847,1850],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// app/api/admin/payout/route.ts\nimport type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\n\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { requireAdminApi } from \"@/lib/auth/session\";\nimport { PayoutSettingsRepository } from \"@/repositories/payout-settings-repo\";\nimport { canViewBank } from \"@/config/constants/roles\";\nimport { payoutSettingsSchema } from \"@/lib/validation/admin\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { logError } from \"@/lib/log\";\n\nexport async function POST(request: NextRequest) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n\n  try {\n    const session = await requireAdminApi();\n    const body = await request.json().catch(() => null);\n    const parsed = payoutSettingsSchema.safeParse(body ?? {});\n\n    if (!parsed.success) {\n      return NextResponse.json(\n        { error: \"Invalid payload\", issues: parsed.error.format(), requestId },\n        { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const supabase = await createSupabaseServerClient();\n    const payoutRepo = new PayoutSettingsRepository(supabase);\n\n    if (!canViewBank(session.role)) {\n      return NextResponse.json(\n        { error: \"Forbidden\", requestId },\n        { status: 403, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const existing = await payoutRepo.get();\n    const primaryAdminId = existing?.primary_admin_id ?? session.user.id;\n\n    const payoutSettings = await payoutRepo.upsert({\n      primaryAdminId,\n      provider: parsed.data.provider,\n      accountLabel: parsed.data.account_label,\n      accountLast4: parsed.data.account_last4,\n    });\n\n    return NextResponse.json(\n      { payoutSettings },\n      { headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  } catch (error: any) {\n    logError(error, {\n      layer: \"api\",\n      requestId,\n      route: \"/api/admin/payout\",\n    });\n\n    return NextResponse.json(\n      { error: \"Failed to update payout settings\", requestId },\n      { status: 500, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\products\\[id]\\duplicate\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\products\\[id]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\products\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\profile\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1332,1335],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1332,1335],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":72,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2492,2495],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2492,2495],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\n\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { requireAdminApi } from \"@/lib/auth/session\";\nimport { ProfileRepository } from \"@/repositories/profile-repo\";\nimport { PayoutSettingsRepository } from \"@/repositories/payout-settings-repo\";\nimport { canViewBank } from \"@/config/constants/roles\";\nimport { adminPreferencesSchema } from \"@/lib/validation/admin\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { logError } from \"@/lib/log\";\n\nexport async function GET(request: NextRequest) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n\n  try {\n    const session = await requireAdminApi();\n    const supabase = await createSupabaseServerClient();\n    const profileRepo = new ProfileRepository(supabase);\n    const profile = await profileRepo.getByUserId(session.user.id);\n    let payoutSettings = null;\n\n    if (canViewBank(session.role)) {\n      const payoutRepo = new PayoutSettingsRepository(supabase);\n      try {\n        payoutSettings = await payoutRepo.get();\n      } catch {\n        payoutSettings = null;\n      }\n    }\n\n    return NextResponse.json(\n      { profile, payoutSettings },\n      { headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  } catch (error: any) {\n    logError(error, {\n      layer: \"api\",\n      requestId,\n      route: \"/api/admin/profile\",\n    });\n\n    return NextResponse.json(\n      { error: \"Failed to load profile\", requestId },\n      { status: 500, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n}\n\nexport async function PATCH(request: NextRequest) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n\n  try {\n    const session = await requireAdminApi();\n    const body = await request.json().catch(() => null);\n    const parsed = adminPreferencesSchema.safeParse(body ?? {});\n\n    if (!parsed.success) {\n      return NextResponse.json(\n        { error: \"Invalid payload\", issues: parsed.error.format(), requestId },\n        { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const supabase = await createSupabaseServerClient();\n    const profileRepo = new ProfileRepository(supabase);\n\n    await profileRepo.updateNotificationPreferences(session.user.id, parsed.data);\n    const profile = await profileRepo.getByUserId(session.user.id);\n\n    return NextResponse.json({ profile }, { headers: { \"Cache-Control\": \"no-store\" } });\n  } catch (error: any) {\n    logError(error, {\n      layer: \"api\",\n      requestId,\n      route: \"/api/admin/profile\",\n    });\n\n    return NextResponse.json(\n      { error: \"Failed to update profile\", requestId },\n      { status: 500, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\shipping\\carriers\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\shipping\\defaults\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\shipping\\labels\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[886,889],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[886,889],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":109,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":109,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3458,3461],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3458,3461],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":159,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":159,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4931,4934],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4931,4934],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":218,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":218,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6483,6486],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6483,6486],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// app/api/admin/shipping/labels/route.ts\n// Enhanced version with audit tracking and cost recording\n\nimport type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\nimport { z } from \"zod\";\n\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { requireAdminApi } from \"@/lib/auth/session\";\nimport { OrdersRepository } from \"@/repositories/orders-repo\";\nimport { ProfileRepository } from \"@/repositories/profile-repo\";\nimport { ShippoService } from \"@/services/shipping-label-service\";\nimport { OrderEmailService } from \"@/services/order-email-service\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { logError } from \"@/lib/log\";\n\nconst labelsSchema = z\n  .object({\n    orderId: z.string().uuid(),\n    shipmentId: z.string(),\n    rateId: z.string(),\n  })\n  .strict();\n\nconst isAlreadyLabeledOrPast = (order: any) => {\n  const status = String(order?.fulfillment_status ?? \"\").toLowerCase();\n  if (order?.tracking_number) {\n    return true;\n  }\n  if ([\"ready_to_ship\", \"shipped\", \"delivered\"].includes(status)) {\n    return true;\n  }\n  return false;\n};\n\nconst mapShippoError = (error: string): string => {\n  const lower = error.toLowerCase();\n\n  if (lower.includes(\"address\") && lower.includes(\"invalid\")) {\n    return \"The shipping address is invalid. Please verify the address details.\";\n  }\n  if (lower.includes(\"insufficient funds\")) {\n    return \"Insufficient funds in your Shippo account. Please add funds to continue.\";\n  }\n  if (lower.includes(\"rate\") && lower.includes(\"expired\")) {\n    return \"The shipping rate has expired. Please get new rates and try again.\";\n  }\n  if (lower.includes(\"carrier\")) {\n    return \"Carrier service unavailable. Please try a different carrier or try again later.\";\n  }\n\n  return error;\n};\n\n// Convert dollar string to cents\nconst dollarsToCents = (dollars: string | null | undefined): number => {\n  if (!dollars) {\n    return 0;\n  }\n  const num = parseFloat(dollars);\n  return Math.round(num * 100);\n};\n\nexport async function POST(request: NextRequest) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n\n  try {\n    const session = await requireAdminApi();\n    const supabase = await createSupabaseServerClient();\n    const adminUserId = session.profile?.id ?? null;\n\n    const body = await request.json().catch(() => null);\n    const parsed = labelsSchema.safeParse(body);\n\n    if (!parsed.success) {\n      return NextResponse.json(\n        { error: \"Invalid payload\", issues: parsed.error.format(), requestId },\n        { status: 400 },\n      );\n    }\n\n    const { orderId, rateId } = parsed.data;\n\n    const ordersRepo = new OrdersRepository(supabase);\n    const profilesRepo = new ProfileRepository(supabase);\n    const shippoService = new ShippoService();\n\n    const order = await ordersRepo.getById(orderId);\n    if (!order) {\n      return NextResponse.json({ error: \"Order not found\", requestId }, { status: 404 });\n    }\n\n    if (isAlreadyLabeledOrPast(order)) {\n      return NextResponse.json(\n        {\n          error: \"A shipping label has already been purchased for this order.\",\n          requestId,\n          carrier: order.shipping_carrier ?? null,\n          trackingNumber: order.tracking_number ?? null,\n        },\n        { status: 409 },\n      );\n    }\n\n    // Purchase label via Shippo\n    let transaction;\n    try {\n      transaction = await shippoService.purchaseLabel(rateId);\n    } catch (shippoError: any) {\n      const mappedError = mapShippoError(shippoError?.message || \"Label purchase failed\");\n\n      // Log for monitoring\n      logError(shippoError, {\n        layer: \"api\",\n        requestId,\n        orderId,\n        rateId,\n        message: \"Shippo label purchase failed\",\n      });\n\n      return NextResponse.json({ error: mappedError, requestId }, { status: 502 });\n    }\n\n    if (transaction.status !== \"SUCCESS\") {\n      const errorText = transaction.messages?.[0]?.text ?? \"Transaction not successful\";\n      const mappedError = mapShippoError(errorText);\n\n      logError(new Error(`Shippo transaction failed: ${errorText}`), {\n        layer: \"api\",\n        requestId,\n        orderId,\n        transactionStatus: transaction.status,\n      });\n\n      return NextResponse.json(\n        { error: `Label purchase failed: ${mappedError}`, requestId },\n        { status: 502 },\n      );\n    }\n\n    const carrier = transaction.carrier;\n    const trackingNumber = transaction.trackingNumber;\n    const trackingUrl = transaction.trackingUrl;\n    const labelUrl = transaction.labelUrl;\n    const shippingCostCents = dollarsToCents(transaction.rate);\n\n    if (!trackingNumber) {\n      return NextResponse.json(\n        {\n          error:\n            \"Label purchase succeeded but returned no tracking number. Please contact support.\",\n          requestId,\n        },\n        { status: 502 },\n      );\n    }\n\n    // Update order with full audit trail\n    const updateData: any = {\n      carrier,\n      trackingNumber,\n      labelUrl,\n      labelCreatedBy: adminUserId,\n      actualShippingCost: shippingCostCents,\n    };\n\n    await ordersRepo.markReadyToShip(orderId, updateData);\n\n    // Send customer notification email\n    try {\n      if (order.user_id) {\n        const profile = await profilesRepo.getByUserId(order.user_id);\n        if (profile?.email) {\n          const emailService = new OrderEmailService();\n          await emailService.sendOrderLabelCreated({\n            to: profile.email,\n            orderId: order.id,\n            carrier,\n            trackingNumber,\n            trackingUrl,\n          });\n        }\n      }\n    } catch (emailError) {\n      // Don't fail the request if email fails\n      logError(emailError, {\n        layer: \"api\",\n        requestId,\n        message: \"Failed to send label created email (non-blocking)\",\n        orderId,\n      });\n    }\n\n    // Log successful label creation\n    logError(new Error(\"Label created successfully\"), {\n      layer: \"api\",\n      requestId,\n      orderId,\n      carrier,\n      trackingNumber,\n      cost: shippingCostCents,\n      createdBy: adminUserId,\n      level: \"info\",\n    });\n\n    return NextResponse.json({\n      success: true,\n      label: {\n        label_url: labelUrl,\n        pdf_url: labelUrl,\n      },\n      trackingCode: trackingNumber,\n      trackingUrl: trackingUrl,\n      carrier: carrier,\n      cost: shippingCostCents,\n      message: \"Label purchased successfully. Customer has been notified via email.\",\n    });\n  } catch (error: any) {\n    logError(error, {\n      layer: \"api\",\n      requestId,\n      route: \"/api/admin/shipping/labels\",\n      message: \"Unexpected error during label creation\",\n    });\n\n    const userMessage = mapShippoError(\n      error.message || \"Failed to create shipping label.\",\n    );\n\n    return NextResponse.json({ error: userMessage, requestId }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\shipping\\origin\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\shipping\\rates\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":134,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":134,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4037,4040],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4037,4040],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":151,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":151,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4565,4568],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4565,4568],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":211,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":211,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6295,6298],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6295,6298],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// app/api/admin/shipping/rates/route.ts\nimport type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\nimport { z } from \"zod\";\n\nimport { createSupabaseAdminClient } from \"@/lib/supabase/service-role\";\nimport { requireAdminApi } from \"@/lib/auth/session\";\nimport { ShippingOriginsRepository } from \"@/repositories/shipping-origins-repo\";\nimport { ShippingCarriersRepository } from \"@/repositories/shipping-carriers-repo\";\nimport { AddressesRepository } from \"@/repositories/addresses-repo\";\nimport { ShippoService } from \"@/services/shipping-label-service\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { logError } from \"@/lib/log\";\n\nexport const dynamic = \"force-dynamic\";\n\nconst noStoreHeaders = { \"Cache-Control\": \"no-store\" };\n\nconst recipientSchema = z\n  .object({\n    name: z.string().trim().optional().nullable(),\n    phone: z.string().trim().optional().nullable(),\n    line1: z.string().trim().min(1),\n    line2: z.string().trim().optional().nullable(),\n    city: z.string().trim().min(1),\n    state: z.string().trim().min(1),\n    postal_code: z.string().trim().min(1),\n    country: z.string().trim().min(1),\n  })\n  .strict();\n\nconst ratesSchema = z\n  .object({\n    orderId: z.string().uuid(),\n    weight: z.number().positive(),\n    length: z.number().positive(),\n    width: z.number().positive(),\n    height: z.number().positive(),\n    recipient: recipientSchema.optional(),\n  })\n  .strict();\n\nconst normalizeCarrier = (v: unknown) =>\n  String(v ?? \"\")\n    .trim()\n    .toUpperCase();\n\nconst toShippoAddress = (address: {\n  name?: string | null;\n  company?: string | null;\n  phone?: string | null;\n  line1?: string | null;\n  line2?: string | null;\n  city?: string | null;\n  state?: string | null;\n  postal_code?: string | null;\n  country?: string | null;\n}) => {\n  if (\n    !address.line1 ||\n    !address.city ||\n    !address.state ||\n    !address.postal_code ||\n    !address.country\n  ) {\n    return null;\n  }\n\n  return {\n    name: address.name ?? undefined,\n    company: address.company ?? undefined,\n    phone: address.phone ?? undefined,\n    street1: address.line1,\n    street2: address.line2 ?? undefined,\n    city: address.city,\n    state: address.state,\n    zip: address.postal_code,\n    country: address.country,\n  };\n};\n\nexport async function POST(request: NextRequest) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n\n  try {\n    await requireAdminApi();\n\n    const supabase = await createSupabaseAdminClient();\n\n    const body = await request.json().catch(() => null);\n    const parsed = ratesSchema.safeParse(body);\n\n    if (!parsed.success) {\n      return NextResponse.json(\n        { error: \"Invalid payload\", issues: parsed.error.format(), requestId },\n        { status: 400, headers: noStoreHeaders },\n      );\n    }\n\n    const { orderId, weight, length, width, height, recipient } = parsed.data;\n\n    const originsRepo = new ShippingOriginsRepository(supabase);\n    const carriersRepo = new ShippingCarriersRepository(supabase);\n    const addressesRepo = new AddressesRepository(supabase);\n    const shippoService = new ShippoService();\n\n    // Get enabled carriers\n    const carriersConfig = await carriersRepo.get();\n    const enabledCarriers = (carriersConfig?.enabled_carriers ?? [])\n      .map(normalizeCarrier)\n      .filter(Boolean);\n\n    const enabledSet = new Set(enabledCarriers);\n\n    if (enabledSet.size === 0) {\n      return NextResponse.json(\n        {\n          error: \"No carriers enabled. Please enable carriers in shipping settings.\",\n          requestId,\n        },\n        { status: 400, headers: noStoreHeaders },\n      );\n    }\n\n    // Get recipient address\n    const recipientSource = recipient ?? (await addressesRepo.getOrderShipping(orderId));\n    if (!recipientSource) {\n      return NextResponse.json(\n        { error: \"Recipient address not found for this order.\", requestId },\n        { status: 404, headers: noStoreHeaders },\n      );\n    }\n\n    const recipientAddress = toShippoAddress(recipientSource as any);\n    if (!recipientAddress) {\n      return NextResponse.json(\n        { error: \"Recipient address is incomplete.\", requestId },\n        { status: 400, headers: noStoreHeaders },\n      );\n    }\n\n    // Get shipper address\n    const shipper = await originsRepo.get();\n    if (!shipper) {\n      return NextResponse.json(\n        { error: \"Shipping origin address not configured in settings.\", requestId },\n        { status: 400, headers: noStoreHeaders },\n      );\n    }\n\n    const shipperAddress = toShippoAddress(shipper as any);\n    if (!shipperAddress) {\n      return NextResponse.json(\n        { error: \"Shipping origin address is incomplete.\", requestId },\n        { status: 400, headers: noStoreHeaders },\n      );\n    }\n\n    // Create shipment and get rates\n    const parcel = { weight, length, width, height };\n    const normalizedShipment = await shippoService.createShipment(\n      shipperAddress,\n      recipientAddress,\n      parcel,\n    );\n\n    if (!normalizedShipment.id) {\n      return NextResponse.json(\n        { error: \"Shippo shipment creation failed: missing shipment ID\", requestId },\n        { status: 502, headers: noStoreHeaders },\n      );\n    }\n\n    // Filter rates by enabled carriers\n    const filteredRates = normalizedShipment.rates.filter((rate) => {\n      const provider = normalizeCarrier(rate.carrier);\n      return enabledSet.has(provider);\n    });\n\n    if (filteredRates.length === 0) {\n      return NextResponse.json(\n        {\n          error:\n            \"No rates available for enabled carriers. Check your carrier settings or try different package dimensions.\",\n          requestId,\n        },\n        { status: 400, headers: noStoreHeaders },\n      );\n    }\n\n    // Map to UI format (already normalized, but keep for compatibility)\n    const uiRates = filteredRates.map((r) => ({\n      id: r.id,\n      carrier: r.carrier,\n      service: r.service,\n      rate: r.rate,\n      currency: r.currency,\n      estimated_delivery_days: r.estimated_delivery_days,\n      delivery_days: r.estimated_delivery_days,\n    }));\n\n    return NextResponse.json(\n      {\n        shipment: {\n          id: normalizedShipment.id,\n          rates: uiRates,\n        },\n      },\n      { headers: noStoreHeaders },\n    );\n  } catch (error: any) {\n    logError(error, { layer: \"api\", requestId, route: \"/api/admin/shipping/rates\" });\n\n    return NextResponse.json(\n      { error: error.message || \"Failed to fetch shipping rates.\", requestId },\n      { status: 500, headers: noStoreHeaders },\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\stripe\\account-session\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":46,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1753,1756],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1753,1756],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// app/api/admin/stripe/account-session/route.ts\nimport type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\n\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { requireAdminApi } from \"@/lib/auth/session\";\nimport { canViewBank } from \"@/config/constants/roles\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { logError } from \"@/lib/log\";\nimport { TenantContextService } from \"@/services/tenant-context-service\";\nimport { StripeAdminService } from \"@/services/stripe-admin-service\";\n\nexport async function POST(request: NextRequest) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n\n  try {\n    const session = await requireAdminApi();\n\n    if (!canViewBank(session.role)) {\n      return NextResponse.json(\n        { error: \"Forbidden\", requestId },\n        { status: 403, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const supabase = await createSupabaseServerClient();\n\n    //  Use the onboarding-specific method that doesn't require existing Stripe account\n    const contextService = new TenantContextService(supabase);\n    const context = await contextService.getAdminContextForOnboarding(session.user.id);\n\n    const service = new StripeAdminService(supabase);\n\n    // This will create the account if it doesn't exist, or return existing one\n    const { accountId } = await service.ensureExpressAccount({\n      userId: session.user.id,\n      tenantId: context.tenantId,\n    });\n\n    const { clientSecret } = await service.createAccountSession({ accountId });\n\n    return NextResponse.json(\n      { client_secret: clientSecret, account_id: accountId },\n      { headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  } catch (error: any) {\n    logError(error, {\n      layer: \"api\",\n      requestId,\n      route: \"/api/admin/stripe/account-session\",\n      message: \"Failed to create account session\",\n    });\n\n    return NextResponse.json(\n      { error: \"Failed to create account session.\", requestId },\n      { status: 500 },\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\stripe\\account\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1521,1524],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1521,1524],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// app/api/admin/stripe/account/route.ts (FIXED)\nimport type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\n\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { requireAdminApi } from \"@/lib/auth/session\";\nimport { canViewBank } from \"@/config/constants/roles\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { logError } from \"@/lib/log\";\nimport { TenantContextService } from \"@/services/tenant-context-service\";\nimport { StripeAdminService } from \"@/services/stripe-admin-service\";\n\nexport async function GET(request: NextRequest) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n\n  try {\n    const session = await requireAdminApi();\n\n    if (!canViewBank(session.role)) {\n      return NextResponse.json(\n        { error: \"Forbidden\", requestId },\n        { status: 403, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const supabase = await createSupabaseServerClient();\n\n    //  Get tenant context to ensure we're accessing the right Stripe account\n    const contextService = new TenantContextService(supabase);\n    const context = await contextService.getAdminContext(session.user.id);\n\n    const service = new StripeAdminService(supabase);\n    const summary = await service.getStripeAccountSummary({\n      userId: session.user.id,\n      tenantId: context.tenantId, // Pass tenant context\n    });\n\n    return NextResponse.json(summary, { headers: { \"Cache-Control\": \"no-store\" } });\n  } catch (error: any) {\n    logError(error, {\n      layer: \"api\",\n      requestId,\n      route: \"/api/admin/stripe/account\",\n      message: \"Failed to retrieve Stripe account details\",\n    });\n\n    const errorMessage =\n      error.raw?.message ||\n      error.message ||\n      \"Failed to retrieve account details from Stripe.\";\n\n    return NextResponse.json({ error: errorMessage, requestId }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\stripe\\bank-account-delete\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":64,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2209,2212],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2209,2212],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// app/api/admin/stripe/bank-account-delete/route.ts (FIXED)\nimport type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\n\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { requireAdminApi } from \"@/lib/auth/session\";\nimport { canViewBank } from \"@/config/constants/roles\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { logError } from \"@/lib/log\";\nimport { TenantContextService } from \"@/services/tenant-context-service\";\nimport { StripeAdminService } from \"@/services/stripe-admin-service\";\nimport { stripeBankAccountSchema } from \"@/lib/validation/stripe\";\n\nexport async function POST(request: NextRequest) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n\n  try {\n    const session = await requireAdminApi();\n\n    if (!canViewBank(session.role)) {\n      return NextResponse.json(\n        { error: \"Forbidden\", requestId },\n        { status: 403, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const supabase = await createSupabaseServerClient();\n\n    //  Get tenant context\n    const contextService = new TenantContextService(supabase);\n    const context = await contextService.getAdminContext(session.user.id);\n\n    const service = new StripeAdminService(supabase);\n    const body = await request.json().catch(() => null);\n    const parsed = stripeBankAccountSchema.safeParse(body ?? {});\n\n    if (!parsed.success) {\n      return NextResponse.json(\n        { error: \"Invalid payload\", issues: parsed.error.format(), requestId },\n        { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const bankAccountId = parsed.data.bank_account_id;\n\n    const summary = await service.getStripeAccountSummary({\n      userId: session.user.id,\n      tenantId: context.tenantId,\n    });\n\n    if (!summary.account?.id) {\n      return NextResponse.json(\n        { error: \"Stripe account not found\", requestId },\n        { status: 404 },\n      );\n    }\n\n    await service.deleteBankAccount({ accountId: summary.account.id, bankAccountId });\n\n    return NextResponse.json(\n      { success: true },\n      { headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  } catch (error: any) {\n    logError(error, {\n      layer: \"api\",\n      requestId,\n      route: \"/api/admin/stripe/bank-account-delete\",\n      message: \"Failed to delete bank account\",\n    });\n\n    return NextResponse.json(\n      { error: \"Failed to delete bank account.\", requestId },\n      { status: 500 },\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\stripe\\payout-account\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":64,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2207,2210],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2207,2210],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// app/api/admin/stripe/payout-account/route.ts (FIXED)\nimport type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\n\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { requireAdminApi } from \"@/lib/auth/session\";\nimport { canViewBank } from \"@/config/constants/roles\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { logError } from \"@/lib/log\";\nimport { TenantContextService } from \"@/services/tenant-context-service\";\nimport { StripeAdminService } from \"@/services/stripe-admin-service\";\nimport { stripeBankAccountSchema } from \"@/lib/validation/stripe\";\n\nexport async function POST(request: NextRequest) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n\n  try {\n    const session = await requireAdminApi();\n\n    if (!canViewBank(session.role)) {\n      return NextResponse.json(\n        { error: \"Forbidden\", requestId },\n        { status: 403, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const supabase = await createSupabaseServerClient();\n\n    //  Get tenant context\n    const contextService = new TenantContextService(supabase);\n    const context = await contextService.getAdminContext(session.user.id);\n\n    const service = new StripeAdminService(supabase);\n    const body = await request.json().catch(() => null);\n    const parsed = stripeBankAccountSchema.safeParse(body ?? {});\n\n    if (!parsed.success) {\n      return NextResponse.json(\n        { error: \"Invalid payload\", issues: parsed.error.format(), requestId },\n        { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const bankAccountId = parsed.data.bank_account_id;\n\n    const summary = await service.getStripeAccountSummary({\n      userId: session.user.id,\n      tenantId: context.tenantId,\n    });\n\n    if (!summary.account?.id) {\n      return NextResponse.json(\n        { error: \"Stripe account not found\", requestId },\n        { status: 404 },\n      );\n    }\n\n    await service.setDefaultPayoutBank({ accountId: summary.account.id, bankAccountId });\n\n    return NextResponse.json(\n      { success: true },\n      { headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  } catch (error: any) {\n    logError(error, {\n      layer: \"api\",\n      requestId,\n      route: \"/api/admin/stripe/payout-account\",\n      message: \"Failed to update payout bank account\",\n    });\n\n    return NextResponse.json(\n      { error: \"Failed to update payout bank account.\", requestId },\n      { status: 500 },\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\stripe\\payout-create\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":66,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2234,2237],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2234,2237],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// app/api/admin/stripe/payout-create/route.ts (FIXED)\nimport type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\n\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { requireAdminApi } from \"@/lib/auth/session\";\nimport { canViewBank } from \"@/config/constants/roles\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { logError } from \"@/lib/log\";\nimport { TenantContextService } from \"@/services/tenant-context-service\";\nimport { StripeAdminService } from \"@/services/stripe-admin-service\";\nimport { stripePayoutCreateSchema } from \"@/lib/validation/stripe\";\n\nexport async function POST(request: NextRequest) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n\n  try {\n    const session = await requireAdminApi();\n\n    if (!canViewBank(session.role)) {\n      return NextResponse.json(\n        { error: \"Forbidden\", requestId },\n        { status: 403, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const supabase = await createSupabaseServerClient();\n\n    //  Get tenant context\n    const contextService = new TenantContextService(supabase);\n    const context = await contextService.getAdminContext(session.user.id);\n\n    const service = new StripeAdminService(supabase);\n    const body = await request.json().catch(() => null);\n    const parsed = stripePayoutCreateSchema.safeParse(body ?? {});\n\n    if (!parsed.success) {\n      return NextResponse.json(\n        { error: \"Invalid payload\", issues: parsed.error.format(), requestId },\n        { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const { amount, currency, method } = parsed.data;\n\n    const summary = await service.getStripeAccountSummary({\n      userId: session.user.id,\n      tenantId: context.tenantId,\n    });\n\n    if (!summary.account?.id) {\n      return NextResponse.json(\n        { error: \"Stripe account not found\", requestId },\n        { status: 404 },\n      );\n    }\n\n    const payout = await service.createManualPayout({\n      accountId: summary.account.id,\n      amount,\n      currency,\n      method,\n    });\n\n    return NextResponse.json({ payout }, { headers: { \"Cache-Control\": \"no-store\" } });\n  } catch (error: any) {\n    logError(error, {\n      layer: \"api\",\n      requestId,\n      route: \"/api/admin/stripe/payout-create\",\n      message: \"Failed to create payout\",\n    });\n\n    const message = error?.raw?.message || error?.message || \"Failed to create payout.\";\n    return NextResponse.json({ error: message, requestId }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\stripe\\payout-schedule\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":79,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2760,2763],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2760,2763],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// app/api/admin/stripe/payout-schedule/route.ts (FIXED)\nimport type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\nimport type Stripe from \"stripe\";\n\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { requireAdminApi } from \"@/lib/auth/session\";\nimport { canViewBank } from \"@/config/constants/roles\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { logError } from \"@/lib/log\";\nimport { TenantContextService } from \"@/services/tenant-context-service\";\nimport { StripeAdminService } from \"@/services/stripe-admin-service\";\nimport type {\n  STRIPE_PAYOUT_INTERVALS,\n  STRIPE_PAYOUT_WEEKLY_ANCHORS,\n} from \"@/config/constants/stripe\";\nimport { stripePayoutScheduleSchema } from \"@/lib/validation/stripe\";\n\ntype Interval = (typeof STRIPE_PAYOUT_INTERVALS)[number];\ntype WeeklyAnchor = (typeof STRIPE_PAYOUT_WEEKLY_ANCHORS)[number];\n\nexport async function POST(request: NextRequest) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n\n  try {\n    const session = await requireAdminApi();\n\n    if (!canViewBank(session.role)) {\n      return NextResponse.json(\n        { error: \"Forbidden\", requestId },\n        { status: 403, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const supabase = await createSupabaseServerClient();\n\n    //  Get tenant context\n    const contextService = new TenantContextService(supabase);\n    const context = await contextService.getAdminContext(session.user.id);\n\n    const service = new StripeAdminService(supabase);\n    const body = await request.json().catch(() => null);\n    const parsed = stripePayoutScheduleSchema.safeParse(body ?? {});\n\n    if (!parsed.success) {\n      return NextResponse.json(\n        { error: \"Invalid payload\", issues: parsed.error.format(), requestId },\n        { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const interval = parsed.data.interval as Interval;\n\n    const summary = await service.getStripeAccountSummary({\n      userId: session.user.id,\n      tenantId: context.tenantId,\n    });\n\n    if (!summary.account?.id) {\n      return NextResponse.json(\n        { error: \"Stripe account not found\", requestId },\n        { status: 404 },\n      );\n    }\n\n    const schedule: Stripe.AccountUpdateParams.Settings.Payouts.Schedule = { interval };\n\n    if (interval === \"weekly\") {\n      schedule.weekly_anchor = parsed.data.weekly_anchor as WeeklyAnchor;\n    }\n\n    if (interval === \"monthly\") {\n      schedule.monthly_anchor = parsed.data.monthly_anchor!;\n    }\n\n    await service.updatePayoutSchedule({ accountId: summary.account.id, schedule });\n\n    return NextResponse.json({ schedule }, { headers: { \"Cache-Control\": \"no-store\" } });\n  } catch (error: any) {\n    logError(error, {\n      layer: \"api\",\n      requestId,\n      route: \"/api/admin/stripe/payout-schedule\",\n      message: \"Failed to update payout schedule\",\n    });\n\n    return NextResponse.json(\n      { error: \"Failed to update payout schedule.\", requestId },\n      { status: 500 },\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\stripe\\payouts\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":70,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2271,2274],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2271,2274],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// app/api/admin/stripe/payouts/route.ts (FIXED)\nimport type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\n\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { requireAdminApi } from \"@/lib/auth/session\";\nimport { canViewBank } from \"@/config/constants/roles\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { logError } from \"@/lib/log\";\nimport { TenantContextService } from \"@/services/tenant-context-service\";\nimport { StripeAdminService } from \"@/services/stripe-admin-service\";\nimport { stripePayoutsQuerySchema } from \"@/lib/validation/stripe\";\n\nexport async function GET(request: NextRequest) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n\n  try {\n    const session = await requireAdminApi();\n\n    if (!canViewBank(session.role)) {\n      return NextResponse.json(\n        { error: \"Forbidden\", requestId },\n        { status: 403, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const supabase = await createSupabaseServerClient();\n\n    //  Get tenant context\n    const contextService = new TenantContextService(supabase);\n    const context = await contextService.getAdminContext(session.user.id);\n\n    const service = new StripeAdminService(supabase);\n    const summary = await service.getStripeAccountSummary({\n      userId: session.user.id,\n      tenantId: context.tenantId,\n    });\n\n    if (!summary.account?.id) {\n      return NextResponse.json(\n        { payouts: [] },\n        { headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const url = new URL(request.url);\n    const parsedQuery = stripePayoutsQuerySchema.safeParse({\n      limit: url.searchParams.get(\"limit\") ?? undefined,\n    });\n\n    if (!parsedQuery.success) {\n      return NextResponse.json(\n        {\n          error: \"Invalid query parameters\",\n          issues: parsedQuery.error.format(),\n          requestId,\n        },\n        { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const { limit } = parsedQuery.data;\n\n    const payouts = await service.listPayouts({\n      accountId: summary.account.id,\n      limit,\n    });\n\n    return NextResponse.json({ payouts }, { headers: { \"Cache-Control\": \"no-store\" } });\n  } catch (error: any) {\n    logError(error, {\n      layer: \"api\",\n      requestId,\n      route: \"/api/admin/stripe/payouts\",\n      message: \"Failed to retrieve payouts\",\n    });\n\n    return NextResponse.json(\n      { error: \"Failed to retrieve payouts.\", requestId },\n      { status: 500 },\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\tax-settings\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":46,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1636,1639],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1636,1639],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":120,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":120,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4218,4221],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4218,4221],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// app/api/admin/tax-settings/route.ts\nimport type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\nimport { z } from \"zod\";\n\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { requireAdminApi } from \"@/lib/auth/session\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { logError } from \"@/lib/log\";\nimport { TenantContextService } from \"@/services/tenant-context-service\";\nimport { TaxSettingsRepository } from \"@/repositories/tax-settings-repo\";\nimport { StripeTaxService } from \"@/services/stripe-tax-service\";\nimport { PRODUCT_TAX_CODES } from \"@/config/constants/nexus-thresholds\";\n\nconst taxSettingsSchema = z\n  .object({\n    taxEnabled: z.boolean(),\n    taxCodeOverrides: z.record(z.string(), z.string()).optional(),\n  })\n  .strict();\n\nconst allowedCategories = new Set(Object.keys(PRODUCT_TAX_CODES));\n\nexport async function GET(request: NextRequest) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n\n  try {\n    const session = await requireAdminApi();\n    const supabase = await createSupabaseServerClient();\n\n    const contextService = new TenantContextService(supabase);\n    const tenantId = await contextService.getTenantId(session.user.id);\n\n    const repo = new TaxSettingsRepository(supabase);\n    const settings = await repo.getByTenant(tenantId);\n\n    return NextResponse.json(\n      {\n        settings: {\n          taxEnabled: settings?.tax_enabled ?? false,\n          taxCodeOverrides: settings?.tax_code_overrides ?? {},\n        },\n      },\n      { headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  } catch (error: any) {\n    logError(error, { layer: \"api\", requestId, route: \"/api/admin/tax-settings\" });\n    return NextResponse.json(\n      { error: error.message || \"Failed to load tax settings\", requestId },\n      {\n        status: error.message?.includes(\"not found\") ? 404 : 500,\n        headers: { \"Cache-Control\": \"no-store\" },\n      },\n    );\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n\n  try {\n    const session = await requireAdminApi();\n    const supabase = await createSupabaseServerClient();\n\n    const contextService = new TenantContextService(supabase);\n    const context = await contextService.getAdminContext(session.user.id);\n\n    const body = await request.json().catch(() => null);\n    const parsed = taxSettingsSchema.safeParse(body ?? {});\n\n    if (!parsed.success) {\n      return NextResponse.json(\n        { error: \"Invalid payload\", issues: parsed.error.format(), requestId },\n        { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    // Filter tax code overrides to only allowed categories\n    const incomingOverrides = parsed.data.taxCodeOverrides ?? {};\n    const filteredOverrides: Record<string, string> = {};\n    for (const [category, code] of Object.entries(incomingOverrides)) {\n      if (!allowedCategories.has(category)) {\n        continue;\n      }\n      const cleaned = String(code ?? \"\").trim();\n      if (!cleaned) {\n        continue;\n      }\n      filteredOverrides[category] = cleaned;\n    }\n\n    const repo = new TaxSettingsRepository(supabase);\n    const existing = await repo.getByTenant(context.tenantId);\n\n    // If disabling tax, deactivate all Stripe Tax registrations for this tenant's Connect account\n    if (parsed.data.taxEnabled === false) {\n      const stripeTax = new StripeTaxService(supabase, context.stripeAccountId);\n      await stripeTax.deactivateStripeTaxRegistrations();\n    }\n\n    const updated = await repo.upsert({\n      tenantId: context.tenantId,\n      homeState: existing?.home_state ?? \"N/A\",\n      businessName: existing?.business_name ?? null,\n      taxIdNumber: existing?.tax_id_number ?? null,\n      stripeTaxSettingsId: existing?.stripe_tax_settings_id ?? null,\n      taxEnabled: parsed.data.taxEnabled,\n      taxCodeOverrides: filteredOverrides,\n    });\n\n    return NextResponse.json(\n      {\n        settings: {\n          taxEnabled: updated.tax_enabled,\n          taxCodeOverrides: updated.tax_code_overrides ?? {},\n        },\n      },\n      { headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  } catch (error: any) {\n    logError(error, { layer: \"api\", requestId, route: \"/api/admin/tax-settings\" });\n    return NextResponse.json(\n      { error: error.message || \"Failed to save tax settings\", requestId },\n      {\n        status: error.message?.includes(\"not configured\") ? 400 : 500,\n        headers: { \"Cache-Control\": \"no-store\" },\n      },\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\admin\\uploads\\product-image\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\analytics\\track\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\auth\\2fa\\challenge\\start\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\auth\\2fa\\challenge\\verify\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\auth\\2fa\\enroll\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\auth\\2fa\\verify-enrollment\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\auth\\callback\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\auth\\forgot-password\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1154,1157],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1154,1157],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// app/api/auth/forgot-password/route.ts\nimport type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\n\nimport { AuthService } from \"@/services/auth-service\";\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { logError } from \"@/lib/log\";\nimport { emailOnlySchema } from \"@/lib/validation/auth\";\n\nexport async function POST(req: NextRequest) {\n  const requestId = getRequestIdFromHeaders(req.headers);\n  const body = await req.json().catch(() => null);\n  const parsed = emailOnlySchema.safeParse(body);\n\n  if (!parsed.success) {\n    return NextResponse.json(\n      { ok: false, error: \"Invalid payload\", issues: parsed.error.format(), requestId },\n      { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n\n  try {\n    const { email } = parsed.data;\n    const supabase = await createSupabaseServerClient();\n    const authService = new AuthService(supabase);\n\n    await authService.sendPasswordReset(email);\n    return NextResponse.json({ ok: true }, { headers: { \"Cache-Control\": \"no-store\" } });\n  } catch (error: any) {\n    logError(error, {\n      layer: \"auth\",\n      requestId,\n      route: \"/api/auth/forgot-password\",\n    });\n\n    return NextResponse.json(\n      { ok: false, error: error.message ?? \"Reset failed\", requestId },\n      { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\auth\\forgot-password\\verify-code\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":79,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2603,2606],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2603,2606],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// app/api/auth/forgot-password/verify-code/route.ts\nimport type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\n\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { AuthService } from \"@/services/auth-service\";\nimport { AdminAuthService } from \"@/services/admin-auth-service\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { logError } from \"@/lib/log\";\nimport { otpVerifySchema } from \"@/lib/validation/auth\";\nimport { isAdminRole, isProfileRole } from \"@/config/constants/roles\";\n\nexport async function POST(req: NextRequest) {\n  const requestId = getRequestIdFromHeaders(req.headers);\n\n  try {\n    const body = await req.json().catch(() => null);\n    const parsed = otpVerifySchema.safeParse(body);\n\n    if (!parsed.success) {\n      return NextResponse.json(\n        { ok: false, error: \"Invalid payload\", issues: parsed.error.format(), requestId },\n        { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const { email, code } = parsed.data;\n\n    const supabase = await createSupabaseServerClient();\n    const authService = new AuthService(supabase);\n    const adminAuthService = new AdminAuthService(supabase);\n\n    // This establishes a recovery session\n    await authService.verifyPasswordResetCode(email, code);\n\n    // Now check if user is admin and needs 2FA\n    const { user, profile } = await authService.getCurrentUserProfile();\n\n    if (!user) {\n      return NextResponse.json(\n        { ok: false, error: \"Session error\", requestId },\n        { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const role = isProfileRole(profile?.role) ? profile.role : \"customer\";\n    const isAdmin = isAdminRole(role);\n\n    // If admin, check 2FA status\n    if (isAdmin) {\n      const { requiresTwoFASetup, requiresTwoFAChallenge } =\n        await adminAuthService.getMfaRequirements();\n\n      if (requiresTwoFASetup) {\n        // Admin has no 2FA setup - require setup\n        return NextResponse.json(\n          {\n            ok: true,\n            requiresTwoFASetup: true,\n            requestId,\n          },\n          { headers: { \"Cache-Control\": \"no-store\" } },\n        );\n      }\n\n      if (requiresTwoFAChallenge) {\n        return NextResponse.json(\n          {\n            ok: true,\n            requiresTwoFAChallenge: true,\n            requestId,\n          },\n          { headers: { \"Cache-Control\": \"no-store\" } },\n        );\n      }\n    }\n\n    return NextResponse.json({ ok: true }, { headers: { \"Cache-Control\": \"no-store\" } });\n  } catch (error: any) {\n    logError(error, {\n      layer: \"auth\",\n      requestId,\n      route: \"/api/auth/forgot-password/verify-code\",\n    });\n\n    return NextResponse.json(\n      {\n        ok: false,\n        error: error?.message ?? \"Invalid or expired code\",\n        requestId,\n      },\n      { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\auth\\login\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":94,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2885,2888],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2885,2888],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// app/api/auth/login/route.ts\nimport type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\n\nimport { AuthService } from \"@/services/auth-service\";\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { setAdminSessionCookie } from \"@/lib/http/admin-session-cookie\";\nimport { AdminAuthService } from \"@/services/admin-auth-service\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { logError } from \"@/lib/log\";\nimport { loginSchema } from \"@/lib/validation/auth\";\nimport { isAdminRole, isProfileRole } from \"@/config/constants/roles\";\n\nexport async function POST(req: NextRequest) {\n  const requestId = getRequestIdFromHeaders(req.headers);\n  const body = await req.json().catch(() => null);\n  const parsed = loginSchema.safeParse(body);\n\n  if (!parsed.success) {\n    return NextResponse.json(\n      { ok: false, error: \"Invalid payload\", issues: parsed.error.format(), requestId },\n      { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n\n  const { email, password } = parsed.data;\n\n  try {\n    const supabase = await createSupabaseServerClient();\n    const authService = new AuthService(supabase);\n    const adminAuthService = new AdminAuthService(supabase);\n\n    const { user, profile } = await authService.signIn(email, password);\n\n    if (!user) {\n      return NextResponse.json(\n        { ok: false, error: \"Invalid credentials\", requestId },\n        { status: 401, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const role = isProfileRole(profile?.role) ? profile.role : \"customer\";\n    const isAdmin = isAdminRole(role);\n\n    // For non-admin users, we're done\n    if (!isAdmin) {\n      return NextResponse.json(\n        { ok: true, isAdmin: false },\n        { headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    // Admin-specific 2FA checks\n    const { requiresTwoFASetup, requiresTwoFAChallenge } =\n      await adminAuthService.getMfaRequirements();\n\n    if (requiresTwoFASetup) {\n      return NextResponse.json(\n        {\n          ok: true,\n          isAdmin: true,\n          requiresTwoFASetup: true,\n          requestId,\n        },\n        { headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    if (requiresTwoFAChallenge) {\n      return NextResponse.json(\n        {\n          ok: true,\n          isAdmin: true,\n          requiresTwoFAChallenge: true,\n          requestId,\n        },\n        { headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    // If they're already at aal2, set admin cookie and let them through\n    let res = NextResponse.json<{ ok: true; isAdmin: true; requestId: string }>(\n      {\n        ok: true,\n        isAdmin: true,\n        requestId,\n      },\n      { headers: { \"Cache-Control\": \"no-store\" } },\n    );\n\n    res = await setAdminSessionCookie(res, user.id);\n\n    return res;\n  } catch (error: any) {\n    if (error?.message?.includes(\"Email not confirmed\")) {\n      try {\n        const supabase = await createSupabaseServerClient();\n        const authService = new AuthService(supabase);\n        await authService.resendVerification(email, \"signin\");\n      } catch {\n        // swallow resend errors\n      }\n\n      return NextResponse.json(\n        { ok: false, requiresEmailVerification: true, requestId },\n        { status: 401, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    logError(error, {\n      layer: \"auth\",\n      requestId,\n      route: \"/api/auth/login\",\n    });\n\n    const message = error?.message ?? \"Login failed\";\n    const status = message.toLowerCase().includes(\"invalid login\") ? 401 : 400;\n\n    return NextResponse.json(\n      { ok: false, error: message, requestId },\n      { status, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\auth\\logout\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[877,880],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[877,880],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/app/api/auth/logout/route.ts\nimport { NextResponse } from \"next/server\";\n\nimport { AuthService } from \"@/services/auth-service\";\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { clearAdminSessionCookie } from \"@/lib/http/admin-session-cookie\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { logError } from \"@/lib/log\";\n\nexport async function POST(request: Request) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n\n  try {\n    const supabase = await createSupabaseServerClient();\n    const authService = new AuthService(supabase);\n\n    await authService.signOut();\n\n    let res = NextResponse.json(\n      { ok: true },\n      { headers: { \"Cache-Control\": \"no-store\" } },\n    );\n    res = clearAdminSessionCookie(res);\n\n    return res; // IMPORTANT: return the response you mutated\n  } catch (error: any) {\n    logError(error, {\n      layer: \"auth\",\n      requestId,\n      route: \"/api/auth/logout\",\n    });\n\n    return NextResponse.json(\n      { ok: false, error: error.message ?? \"Logout failed\", requestId },\n      { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\auth\\otp\\request\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":32,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1247,1250],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1247,1250],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// app/api/auth/otp/request/route.ts\nimport type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\n\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { AuthService } from \"@/services/auth-service\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { logError } from \"@/lib/log\";\nimport { emailOnlySchema } from \"@/lib/validation/auth\";\n\nexport async function POST(req: NextRequest) {\n  const requestId = getRequestIdFromHeaders(req.headers);\n  const body = await req.json().catch(() => null);\n  const parsed = emailOnlySchema.safeParse(body);\n\n  if (!parsed.success) {\n    return NextResponse.json(\n      { ok: false, error: \"Invalid payload\", issues: parsed.error.format(), requestId },\n      { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n\n  try {\n    const { email } = parsed.data;\n    const supabase = await createSupabaseServerClient();\n    const authService = new AuthService(supabase);\n\n    await authService.requestEmailOtpForSignIn(email);\n\n    // Important: always respond with ok=true so we don't leak whether the email exists.\n    return NextResponse.json({ ok: true }, { headers: { \"Cache-Control\": \"no-store\" } });\n  } catch (error: any) {\n    logError(error, {\n      layer: \"auth\",\n      requestId,\n      route: \"/api/auth/otp/request\",\n    });\n\n    // Generic error to avoid leaking details\n    return NextResponse.json(\n      { ok: false, error: \"Could not send code. Please try again.\", requestId },\n      { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\auth\\otp\\verify\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":93,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2880,2883],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2880,2883],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// app/api/auth/otp/verify/route.ts\nimport type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\n\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { AuthService } from \"@/services/auth-service\";\nimport { setAdminSessionCookie } from \"@/lib/http/admin-session-cookie\";\nimport { AdminAuthService } from \"@/services/admin-auth-service\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { logError } from \"@/lib/log\";\nimport { otpVerifySchema } from \"@/lib/validation/auth\";\nimport { isAdminRole, isProfileRole } from \"@/config/constants/roles\";\n\nexport async function POST(req: NextRequest) {\n  const requestId = getRequestIdFromHeaders(req.headers);\n  const body = await req.json().catch(() => null);\n  const parsed = otpVerifySchema.safeParse(body);\n\n  if (!parsed.success) {\n    return NextResponse.json(\n      { ok: false, error: \"Invalid payload\", issues: parsed.error.format(), requestId },\n      { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n\n  try {\n    const { email, code } = parsed.data;\n    const supabase = await createSupabaseServerClient();\n    const authService = new AuthService(supabase);\n    const adminAuthService = new AdminAuthService(supabase);\n\n    const { user, profile } = await authService.verifyEmailOtpForSignIn(email, code);\n\n    if (!user) {\n      return NextResponse.json(\n        { ok: false, error: \"Invalid or expired code\", requestId },\n        { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const role = isProfileRole(profile?.role) ? profile.role : \"customer\";\n    const isAdmin = isAdminRole(role);\n\n    // For non-admin users, we're done\n    if (!isAdmin) {\n      return NextResponse.json(\n        { ok: true, isAdmin: false },\n        { headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    // Admin-specific 2FA checks\n    const { requiresTwoFASetup, requiresTwoFAChallenge } =\n      await adminAuthService.getMfaRequirements();\n\n    if (requiresTwoFASetup) {\n      return NextResponse.json(\n        {\n          ok: true,\n          isAdmin: true,\n          requiresTwoFASetup: true,\n          requestId,\n        },\n        { headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    if (requiresTwoFAChallenge) {\n      return NextResponse.json(\n        {\n          ok: true,\n          isAdmin: true,\n          requiresTwoFAChallenge: true,\n          requestId,\n        },\n        { headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    // Already at aal2, set admin cookie\n    let res = NextResponse.json<{ ok: true; isAdmin: true; requestId: string }>(\n      {\n        ok: true,\n        isAdmin: true,\n        requestId,\n      },\n      { headers: { \"Cache-Control\": \"no-store\" } },\n    );\n\n    res = await setAdminSessionCookie(res, user.id);\n\n    return res;\n  } catch (error: any) {\n    if (error?.message?.includes(\"Email not confirmed\")) {\n      return NextResponse.json(\n        { ok: false, requiresEmailVerification: true, requestId },\n        { status: 401, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    logError(error, {\n      layer: \"auth\",\n      requestId,\n      route: \"/api/auth/otp/verify\",\n    });\n\n    return NextResponse.json(\n      { ok: false, error: error.message ?? \"Login failed\", requestId },\n      { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\auth\\register\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":43,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1619,1622],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1619,1622],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// app/api/auth/register/route.ts\nimport type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\n\nimport { AuthService } from \"@/services/auth-service\";\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { logError } from \"@/lib/log\";\nimport { registerSchema } from \"@/lib/validation/auth\";\nimport { isPasswordValid } from \"@/lib/validation/password\";\n\nexport async function POST(req: NextRequest) {\n  const requestId = getRequestIdFromHeaders(req.headers);\n  const body = await req.json().catch(() => null);\n  const parsed = registerSchema.safeParse(body);\n\n  if (!parsed.success) {\n    return NextResponse.json(\n      { ok: false, error: \"Invalid payload\", issues: parsed.error.format(), requestId },\n      { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n\n  try {\n    const { email, password, updatesOptIn } = parsed.data;\n    if (!isPasswordValid(password)) {\n      return NextResponse.json(\n        { ok: false, error: \"Password does not meet the required criteria.\", requestId },\n        { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    // 1) Create request-scoped Supabase client (cookie/session-bound)\n    const supabase = await createSupabaseServerClient();\n\n    // 2) Inject into service\n    const authService = new AuthService(supabase);\n\n    // 3) Perform the sign-up\n    await authService.signUp(email, password, updatesOptIn);\n\n    return NextResponse.json({ ok: true }, { headers: { \"Cache-Control\": \"no-store\" } });\n  } catch (error: any) {\n    logError(error, {\n      layer: \"auth\",\n      requestId,\n      route: \"/api/auth/register\",\n    });\n\n    return NextResponse.json(\n      { ok: false, error: error.message ?? \"Sign up failed\", requestId },\n      { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\auth\\resend-verification\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1349,1352],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1349,1352],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// app/api/auth/resend-verification/route.ts\nimport type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\n\nimport { AuthService, type VerificationFlow } from \"@/services/auth-service\";\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { logError } from \"@/lib/log\";\nimport { resendVerificationSchema } from \"@/lib/validation/auth\";\n\nexport async function POST(req: NextRequest) {\n  const requestId = getRequestIdFromHeaders(req.headers);\n  const body = await req.json().catch(() => null);\n  const parsed = resendVerificationSchema.safeParse(body);\n\n  if (!parsed.success) {\n    return NextResponse.json(\n      { ok: false, error: \"Invalid payload\", issues: parsed.error.format(), requestId },\n      { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n\n  const normalizedEmail = parsed.data.email.trim();\n  const verificationFlow: VerificationFlow =\n    parsed.data.flow === \"signin\" ? \"signin\" : \"signup\";\n\n  try {\n    const supabase = await createSupabaseServerClient();\n    const authService = new AuthService(supabase);\n\n    await authService.resendVerification(normalizedEmail, verificationFlow);\n\n    return NextResponse.json({ ok: true }, { headers: { \"Cache-Control\": \"no-store\" } });\n  } catch (error: any) {\n    logError(error, {\n      layer: \"auth\",\n      requestId,\n      route: \"/api/auth/resend-verification\",\n    });\n\n    return NextResponse.json(\n      {\n        ok: false,\n        error: error.message ?? \"Could not resend verification email.\",\n        requestId,\n      },\n      { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\auth\\session\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\auth\\update-password\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1470,1473],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1470,1473],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// app/api/auth/update-password/route.ts\nimport type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\n\nimport { AuthService } from \"@/services/auth-service\";\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { logError } from \"@/lib/log\";\nimport { updatePasswordSchema } from \"@/lib/validation/auth\";\nimport { isPasswordValid } from \"@/lib/validation/password\";\n\nexport async function POST(req: NextRequest) {\n  const requestId = getRequestIdFromHeaders(req.headers);\n  const body = await req.json().catch(() => null);\n  const parsed = updatePasswordSchema.safeParse(body);\n\n  if (!parsed.success) {\n    return NextResponse.json(\n      { ok: false, error: \"Invalid payload\", issues: parsed.error.format(), requestId },\n      { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n\n  try {\n    const { password } = parsed.data;\n    if (!isPasswordValid(password)) {\n      return NextResponse.json(\n        { ok: false, error: \"Password does not meet the required criteria.\", requestId },\n        { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n    const supabase = await createSupabaseServerClient();\n    const authService = new AuthService(supabase);\n\n    await authService.updatePassword(password);\n    return NextResponse.json({ ok: true }, { headers: { \"Cache-Control\": \"no-store\" } });\n  } catch (error: any) {\n    logError(error, {\n      layer: \"auth\",\n      requestId,\n      route: \"/api/auth/update-password\",\n    });\n\n    return NextResponse.json(\n      { ok: false, error: error.message ?? \"Password update failed\", requestId },\n      { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\auth\\verify-email\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":44,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1477,1480],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1477,1480],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// app/api/auth/verify-email/route.ts\nimport type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\n\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { AuthService } from \"@/services/auth-service\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { logError } from \"@/lib/log\";\nimport { verifyEmailSchema } from \"@/lib/validation/auth\";\n\nexport async function POST(req: NextRequest) {\n  const requestId = getRequestIdFromHeaders(req.headers);\n  const body = await req.json().catch(() => null);\n  const parsed = verifyEmailSchema.safeParse(body);\n\n  if (!parsed.success) {\n    return NextResponse.json(\n      { ok: false, error: \"Invalid payload\", issues: parsed.error.format(), requestId },\n      { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n\n  const { email, code, flow } = parsed.data;\n\n  try {\n    const supabase = await createSupabaseServerClient();\n    const authService = new AuthService(supabase);\n\n    const { user } = await authService.verifyEmailOtpForSignup(email, code);\n\n    if (!user) {\n      return NextResponse.json(\n        { ok: false, error: \"Invalid or expired code.\", requestId },\n        { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const nextPath = flow === \"signup\" ? \"/\" : \"/\";\n\n    return NextResponse.json(\n      { ok: true, nextPath },\n      { headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  } catch (err: any) {\n    logError(err, {\n      layer: \"auth\",\n      requestId,\n      route: \"/api/auth/verify-email\",\n    });\n\n    return NextResponse.json(\n      { ok: false, error: err?.message ?? \"Could not verify code.\", requestId },\n      { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\cart\\restore\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\cart\\snapshot\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\cart\\validate\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":94,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3080,3083],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3080,3083],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\n\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { ProductRepository } from \"@/repositories/product-repo\";\nimport { cartValidateSchema } from \"@/lib/validation/cart\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { logError } from \"@/lib/log\";\nimport type { CartItem } from \"@/types/domain/cart\";\n\nconst PLACEHOLDER_IMAGE = \"/placeholder.png\";\n\nexport async function POST(request: NextRequest) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n\n  try {\n    const body = await request.json().catch(() => null);\n    const parsed = cartValidateSchema.safeParse(body ?? {});\n\n    if (!parsed.success) {\n      return NextResponse.json(\n        { error: \"Invalid payload\", issues: parsed.error.format(), requestId },\n        { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const items = parsed.data.items ?? [];\n    if (items.length === 0) {\n      return NextResponse.json(\n        { items: [], removed: [] },\n        { headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const supabase = await createSupabaseServerClient();\n    const repo = new ProductRepository(supabase);\n    const variantIds = [...new Set(items.map((item) => item.variantId))];\n    const variants = await repo.getVariantsForCart(variantIds);\n    const variantMap = new Map(variants.map((variant) => [variant.variantId, variant]));\n\n    const nextItems: CartItem[] = [];\n    const removed: Array<{ productId: string; variantId: string; reason: string }> = [];\n\n    for (const item of items) {\n      const variant = variantMap.get(item.variantId);\n      if (!variant || variant.productId !== item.productId) {\n        removed.push({\n          productId: item.productId,\n          variantId: item.variantId,\n          reason: \"not_found\",\n        });\n        continue;\n      }\n\n      if (!variant.isActive || variant.isOutOfStock || variant.stock <= 0) {\n        removed.push({\n          productId: item.productId,\n          variantId: item.variantId,\n          reason: \"out_of_stock\",\n        });\n        continue;\n      }\n\n      const maxStock = Math.max(0, variant.stock);\n      const quantity = Math.min(item.quantity, maxStock);\n\n      if (quantity <= 0) {\n        removed.push({\n          productId: item.productId,\n          variantId: item.variantId,\n          reason: \"insufficient_stock\",\n        });\n        continue;\n      }\n\n      nextItems.push({\n        productId: variant.productId,\n        variantId: variant.variantId,\n        sizeLabel: variant.sizeLabel,\n        brand: variant.brand,\n        name: variant.name,\n        titleDisplay: variant.titleDisplay || `${variant.brand} ${variant.name}`.trim(),\n        priceCents: variant.priceCents,\n        imageUrl: variant.imageUrl ?? PLACEHOLDER_IMAGE,\n        quantity,\n        maxStock,\n      });\n    }\n\n    return NextResponse.json(\n      { items: nextItems, removed },\n      { headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  } catch (error: any) {\n    logError(error, {\n      layer: \"api\",\n      requestId,\n      route: \"/api/cart/validate\",\n    });\n\n    return NextResponse.json(\n      { error: \"Failed to validate cart\", requestId },\n      { status: 500, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\chats\\[chatId]\\close\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1324,1327],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1324,1327],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// app/api/chats/[chatId]/close/route.ts\nimport type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\n\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { requireUserApi } from \"@/lib/auth/session\";\nimport { ChatService } from \"@/services/chat-service\";\nimport { chatIdParamsSchema } from \"@/lib/validation/chat\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { logError } from \"@/lib/log\";\n\nexport async function POST(\n  request: NextRequest,\n  { params }: { params: Promise<{ chatId: string }> },\n) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n  const { chatId } = await params;\n\n  const parsedParams = chatIdParamsSchema.safeParse({ chatId });\n  if (!parsedParams.success) {\n    return NextResponse.json(\n      { error: \"Invalid params\", issues: parsedParams.error.format(), requestId },\n      { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n\n  try {\n    const session = await requireUserApi();\n    const supabase = await createSupabaseServerClient();\n    const chatService = new ChatService(supabase);\n\n    const chat = await chatService.closeChat(parsedParams.data.chatId, session.user.id);\n\n    return NextResponse.json({ chat }, { headers: { \"Cache-Control\": \"no-store\" } });\n  } catch (error: any) {\n    logError(error, {\n      layer: \"api\",\n      requestId,\n      route: \"/api/chats/:chatId/close\",\n    });\n\n    return NextResponse.json(\n      { error: \"Failed to close chat\", requestId },\n      { status: 500, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\chats\\[chatId]\\messages\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1400,1403],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1400,1403],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":88,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3027,3030],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3027,3030],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// app/api/chats/[chatId]/messages/route.ts\nimport type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\n\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { createSupabaseAdminClient } from \"@/lib/supabase/service-role\";\nimport { requireUserApi } from \"@/lib/auth/session\";\nimport { ChatService } from \"@/services/chat-service\";\nimport { chatIdParamsSchema, sendChatMessageSchema } from \"@/lib/validation/chat\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { logError } from \"@/lib/log\";\n\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: Promise<{ chatId: string }> },\n) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n  const { chatId } = await params;\n\n  const parsedParams = chatIdParamsSchema.safeParse({ chatId });\n  if (!parsedParams.success) {\n    return NextResponse.json(\n      { error: \"Invalid params\", issues: parsedParams.error.format(), requestId },\n      { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n\n  try {\n    await requireUserApi();\n    const supabase = await createSupabaseServerClient();\n    const chatService = new ChatService(supabase);\n\n    const messages = await chatService.listMessages(parsedParams.data.chatId);\n\n    return NextResponse.json({ messages }, { headers: { \"Cache-Control\": \"no-store\" } });\n  } catch (error: any) {\n    logError(error, {\n      layer: \"api\",\n      requestId,\n      route: \"/api/chats/:chatId/messages\",\n    });\n\n    return NextResponse.json(\n      { error: \"Failed to load messages\", requestId },\n      { status: 500, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n}\n\nexport async function POST(\n  request: NextRequest,\n  { params }: { params: Promise<{ chatId: string }> },\n) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n  const { chatId } = await params;\n\n  const parsedParams = chatIdParamsSchema.safeParse({ chatId });\n  if (!parsedParams.success) {\n    return NextResponse.json(\n      { error: \"Invalid params\", issues: parsedParams.error.format(), requestId },\n      { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n\n  const body = await request.json().catch(() => null);\n  const parsedBody = sendChatMessageSchema.safeParse(body ?? {});\n\n  if (!parsedBody.success) {\n    return NextResponse.json(\n      { error: \"Invalid payload\", issues: parsedBody.error.format(), requestId },\n      { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n\n  try {\n    const session = await requireUserApi();\n    const supabase = await createSupabaseServerClient();\n    const adminSupabase = createSupabaseAdminClient();\n    const chatService = new ChatService(supabase, adminSupabase);\n\n    const message = await chatService.sendMessage({\n      chatId: parsedParams.data.chatId,\n      senderId: session.user.id,\n      body: parsedBody.data.message,\n    });\n\n    return NextResponse.json({ message }, { headers: { \"Cache-Control\": \"no-store\" } });\n  } catch (error: any) {\n    logError(error, {\n      layer: \"api\",\n      requestId,\n      route: \"/api/chats/:chatId/messages\",\n    });\n\n    const message = error?.message ?? \"Failed to send message\";\n    const status = message.includes(\"Chat\") || message.includes(\"Forbidden\") ? 400 : 500;\n\n    return NextResponse.json(\n      { error: message, requestId },\n      { status, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\chats\\current\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[858,861],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[858,861],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// app/api/chats/current/route.ts\nimport type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\n\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { requireUserApi } from \"@/lib/auth/session\";\nimport { ChatService } from \"@/services/chat-service\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { logError } from \"@/lib/log\";\n\nexport async function GET(request: NextRequest) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n\n  try {\n    const session = await requireUserApi();\n    const supabase = await createSupabaseServerClient();\n    const chatService = new ChatService(supabase);\n\n    const chat = await chatService.getOpenChatForUser(session.user.id);\n\n    return NextResponse.json({ chat }, { headers: { \"Cache-Control\": \"no-store\" } });\n  } catch (error: any) {\n    logError(error, {\n      layer: \"api\",\n      requestId,\n      route: \"/api/chats/current\",\n    });\n\n    return NextResponse.json(\n      { error: \"Failed to load chat\", requestId },\n      { status: 500, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\chats\\guest\\[chatId]\\close\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\chats\\guest\\[chatId]\\messages\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\chats\\guest\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\chats\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1351,1354],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1351,1354],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":77,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2592,2595],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2592,2595],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// app/api/chats/route.ts\nimport type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\n\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { createSupabaseAdminClient } from \"@/lib/supabase/service-role\";\nimport { requireAdminApi, requireUserApi } from \"@/lib/auth/session\";\nimport { ChatService } from \"@/services/chat-service\";\nimport { createChatSchema, listChatsQuerySchema } from \"@/lib/validation/chat\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { logError } from \"@/lib/log\";\n\nexport async function GET(request: NextRequest) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n\n  try {\n    await requireAdminApi();\n    const supabase = await createSupabaseServerClient();\n    const chatService = new ChatService(supabase);\n\n    const parsed = listChatsQuerySchema.safeParse({\n      status: request.nextUrl.searchParams.get(\"status\") ?? undefined,\n    });\n\n    if (!parsed.success) {\n      return NextResponse.json(\n        { error: \"Invalid query\", issues: parsed.error.format(), requestId },\n        { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const chats = await chatService.listAdminChats(parsed.data);\n\n    return NextResponse.json({ chats }, { headers: { \"Cache-Control\": \"no-store\" } });\n  } catch (error: any) {\n    logError(error, {\n      layer: \"api\",\n      requestId,\n      route: \"/api/chats\",\n    });\n\n    return NextResponse.json(\n      { error: \"Failed to load chats\", requestId },\n      { status: 500, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n\n  try {\n    const session = await requireUserApi();\n    const body = await request.json().catch(() => null);\n    const parsed = createChatSchema.safeParse(body ?? {});\n\n    if (!parsed.success) {\n      return NextResponse.json(\n        { error: \"Invalid payload\", issues: parsed.error.format(), requestId },\n        { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const supabase = await createSupabaseServerClient();\n    const adminSupabase = createSupabaseAdminClient();\n    const chatService = new ChatService(supabase, adminSupabase);\n\n    const result = await chatService.createChatForUser({\n      userId: session.user.id,\n      orderId: parsed.data.orderId,\n    });\n\n    return NextResponse.json(\n      { chat: result.chat, created: result.created },\n      { headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  } catch (error: any) {\n    logError(error, {\n      layer: \"api\",\n      requestId,\n      route: \"/api/chats\",\n    });\n\n    const message = error?.message ?? \"Failed to create chat\";\n    const status = message.includes(\"Order\") ? 400 : 500;\n\n    return NextResponse.json(\n      { error: message, requestId },\n      { status, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\checkout\\calculate-shipping\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":72,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2449,2452],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2449,2452],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/app/api/checkout/calculate-shipping/route.ts (NEW)\n\nimport type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\n\nimport { createSupabaseAdminClient } from \"@/lib/supabase/service-role\";\nimport { ProductRepository } from \"@/repositories/product-repo\";\nimport { ShippingDefaultsRepository } from \"@/repositories/shipping-defaults-repo\";\nimport { calculateShippingSchema } from \"@/lib/validation/checkout\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { logError } from \"@/lib/log\";\n\nexport async function POST(request: NextRequest) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n\n  try {\n    const body = await request.json().catch(() => null);\n    const parsed = calculateShippingSchema.safeParse(body ?? {});\n\n    if (!parsed.success) {\n      return NextResponse.json(\n        { error: \"Invalid payload\", issues: parsed.error.format(), requestId },\n        { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const { productIds } = parsed.data;\n\n    const adminSupabase = createSupabaseAdminClient();\n    const productsRepo = new ProductRepository(adminSupabase);\n\n    // Fetch products to get categories\n    const products = await productsRepo.getProductsForCheckout(productIds);\n\n    if (products.length === 0) {\n      return NextResponse.json(\n        { shippingCost: 0, requestId },\n        { headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const categories = [...new Set(products.map((p) => p.category))];\n    const tenantIds = new Set(\n      products.map((p) => p.tenantId).filter((id): id is string => Boolean(id)),\n    );\n\n    if (tenantIds.size !== 1) {\n      return NextResponse.json(\n        { shippingCost: 0, requestId },\n        { headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const [tenantId] = [...tenantIds];\n    const shippingDefaultsRepo = new ShippingDefaultsRepository(adminSupabase);\n    const shippingDefaults = await shippingDefaultsRepo.getByCategories(\n      tenantId,\n      categories,\n    );\n\n    // Calculate max shipping (flat rate approach)\n    const maxShippingCents = Math.max(\n      ...shippingDefaults.map((d) => Number(d.shipping_cost_cents ?? 0)),\n      0,\n    );\n    const maxShipping = maxShippingCents / 100;\n\n    return NextResponse.json(\n      { shippingCost: maxShipping, requestId },\n      { headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  } catch (error: any) {\n    logError(error, {\n      layer: \"api\",\n      requestId,\n      route: \"/api/checkout/calculate-shipping\",\n    });\n\n    return NextResponse.json(\n      { error: \"Failed to calculate shipping\", requestId },\n      { status: 500, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\checkout\\confirm-payment\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":234,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":234,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8053,8056],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8053,8056],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":375,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":375,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12856,12859],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12856,12859],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":509,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":509,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17456,17459],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17456,17459],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// app/api/checkout/confirm-payment/route.ts\nimport type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\nimport Stripe from \"stripe\";\n\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { createSupabaseAdminClient } from \"@/lib/supabase/service-role\";\nimport { OrdersRepository } from \"@/repositories/orders-repo\";\nimport { AddressesRepository } from \"@/repositories/addresses-repo\";\nimport { OrderEventsRepository } from \"@/repositories/order-events-repo\";\nimport { ProfileRepository } from \"@/repositories/profile-repo\";\nimport { NexusRepository } from \"@/repositories/nexus-repo\";\nimport { ProductService } from \"@/services/product-service\";\nimport { OrderEmailService } from \"@/services/order-email-service\";\nimport { AdminOrderEmailService } from \"@/services/admin-order-email-service\";\nimport { OrderAccessTokenService } from \"@/services/order-access-token-service\";\nimport { ChatService } from \"@/services/chat-service\";\nimport { confirmPaymentSchema } from \"@/lib/validation/checkout\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { log, logError } from \"@/lib/log\";\nimport { env } from \"@/config/env\";\n\nconst stripe = new Stripe(env.STRIPE_SECRET_KEY, {\n  apiVersion: \"2025-10-29.clover\",\n});\n\nexport async function POST(request: NextRequest) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n\n  try {\n    const supabase = await createSupabaseServerClient();\n    const {\n      data: { user },\n    } = await supabase.auth.getUser();\n    const userId = user?.id ?? null;\n    const adminSupabase = createSupabaseAdminClient();\n    const body = await request.json().catch(() => null);\n    const parsed = confirmPaymentSchema.safeParse(body ?? {});\n\n    if (!parsed.success) {\n      return NextResponse.json(\n        { error: \"Invalid payload\", issues: parsed.error.format(), requestId },\n        { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const { orderId, paymentIntentId, fulfillment, shippingAddress } = parsed.data;\n\n    const ordersRepo = new OrdersRepository(adminSupabase);\n    const orderEventsRepo = new OrderEventsRepository(adminSupabase);\n    const addressesRepo = new AddressesRepository(adminSupabase);\n    const profilesRepo = new ProfileRepository(adminSupabase);\n    const productService = new ProductService(adminSupabase);\n    const orderEmailService = new OrderEmailService();\n    const adminOrderEmailService = new AdminOrderEmailService();\n    const orderAccessTokens = new OrderAccessTokenService(adminSupabase);\n    const nexusRepo = new NexusRepository(adminSupabase); // NEW: For tax tracking\n\n    const order = await ordersRepo.getById(orderId);\n\n    if (!order) {\n      return NextResponse.json(\n        { error: \"Order not found\", requestId },\n        { status: 404, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    if (!userId && order.user_id) {\n      return NextResponse.json(\n        { error: \"Unauthorized\", requestId },\n        { status: 403, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    if (userId && order.user_id && order.user_id !== userId) {\n      return NextResponse.json(\n        { error: \"Unauthorized\", requestId },\n        { status: 403, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const paymentIntent = await stripe.paymentIntents.retrieve(paymentIntentId);\n\n    if (paymentIntent.metadata?.order_id && paymentIntent.metadata.order_id !== orderId) {\n      return NextResponse.json(\n        {\n          error: \"Payment intent does not match order\",\n          code: \"PAYMENT_INTENT_MISMATCH\",\n          requestId,\n        },\n        { status: 409, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    if (\n      order.stripe_payment_intent_id &&\n      order.stripe_payment_intent_id !== paymentIntentId\n    ) {\n      return NextResponse.json(\n        {\n          error: \"Payment intent already attached to order\",\n          code: \"PAYMENT_INTENT_CONFLICT\",\n          requestId,\n        },\n        { status: 409, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    if (paymentIntent.status === \"processing\") {\n      return NextResponse.json(\n        { success: true, processing: true },\n        { status: 202, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    if (paymentIntent.status !== \"succeeded\") {\n      return NextResponse.json(\n        { error: \"Payment not completed\", code: \"PAYMENT_NOT_SUCCEEDED\", requestId },\n        { status: 409, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const expectedAmount = Math.round(Number(order.total ?? 0) * 100);\n    const expectedCurrency = (order.currency ?? \"USD\").toLowerCase();\n    if (\n      paymentIntent.amount !== expectedAmount ||\n      paymentIntent.currency?.toLowerCase() !== expectedCurrency\n    ) {\n      return NextResponse.json(\n        { error: \"Payment amount mismatch\", code: \"PAYMENT_AMOUNT_MISMATCH\", requestId },\n        { status: 409, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const expectedFulfillment = order.fulfillment === \"pickup\" ? \"pickup\" : \"ship\";\n\n    if (!order.stripe_payment_intent_id) {\n      await ordersRepo.updateStripePaymentIntent(orderId, paymentIntentId);\n    }\n\n    if (fulfillment && fulfillment !== expectedFulfillment) {\n      return NextResponse.json(\n        {\n          error: \"Fulfillment mismatch. Please refresh checkout.\",\n          code: \"FULFILLMENT_MISMATCH\",\n          requestId,\n        },\n        { status: 409, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    // Get order items and decrement inventory\n    const orderItems = await ordersRepo.getOrderItems(orderId);\n    const itemsToDecrement = orderItems.map((item) => ({\n      productId: item.product_id,\n      variantId: item.variant_id,\n      quantity: item.quantity,\n    }));\n\n    const didMarkPaid = await ordersRepo.markPaidTransactionally(\n      orderId,\n      paymentIntentId,\n      itemsToDecrement,\n    );\n    const alreadyPaid = order.status === \"paid\" || !didMarkPaid;\n\n    if (didMarkPaid) {\n      const productIds = [...new Set(orderItems.map((item) => item.product_id))];\n      for (const productId of productIds) {\n        await productService.syncSizeTags(productId);\n      }\n\n      // NEW: Record sale for nexus tracking\n      if (order.customer_state && order.tenant_id) {\n        try {\n          const taxAmount = Number(order.tax_amount ?? 0);\n          const orderTotal = Number(order.total ?? 0);\n          const isTaxable = taxAmount > 0;\n\n          await nexusRepo.recordSale({\n            tenantId: order.tenant_id,\n            stateCode: order.customer_state,\n            orderTotal,\n            taxAmount,\n            isTaxable,\n          });\n\n          log({\n            level: \"info\",\n            layer: \"api\",\n            message: \"nexus_sale_recorded\",\n            requestId,\n            orderId: order.id,\n            state: order.customer_state,\n            taxAmount,\n            isTaxable,\n          });\n        } catch (nexusError) {\n          log({\n            level: \"warn\",\n            layer: \"api\",\n            message: \"nexus_tracking_failed\",\n            requestId,\n            orderId: order.id,\n            error: nexusError instanceof Error ? nexusError.message : String(nexusError),\n          });\n        }\n      }\n    }\n\n    try {\n      const hasPaidEvent = await orderEventsRepo.hasEvent(orderId, \"paid\");\n      if (!hasPaidEvent) {\n        await orderEventsRepo.insertEvent({\n          orderId,\n          type: \"paid\",\n          message: \"Payment confirmed.\",\n        });\n      }\n    } catch (eventError) {\n      log({\n        level: \"warn\",\n        layer: \"api\",\n        message: \"order_event_create_failed\",\n        requestId,\n        orderId,\n        error: eventError instanceof Error ? eventError.message : String(eventError),\n      });\n    }\n\n    const paymentShipping = paymentIntent.shipping?.address\n      ? {\n          name: paymentIntent.shipping?.name ?? null,\n          phone: (paymentIntent.shipping as any)?.phone ?? null,\n          line1: paymentIntent.shipping.address?.line1 ?? null,\n          line2: paymentIntent.shipping.address?.line2 ?? null,\n          city: paymentIntent.shipping.address?.city ?? null,\n          state: paymentIntent.shipping.address?.state ?? null,\n          postal_code: paymentIntent.shipping.address?.postal_code ?? null,\n          country: paymentIntent.shipping.address?.country ?? null,\n        }\n      : null;\n\n    const resolvedShipping = shippingAddress ?? paymentShipping;\n\n    if (\n      expectedFulfillment === \"ship\" &&\n      resolvedShipping?.line1 &&\n      resolvedShipping.city &&\n      resolvedShipping.state &&\n      resolvedShipping.postal_code &&\n      resolvedShipping.country\n    ) {\n      await addressesRepo.insertOrderShippingSnapshot(orderId, {\n        name: resolvedShipping.name,\n        phone: resolvedShipping.phone,\n        line1: resolvedShipping.line1,\n        line2: resolvedShipping.line2 ?? null,\n        city: resolvedShipping.city,\n        state: resolvedShipping.state,\n        postalCode: resolvedShipping.postal_code,\n        country: resolvedShipping.country,\n      });\n\n      if (order.user_id) {\n        await addressesRepo.upsertUserAddress(order.user_id, {\n          name: resolvedShipping.name,\n          phone: resolvedShipping.phone,\n          line1: resolvedShipping.line1,\n          line2: resolvedShipping.line2 ?? null,\n          city: resolvedShipping.city,\n          state: resolvedShipping.state,\n          postalCode: resolvedShipping.postal_code,\n          country: resolvedShipping.country,\n        });\n      }\n\n      await ordersRepo.setFulfillmentStatus(orderId, \"unfulfilled\");\n    }\n\n    if (expectedFulfillment === \"pickup\" && order.user_id) {\n      try {\n        const chatService = new ChatService(adminSupabase, adminSupabase);\n        await chatService.createChatForUser({ userId: order.user_id, orderId: order.id });\n      } catch (chatError) {\n        log({\n          level: \"warn\",\n          layer: \"api\",\n          message: \"pickup_chat_create_failed\",\n          requestId,\n          orderId,\n          error: chatError instanceof Error ? chatError.message : String(chatError),\n        });\n      }\n    }\n\n    try {\n      const hasAdminEmailEvent = await orderEventsRepo.hasEvent(\n        order.id,\n        \"admin_order_email_sent\",\n      );\n      if (!hasAdminEmailEvent) {\n        const staff = await profilesRepo.listStaffProfiles();\n        const recipients = staff.filter(\n          (admin) => admin.admin_order_notifications_enabled !== false && admin.email,\n        );\n\n        if (recipients.length > 0) {\n          let adminCustomerEmail = paymentIntent.receipt_email ?? null;\n          if (!adminCustomerEmail && order.user_id) {\n            const profile = await profilesRepo.getByUserId(order.user_id);\n            adminCustomerEmail = profile?.email ?? null;\n          }\n          if (!adminCustomerEmail) {\n            adminCustomerEmail = order.guest_email ?? null;\n          }\n\n          const itemCount = orderItems.reduce(\n            (sum, item) => sum + Number(item.quantity ?? 0),\n            0,\n          );\n\n          await Promise.all(\n            recipients.map((admin) =>\n              adminOrderEmailService.sendOrderPlaced({\n                to: admin.email ?? \"\",\n                orderId: order.id,\n                fulfillment: expectedFulfillment,\n                subtotal: Number(order.subtotal ?? 0),\n                shipping: Number(order.shipping ?? 0),\n                tax: Number(order.tax_amount ?? 0),\n                total: Number(order.total ?? 0),\n                itemCount,\n                customerEmail: adminCustomerEmail,\n              }),\n            ),\n          );\n\n          await orderEventsRepo.insertEvent({\n            orderId: order.id,\n            type: \"admin_order_email_sent\",\n            message: \"Admin order email sent.\",\n          });\n        }\n      }\n    } catch (adminEmailError) {\n      log({\n        level: \"warn\",\n        layer: \"api\",\n        message: \"order_admin_email_failed\",\n        requestId,\n        orderId,\n        error:\n          adminEmailError instanceof Error\n            ? adminEmailError.message\n            : String(adminEmailError),\n      });\n    }\n\n    try {\n      let email = paymentIntent.receipt_email ?? null;\n      if (!email && order.user_id) {\n        const profile = await profilesRepo.getByUserId(order.user_id);\n        email = profile?.email ?? null;\n      }\n      if (!email && !order.user_id) {\n        email = order.guest_email ?? null;\n      }\n\n      if (!order.user_id && email && order.guest_email !== email) {\n        await ordersRepo.updateGuestEmail(order.id, email);\n      }\n\n      const detailedItems = await ordersRepo.getOrderItemsDetailed(orderId);\n      const items = detailedItems.map((item: any) => {\n        const product = item.product;\n        const title =\n          product?.title_display ??\n          `${product?.brand ?? \"\"} ${product?.name ?? \"\"}`.trim();\n        const unitPrice = Number(item.unit_price ?? 0);\n        const lineTotal =\n          Number(item.line_total ?? 0) || unitPrice * Number(item.quantity ?? 0);\n        return {\n          title: title || \"Item\",\n          sizeLabel: item.variant?.size_label ?? null,\n          quantity: Number(item.quantity ?? 0),\n          unitPrice,\n          lineTotal,\n        };\n      });\n\n      const hasConfirmationEvent = await orderEventsRepo.hasEvent(\n        order.id,\n        \"confirmation_email_sent\",\n      );\n      const hasPickupEvent = await orderEventsRepo.hasEvent(\n        order.id,\n        \"pickup_instructions_sent\",\n      );\n      const shouldSendConfirmation = !hasConfirmationEvent;\n      const shouldSendPickup = expectedFulfillment === \"pickup\" && !hasPickupEvent;\n\n      let orderUrl: string | null = null;\n      if (!order.user_id && email && (shouldSendConfirmation || shouldSendPickup)) {\n        const { token } = await orderAccessTokens.createToken({ orderId: order.id });\n        orderUrl = `${env.NEXT_PUBLIC_SITE_URL}/order-status/${order.id}?token=${encodeURIComponent(token)}`;\n      }\n\n      const shippingSnapshot =\n        expectedFulfillment === \"ship\"\n          ? await addressesRepo.getOrderShipping(orderId)\n          : null;\n      const fallbackShipping = shippingSnapshot\n        ? null\n        : resolvedShipping\n          ? {\n              name: resolvedShipping.name ?? null,\n              line1: resolvedShipping.line1 ?? null,\n              line2: resolvedShipping.line2 ?? null,\n              city: resolvedShipping.city ?? null,\n              state: resolvedShipping.state ?? null,\n              postalCode: resolvedShipping.postal_code ?? null,\n              country: resolvedShipping.country ?? null,\n            }\n          : null;\n\n      if (email && shouldSendConfirmation) {\n        await orderEmailService.sendOrderConfirmation({\n          to: email,\n          orderId: order.id,\n          createdAt: order.created_at ?? new Date().toISOString(),\n          fulfillment: expectedFulfillment,\n          currency: order.currency ?? \"USD\",\n          subtotal: Number(order.subtotal ?? 0),\n          shipping: Number(order.shipping ?? 0),\n          tax: Number(order.tax_amount ?? 0), // NEW: Include tax in email\n          total: Number(order.total ?? 0),\n          items,\n          orderUrl,\n          shippingAddress: shippingSnapshot\n            ? {\n                name: shippingSnapshot.name,\n                line1: shippingSnapshot.line1,\n                line2: shippingSnapshot.line2,\n                city: shippingSnapshot.city,\n                state: shippingSnapshot.state,\n                postalCode: shippingSnapshot.postal_code,\n                country: shippingSnapshot.country,\n              }\n            : fallbackShipping,\n        });\n\n        try {\n          await orderEventsRepo.insertEvent({\n            orderId: order.id,\n            type: \"confirmation_email_sent\",\n            message: \"Order confirmation emailed.\",\n          });\n        } catch (eventError) {\n          log({\n            level: \"warn\",\n            layer: \"api\",\n            message: \"order_event_create_failed\",\n            requestId,\n            orderId,\n            error: eventError instanceof Error ? eventError.message : String(eventError),\n          });\n        }\n      }\n\n      if (email && shouldSendPickup) {\n        await orderEmailService.sendPickupInstructions({\n          to: email,\n          orderId: order.id,\n          orderUrl,\n        });\n\n        try {\n          await orderEventsRepo.insertEvent({\n            orderId: order.id,\n            type: \"pickup_instructions_sent\",\n            message: \"Pickup instructions emailed.\",\n          });\n        } catch (eventError) {\n          log({\n            level: \"warn\",\n            layer: \"api\",\n            message: \"order_event_create_failed\",\n            requestId,\n            orderId,\n            error: eventError instanceof Error ? eventError.message : String(eventError),\n          });\n        }\n      }\n    } catch (emailError) {\n      log({\n        level: \"warn\",\n        layer: \"api\",\n        message: \"order_email_send_failed\",\n        requestId,\n        orderId,\n        error: emailError instanceof Error ? emailError.message : String(emailError),\n      });\n    }\n    return NextResponse.json(\n      { success: true, alreadyPaid },\n      { headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  } catch (error: any) {\n    logError(error, {\n      layer: \"api\",\n      requestId,\n      route: \"/api/checkout/confirm-payment\",\n    });\n\n    return NextResponse.json(\n      { error: error.message || \"Failed to confirm payment\", requestId },\n      { status: 500, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\checkout\\create-payment-intent\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":145,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":145,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5347,5350],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5347,5350],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":204,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":204,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7370,7373],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7370,7373],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":465,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":465,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15277,15280],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15277,15280],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// app/api/checkout/create-payment-intent/route.ts\nimport type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\nimport Stripe from \"stripe\";\n\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { createSupabaseAdminClient } from \"@/lib/supabase/service-role\";\nimport { ProductRepository } from \"@/repositories/product-repo\";\nimport { OrdersRepository } from \"@/repositories/orders-repo\";\nimport { ProfileRepository } from \"@/repositories/profile-repo\";\nimport { ShippingDefaultsRepository } from \"@/repositories/shipping-defaults-repo\";\nimport { TaxSettingsRepository } from \"@/repositories/tax-settings-repo\";\nimport { StripeTaxService } from \"@/services/stripe-tax-service\";\nimport { createCartHash } from \"@/lib/crypto\";\nimport { checkoutSessionSchema } from \"@/lib/validation/checkout\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { log, logError } from \"@/lib/log\";\nimport { env } from \"@/config/env\";\n\nconst stripe = new Stripe(env.STRIPE_SECRET_KEY, {\n  apiVersion: \"2025-10-29.clover\",\n});\n\nexport async function POST(request: NextRequest) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n\n  try {\n    const supabase = await createSupabaseServerClient();\n    const {\n      data: { user },\n    } = await supabase.auth.getUser();\n    const userId = user?.id ?? null;\n    const userEmail = user?.email ?? null;\n\n    if (!userId && env.NEXT_PUBLIC_GUEST_CHECKOUT_ENABLED !== \"true\") {\n      return NextResponse.json(\n        { error: \"GUEST_CHECKOUT_DISABLED\", code: \"GUEST_CHECKOUT_DISABLED\", requestId },\n        { status: 403, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const adminSupabase = createSupabaseAdminClient();\n    const ordersSupabase = userId ? supabase : adminSupabase;\n\n    const body = await request.json().catch(() => null);\n    const parsed = checkoutSessionSchema.safeParse(body ?? {});\n\n    if (!parsed.success) {\n      return NextResponse.json(\n        { error: \"Invalid payload\", issues: parsed.error.format(), requestId },\n        { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const { items, idempotencyKey, fulfillment, guestEmail, shippingAddress } =\n      parsed.data;\n\n    if (!userId && !guestEmail) {\n      return NextResponse.json(\n        { error: \"GUEST_EMAIL_REQUIRED\", code: \"GUEST_EMAIL_REQUIRED\", requestId },\n        { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const normalizedFulfillment = fulfillment === \"pickup\" ? \"pickup\" : \"ship\";\n    const cartHash = createCartHash(items, normalizedFulfillment);\n    const ordersRepo = new OrdersRepository(ordersSupabase);\n\n    const existingOrder = await ordersRepo.getByIdempotencyKey(idempotencyKey);\n    if (existingOrder) {\n      const expiresAt = existingOrder.expires_at\n        ? new Date(existingOrder.expires_at)\n        : null;\n      if (expiresAt && expiresAt < new Date()) {\n        return NextResponse.json(\n          {\n            error: \"IDEMPOTENCY_KEY_EXPIRED\",\n            code: \"IDEMPOTENCY_KEY_EXPIRED\",\n            requestId,\n          },\n          { status: 409, headers: { \"Cache-Control\": \"no-store\" } },\n        );\n      }\n\n      if (existingOrder.cart_hash !== cartHash) {\n        return NextResponse.json(\n          { error: \"CART_MISMATCH\", code: \"CART_MISMATCH\", requestId },\n          { status: 409, headers: { \"Cache-Control\": \"no-store\" } },\n        );\n      }\n\n      if (existingOrder.status === \"paid\") {\n        return NextResponse.json(\n          { status: \"paid\", orderId: existingOrder.id, requestId },\n          { headers: { \"Cache-Control\": \"no-store\" } },\n        );\n      }\n\n      if (!existingOrder.user_id && guestEmail && !existingOrder.guest_email) {\n        await ordersRepo.updateGuestEmail(existingOrder.id, guestEmail);\n      }\n\n      if (existingOrder.stripe_payment_intent_id) {\n        const paymentIntent = await stripe.paymentIntents.retrieve(\n          existingOrder.stripe_payment_intent_id,\n        );\n\n        if (paymentIntent.status === \"succeeded\") {\n          return NextResponse.json(\n            { status: \"paid\", orderId: existingOrder.id, requestId },\n            { headers: { \"Cache-Control\": \"no-store\" } },\n          );\n        }\n\n        if (paymentIntent.status === \"canceled\") {\n          return NextResponse.json(\n            {\n              error: \"PAYMENT_INTENT_CANCELED\",\n              code: \"PAYMENT_INTENT_CANCELED\",\n              requestId,\n            },\n            { status: 409, headers: { \"Cache-Control\": \"no-store\" } },\n          );\n        }\n\n        return NextResponse.json(\n          {\n            clientSecret: paymentIntent.client_secret,\n            orderId: existingOrder.id,\n            paymentIntentId: paymentIntent.id,\n            subtotal: Number(existingOrder.subtotal ?? 0),\n            shipping: Number(existingOrder.shipping ?? 0),\n            tax: Number(existingOrder.tax_amount ?? 0),\n            total: Number(existingOrder.total ?? 0),\n            fulfillment: existingOrder.fulfillment ?? normalizedFulfillment,\n            requestId,\n          },\n          { headers: { \"Cache-Control\": \"no-store\" } },\n        );\n      }\n    }\n\n    // Fetch products\n    const productsRepo = new ProductRepository(adminSupabase);\n    const productIds = [...new Set(items.map((i: any) => i.productId))];\n    const products = await productsRepo.getProductsForCheckout(productIds);\n\n    if (products.length === 0) {\n      return NextResponse.json(\n        { error: \"No valid products found\", requestId },\n        { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const productMap = new Map(products.map((p) => [p.id, p]));\n\n    // Validate single tenant\n    const tenantIds = new Set(\n      products.map((p) => p.tenantId).filter((id): id is string => Boolean(id)),\n    );\n    if (tenantIds.size === 0) {\n      return NextResponse.json(\n        { error: \"Products must belong to a tenant\", requestId },\n        { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n    if (tenantIds.size !== 1) {\n      return NextResponse.json(\n        { error: \"All items must be from the same seller\", requestId },\n        { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n    const [tenantId] = [...tenantIds];\n\n    // Get tenant's Stripe Connect account\n    const tenantProfileRepo = new ProfileRepository(adminSupabase);\n    const tenantStripeAccountId =\n      await tenantProfileRepo.getStripeAccountIdForTenant(tenantId);\n\n    if (!tenantStripeAccountId) {\n      log({\n        level: \"error\",\n        layer: \"api\",\n        message: \"tenant_missing_stripe_account\",\n        requestId,\n        tenantId,\n      });\n      return NextResponse.json(\n        { error: \"Seller payment account not configured\", requestId },\n        { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const categories = [...new Set(products.map((p) => p.category))];\n    const shippingDefaultsRepo = new ShippingDefaultsRepository(adminSupabase);\n    const shippingDefaults = await shippingDefaultsRepo.getByCategories(\n      tenantId,\n      categories,\n    );\n    const shippingDefaultsMap = new Map(\n      shippingDefaults.map((row) => [row.category, Number(row.shipping_cost_cents ?? 0)]),\n    );\n\n    const lineItems = items.map((item: any) => {\n      const product = productMap.get(item.productId);\n      if (!product) {\n        throw new Error(\"Product not found\");\n      }\n\n      const variant = product.variants.find((v) => v.id === item.variantId);\n      if (!variant) {\n        throw new Error(\"Variant not found\");\n      }\n      if (variant.stock < item.quantity) {\n        throw new Error(\"INSUFFICIENT_STOCK\");\n      }\n\n      const unitPrice = Number(variant.priceCents ?? 0) / 100;\n      const unitCost = Number(variant.costCents ?? 0) / 100;\n      const lineTotal = unitPrice * item.quantity;\n\n      return {\n        productId: item.productId,\n        variantId: item.variantId,\n        quantity: item.quantity,\n        unitPrice,\n        unitCost,\n        lineTotal,\n        category: product.category,\n      };\n    });\n\n    const subtotal = lineItems.reduce((sum, item) => sum + item.lineTotal, 0);\n\n    let shipping = 0;\n    if (normalizedFulfillment === \"ship\") {\n      const shippingCosts = lineItems.map((item) => {\n        const costInCents = shippingDefaultsMap.get(item.category) ?? 0;\n        return costInCents / 100;\n      });\n      shipping = Math.max(...shippingCosts, 0);\n    }\n\n    // Get tax settings for tenant's Connect account\n    const taxSettingsRepo = new TaxSettingsRepository(adminSupabase);\n    const taxSettings = await taxSettingsRepo.getByTenant(tenantId);\n    const homeState = (taxSettings?.home_state ?? \"SC\").trim().toUpperCase();\n    const taxEnabled = taxSettings?.tax_enabled ?? false;\n    const taxCodeOverrides =\n      taxSettings?.tax_code_overrides &&\n      typeof taxSettings.tax_code_overrides === \"object\"\n        ? (taxSettings.tax_code_overrides as Record<string, string>)\n        : {};\n\n    // Calculate tax using tenant's Stripe Connect account\n    const taxService = new StripeTaxService(adminSupabase, tenantStripeAccountId);\n    const destinationState =\n      normalizedFulfillment === \"pickup\"\n        ? homeState\n        : (shippingAddress?.state?.trim().toUpperCase() ?? null);\n\n    const stripeRegistrations =\n      taxEnabled && destinationState\n        ? await taxService.getStripeRegistrations()\n        : new Map<string, { id: string; state: string; active: boolean }>();\n\n    let customerAddress: {\n      line1: string;\n      line2?: string | null;\n      city: string;\n      state: string;\n      postal_code: string;\n      country: string;\n    } | null = null;\n\n    if (normalizedFulfillment === \"ship\" && shippingAddress) {\n      customerAddress = {\n        line1: shippingAddress.line1,\n        line2: shippingAddress.line2 ?? null,\n        city: shippingAddress.city,\n        state: shippingAddress.state.trim().toUpperCase(),\n        postal_code: shippingAddress.postal_code,\n        country: shippingAddress.country,\n      };\n    } else if (normalizedFulfillment === \"pickup\") {\n      const officeAddress = await taxService.getHeadOfficeAddress();\n      if (officeAddress) {\n        customerAddress = officeAddress;\n      } else {\n        customerAddress = {\n          line1: \"123 Main St\",\n          city: \"Charleston\",\n          state: homeState,\n          postal_code: \"29401\",\n          country: \"US\",\n        };\n      }\n    }\n\n    const hasStripeRegistration =\n      taxEnabled && destinationState\n        ? (stripeRegistrations.get(destinationState)?.active ?? false)\n        : false;\n\n    log({\n      level: \"info\",\n      layer: \"api\",\n      message: \"tax_calculation_setup\",\n      requestId,\n      tenantId,\n      stripeAccountId: tenantStripeAccountId,\n      taxEnabled,\n      destinationState,\n      hasStripeRegistration,\n      customerAddress: customerAddress ? \"provided\" : \"null\",\n    });\n\n    const taxCalc =\n      hasStripeRegistration && customerAddress\n        ? await taxService.calculateTax({\n            currency: \"usd\",\n            customerAddress,\n            lineItems: lineItems.map((item) => ({\n              amount: Math.round(item.unitPrice * 100),\n              quantity: item.quantity,\n              productId: item.productId,\n              category: item.category,\n            })),\n            shippingCost: Math.round(shipping * 100),\n            taxCodes: taxCodeOverrides,\n            taxEnabled,\n          })\n        : {\n            taxAmount: 0,\n            totalAmount: Math.round((subtotal + shipping) * 100),\n            taxCalculationId: null,\n          };\n\n    const tax = taxCalc.taxAmount / 100;\n    const total = subtotal + shipping + tax;\n\n    log({\n      level: \"info\",\n      layer: \"api\",\n      message: \"tax_calculated\",\n      requestId,\n      taxAmount: tax,\n      taxCalculationId: taxCalc.taxCalculationId,\n      subtotal,\n      shipping,\n      total,\n    });\n\n    const expiresAt = new Date(Date.now() + 60 * 60 * 1000);\n\n    const order =\n      existingOrder ??\n      (await ordersRepo.createPendingOrder({\n        userId,\n        guestEmail: guestEmail ?? null,\n        tenantId,\n        currency: \"USD\",\n        subtotal,\n        shipping,\n        total,\n        fulfillment: normalizedFulfillment,\n        idempotencyKey,\n        cartHash,\n        expiresAt,\n        items: lineItems.map((li) => ({\n          productId: li.productId,\n          variantId: li.variantId,\n          quantity: li.quantity,\n          unitPrice: li.unitPrice,\n          unitCost: li.unitCost,\n          lineTotal: li.lineTotal,\n        })),\n      }));\n\n    const customerState = destinationState ?? null;\n\n    // Update order with tax information\n    await adminSupabase\n      .from(\"orders\")\n      .update({\n        tax_amount: tax,\n        tax_calculation_id: taxCalc.taxCalculationId,\n        customer_state: customerState,\n      })\n      .eq(\"id\", order.id);\n\n    let stripeCustomerId: string | undefined;\n    let receiptEmail: string | undefined;\n    if (userId) {\n      const profileRepo = new ProfileRepository(supabase);\n      const profile = await profileRepo.getByUserId(userId);\n      if (profile?.stripe_customer_id) {\n        stripeCustomerId = profile.stripe_customer_id;\n      } else if (user?.email) {\n        const customer = await stripe.customers.create({\n          email: user.email,\n          metadata: { userId },\n        });\n        stripeCustomerId = customer.id;\n        await profileRepo.setStripeCustomerId(userId, stripeCustomerId);\n      }\n      receiptEmail = userEmail ?? profile?.email ?? undefined;\n    }\n\n    //  SIMPLIFIED: Always use automatic payment methods\n    const paymentIntentParams: Stripe.PaymentIntentCreateParams = {\n      amount: Math.round(total * 100),\n      currency: \"usd\",\n      automatic_payment_methods: { enabled: true }, //  Simplified\n      customer: stripeCustomerId,\n      receipt_email: receiptEmail ?? guestEmail ?? undefined,\n      metadata: {\n        order_id: order.id,\n        cart_hash: cartHash,\n        fulfillment: normalizedFulfillment,\n        tax_calculation_id: taxCalc.taxCalculationId ?? \"\",\n        tenant_id: tenantId,\n      },\n      transfer_data: {\n        destination: tenantStripeAccountId,\n      },\n    };\n\n    const paymentIntent = await stripe.paymentIntents.create(paymentIntentParams, {\n      idempotencyKey,\n    });\n\n    log({\n      level: \"info\",\n      layer: \"api\",\n      message: \"payment_intent_created\",\n      requestId,\n      orderId: order.id,\n      paymentIntentId: paymentIntent.id,\n      tenantId,\n      stripeAccountId: tenantStripeAccountId,\n      tax,\n      taxCalculationId: taxCalc.taxCalculationId,\n      customerState,\n    });\n\n    if (!order.stripe_payment_intent_id) {\n      await ordersRepo.updateStripePaymentIntent(order.id, paymentIntent.id);\n    }\n\n    return NextResponse.json(\n      {\n        clientSecret: paymentIntent.client_secret,\n        orderId: order.id,\n        paymentIntentId: paymentIntent.id,\n        subtotal,\n        shipping,\n        tax,\n        total,\n        fulfillment: normalizedFulfillment,\n        requestId,\n      },\n      { headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  } catch (error: any) {\n    logError(error, {\n      layer: \"api\",\n      requestId,\n      route: \"/api/checkout/create-payment-intent\",\n    });\n\n    return NextResponse.json(\n      { error: error.message || \"Failed to create payment intent\", requestId },\n      { status: 500, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\checkout\\session\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":69,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2284,2287],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2284,2287],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/app/api/checkout/session/route.ts (CORRECTED)\n\nimport type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\n\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { createSupabaseAdminClient } from \"@/lib/supabase/service-role\";\nimport { CheckoutService } from \"@/services/checkout-service\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { log, logError } from \"@/lib/log\";\nimport { checkoutSessionSchema } from \"@/lib/validation/checkout\";\nimport { env } from \"@/config/env\";\n\nexport async function POST(request: NextRequest) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n\n  try {\n    const supabase = await createSupabaseServerClient();\n\n    // Get user (optional)\n    const {\n      data: { user },\n    } = await supabase.auth.getUser();\n    const userId = user?.id ?? null;\n\n    if (!userId && env.NEXT_PUBLIC_GUEST_CHECKOUT_ENABLED !== \"true\") {\n      return NextResponse.json(\n        { error: \"GUEST_CHECKOUT_DISABLED\", code: \"GUEST_CHECKOUT_DISABLED\", requestId },\n        { status: 403, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    // Parse body\n    const body = await request.json().catch(() => null);\n    const parsed = checkoutSessionSchema.safeParse(body);\n    if (!parsed.success) {\n      return NextResponse.json(\n        { error: \"Invalid payload\", issues: parsed.error.format(), requestId },\n        { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    log({\n      level: \"info\",\n      layer: \"api\", // FIXED: Changed from \"route\" to \"api\"\n      message: \"checkout_session_request\",\n      requestId,\n      userId,\n      itemCount: parsed.data.items.length,\n      fulfillment: parsed.data.fulfillment,\n    });\n\n    // Create checkout session\n    const adminSupabase = createSupabaseAdminClient();\n    const checkoutService = new CheckoutService(supabase, adminSupabase);\n    const result = await checkoutService.createCheckoutSession(parsed.data, userId);\n\n    log({\n      level: \"info\",\n      layer: \"api\",\n      message: \"checkout_session_created\",\n      requestId,\n      orderId: result.orderId,\n    });\n\n    return NextResponse.json(result, {\n      headers: { \"Cache-Control\": \"no-store\" },\n    });\n  } catch (error: any) {\n    logError(error, {\n      layer: \"api\",\n      requestId,\n      route: \"/api/checkout/session\",\n    });\n\n    if (\n      error.message === \"IDEMPOTENCY_KEY_EXPIRED\" ||\n      error.message === \"CART_MISMATCH\" ||\n      error.message === \"GUEST_EMAIL_REQUIRED\" ||\n      error.message === \"GUEST_CHECKOUT_DISABLED\"\n    ) {\n      return NextResponse.json(\n        {\n          error: error.message,\n          code: error.message,\n          requestId,\n        },\n        {\n          status:\n            error.message === \"GUEST_EMAIL_REQUIRED\"\n              ? 400\n              : error.message === \"GUEST_CHECKOUT_DISABLED\"\n                ? 403\n                : 409,\n          headers: { \"Cache-Control\": \"no-store\" },\n        },\n      );\n    }\n\n    return NextResponse.json(\n      {\n        error: \"Failed to create checkout session\",\n        message: error.message,\n        requestId,\n      },\n      { status: 500, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\checkout\\update-fulfillment\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":291,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":291,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9917,9920],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9917,9920],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/app/api/checkout/update-fulfillment/route.ts\nimport type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\nimport Stripe from \"stripe\";\n\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { createSupabaseAdminClient } from \"@/lib/supabase/service-role\";\nimport { OrdersRepository } from \"@/repositories/orders-repo\";\nimport { ProductRepository } from \"@/repositories/product-repo\";\nimport { ProfileRepository } from \"@/repositories/profile-repo\";\nimport { ShippingDefaultsRepository } from \"@/repositories/shipping-defaults-repo\";\nimport { TaxSettingsRepository } from \"@/repositories/tax-settings-repo\";\nimport { StripeTaxService } from \"@/services/stripe-tax-service\";\nimport { createCartHash } from \"@/lib/crypto\";\nimport { updateFulfillmentSchema } from \"@/lib/validation/checkout\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { logError } from \"@/lib/log\";\nimport { env } from \"@/config/env\";\n\nconst stripe = new Stripe(env.STRIPE_SECRET_KEY, {\n  apiVersion: \"2025-10-29.clover\",\n});\n\nexport async function POST(request: NextRequest) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n\n  try {\n    const supabase = await createSupabaseServerClient();\n    const {\n      data: { user },\n    } = await supabase.auth.getUser();\n    const userId = user?.id ?? null;\n    const adminSupabase = createSupabaseAdminClient();\n    const body = await request.json().catch(() => null);\n    const parsed = updateFulfillmentSchema.safeParse(body ?? {});\n\n    if (!parsed.success) {\n      return NextResponse.json(\n        { error: \"Invalid payload\", issues: parsed.error.format(), requestId },\n        { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const { orderId, fulfillment, shippingAddress } = parsed.data;\n\n    const ordersRepo = new OrdersRepository(adminSupabase);\n    const order = await ordersRepo.getById(orderId);\n\n    if (!order) {\n      return NextResponse.json(\n        { error: \"Order not found\", requestId },\n        { status: 404, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    if (!userId && order.user_id) {\n      return NextResponse.json(\n        { error: \"Unauthorized\", requestId },\n        { status: 403, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    if (userId && order.user_id && order.user_id !== userId) {\n      return NextResponse.json(\n        { error: \"Unauthorized\", requestId },\n        { status: 403, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    if (order.status !== \"pending\") {\n      return NextResponse.json(\n        { error: \"ORDER_NOT_PENDING\", code: \"ORDER_NOT_PENDING\", requestId },\n        { status: 409, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    if (!order.stripe_payment_intent_id) {\n      return NextResponse.json(\n        { error: \"MISSING_PAYMENT_INTENT\", code: \"MISSING_PAYMENT_INTENT\", requestId },\n        { status: 409, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const orderItems = await ordersRepo.getOrderItems(orderId);\n    if (orderItems.length === 0) {\n      return NextResponse.json(\n        { error: \"Order has no items\", requestId },\n        { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const productIds = [...new Set(orderItems.map((item) => item.product_id))];\n    const productsRepo = new ProductRepository(adminSupabase);\n    const products = await productsRepo.getProductsForCheckout(productIds);\n\n    if (products.length === 0) {\n      return NextResponse.json(\n        { error: \"No valid products found\", requestId },\n        { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const productMap = new Map(products.map((product) => [product.id, product]));\n\n    const tenantIds = new Set(\n      products\n        .map((product) => product.tenantId)\n        .filter((id): id is string => Boolean(id)),\n    );\n    if (tenantIds.size !== 1) {\n      return NextResponse.json(\n        { error: \"Checkout requires a single tenant\", requestId },\n        { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n    const [tenantId] = [...tenantIds];\n    const tenantProfileRepo = new ProfileRepository(adminSupabase);\n    const tenantStripeAccountId =\n      await tenantProfileRepo.getStripeAccountIdForTenant(tenantId);\n\n    const categories = [...new Set(products.map((product) => product.category))];\n    const shippingDefaultsRepo = new ShippingDefaultsRepository(adminSupabase);\n    const shippingDefaults = await shippingDefaultsRepo.getByCategories(\n      tenantId,\n      categories,\n    );\n    const shippingDefaultsMap = new Map(\n      shippingDefaults.map((row) => [row.category, Number(row.shipping_cost_cents ?? 0)]),\n    );\n\n    const subtotal = orderItems.reduce(\n      (sum, item) => sum + Number(item.unit_price ?? 0) * Number(item.quantity ?? 0),\n      0,\n    );\n\n    let shipping = 0;\n    if (fulfillment === \"ship\") {\n      const shippingCosts = orderItems.map((item) => {\n        const product = productMap.get(item.product_id);\n        if (!product) {\n          return 0;\n        }\n        const costInCents = shippingDefaultsMap.get(product.category) ?? 0;\n        return costInCents / 100;\n      });\n      shipping = Math.max(...shippingCosts, 0);\n    }\n\n    const taxSettingsRepo = new TaxSettingsRepository(adminSupabase);\n    const taxSettings = await taxSettingsRepo.getByTenant(tenantId);\n    const homeState = (taxSettings?.home_state ?? \"SC\").trim().toUpperCase();\n    const taxEnabled = taxSettings?.tax_enabled ?? false;\n    const taxCodeOverrides =\n      taxSettings?.tax_code_overrides &&\n      typeof taxSettings.tax_code_overrides === \"object\"\n        ? (taxSettings.tax_code_overrides as Record<string, string>)\n        : {};\n\n    const taxService = tenantStripeAccountId\n      ? new StripeTaxService(adminSupabase, tenantStripeAccountId)\n      : null;\n    const destinationState =\n      fulfillment === \"pickup\"\n        ? homeState\n        : (shippingAddress?.state?.trim().toUpperCase() ?? null);\n    const stripeRegistrations =\n      taxEnabled && destinationState && taxService\n        ? await taxService.getStripeRegistrations()\n        : new Map<string, { id: string; state: string; active: boolean }>();\n\n    let customerAddress: {\n      line1: string;\n      line2?: string | null;\n      city: string;\n      state: string;\n      postal_code: string;\n      country: string;\n    } | null = null;\n\n    if (fulfillment === \"ship\" && shippingAddress) {\n      customerAddress = {\n        line1: shippingAddress.line1,\n        line2: shippingAddress.line2 ?? null,\n        city: shippingAddress.city,\n        state: shippingAddress.state.trim().toUpperCase(),\n        postal_code: shippingAddress.postal_code,\n        country: shippingAddress.country,\n      };\n    } else if (fulfillment === \"pickup\" && taxService) {\n      const officeAddress = await taxService.getHeadOfficeAddress();\n      if (officeAddress) {\n        customerAddress = officeAddress;\n      } else {\n        customerAddress = {\n          line1: \"123 Main St\",\n          city: \"Charleston\",\n          state: homeState,\n          postal_code: \"29401\",\n          country: \"US\",\n        };\n      }\n    }\n\n    const taxLineItems = orderItems.map((item) => {\n      const product = productMap.get(item.product_id);\n      return {\n        amount: Math.round(Number(item.unit_price ?? 0) * 100),\n        quantity: Number(item.quantity ?? 0),\n        productId: item.product_id,\n        category: product?.category ?? \"other\",\n      };\n    });\n\n    const hasStripeRegistration =\n      taxEnabled && destinationState\n        ? (stripeRegistrations.get(destinationState)?.active ?? false)\n        : false;\n\n    const taxCalc =\n      hasStripeRegistration && customerAddress && taxService\n        ? await taxService.calculateTax({\n            currency: \"usd\",\n            customerAddress,\n            lineItems: taxLineItems,\n            shippingCost: Math.round(shipping * 100),\n            taxCodes: taxCodeOverrides,\n            taxEnabled,\n          })\n        : {\n            taxAmount: 0,\n            totalAmount: Math.round((subtotal + shipping) * 100),\n            taxCalculationId: null,\n          };\n\n    const tax = taxCalc.taxAmount / 100;\n    const total = subtotal + shipping + tax;\n    const cartHash = createCartHash(\n      orderItems.map((item) => ({\n        productId: item.product_id,\n        variantId: item.variant_id,\n        quantity: item.quantity,\n      })),\n      fulfillment,\n    );\n\n    const paymentIntent = await stripe.paymentIntents.retrieve(\n      order.stripe_payment_intent_id,\n    );\n\n    if (paymentIntent.status === \"succeeded\") {\n      return NextResponse.json(\n        { error: \"ORDER_ALREADY_PAID\", code: \"ORDER_ALREADY_PAID\", requestId },\n        { status: 409, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    if (paymentIntent.status === \"canceled\") {\n      return NextResponse.json(\n        { error: \"PAYMENT_INTENT_CANCELED\", code: \"PAYMENT_INTENT_CANCELED\", requestId },\n        { status: 409, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    await stripe.paymentIntents.update(order.stripe_payment_intent_id, {\n      amount: Math.round(total * 100),\n      metadata: {\n        fulfillment,\n        cart_hash: cartHash,\n        tax_calculation_id: taxCalc.taxCalculationId ?? \"\",\n      },\n    });\n\n    await adminSupabase\n      .from(\"orders\")\n      .update({\n        subtotal,\n        shipping,\n        tax_amount: tax,\n        tax_calculation_id: taxCalc.taxCalculationId,\n        total,\n        fulfillment,\n        cart_hash: cartHash,\n        customer_state: destinationState,\n      })\n      .eq(\"id\", orderId);\n\n    return NextResponse.json(\n      { subtotal, shipping, tax, total, fulfillment, requestId },\n      { headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  } catch (error: any) {\n    logError(error, {\n      layer: \"api\",\n      requestId,\n      route: \"/api/checkout/update-fulfillment\",\n    });\n\n    return NextResponse.json(\n      { error: \"Failed to update fulfillment\", requestId },\n      { status: 500, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\contact\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\email\\confirm\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\email\\subscribe\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":113,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":113,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3752,3755],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3752,3755],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// app/api/email/subscribe/route.ts\nimport { randomBytes } from \"crypto\";\n\nimport type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\n\nimport { createSupabaseAdminClient } from \"@/lib/supabase/service-role\";\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { EmailSubscriptionService } from \"@/services/email-subscription-service\";\nimport { emailSubscribeSchema } from \"@/lib/validation/email\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { logError } from \"@/lib/log\";\nimport { sendEmail } from \"@/lib/email/mailer\";\nimport {\n  buildSubscriptionConfirmationEmail,\n  buildSubscriptionConfirmedEmail,\n} from \"@/lib/email/subscription\";\nimport { emailSubjects } from \"@/config/constants/email\";\nimport { env } from \"@/config/env\";\n\nexport async function POST(req: NextRequest) {\n  const requestId = getRequestIdFromHeaders(req.headers);\n\n  try {\n    const body = await req.json().catch(() => null);\n    const parsed = emailSubscribeSchema.safeParse(body);\n\n    if (!parsed.success) {\n      return NextResponse.json(\n        { ok: false, error: \"Invalid payload\", issues: parsed.error.format(), requestId },\n        { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const supabase = createSupabaseAdminClient();\n    const service = new EmailSubscriptionService(supabase);\n\n    const sessionSupabase = await createSupabaseServerClient();\n    const {\n      data: { user },\n    } = await sessionSupabase.auth.getUser();\n    const normalizedEmail = parsed.data.email.trim().toLowerCase();\n    const userEmail = user?.email?.trim().toLowerCase();\n    const signedInMatch = Boolean(userEmail && userEmail === normalizedEmail);\n\n    if (signedInMatch) {\n      const status = await service.subscribeDirect(\n        normalizedEmail,\n        parsed.data.source ?? \"website\",\n      );\n\n      if (status === \"subscribed\") {\n        const { html, text } = buildSubscriptionConfirmedEmail();\n\n        try {\n          await sendEmail({\n            to: normalizedEmail,\n            subject: emailSubjects.subscriptionConfirmed(),\n            html,\n            text,\n          });\n        } catch (emailError) {\n          logError(emailError, {\n            layer: \"api\",\n            requestId,\n            route: \"/api/email/subscribe\",\n            message: \"email_subscription_thankyou_failed\",\n          });\n        }\n      }\n\n      return NextResponse.json(\n        { ok: true },\n        { headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const token = randomBytes(32).toString(\"base64url\");\n    const expiresAt = new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString();\n    const status = await service.requestConfirmation(\n      normalizedEmail,\n      parsed.data.source ?? \"website\",\n      token,\n      expiresAt,\n    );\n\n    if (status === \"pending\") {\n      const confirmUrl = `${env.NEXT_PUBLIC_SITE_URL}/api/email/confirm?token=${token}`;\n      const { html, text } = buildSubscriptionConfirmationEmail(confirmUrl);\n\n      try {\n        await sendEmail({\n          to: parsed.data.email,\n          subject: emailSubjects.subscriptionConfirmation(),\n          html,\n          text,\n        });\n      } catch (emailError) {\n        logError(emailError, {\n          layer: \"api\",\n          requestId,\n          route: \"/api/email/subscribe\",\n          message: \"email_subscription_confirmation_failed\",\n        });\n        return NextResponse.json(\n          { ok: false, error: \"Failed to send confirmation email.\", requestId },\n          { status: 500, headers: { \"Cache-Control\": \"no-store\" } },\n        );\n      }\n    }\n\n    return NextResponse.json({ ok: true }, { headers: { \"Cache-Control\": \"no-store\" } });\n  } catch (error: any) {\n    logError(error, {\n      layer: \"api\",\n      requestId,\n      route: \"/api/email/subscribe\",\n    });\n    return NextResponse.json(\n      { ok: false, error: \"Subscription failed\", requestId },\n      { status: 500, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\healthz\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\invites\\accept\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1536,1539],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1536,1539],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\n\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { createSupabaseAdminClient } from \"@/lib/supabase/service-role\";\nimport { requireUserApi } from \"@/lib/auth/session\";\nimport { AdminInviteService } from \"@/services/admin-invite-service\";\nimport { adminInviteAcceptSchema } from \"@/lib/validation/admin\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { logError } from \"@/lib/log\";\n\nexport async function POST(request: NextRequest) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n\n  try {\n    const session = await requireUserApi();\n    const body = await request.json().catch(() => null);\n    const parsed = adminInviteAcceptSchema.safeParse(body ?? {});\n\n    if (!parsed.success) {\n      return NextResponse.json(\n        { error: \"Invalid payload\", issues: parsed.error.format(), requestId },\n        { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    const supabase = await createSupabaseServerClient();\n    const adminSupabase = createSupabaseAdminClient();\n    const inviteService = new AdminInviteService(supabase, adminSupabase);\n\n    const result = await inviteService.acceptInvite({\n      userId: session.user.id,\n      userEmail: session.user.email,\n      token: parsed.data.token,\n    });\n\n    return NextResponse.json(\n      { ok: true, role: result.role },\n      { headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  } catch (error: any) {\n    logError(error, {\n      layer: \"api\",\n      requestId,\n      route: \"/api/invites/accept\",\n    });\n\n    const message = error?.message ?? \"Failed to accept invite\";\n    const status = message.includes(\"Invite\") ? 400 : 500;\n\n    return NextResponse.json(\n      { error: message, requestId },\n      { status, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\maps\\us-states\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\me\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\orders\\[orderId]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2255,2258],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2255,2258],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/app/api/orders/[orderId]/route.ts (CORRECTED)\n\nimport type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\nimport { z } from \"zod\";\n\nimport { createSupabaseServerClient } from \"@/lib/supabase/server\";\nimport { OrdersService } from \"@/services/orders-service\";\nimport { createSupabaseAdminClient } from \"@/lib/supabase/service-role\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { logError } from \"@/lib/log\";\n\nconst paramsSchema = z.object({\n  orderId: z.string().uuid(),\n});\n\nconst querySchema = z\n  .object({\n    token: z.string().trim().min(1).optional(),\n  })\n  .strict();\n\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: Promise<{ orderId: string }> },\n) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n  const { orderId } = await params;\n  const paramsParsed = paramsSchema.safeParse({ orderId });\n  const tokenParam = request.nextUrl.searchParams.get(\"token\");\n  const queryParsed = querySchema.safeParse({\n    token: tokenParam && tokenParam.trim().length > 0 ? tokenParam : undefined,\n  });\n\n  if (!paramsParsed.success) {\n    return NextResponse.json(\n      { error: \"Invalid params\", issues: paramsParsed.error.format(), requestId },\n      { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n\n  if (!queryParsed.success) {\n    return NextResponse.json(\n      { error: \"Invalid query\", issues: queryParsed.error.format(), requestId },\n      { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n\n  try {\n    const supabase = await createSupabaseServerClient();\n\n    // Get user (optional)\n    const {\n      data: { user },\n    } = await supabase.auth.getUser();\n    const userId = user?.id ?? null;\n\n    // Get access token from query (for guest access)\n    const accessToken = queryParsed.data.token ?? null;\n\n    // Get order status\n    const adminSupabase = createSupabaseAdminClient();\n    const ordersService = new OrdersService(supabase, adminSupabase);\n    const status = await ordersService.getOrderStatus(\n      paramsParsed.data.orderId,\n      userId,\n      accessToken,\n    );\n\n    return NextResponse.json(status, {\n      headers: { \"Cache-Control\": \"no-store\" },\n    });\n  } catch (error: any) {\n    logError(error, {\n      layer: \"api\",\n      requestId,\n      route: \"/api/orders/:orderId\",\n    });\n\n    if (error.message === \"Unauthorized\" || error.message === \"Order not found\") {\n      return NextResponse.json(\n        { error: error.message, requestId },\n        { status: 404, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    return NextResponse.json(\n      { error: \"Failed to fetch order status\", requestId },\n      { status: 500, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\readyz\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\store\\catalog\\brand-groups\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\store\\catalog\\brands\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\store\\filters\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\store\\products\\[id]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\store\\products\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\webhooks\\shippo\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":222,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":222,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7337,7340],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7337,7340],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// app/api/webhooks/shippo/route.ts\n\nimport type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\n\nimport { env } from \"@/config/env\";\nimport { createSupabaseAdminClient } from \"@/lib/supabase/service-role\";\nimport { OrdersRepository } from \"@/repositories/orders-repo\";\nimport { ProfileRepository } from \"@/repositories/profile-repo\";\nimport { OrderEventsRepository } from \"@/repositories/order-events-repo\";\nimport { OrderEmailService } from \"@/services/order-email-service\";\nimport { OrderAccessTokenService } from \"@/services/order-access-token-service\";\nimport { logError } from \"@/lib/log\";\nimport { SHIPPO_TRACKING_STATUS_MAP } from \"@/config/constants/shipping\";\nimport {\n  shippoTrackingUpdateSchema,\n  shippoWebhookEventSchema,\n  shippoWebhookQuerySchema,\n} from \"@/lib/validation/webhooks\";\n\ntype EmailTrigger = \"in_transit\" | \"delivered\" | null;\n\nconst getEmailTrigger = (\n  currentStatus: string | null,\n  newStatus: string,\n): EmailTrigger => {\n  if (currentStatus === newStatus) {\n    return null;\n  }\n\n  if (newStatus === \"shipped\" && currentStatus !== \"shipped\") {\n    return \"in_transit\";\n  }\n  if (newStatus === \"delivered\" && currentStatus !== \"delivered\") {\n    return \"delivered\";\n  }\n\n  return null;\n};\n\nexport async function POST(req: NextRequest) {\n  try {\n    // Verify webhook token\n    const url = new URL(req.url);\n    const queryParsed = shippoWebhookQuerySchema.safeParse({\n      token: url.searchParams.get(\"token\") ?? undefined,\n    });\n\n    if (!queryParsed.success) {\n      return NextResponse.json({ error: \"invalid token\" }, { status: 401 });\n    }\n\n    const { token } = queryParsed.data;\n\n    if (env.SHIPPO_WEBHOOK_TOKEN) {\n      if (!token || token !== env.SHIPPO_WEBHOOK_TOKEN) {\n        return NextResponse.json({ error: \"invalid token\" }, { status: 401 });\n      }\n    }\n\n    const payload = await req.json().catch(() => null);\n    const parsedEvent = shippoWebhookEventSchema.safeParse(payload);\n    if (!parsedEvent.success) {\n      logError(new Error(\"Webhook received invalid JSON\"), {\n        layer: \"api\",\n        route: \"/api/webhooks/shippo\",\n      });\n      return NextResponse.json({ ok: false }, { status: 400 });\n    }\n\n    // Only handle tracking updates\n    if (parsedEvent.data.event !== \"track_updated\") {\n      return NextResponse.json({ ok: true });\n    }\n\n    const trackingEvent = shippoTrackingUpdateSchema.safeParse(parsedEvent.data);\n    if (!trackingEvent.success) {\n      logError(new Error(\"Shippo webhook missing tracking data\"), {\n        layer: \"api\",\n        route: \"/api/webhooks/shippo\",\n        eventType: parsedEvent.data.event,\n      });\n      return NextResponse.json({ ok: true });\n    }\n\n    const data = trackingEvent.data.data ?? {};\n\n    // Shippo webhook sends tracking_number and tracking_status\n    const trackingNumber: string | undefined =\n      data.tracking_number ?? data.trackingNumber;\n\n    const trackingStatus = data.tracking_status ?? data.trackingStatus;\n    const statusRaw: string | undefined = trackingStatus?.status;\n\n    if (!trackingNumber || !statusRaw) {\n      logError(new Error(\"Shippo webhook missing tracking data\"), {\n        layer: \"api\",\n        route: \"/api/webhooks/shippo\",\n        hasTrackingNumber: !!trackingNumber,\n        hasStatus: !!statusRaw,\n        eventType: parsedEvent.data.event,\n      });\n      return NextResponse.json({ ok: true });\n    }\n\n    const status = String(statusRaw).toUpperCase();\n    const newFulfillmentStatus = SHIPPO_TRACKING_STATUS_MAP[status];\n\n    // Ignore statuses we don't track\n    if (newFulfillmentStatus === null || newFulfillmentStatus === undefined) {\n      return NextResponse.json({ ok: true });\n    }\n\n    const adminSupabase = createSupabaseAdminClient();\n    const ordersRepo = new OrdersRepository(adminSupabase);\n    const profilesRepo = new ProfileRepository(adminSupabase);\n    const orderEventsRepo = new OrderEventsRepository(adminSupabase);\n    const accessTokenService = new OrderAccessTokenService(adminSupabase);\n\n    // Find order by tracking number\n    const { data: orders } = await adminSupabase\n      .from(\"orders\")\n      .select(\"*\")\n      .eq(\"tracking_number\", trackingNumber)\n      .limit(1);\n\n    if (!orders || orders.length === 0) {\n      // Not an error - webhook might arrive before order is in our system\n      return NextResponse.json({ ok: true });\n    }\n\n    const order = orders[0];\n    const currentFulfillmentStatus = order.fulfillment_status;\n\n    // Update status if changed\n    if (currentFulfillmentStatus !== newFulfillmentStatus) {\n      await ordersRepo.setFulfillmentStatus(order.id, newFulfillmentStatus);\n    }\n\n    // Create fulfillment events\n    if (currentFulfillmentStatus !== newFulfillmentStatus) {\n      const eventType = newFulfillmentStatus === \"delivered\" ? \"delivered\" : \"shipped\";\n      try {\n        const hasEvent = await orderEventsRepo.hasEvent(order.id, eventType);\n        if (!hasEvent) {\n          await orderEventsRepo.insertEvent({\n            orderId: order.id,\n            type: eventType,\n            message:\n              eventType === \"delivered\"\n                ? \"Order delivered.\"\n                : \"Order is in transit with the carrier.\",\n          });\n        }\n      } catch (eventError) {\n        logError(eventError, {\n          layer: \"api\",\n          route: \"/api/webhooks/shippo\",\n          message: \"Failed to create order event\",\n          orderId: order.id,\n        });\n      }\n    }\n\n    // Send appropriate email\n    const emailTrigger = getEmailTrigger(currentFulfillmentStatus, newFulfillmentStatus);\n\n    if (emailTrigger && (order.user_id || order.guest_email)) {\n      try {\n        const profile = order.user_id\n          ? await profilesRepo.getByUserId(order.user_id)\n          : null;\n        const email = profile?.email ?? order.guest_email ?? null;\n        if (!email) {\n          return NextResponse.json({ ok: true });\n        }\n\n        const emailService = new OrderEmailService();\n\n        const carrier = order.shipping_carrier ?? data.carrier ?? null;\n        const trackingUrl =\n          data.tracking_url_provider ?? data.trackingUrlProvider ?? null;\n\n        let orderUrl: string | null = null;\n        if (!order.user_id && order.guest_email) {\n          const { token: orderToken } = await accessTokenService.createToken({\n            orderId: order.id,\n          });\n          orderUrl = `${env.NEXT_PUBLIC_SITE_URL}/order-status/${order.id}?token=${encodeURIComponent(orderToken)}`;\n        }\n\n        if (emailTrigger === \"in_transit\") {\n          await emailService.sendOrderInTransit({\n            to: email,\n            orderId: order.id,\n            carrier,\n            trackingNumber,\n            trackingUrl,\n            orderUrl,\n          });\n        } else if (emailTrigger === \"delivered\") {\n          await emailService.sendOrderDelivered({\n            to: email,\n            orderId: order.id,\n            carrier,\n            trackingNumber,\n            trackingUrl,\n            orderUrl,\n          });\n        }\n      } catch (emailError) {\n        logError(emailError, {\n          layer: \"api\",\n          route: \"/api/webhooks/shippo\",\n          message: \"Failed to send tracking status email\",\n          orderId: order.id,\n        });\n      }\n    }\n\n    return NextResponse.json({ ok: true });\n  } catch (e: any) {\n    logError(e, { layer: \"api\", route: \"/api/webhooks/shippo\" });\n    return NextResponse.json({ error: \"webhook processing failed\" }, { status: 500 });\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\api\\webhooks\\stripe\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1363,1366],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1363,1366],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":223,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":223,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6875,6878],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6875,6878],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":240,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":240,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7236,7239],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7236,7239],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":298,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":298,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8536,8539],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8536,8539],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":331,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":331,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9420,9423],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9420,9423],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// app/api/webhooks/stripe/route.ts (FIXED)\nimport type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\nimport Stripe from \"stripe\";\n\nimport { createSupabaseAdminClient } from \"@/lib/supabase/service-role\";\nimport { StripeOrderJob } from \"@/jobs/stripe-order-job\";\nimport { ProfileRepository } from \"@/repositories/profile-repo\";\nimport { StripeTaxService } from \"@/services/stripe-tax-service\";\nimport { getRequestIdFromHeaders } from \"@/lib/http/request-id\";\nimport { log, logError } from \"@/lib/log\";\nimport { env } from \"@/config/env\";\n\nconst stripe = new Stripe(env.STRIPE_SECRET_KEY, {\n  apiVersion: \"2025-10-29.clover\",\n});\n\nexport async function POST(request: NextRequest) {\n  const requestId = getRequestIdFromHeaders(request.headers);\n\n  try {\n    const body = await request.text();\n    const signature = request.headers.get(\"stripe-signature\");\n\n    if (!signature) {\n      log({\n        level: \"warn\",\n        layer: \"api\",\n        message: \"stripe_webhook_missing_signature\",\n        requestId,\n      });\n      return NextResponse.json(\n        { error: \"Missing signature\", requestId },\n        { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    let event: Stripe.Event;\n    try {\n      event = stripe.webhooks.constructEvent(body, signature, env.STRIPE_WEBHOOK_SECRET);\n    } catch (err: any) {\n      logError(err, {\n        layer: \"api\",\n        requestId,\n        route: \"/api/stripe/webhook\",\n      });\n      return NextResponse.json(\n        { error: \"Invalid signature\", requestId },\n        { status: 400, headers: { \"Cache-Control\": \"no-store\" } },\n      );\n    }\n\n    log({\n      level: \"info\",\n      layer: \"api\",\n      message: \"stripe_webhook_received\",\n      requestId,\n      eventType: event.type,\n      eventId: event.id,\n    });\n\n    const adminSupabase = createSupabaseAdminClient();\n    const job = new StripeOrderJob(adminSupabase, adminSupabase);\n\n    switch (event.type) {\n      case \"checkout.session.completed\":\n        await job.processCheckoutSessionCompleted(event, requestId);\n        break;\n\n      case \"payment_intent.succeeded\":\n        await job.processPaymentIntentSucceeded(event, requestId);\n\n        //  Record tax transaction using tenant's Stripe Connect account\n        const paymentIntent = event.data.object as Stripe.PaymentIntent;\n        const taxCalculationId = paymentIntent.metadata?.tax_calculation_id;\n        const orderId = paymentIntent.metadata?.order_id;\n        const tenantId = paymentIntent.metadata?.tenant_id;\n\n        log({\n          level: \"info\",\n          layer: \"stripe\",\n          message: \"payment_intent_metadata\",\n          requestId,\n          orderId,\n          taxCalculationId,\n          tenantId,\n          hasAllMetadata: !!(taxCalculationId && orderId && tenantId),\n        });\n\n        if (taxCalculationId && taxCalculationId !== \"\" && orderId && tenantId) {\n          try {\n            // Get the tenant's Stripe Connect account ID\n            const profileRepo = new ProfileRepository(adminSupabase);\n            const stripeAccountId =\n              await profileRepo.getStripeAccountIdForTenant(tenantId);\n\n            if (!stripeAccountId) {\n              log({\n                level: \"warn\",\n                layer: \"stripe\",\n                message: \"tax_transaction_missing_connect_account\",\n                requestId,\n                orderId,\n                tenantId,\n              });\n            } else {\n              log({\n                level: \"info\",\n                layer: \"stripe\",\n                message: \"creating_tax_transaction\",\n                requestId,\n                orderId,\n                taxCalculationId,\n                stripeAccountId,\n              });\n\n              //  Create tax transaction on the tenant's Stripe Connect account\n              const taxService = new StripeTaxService(adminSupabase, stripeAccountId);\n              const taxTransactionId = await taxService.createTaxTransaction({\n                taxCalculationId,\n                reference: orderId,\n              });\n\n              if (taxTransactionId) {\n                await adminSupabase\n                  .from(\"orders\")\n                  .update({ stripe_tax_transaction_id: taxTransactionId })\n                  .eq(\"id\", orderId);\n\n                log({\n                  level: \"info\",\n                  layer: \"stripe\",\n                  message: \"tax_transaction_created\",\n                  requestId,\n                  orderId,\n                  taxTransactionId,\n                  stripeAccountId,\n                });\n              } else {\n                log({\n                  level: \"warn\",\n                  layer: \"stripe\",\n                  message: \"tax_transaction_not_created\",\n                  requestId,\n                  orderId,\n                  taxCalculationId,\n                });\n              }\n            }\n          } catch (taxError) {\n            logError(taxError, {\n              layer: \"stripe\",\n              requestId,\n              message: \"Failed to create tax transaction\",\n              orderId,\n              taxCalculationId,\n              tenantId,\n            });\n          }\n        } else {\n          log({\n            level: \"info\",\n            layer: \"stripe\",\n            message: \"skipping_tax_transaction\",\n            requestId,\n            reason: \"missing_metadata\",\n            orderId,\n            taxCalculationId,\n            tenantId,\n          });\n        }\n        break;\n\n      case \"account.updated\":\n        log({\n          level: \"info\",\n          layer: \"stripe\",\n          message: \"stripe_account_updated\",\n          requestId,\n          eventId: event.id,\n          accountId: (event.data.object as Stripe.Account).id,\n        });\n        break;\n\n      case \"payout.created\":\n      case \"payout.updated\":\n      case \"payout.paid\":\n      case \"payout.failed\":\n        log({\n          level: \"info\",\n          layer: \"stripe\",\n          message: `stripe_payout_${event.type.split(\".\")[1]}`,\n          requestId,\n          eventId: event.id,\n          payoutId: (event.data.object as Stripe.Payout).id,\n          payout_status: (event.data.object as Stripe.Payout).status,\n          amount: (event.data.object as Stripe.Payout).amount,\n        });\n        break;\n\n      case \"charge.refunded\":\n      case \"charge.refund.updated\":\n      case \"refund.created\":\n      case \"refund.updated\":\n        await handleRefundEvent(event, requestId, adminSupabase);\n        break;\n\n      default:\n        log({\n          level: \"info\",\n          layer: \"stripe\",\n          message: \"stripe_webhook_unhandled_event\",\n          requestId,\n          eventType: event.type,\n          eventId: event.id,\n        });\n    }\n\n    return NextResponse.json(\n      { received: true },\n      { headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  } catch (error: any) {\n    logError(error, {\n      layer: \"api\",\n      requestId,\n      route: \"/api/stripe/webhook\",\n    });\n\n    return NextResponse.json(\n      { error: \"Internal error\", requestId },\n      { status: 200, headers: { \"Cache-Control\": \"no-store\" } },\n    );\n  }\n}\n\nasync function handleRefundEvent(\n  event: Stripe.Event,\n  requestId: string,\n  adminSupabase: any,\n) {\n  try {\n    const refund = event.data.object as Stripe.Refund;\n\n    log({\n      level: \"info\",\n      layer: \"stripe\",\n      message: \"stripe_refund_event\",\n      requestId,\n      eventId: event.id,\n      refundId: refund.id,\n      chargeId: refund.charge,\n      amount: refund.amount,\n      refund_status: refund.status,\n      reason: refund.reason,\n    });\n\n    const chargeId =\n      typeof refund.charge === \"string\" ? refund.charge : refund.charge?.id;\n\n    if (!chargeId) {\n      log({\n        level: \"warn\",\n        layer: \"stripe\",\n        message: \"refund_missing_charge_id\",\n        requestId,\n        refundId: refund.id,\n      });\n      return;\n    }\n\n    const { data: orders, error: queryError } = await adminSupabase\n      .from(\"orders\")\n      .select(\"id, status, refund_amount, refund_reason\")\n      .or(\n        `stripe_charge_id.eq.${chargeId},stripe_payment_intent_id.eq.${refund.payment_intent}`,\n      )\n      .limit(1);\n\n    if (queryError) {\n      throw queryError;\n    }\n\n    if (!orders || orders.length === 0) {\n      log({\n        level: \"warn\",\n        layer: \"stripe\",\n        message: \"refund_order_not_found\",\n        requestId,\n        chargeId,\n        refundId: refund.id,\n      });\n      return;\n    }\n\n    const order = orders[0];\n\n    const updateData: any = {\n      refund_amount: refund.amount,\n      refund_reason: refund.reason || \"requested_by_customer\",\n      refunded_at: new Date(refund.created * 1000).toISOString(),\n    };\n\n    if (refund.status === \"succeeded\") {\n      updateData.status = \"refunded\";\n    } else if (refund.status === \"pending\") {\n      updateData.status = \"refund_pending\";\n    } else if (refund.status === \"failed\") {\n      updateData.status = \"refund_failed\";\n    }\n\n    const { error: updateError } = await adminSupabase\n      .from(\"orders\")\n      .update(updateData)\n      .eq(\"id\", order.id);\n\n    if (updateError) {\n      throw updateError;\n    }\n\n    log({\n      level: \"info\",\n      layer: \"stripe\",\n      message: \"refund_order_updated\",\n      requestId,\n      orderId: order.id,\n      refundId: refund.id,\n      amount: refund.amount,\n      refund_status: refund.status,\n    });\n  } catch (error: any) {\n    logError(error, {\n      layer: \"stripe\",\n      requestId,\n      event: \"handle_refund_event\",\n      message: \"Failed to process refund event\",\n    });\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\auth\\2fa\\challenge\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\auth\\2fa\\setup\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\auth\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\auth\\login\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\auth\\register\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\brands\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\bug-report\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\cart\\error.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\cart\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\checkout\\cancel\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\checkout\\error.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\checkout\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\checkout\\processing\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\checkout\\processing\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\checkout\\start\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\checkout\\success\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":96,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":96,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2946,2949],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2946,2949],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// app/checkout/success/page.tsx\n\"use client\";\n\nimport { useEffect, useRef, useState, Suspense } from \"react\";\nimport { useSearchParams, useRouter } from \"next/navigation\";\nimport { CheckCircle, Loader2, Mail } from \"lucide-react\";\n\nimport { clearIdempotencyKeyFromStorage } from \"@/lib/idempotency\";\nimport type { OrderStatusResponse } from \"@/types/domain/checkout\";\nimport { useCart } from \"@/components/cart/CartProvider\";\nimport { clearGuestShippingAddress } from \"@/lib/checkout/guest-shipping-address\";\n\nfunction SuccessContent() {\n  const searchParams = useSearchParams();\n  const router = useRouter();\n  const { clearCart } = useCart();\n  const orderId = searchParams.get(\"orderId\");\n  const accessToken = searchParams.get(\"token\");\n  const fulfillmentParam = searchParams.get(\"fulfillment\");\n  const isPickupParam = fulfillmentParam === \"pickup\";\n\n  const [status, setStatus] = useState<OrderStatusResponse | null>(null);\n  const [canFetchStatus, setCanFetchStatus] = useState<boolean | null>(null);\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\n  const [isPolling, setIsPolling] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const hasClearedRef = useRef(false);\n\n  useEffect(() => {\n    if (!orderId) {\n      router.push(\"/cart\");\n      return;\n    }\n\n    clearIdempotencyKeyFromStorage();\n    clearGuestShippingAddress();\n\n    if (!hasClearedRef.current) {\n      hasClearedRef.current = true;\n      clearCart();\n    }\n  }, [orderId, router, clearCart]);\n\n  useEffect(() => {\n    if (accessToken) {\n      setCanFetchStatus(true);\n      return;\n    }\n\n    const loadSession = async () => {\n      try {\n        const response = await fetch(\"/api/auth/session\", { cache: \"no-store\" });\n        const data = await response.json().catch(() => null);\n        const hasUser = Boolean(data?.user);\n        setIsAuthenticated(hasUser);\n        setCanFetchStatus(hasUser);\n      } catch {\n        setCanFetchStatus(false);\n      }\n    };\n\n    loadSession();\n  }, [accessToken]);\n\n  useEffect(() => {\n    if (!orderId || !canFetchStatus) {\n      return;\n    }\n\n    let pollInterval: NodeJS.Timeout;\n    let timeoutId: NodeJS.Timeout;\n\n    const pollOrderStatus = async () => {\n      try {\n        const tokenQuery = accessToken ? `?token=${encodeURIComponent(accessToken)}` : \"\";\n        const response = await fetch(`/api/orders/${orderId}${tokenQuery}`, {\n          cache: \"no-store\",\n        });\n\n        const data = await response.json().catch(() => null);\n        if (!response.ok) {\n          if (data?.error === \"Unauthorized\") {\n            setCanFetchStatus(false);\n            return;\n          }\n          throw new Error(data?.error || \"Failed to fetch order status\");\n        }\n\n        setStatus(data);\n\n        if (data?.status === \"paid\") {\n          setIsPolling(false);\n          clearInterval(pollInterval);\n          clearTimeout(timeoutId);\n        }\n      } catch (err: any) {\n        setError(err.message || \"Failed to fetch order status\");\n        setIsPolling(false);\n        clearInterval(pollInterval);\n        clearTimeout(timeoutId);\n      }\n    };\n\n    setIsPolling(true);\n    pollOrderStatus();\n\n    pollInterval = setInterval(() => {\n      void pollOrderStatus();\n    }, 2000);\n    timeoutId = setTimeout(() => {\n      setIsPolling(false);\n      clearInterval(pollInterval);\n    }, 60000);\n\n    return () => {\n      clearInterval(pollInterval);\n      clearTimeout(timeoutId);\n    };\n  }, [accessToken, canFetchStatus, orderId]);\n\n  if (!orderId) {\n    return null;\n  }\n\n  if (error) {\n    return (\n      <div className=\"max-w-2xl mx-auto px-4 py-20 text-center\">\n        <div className=\"bg-red-900/20 border border-red-500 text-red-400 p-6 rounded\">\n          <p className=\"text-lg font-semibold mb-2\">Error</p>\n          <p>{error}</p>\n          <button\n            onClick={() => router.push(\"/cart\")}\n            className=\"mt-4 px-6 py-2 bg-red-600 hover:bg-red-700 text-white rounded transition\"\n          >\n            Return to Cart\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  if (canFetchStatus === false) {\n    return (\n      <div className=\"max-w-2xl mx-auto px-4 py-20 text-center\">\n        <Mail className=\"w-16 h-16 text-red-600 mx-auto mb-6\" />\n        <h1 className=\"text-3xl font-bold text-white mb-4\">Order received</h1>\n        <p className=\"text-gray-400 mb-6\">\n          Thanks for your purchase. We are finalizing your order and will email a secure\n          order status link shortly.\n        </p>\n        {isPickupParam && (\n          <div className=\"bg-zinc-900 border border-zinc-800/70 rounded p-6 mb-6 text-left\">\n            <h2 className=\"text-lg font-semibold text-white mb-2\">Local pickup</h2>\n            <p className=\"text-sm text-gray-400 mb-2\">\n              Check your email for pickup instructions and scheduling.\n            </p>\n            <p className=\"text-sm text-gray-400\">\n              You can also DM us on Instagram{\" \"}\n              <a\n                href=\"https://instagram.com/realdealkickzllc\"\n                className=\"text-red-400 hover:text-red-300\"\n                target=\"_blank\"\n                rel=\"noreferrer\"\n              >\n                @realdealkickzllc\n              </a>{\" \"}\n              to schedule pickup.\n            </p>\n          </div>\n        )}\n        <p className=\"text-xs text-zinc-500 mb-6\">Order ID: {orderId}</p>\n        <button\n          onClick={() => router.push(\"/store\")}\n          className=\"w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 rounded transition\"\n        >\n          Continue Shopping\n        </button>\n      </div>\n    );\n  }\n\n  if (isPolling || !status || status.status !== \"paid\") {\n    return (\n      <div className=\"max-w-2xl mx-auto px-4 py-20 text-center\">\n        <Loader2 className=\"w-16 h-16 text-red-600 mx-auto mb-6 animate-spin\" />\n        <h1 className=\"text-3xl font-bold text-white mb-4\">Processing your payment...</h1>\n        <p className=\"text-gray-400 mb-8\">\n          Please wait while we confirm your order. This should only take a moment.\n        </p>\n        {status && (\n          <div className=\"bg-zinc-900 border border-zinc-800/70 rounded p-6 text-left\">\n            <div className=\"flex justify-between text-gray-400 mb-2\">\n              <span>Order ID:</span>\n              <span className=\"text-white font-mono text-sm\">{status.id}</span>\n            </div>\n            <div className=\"flex justify-between text-gray-400\">\n              <span>Status:</span>\n              <span className=\"text-yellow-500 capitalize\">{status.status}</span>\n            </div>\n          </div>\n        )}\n      </div>\n    );\n  }\n\n  const isPickup = status.fulfillment === \"pickup\" || isPickupParam;\n\n  return (\n    <div className=\"max-w-2xl mx-auto px-4 py-20 text-center\">\n      <CheckCircle className=\"w-16 h-16 text-green-500 mx-auto mb-6\" />\n      <h1 className=\"text-3xl font-bold text-white mb-4\">Order Confirmed!</h1>\n      <p className=\"text-gray-400 mb-8\">\n        Thank you for your purchase. Your order has been successfully processed.\n      </p>\n\n      <div className=\"bg-zinc-900 border border-zinc-800/70 rounded p-6 mb-6 text-left\">\n        <h2 className=\"text-xl font-semibold text-white mb-4\">Order Details</h2>\n        <div className=\"space-y-2 text-gray-400\">\n          <div className=\"flex justify-between\">\n            <span>Order ID:</span>\n            <span className=\"text-white font-mono text-sm\">{status.id}</span>\n          </div>\n          <div className=\"flex justify-between\">\n            <span>Subtotal:</span>\n            <span className=\"text-white\">${status.subtotal.toFixed(2)}</span>\n          </div>\n          <div className=\"flex justify-between\">\n            <span>Shipping:</span>\n            <span className=\"text-white\">\n              {status.fulfillment === \"pickup\"\n                ? \"Free (Pickup)\"\n                : `$${status.shipping.toFixed(2)}`}\n            </span>\n          </div>\n          <div className=\"border-t border-zinc-800/70 pt-2 mt-2\">\n            <div className=\"flex justify-between text-xl font-bold\">\n              <span className=\"text-white\">Total:</span>\n              <span className=\"text-white\">${status.total.toFixed(2)}</span>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {isPickup && (\n        <div className=\"bg-zinc-900 border border-zinc-800/70 rounded p-6 mb-6 text-left\">\n          <h2 className=\"text-lg font-semibold text-white mb-2\">Local pickup</h2>\n          <p className=\"text-sm text-gray-400 mb-2\">\n            Check your email for pickup instructions and scheduling.\n          </p>\n          <p className=\"text-sm text-gray-400 mb-2\">\n            You can also DM us on{\" \"}\n            <a\n              href=\"https://instagram.com/realdealkickzllc\"\n              className=\"text-red-400 hover:text-red-300\"\n              target=\"_blank\"\n              rel=\"noreferrer\"\n            >\n              Instagram @realdealkickzllc\n            </a>\n            .\n          </p>\n          {isAuthenticated && (\n            <p className=\"text-sm text-gray-400\">\n              You can also use the in-app pickup chat below if you prefer.\n            </p>\n          )}\n        </div>\n      )}\n\n      <div className=\"space-y-3\">\n        {isAuthenticated && isPickup && (\n          <button\n            onClick={() => window.dispatchEvent(new CustomEvent(\"openChat\"))}\n            className=\"w-full bg-zinc-800 hover:bg-zinc-700 text-white font-semibold py-3 rounded transition\"\n          >\n            Open pickup chat\n          </button>\n        )}\n        {isAuthenticated && (\n          <button\n            onClick={() => router.push(\"/account\")}\n            className=\"w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 rounded transition\"\n          >\n            Go to Account\n          </button>\n        )}\n        <button\n          onClick={() => router.push(\"/store\")}\n          className=\"w-full bg-zinc-800 hover:bg-zinc-700 text-white font-semibold py-3 rounded transition\"\n        >\n          Continue Shopping\n        </button>\n      </div>\n    </div>\n  );\n}\n\nexport default function CheckoutSuccessPage() {\n  return (\n    <Suspense\n      fallback={\n        <div className=\"max-w-2xl mx-auto px-4 py-20 text-center\">\n          <Loader2 className=\"w-16 h-16 text-red-600 mx-auto animate-spin\" />\n        </div>\n      }\n    >\n      <SuccessContent />\n    </Suspense>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\contact\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\email\\confirm\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\error.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\hours\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\invite\\admin\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[344,347],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[344,347],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useEffect, useMemo, useState } from \"react\";\nimport Link from \"next/link\";\nimport { useSearchParams } from \"next/navigation\";\n\nimport { logError } from \"@/lib/log\";\n\ntype InviteState = \"idle\" | \"accepting\" | \"accepted\" | \"error\" | \"missing\";\n\ntype MeResponse = {\n  user: { id: string; email: string } | null;\n  profile: any;\n};\n\nexport default function AdminInvitePage() {\n  const searchParams = useSearchParams();\n  const token = searchParams.get(\"token\");\n  const [state, setState] = useState<InviteState>(\"idle\");\n  const [message, setMessage] = useState(\"\");\n  const [me, setMe] = useState<MeResponse | null>(null);\n\n  const nextUrl = useMemo(() => {\n    if (!token) {\n      return \"/invite/admin\";\n    }\n    return `/invite/admin?token=${encodeURIComponent(token)}`;\n  }, [token]);\n\n  useEffect(() => {\n    const loadMe = async () => {\n      try {\n        const response = await fetch(\"/api/me\", { cache: \"no-store\" });\n        const data = await response.json();\n        setMe(data);\n      } catch (error) {\n        logError(error, { layer: \"frontend\", event: \"admin_invite_load_me\" });\n      }\n    };\n\n    loadMe();\n  }, []);\n\n  useEffect(() => {\n    if (!token) {\n      setState(\"missing\");\n      setMessage(\"This invite link is missing a token.\");\n      return;\n    }\n\n    if (!me?.user || state !== \"idle\") {\n      return;\n    }\n\n    const acceptInvite = async () => {\n      setState(\"accepting\");\n      setMessage(\"Accepting invite...\");\n\n      try {\n        const response = await fetch(\"/api/invites/accept\", {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({ token }),\n        });\n\n        const data = await response.json().catch(() => null);\n        if (!response.ok) {\n          setState(\"error\");\n          setMessage(data?.error ?? \"Failed to accept invite.\");\n          return;\n        }\n\n        setState(\"accepted\");\n        setMessage(\"Invite accepted. Your account now has admin access.\");\n      } catch {\n        setState(\"error\");\n        setMessage(\"Failed to accept invite.\");\n      }\n    };\n\n    acceptInvite();\n  }, [token, me, state]);\n\n  if (!token) {\n    return (\n      <div className=\"max-w-xl mx-auto px-6 py-16\">\n        <div className=\"bg-zinc-900 border border-zinc-800/70 p-6 text-center\">\n          <h1 className=\"text-2xl font-bold text-white mb-2\">Invite link invalid</h1>\n          <p className=\"text-zinc-400\">This admin invite is missing a token.</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!me?.user) {\n    return (\n      <div className=\"max-w-xl mx-auto px-6 py-16\">\n        <div className=\"bg-zinc-900 border border-zinc-800/70 p-6 text-center space-y-4\">\n          <h1 className=\"text-2xl font-bold text-white\">Admin invitation</h1>\n          <p className=\"text-zinc-400\">\n            Sign in or create an account to accept this admin invitation.\n          </p>\n          <div className=\"flex flex-col sm:flex-row gap-3 justify-center\">\n            <Link\n              href={`/auth/login?next=${encodeURIComponent(nextUrl)}`}\n              className=\"bg-red-600 hover:bg-red-700 text-white font-semibold px-5 py-2\"\n            >\n              Sign in\n            </Link>\n            <Link\n              href={`/auth/register?next=${encodeURIComponent(nextUrl)}`}\n              className=\"bg-zinc-800 hover:bg-zinc-700 text-white font-semibold px-5 py-2\"\n            >\n              Create account\n            </Link>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"max-w-xl mx-auto px-6 py-16\">\n      <div className=\"bg-zinc-900 border border-zinc-800/70 p-6 text-center space-y-3\">\n        <h1 className=\"text-2xl font-bold text-white\">Admin invitation</h1>\n        <p className=\"text-zinc-400\">{message}</p>\n        {state === \"accepted\" && (\n          <Link\n            href=\"/admin\"\n            className=\"inline-flex items-center justify-center bg-red-600 hover:bg-red-700 text-white font-semibold px-5 py-2\"\n          >\n            Go to admin\n          </Link>\n        )}\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\legal\\privacy\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\legal\\refunds\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\legal\\shipping\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\legal\\terms\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\not-found.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\order-status\\[orderId]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1324,1327],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1324,1327],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// app/order-status/[orderId]/page.tsx\n\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { useParams, useRouter, useSearchParams } from \"next/navigation\";\nimport { Loader2 } from \"lucide-react\";\n\nimport type { OrderStatusResponse } from \"@/types/domain/checkout\";\nimport { OrderStatusView } from \"@/components/orders/OrderStatusView\";\n\nexport default function OrderStatusPage() {\n  const router = useRouter();\n  const params = useParams<{ orderId: string }>();\n  const searchParams = useSearchParams();\n  const token = searchParams.get(\"token\");\n  const orderId = params?.orderId;\n\n  const [status, setStatus] = useState<OrderStatusResponse | null>(null);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (!orderId) {\n      return;\n    }\n    if (!token) {\n      setError(\"Missing secure order link. Please check your email.\");\n      return;\n    }\n\n    const loadStatus = async () => {\n      try {\n        const response = await fetch(\n          `/api/orders/${orderId}?token=${encodeURIComponent(token)}`,\n          { cache: \"no-store\" },\n        );\n        const data = await response.json().catch(() => null);\n        if (!response.ok) {\n          throw new Error(data?.error || \"Unable to load order status.\");\n        }\n        setStatus(data);\n      } catch (err: any) {\n        setError(err?.message ?? \"Unable to load order status.\");\n      }\n    };\n\n    loadStatus();\n  }, [orderId, token]);\n\n  if (!orderId) {\n    return null;\n  }\n\n  if (error) {\n    return (\n      <div className=\"max-w-2xl mx-auto px-4 py-20 text-center\">\n        <div className=\"bg-red-900/20 border border-red-500 text-red-400 p-6 rounded\">\n          <p className=\"text-lg font-semibold mb-2\">Order status unavailable</p>\n          <p>{error}</p>\n          <button\n            onClick={() => router.push(\"/\")}\n            className=\"mt-4 px-6 py-2 bg-red-600 hover:bg-red-700 text-white rounded transition\"\n          >\n            Back to Home\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  if (!status) {\n    return (\n      <div className=\"max-w-2xl mx-auto px-4 py-20 text-center\">\n        <Loader2 className=\"w-16 h-16 text-red-600 mx-auto animate-spin\" />\n      </div>\n    );\n  }\n\n  return <OrderStatusView status={status} />;\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\privacy\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\refunds\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\shipping\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\sitemap.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\store\\[productId]\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\store\\error.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\store\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\terms\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\app\\too-many-requests\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\eslint.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\sneaker-eco\\rdk\\next.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\postcss.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\sneaker-eco\\rdk\\proxy.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\scripts\\check-env-case.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: info, warn, error.","line":129,"column":1,"nodeType":"MemberExpression","messageId":"limited","endLine":129,"endColumn":12,"suggestions":[{"fix":{"range":[4335,4396],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import fs from \"node:fs\";\nimport path from \"node:path\";\n\n// Starting from project root we create a absolute path to src/config/env.ts that works across all OS's and CI runners\nconst ENV_MODULE_PATH = path.join(process.cwd(), \"src/config/env.ts\");\n// Gets the plain text contents of env.ts\nconst envSource = fs.readFileSync(ENV_MODULE_PATH, \"utf8\");\n// Extracts the environment variables from the plain text with regex\nconst declaredEnvVars = Array.from(envSource.matchAll(/([A-Z0-9_]+)\\s*:/g)).map(\n  (m) => m[1],\n);\n\n// Gets the absolute path of the directory where the script is executed (Gets the root)\nconst ROOT = process.cwd();\n// The list of folders for the scanner to skip\nconst IGNORE_DIRS = new Set([\n  \"node_modules\",\n  \".next\",\n  \"public\",\n  \"supabase\",\n  \"scripts\",\n  \"docs\",\n  \".vscode\",\n]);\n\n// Empty array that will contain the file paths to scan\nconst filesToScan: string[] = [];\n\n// Recursive function: Recursion returns where it left off. Ex. [\"api\", \"page.tsx\"] -> api validated -> back to where we left -> page.tsx\nfunction walk(dir: string): void {\n  // Lists all items inside folder. If dir is rdk/infra -> entries = [\"docker\", \"Caddyfile\"]\n  const entries = fs.readdirSync(dir);\n\n  // Loops through each element of the entries array\n  for (const entry of entries) {\n    // Joins the directory and directory path\n    const full = path.join(dir, entry);\n\n    // If entry is in IGNORE_DIRS we go to the next element in the array\n    if (IGNORE_DIRS.has(entry)) {\n      continue;\n    }\n\n    // Stores the stats of full as a object. Ex. \"isFile: [Function], isDirectory: [Function], ...\"\"\n    const stat = fs.statSync(full);\n\n    // If stat.Directory returns true the path is a folder\n    if (stat.isDirectory()) {\n      // We then call the function again with full as our dir this time\n      walk(full);\n      // If full ends with one of these extensions...\n    } else if (full.endsWith(\".ts\") || full.endsWith(\".tsx\") || full.endsWith(\".mts\")) {\n      // We push full (the file path) to filesToScan\n      filesToScan.push(full);\n    }\n  }\n}\n// Calls the walk function\nwalk(ROOT);\n\n// Validator var. If we find a error this will become true\nlet hasError = false;\n\n// Map to store undeclared env vars AND where they were found\n// Key: ENV NAME\n// Value: Array of { file, line }\nconst illegalEnvLocations = new Map<string, Array<{ file: string; line: number }>>();\n\n// Loops through all elements in the filesToScan array\nfor (const file of filesToScan) {\n  // Gets the plain text contents of file\n  const code = fs.readFileSync(file, \"utf8\");\n  const lines = code.split(/\\r?\\n/);\n\n  // Check each line for process.env.<VAR>\n  for (let lineNumber = 0; lineNumber < lines.length; lineNumber++) {\n    const line = lines[lineNumber];\n\n    // Matches is a array that contains all occurrences of process.env. and uses a regex to see what follows it. /g returns all matches\n    const matches = Array.from(line.matchAll(/process\\.env\\.([A-Za-z0-9_]+)/g));\n\n    // We loop through the elements of matches\n    for (const m of matches) {\n      // m looks like \"process.env.STRIPE_SECRET_KEY\", \"STRIPE_SECRET_KEY\", index: 35, input: \"...entire line...\". We get index 1\n      const key = m[1];\n\n      // Check for env var is not proper\n      if (!/^[A-Z0-9_]+$/.test(key)) {\n        console.error(`Invalid casing for env var \"${key}\" in ${file}:${lineNumber + 1}`);\n        hasError = true;\n      }\n\n      // Check if env var is not in env.ts meaning it would be illegal\n      if (!declaredEnvVars.includes(key)) {\n        if (!illegalEnvLocations.has(key)) {\n          illegalEnvLocations.set(key, []);\n        }\n\n        illegalEnvLocations.get(key)!.push({\n          file,\n          line: lineNumber + 1,\n        });\n\n        hasError = true;\n      }\n    }\n  }\n}\n\n// If illegalEnvLocations contains anything our check fails and we output the failures\nif (illegalEnvLocations.size > 0) {\n  console.error(\"\\nERROR: Env vars found in code but NOT declared in env.ts:\");\n\n  for (const [key, locations] of illegalEnvLocations.entries()) {\n    console.error(`  - ${key}`);\n    for (const loc of locations) {\n      console.error(`      ${loc.file}:${loc.line}`);\n    }\n  }\n}\n\n// If hasError is true we fail\nif (hasError) {\n  console.error(\"\\ncheck-env-naming FAILED\\n\");\n  process.exit(1);\n}\n\n// If there is no errors this will print\nconsole.log(\"Env naming validated  casing/declaration OK.\");\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\scripts\\check-file-case.ts","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: info, warn, error.","line":150,"column":1,"nodeType":"MemberExpression","messageId":"limited","endLine":150,"endColumn":12,"suggestions":[{"fix":{"range":[3330,3373],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import fs from \"node:fs\";\nimport path from \"node:path\";\n\n// Whitelisted files\nconst allowedExactNames = [\n  /^Dockerfile$/,\n  /^Caddyfile$/,\n  /^LICENSE$/,\n  /^LICENSE\\.txt$/,\n  /^database\\.types\\.ts$/,\n  /^jest\\.config\\.ts$/,\n  /^next-env\\.d\\.ts$/,\n  /^playwright\\.config\\.ts$/,\n  /^\\.env\\.example$/,\n  /^\\.env\\.local$/,\n  /^\\.gitignore$/,\n  /^\\.prettierrc$/,\n  /^eslint\\.config\\.mjs$/,\n  /^compose\\.yml$/,\n  /^next\\.config\\.js$/,\n  /^postcss\\.config\\.js$/,\n  /^global\\.css$/,\n  /^tailwind\\.config\\.js$/,\n];\n\n// Whitelisted directories\nconst IGNORE_DIRS = new Set([\n  \"node_modules\",\n  \".next\",\n  \"public\",\n  \"scripts\",\n  \"docs\",\n  \".vscode\",\n  \"supabase\",\n  \"tests\",\n  \".git\",\n  \".github\",\n]);\n\nconst allowedExtensions = /\\.(md|ps1|json)$/i; // Allow .md , .ps1 , and .json\nconst tsPatternLowercase = /^[a-z0-9\\-]+\\.ts$/; // TS logic files: lowercase-with-dashes\nconst tsxPatternPascal = /^[A-Z][A-Za-z0-9]+\\.tsx$/; // TSX outside app: PascalCase ONLY\nconst appRoutePattern = /^[a-z0-9\\-]+\\.tsx$/; // TSX inside app: lowercase-with-dashes ONLY\n\n// FILE COLLECTION (recursive filesystem walk)\nconst ROOT = process.cwd();\nconst allFiles: string[] = [];\n\n// Recursively collects all files from ROOT,\n// respecting the IGNORE_DIRS list.\nfunction walk(dir: string): void {\n  const entries = fs.readdirSync(dir);\n\n  for (const entry of entries) {\n    const full = path.join(dir, entry);\n    const stat = fs.statSync(full);\n\n    if (stat.isDirectory()) {\n      const folderName = path.basename(full);\n\n      // Skip ignored directories\n      if (IGNORE_DIRS.has(folderName)) {\n        continue;\n      }\n\n      walk(full);\n    } else {\n      allFiles.push(full);\n    }\n  }\n}\n\nwalk(ROOT);\n\n// VALIDATION LOGIC\nconst invalid: string[] = [];\n\nfor (const fullPath of allFiles) {\n  const file = path.basename(fullPath);\n  const dir = path.dirname(fullPath);\n\n  const isTs = file.endsWith(\".ts\") && !file.endsWith(\".tsx\");\n  const isTsx = file.endsWith(\".tsx\");\n\n  // Detect if file is inside /app folder\n  const inAppFolder = /(^|[\\\\/])app[\\\\/]/.test(fullPath);\n\n  // RULE: Entire `tests/` folder is allowed\n  if (/(^|[\\\\/])tests[\\\\/]/.test(fullPath)) {\n    continue;\n  }\n\n  // RULE: exact whitelisted filenames\n  if (allowedExactNames.some((rx) => rx.test(file))) {\n    continue;\n  }\n\n  // RULE: allowed extensions (.md, .ps1)\n  if (allowedExtensions.test(file)) {\n    continue;\n  }\n\n  // RULE: TS logic files (.ts)\n  // lowercase-with-dashes only\n  if (isTs) {\n    if (!tsPatternLowercase.test(file)) {\n      invalid.push(fullPath);\n    }\n    continue;\n  }\n\n  // RULE: TSX files inside /app\n  // lowercase-with-dashes only\n  if (isTsx && inAppFolder) {\n    if (!appRoutePattern.test(file)) {\n      invalid.push(fullPath);\n    }\n    continue;\n  }\n\n  // RULE: TSX files outside /app\n  // PascalCase only\n  if (isTsx && !inAppFolder) {\n    if (!tsxPatternPascal.test(file)) {\n      invalid.push(fullPath);\n    }\n    continue;\n  }\n\n  // RULE: Directories must be lowercase (except ignored)\n  const segments = dir.split(/[\\\\/]/).filter(Boolean);\n\n  for (const seg of segments) {\n    if (IGNORE_DIRS.has(seg)) {\n      continue;\n    }\n    if (/[A-Z]/.test(seg)) {\n      invalid.push(fullPath);\n      break;\n    }\n  }\n}\n\n// OUTPUT\nif (invalid.length > 0) {\n  console.error(\"Invalid casing detected:\\n\" + invalid.join(\"\\n\"));\n  process.exit(1);\n}\n\nconsole.log(\"File naming validated  OK.\");\nprocess.exit(0);\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\account\\AccountProfile.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1222,1225],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1222,1225],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":31,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1403,1406],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1403,1406],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":115,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4012,4015],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4012,4015],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":129,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4587,4590],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4587,4590],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":724,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":724,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26069,26072],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26069,26072],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/account/AccountProfile.tsx\n\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport { Eye, EyeOff } from \"lucide-react\";\n\nimport type { Tables } from \"@/types/db/database.types\";\nimport { logError } from \"@/lib/log\";\nimport { PasswordRequirements } from \"@/components/auth/register/PasswordRequirements\";\nimport { isPasswordValid } from \"@/lib/validation/password\";\nimport { Toast } from \"@/components/ui/Toast\";\nimport { ToggleSwitch } from \"@/components/ui/ToggleSwitch\";\n\ntype ShippingProfile = Tables<\"shipping_profiles\">;\n\nexport function AccountProfile({ userEmail }: { userEmail: string }) {\n  const [profile, setProfile] = useState<Partial<ShippingProfile>>({});\n  const [isLoading, setIsLoading] = useState(false);\n  const [message, setMessage] = useState(\"\");\n  const [newPassword, setNewPassword] = useState(\"\");\n  const [confirmPassword, setConfirmPassword] = useState(\"\");\n  const [newPasswordVisible, setNewPasswordVisible] = useState(false);\n  const [confirmPasswordVisible, setConfirmPasswordVisible] = useState(false);\n  const [toast, setToast] = useState<{\n    message: string;\n    tone: \"success\" | \"error\" | \"info\";\n  } | null>(null);\n  const [orders, setOrders] = useState<any[]>([]);\n  const [isOrdersLoading, setIsOrdersLoading] = useState(false);\n  const [isSigningOut, setIsSigningOut] = useState(false);\n  const [addresses, setAddresses] = useState<any[]>([]);\n  const [isAddressesLoading, setIsAddressesLoading] = useState(false);\n  const [chatNotificationsEnabled, setChatNotificationsEnabled] = useState(true);\n  const [isChatSaving, setIsChatSaving] = useState(false);\n  const [isAddressSaving, setIsAddressSaving] = useState(false);\n  const [isDefaultSaving, setIsDefaultSaving] = useState(false);\n  const [setAsDefault, setSetAsDefault] = useState(false);\n  const [addressForm, setAddressForm] = useState({\n    name: \"\",\n    phone: \"\",\n    line1: \"\",\n    line2: \"\",\n    city: \"\",\n    state: \"\",\n    postal_code: \"\",\n    country: \"\",\n  });\n\n  useEffect(() => {\n    loadProfile();\n    loadOrders();\n    loadAddresses();\n    loadChatNotifications();\n  }, []);\n\n  const loadProfile = async () => {\n    try {\n      const response = await fetch(\"/api/account/shipping\");\n      const data = await response.json();\n      setProfile(data);\n    } catch (error) {\n      logError(error, { layer: \"frontend\", event: \"account_load_profile\" });\n    }\n  };\n\n  const loadOrders = async () => {\n    setIsOrdersLoading(true);\n    try {\n      const response = await fetch(\"/api/account/orders\");\n      const data = await response.json();\n      setOrders(data.orders || []);\n    } catch (error) {\n      logError(error, { layer: \"frontend\", event: \"account_load_orders\" });\n    } finally {\n      setIsOrdersLoading(false);\n    }\n  };\n\n  const loadChatNotifications = async () => {\n    try {\n      const response = await fetch(\"/api/account/notifications\", { cache: \"no-store\" });\n      const data = await response.json();\n      setChatNotificationsEnabled(Boolean(data.chat_notifications_enabled));\n    } catch (error) {\n      logError(error, { layer: \"frontend\", event: \"account_load_chat_notifications\" });\n    }\n  };\n\n  const handleSaveChatNotifications = async () => {\n    setIsChatSaving(true);\n    setMessage(\"\");\n    try {\n      const response = await fetch(\"/api/account/notifications\", {\n        method: \"PATCH\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ chat_notifications_enabled: chatNotificationsEnabled }),\n      });\n\n      const data = await response.json().catch(() => null);\n      if (!response.ok) {\n        setMessage(data?.error ?? \"Failed to update chat notifications\");\n        return;\n      }\n\n      setMessage(\"Chat notification preference updated.\");\n    } catch {\n      setMessage(\"Failed to update chat notifications\");\n    } finally {\n      setIsChatSaving(false);\n    }\n  };\n\n  const formatField = (value?: string | null) => (value ?? \"\").trim().toLowerCase();\n\n  const isDefaultAddress = (address: any) => {\n    if (!profile.address_line1) {\n      return false;\n    }\n    return (\n      formatField(profile.address_line1) === formatField(address.line1) &&\n      formatField(profile.address_line2) === formatField(address.line2) &&\n      formatField(profile.city) === formatField(address.city) &&\n      formatField(profile.state) === formatField(address.state) &&\n      formatField(profile.postal_code) === formatField(address.postal_code) &&\n      formatField(profile.country) === formatField(address.country)\n    );\n  };\n\n  const handleSetDefaultAddress = async (address: any, silent?: boolean) => {\n    setIsDefaultSaving(true);\n    if (!silent) {\n      setMessage(\"\");\n    }\n\n    try {\n      const response = await fetch(\"/api/account/shipping\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          full_name: address.name ?? null,\n          phone: address.phone ?? null,\n          address_line1: address.line1 ?? null,\n          address_line2: address.line2 ?? null,\n          city: address.city ?? null,\n          state: address.state ?? null,\n          postal_code: address.postal_code ?? null,\n          country: address.country ?? null,\n        }),\n      });\n\n      const data = await response.json().catch(() => null);\n\n      if (!response.ok) {\n        if (!silent) {\n          setMessage(data?.error ?? \"Failed to set default shipping address\");\n        }\n        return;\n      }\n\n      setProfile(data || {});\n      if (!silent) {\n        setMessage(\"Default shipping address updated successfully.\");\n      }\n    } catch {\n      if (!silent) {\n        setMessage(\"Error updating default shipping address\");\n      }\n    } finally {\n      setIsDefaultSaving(false);\n    }\n  };\n\n  const handleClearDefaultShipping = async (silent?: boolean) => {\n    setIsDefaultSaving(true);\n    if (!silent) {\n      setMessage(\"\");\n    }\n\n    try {\n      const response = await fetch(\"/api/account/shipping\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          full_name: null,\n          phone: null,\n          address_line1: null,\n          address_line2: null,\n          city: null,\n          state: null,\n          postal_code: null,\n          country: null,\n        }),\n      });\n\n      const data = await response.json().catch(() => null);\n\n      if (!response.ok) {\n        if (!silent) {\n          setMessage(data?.error ?? \"Failed to clear default shipping address\");\n        }\n        return;\n      }\n\n      setProfile(data || {});\n      if (!silent) {\n        setMessage(\"Default shipping address cleared successfully.\");\n      }\n    } catch {\n      if (!silent) {\n        setMessage(\"Error clearing default shipping address\");\n      }\n    } finally {\n      setIsDefaultSaving(false);\n    }\n  };\n\n  const handleChangePassword = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsLoading(true);\n    setMessage(\"\");\n\n    if (newPassword !== confirmPassword) {\n      setMessage(\"Passwords do not match\");\n      setIsLoading(false);\n      return;\n    }\n\n    if (!isPasswordValid(newPassword)) {\n      setMessage(\"Password does not meet the required criteria.\");\n      setIsLoading(false);\n      return;\n    }\n\n    try {\n      const response = await fetch(\"/api/account/password\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ password: newPassword }),\n      });\n\n      const data = await response.json().catch(() => null);\n\n      if (!response.ok) {\n        setMessage(`Failed to change password: ${data?.error ?? \"Unknown error\"}`);\n      } else {\n        setToast({ message: \"Password changed successfully!\", tone: \"success\" });\n        setNewPassword(\"\");\n        setConfirmPassword(\"\");\n        setNewPasswordVisible(false);\n        setConfirmPasswordVisible(false);\n      }\n    } catch {\n      setMessage(\"Error changing password\");\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const loadAddresses = async () => {\n    setIsAddressesLoading(true);\n    try {\n      const response = await fetch(\"/api/account/addresses\");\n      const data = await response.json();\n      setAddresses(data.addresses || []);\n    } catch (error) {\n      logError(error, { layer: \"frontend\", event: \"account_load_addresses\" });\n    } finally {\n      setIsAddressesLoading(false);\n    }\n  };\n\n  const handleSaveAddress = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsAddressSaving(true);\n    setMessage(\"\");\n    const addressPayload = { ...addressForm };\n\n    try {\n      const response = await fetch(\"/api/account/addresses\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(addressForm),\n      });\n\n      if (!response.ok) {\n        setMessage(\"Failed to save address\");\n        return;\n      }\n\n      const data = await response.json();\n      setAddresses(data.addresses || []);\n      setAddressForm({\n        name: \"\",\n        phone: \"\",\n        line1: \"\",\n        line2: \"\",\n        city: \"\",\n        state: \"\",\n        postal_code: \"\",\n        country: \"\",\n      });\n      if (setAsDefault) {\n        await handleSetDefaultAddress(\n          {\n            name: addressPayload.name,\n            phone: addressPayload.phone,\n            line1: addressPayload.line1,\n            line2: addressPayload.line2,\n            city: addressPayload.city,\n            state: addressPayload.state,\n            postal_code: addressPayload.postal_code,\n            country: addressPayload.country,\n          },\n          true,\n        );\n      }\n      setSetAsDefault(false);\n      setMessage(\n        setAsDefault\n          ? \"Address saved successfully and set as default shipping.\"\n          : \"Address saved successfully!\",\n      );\n    } catch {\n      setMessage(\"Error saving address\");\n    } finally {\n      setIsAddressSaving(false);\n    }\n  };\n\n  const handleDeleteAddress = async (addressId: string) => {\n    setMessage(\"\");\n    const targetAddress = addresses.find((address) => address.id === addressId);\n    const wasDefault = targetAddress ? isDefaultAddress(targetAddress) : false;\n    try {\n      const response = await fetch(`/api/account/addresses/${addressId}`, {\n        method: \"DELETE\",\n      });\n\n      if (!response.ok) {\n        setMessage(\"Failed to remove address\");\n        return;\n      }\n\n      setAddresses((prev) => prev.filter((address) => address.id !== addressId));\n      if (wasDefault) {\n        await handleClearDefaultShipping(true);\n      }\n    } catch {\n      setMessage(\"Error removing address\");\n    }\n  };\n\n  const getTrackingUrl = (carrier?: string | null, trackingNumber?: string | null) => {\n    if (!trackingNumber) {\n      return null;\n    }\n    const normalized = (carrier ?? \"\").toLowerCase();\n    const encodedTracking = encodeURIComponent(trackingNumber);\n\n    if (normalized.includes(\"ups\")) {\n      return `https://www.ups.com/track?loc=en_US&tracknum=${encodedTracking}`;\n    }\n    if (normalized.includes(\"usps\")) {\n      return `https://tools.usps.com/go/TrackConfirmAction?tLabels=${encodedTracking}`;\n    }\n    if (normalized.includes(\"fedex\") || normalized.includes(\"fed ex\")) {\n      return `https://www.fedex.com/fedextrack/?trknbr=${encodedTracking}`;\n    }\n    if (normalized.includes(\"dhl\")) {\n      return `https://www.dhl.com/us-en/home/tracking/tracking-express.html?submit=1&tracking-id=${encodedTracking}`;\n    }\n\n    return null;\n  };\n\n  const handleLogout = async () => {\n    setIsSigningOut(true);\n    try {\n      await fetch(\"/api/auth/logout\", { method: \"POST\" });\n      window.location.href = \"/\";\n    } catch {\n      setMessage(\"Failed to log out. Please try again.\");\n    } finally {\n      setIsSigningOut(false);\n    }\n  };\n\n  return (\n    <div className=\"max-w-4xl mx-auto px-4 py-8 text-[13px] sm:text-base\">\n      <h1 className=\"text-2xl sm:text-3xl font-bold text-white mb-6 sm:mb-8\">\n        Account Settings\n      </h1>\n\n      {message && (\n        <div\n          className={`mb-6 p-4 rounded ${\n            message.includes(\"success\")\n              ? \"bg-green-900/20 text-green-400\"\n              : \"bg-red-900/20 text-red-400\"\n          }`}\n        >\n          {message}\n        </div>\n      )}\n\n      {/* Email (Read-only) */}\n      <div className=\"bg-zinc-900 border border-zinc-800/70 rounded p-4 sm:p-6 mb-6\">\n        <h2 className=\"text-lg sm:text-xl font-semibold text-white mb-3 sm:mb-4\">\n          Email\n        </h2>\n        <p className=\"text-gray-400\">{userEmail}</p>\n        <p className=\"text-gray-500 text-[12px] sm:text-sm mt-2\">\n          Email changes are not currently supported\n        </p>\n      </div>\n\n      <div className=\"bg-zinc-900 border border-zinc-800/70 rounded p-4 sm:p-6 mb-6\">\n        <h2 className=\"text-lg sm:text-xl font-semibold text-white mb-3 sm:mb-4\">\n          Chat Notifications\n        </h2>\n        <p className=\"text-gray-400 text-[12px] sm:text-sm mb-4\">\n          Get email updates when admins reply to your chat.\n        </p>\n        <div className=\"flex items-center justify-between gap-4 text-[12px] sm:text-sm text-zinc-300\">\n          <span>Email me about chat replies</span>\n          <ToggleSwitch\n            checked={chatNotificationsEnabled}\n            onChange={setChatNotificationsEnabled}\n            ariaLabel=\"Chat notification preference\"\n          />\n        </div>\n        <button\n          type=\"button\"\n          onClick={() => {\n            void handleSaveChatNotifications();\n          }}\n          disabled={isChatSaving}\n          className=\"mt-4 bg-red-600 hover:bg-red-700 disabled:bg-gray-600 text-white font-semibold px-5 py-2 text-[12px] sm:text-sm rounded transition\"\n        >\n          {isChatSaving ? \"Saving...\" : \"Save Preference\"}\n        </button>\n      </div>\n\n      {/* Saved Addresses */}\n      <div className=\"bg-zinc-900 border border-zinc-800/70 rounded p-4 sm:p-6 mb-6\">\n        <div className=\"flex items-center justify-between flex-wrap gap-2 mb-4\">\n          <h2 className=\"text-lg sm:text-xl font-semibold text-white\">\n            Shipping Addresses\n          </h2>\n          <span className=\"text-[11px] sm:text-xs text-zinc-500\">\n            Save multiple addresses and pick a default for checkout.\n          </span>\n        </div>\n\n        <div className=\"border border-zinc-800/70 rounded p-4 mb-6\">\n          <div className=\"flex items-center justify-between flex-wrap gap-2\">\n            <div>\n              <div className=\"text-[11px] sm:text-xs uppercase tracking-[0.2em] text-zinc-500\">\n                Default shipping address\n              </div>\n              {profile.address_line1 ? (\n                <div className=\"text-[12px] sm:text-sm text-zinc-300 mt-2 space-y-1\">\n                  {profile.full_name && (\n                    <div className=\"text-white font-semibold\">{profile.full_name}</div>\n                  )}\n                  <div>{profile.address_line1}</div>\n                  {profile.address_line2 && <div>{profile.address_line2}</div>}\n                  <div>\n                    {profile.city}, {profile.state} {profile.postal_code}\n                  </div>\n                  <div>{profile.country}</div>\n                  {profile.phone && <div className=\"text-zinc-500\">{profile.phone}</div>}\n                </div>\n              ) : (\n                <div className=\"text-[12px] sm:text-sm text-zinc-500 mt-2\">\n                  No default shipping address yet. Choose one below.\n                </div>\n              )}\n            </div>\n            {profile.address_line1 && (\n              <button\n                type=\"button\"\n                onClick={() => {\n                  void handleClearDefaultShipping();\n                }}\n                disabled={isDefaultSaving}\n                className=\"text-[11px] sm:text-xs text-red-400 hover:text-red-300 transition-colors disabled:opacity-60\"\n              >\n                {isDefaultSaving ? \"Updating...\" : \"Clear default\"}\n              </button>\n            )}\n          </div>\n        </div>\n\n        {isAddressesLoading ? (\n          <div className=\"text-gray-400 mb-6\">Loading addresses...</div>\n        ) : addresses.length === 0 ? (\n          <div className=\"text-gray-400 mb-6\">No saved addresses yet.</div>\n        ) : (\n          <div className=\"space-y-3 mb-6\">\n            {addresses.map((address) => (\n              <div key={address.id} className=\"border border-zinc-800/70 rounded p-4\">\n                <div className=\"flex items-start justify-between gap-4\">\n                  <div className=\"text-[12px] sm:text-sm text-zinc-300\">\n                    <div className=\"flex items-center gap-2 text-white font-semibold\">\n                      <span>{address.name || \"Saved Address\"}</span>\n                      {isDefaultAddress(address) && (\n                        <span className=\"text-[10px] uppercase tracking-[0.12em] text-zinc-300 bg-zinc-800/70 px-2 py-0.5 rounded\">\n                          Default\n                        </span>\n                      )}\n                    </div>\n                    <div>{address.line1}</div>\n                    {address.line2 && <div>{address.line2}</div>}\n                    <div>\n                      {address.city}, {address.state} {address.postal_code}\n                    </div>\n                    <div>{address.country}</div>\n                    {address.phone && (\n                      <div className=\"text-zinc-500\">{address.phone}</div>\n                    )}\n                  </div>\n                  <button\n                    type=\"button\"\n                    onClick={() => {\n                      void handleDeleteAddress(address.id);\n                    }}\n                    className=\"text-[11px] sm:text-xs text-red-400 hover:text-red-300 transition-colors\"\n                  >\n                    Remove\n                  </button>\n                </div>\n                {!isDefaultAddress(address) && (\n                  <button\n                    type=\"button\"\n                    onClick={() => {\n                      void handleSetDefaultAddress(address);\n                    }}\n                    disabled={isDefaultSaving}\n                    className=\"mt-3 text-[11px] sm:text-xs text-zinc-300 hover:text-white transition-colors disabled:opacity-60\"\n                  >\n                    {isDefaultSaving ? \"Updating...\" : \"Set as default shipping\"}\n                  </button>\n                )}\n              </div>\n            ))}\n          </div>\n        )}\n\n        <form\n          onSubmit={(event) => {\n            void handleSaveAddress(event);\n          }}\n          className=\"space-y-4\"\n        >\n          <div>\n            <label className=\"block text-gray-400 text-[12px] sm:text-sm mb-1\">\n              Full Name\n            </label>\n            <input\n              type=\"text\"\n              value={addressForm.name}\n              onChange={(e) => setAddressForm({ ...addressForm, name: e.target.value })}\n              className=\"w-full bg-zinc-800 text-white px-4 py-2 text-[13px] sm:text-sm rounded border border-zinc-800/70 focus:outline-none focus:ring-2 focus:ring-red-600\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-gray-400 text-[12px] sm:text-sm mb-1\">\n              Phone\n            </label>\n            <input\n              type=\"tel\"\n              value={addressForm.phone}\n              onChange={(e) => setAddressForm({ ...addressForm, phone: e.target.value })}\n              className=\"w-full bg-zinc-800 text-white px-4 py-2 text-[13px] sm:text-sm rounded border border-zinc-800/70 focus:outline-none focus:ring-2 focus:ring-red-600\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-gray-400 text-[12px] sm:text-sm mb-1\">\n              Address Line 1 <span className=\"text-red-500\">*</span>\n            </label>\n            <input\n              type=\"text\"\n              required\n              value={addressForm.line1}\n              onChange={(e) => setAddressForm({ ...addressForm, line1: e.target.value })}\n              className=\"w-full bg-zinc-800 text-white px-4 py-2 text-[13px] sm:text-sm rounded border border-zinc-800/70 focus:outline-none focus:ring-2 focus:ring-red-600\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-gray-400 text-[12px] sm:text-sm mb-1\">\n              Apartment / Unit\n            </label>\n            <input\n              type=\"text\"\n              value={addressForm.line2}\n              onChange={(e) => setAddressForm({ ...addressForm, line2: e.target.value })}\n              className=\"w-full bg-zinc-800 text-white px-4 py-2 text-[13px] sm:text-sm rounded border border-zinc-800/70 focus:outline-none focus:ring-2 focus:ring-red-600\"\n            />\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <label className=\"block text-gray-400 text-[12px] sm:text-sm mb-1\">\n                City <span className=\"text-red-500\">*</span>\n              </label>\n              <input\n                type=\"text\"\n                required\n                value={addressForm.city}\n                onChange={(e) => setAddressForm({ ...addressForm, city: e.target.value })}\n                className=\"w-full bg-zinc-800 text-white px-4 py-2 text-[13px] sm:text-sm rounded border border-zinc-800/70 focus:outline-none focus:ring-2 focus:ring-red-600\"\n              />\n            </div>\n\n            <div>\n              <label className=\"block text-gray-400 text-[12px] sm:text-sm mb-1\">\n                State <span className=\"text-red-500\">*</span>\n              </label>\n              <input\n                type=\"text\"\n                required\n                value={addressForm.state}\n                onChange={(e) =>\n                  setAddressForm({ ...addressForm, state: e.target.value })\n                }\n                className=\"w-full bg-zinc-800 text-white px-4 py-2 text-[13px] sm:text-sm rounded border border-zinc-800/70 focus:outline-none focus:ring-2 focus:ring-red-600\"\n              />\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <label className=\"block text-gray-400 text-[12px] sm:text-sm mb-1\">\n                Postal Code <span className=\"text-red-500\">*</span>\n              </label>\n              <input\n                type=\"text\"\n                required\n                value={addressForm.postal_code}\n                onChange={(e) =>\n                  setAddressForm({ ...addressForm, postal_code: e.target.value })\n                }\n                className=\"w-full bg-zinc-800 text-white px-4 py-2 text-[13px] sm:text-sm rounded border border-zinc-800/70 focus:outline-none focus:ring-2 focus:ring-red-600\"\n              />\n            </div>\n\n            <div>\n              <label className=\"block text-gray-400 text-[12px] sm:text-sm mb-1\">\n                Country <span className=\"text-red-500\">*</span>\n              </label>\n              <input\n                type=\"text\"\n                required\n                value={addressForm.country}\n                onChange={(e) =>\n                  setAddressForm({ ...addressForm, country: e.target.value })\n                }\n                className=\"w-full bg-zinc-800 text-white px-4 py-2 text-[13px] sm:text-sm rounded border border-zinc-800/70 focus:outline-none focus:ring-2 focus:ring-red-600\"\n              />\n            </div>\n          </div>\n\n          <label className=\"flex items-center gap-2 text-[12px] sm:text-sm text-zinc-400\">\n            <input\n              type=\"checkbox\"\n              checked={setAsDefault}\n              onChange={(e) => setSetAsDefault(e.target.checked)}\n              className=\"rdk-checkbox\"\n            />\n            Set as default shipping address\n          </label>\n\n          <button\n            type=\"submit\"\n            disabled={isAddressSaving}\n            className=\"bg-red-600 hover:bg-red-700 disabled:bg-gray-600 text-white font-semibold px-5 py-2 text-[12px] sm:text-sm rounded transition\"\n          >\n            {isAddressSaving ? \"Saving...\" : \"Add Address\"}\n          </button>\n        </form>\n      </div>\n\n      {/* Order History */}\n      <div className=\"bg-zinc-900 border border-zinc-800/70 rounded p-4 sm:p-6 mb-6\">\n        <h2 className=\"text-lg sm:text-xl font-semibold text-white mb-3 sm:mb-4\">\n          Order History\n        </h2>\n        {isOrdersLoading ? (\n          <div className=\"text-gray-400\">Loading orders...</div>\n        ) : orders.length === 0 ? (\n          <div className=\"text-gray-400\">No orders yet.</div>\n        ) : (\n          <div className=\"space-y-4\">\n            {orders.map((order) => {\n              const trackingUrl = getTrackingUrl(\n                order.shipping_carrier,\n                order.tracking_number,\n              );\n              const showTracking = order.fulfillment === \"ship\" && order.tracking_number;\n\n              return (\n                <div key={order.id} className=\"border border-zinc-800/70 rounded p-4\">\n                  <div className=\"flex flex-wrap items-center justify-between gap-2 mb-3\">\n                    <div className=\"text-white font-semibold\">\n                      Order #{order.id.slice(0, 8)}\n                    </div>\n                    <div className=\"text-gray-400 text-[12px] sm:text-sm\">\n                      {new Date(order.created_at).toLocaleDateString()}\n                    </div>\n                  </div>\n                  <div className=\"flex flex-wrap items-center justify-between gap-2 mb-3\">\n                    <span className=\"text-gray-400 text-[12px] sm:text-sm\">\n                      Status: {order.status}\n                    </span>\n                    <span className=\"text-white font-semibold\">\n                      ${Number(order.total ?? 0).toFixed(2)}\n                    </span>\n                  </div>\n                  <div className=\"space-y-2\">\n                    {(order.items || []).map((item: any) => (\n                      <div\n                        key={item.id}\n                        className=\"flex items-center justify-between text-[12px] sm:text-sm\"\n                      >\n                        <span className=\"text-gray-300\">\n                          {item.product?.title_display ??\n                            `${item.product?.brand ?? \"\"} ${item.product?.name ?? \"\"}`.trim()}\n                          {item.variant?.size_label\n                            ? ` (${item.variant.size_label})`\n                            : \"\"}\n                        </span>\n                        <span className=\"text-gray-400\">x{item.quantity}</span>\n                      </div>\n                    ))}\n                  </div>\n                  {showTracking && (\n                    <div className=\"mt-3 flex flex-wrap items-center justify-between gap-2 text-[12px] sm:text-sm\">\n                      <div className=\"text-zinc-400\">\n                        Tracking:{\" \"}\n                        {order.shipping_carrier ? `${order.shipping_carrier} ` : \"\"}\n                        <span className=\"text-zinc-200\">{order.tracking_number}</span>\n                      </div>\n                      {trackingUrl ? (\n                        <a\n                          href={trackingUrl}\n                          target=\"_blank\"\n                          rel=\"noopener noreferrer\"\n                          className=\"text-red-400 hover:underline\"\n                        >\n                          Track shipment\n                        </a>\n                      ) : null}\n                    </div>\n                  )}\n                </div>\n              );\n            })}\n          </div>\n        )}\n      </div>\n\n      {/* Change Password */}\n      <div className=\"bg-zinc-900 border border-zinc-800/70 rounded p-4 sm:p-6\">\n        <h2 className=\"text-lg sm:text-xl font-semibold text-white mb-3 sm:mb-4\">\n          Change Password\n        </h2>\n        <form\n          onSubmit={(event) => {\n            void handleChangePassword(event);\n          }}\n          className=\"space-y-4\"\n        >\n          <div>\n            <label className=\"block text-gray-400 text-[12px] sm:text-sm mb-1\">\n              New Password\n            </label>\n            <div className=\"relative\">\n              <input\n                type={newPasswordVisible ? \"text\" : \"password\"}\n                value={newPassword}\n                onChange={(e) => setNewPassword(e.target.value)}\n                autoComplete=\"new-password\"\n                className=\"w-full bg-zinc-800 text-white px-4 py-2 pr-11 text-[13px] sm:text-sm rounded border border-zinc-800/70 focus:outline-none focus:ring-2 focus:ring-red-600\"\n              />\n              <button\n                type=\"button\"\n                onClick={() => setNewPasswordVisible((prev) => !prev)}\n                className=\"absolute right-3 top-1/2 -translate-y-1/2 text-zinc-500 hover:text-zinc-300 transition-colors\"\n                aria-label={newPasswordVisible ? \"Hide password\" : \"Show password\"}\n              >\n                {newPasswordVisible ? (\n                  <EyeOff className=\"w-4 h-4\" />\n                ) : (\n                  <Eye className=\"w-4 h-4\" />\n                )}\n              </button>\n            </div>\n          </div>\n\n          <PasswordRequirements password={newPassword} />\n\n          <div>\n            <label className=\"block text-gray-400 text-[12px] sm:text-sm mb-1\">\n              Confirm Password\n            </label>\n            <div className=\"relative\">\n              <input\n                type={confirmPasswordVisible ? \"text\" : \"password\"}\n                value={confirmPassword}\n                onChange={(e) => setConfirmPassword(e.target.value)}\n                autoComplete=\"new-password\"\n                className=\"w-full bg-zinc-800 text-white px-4 py-2 pr-11 text-[13px] sm:text-sm rounded border border-zinc-800/70 focus:outline-none focus:ring-2 focus:ring-red-600\"\n              />\n              <button\n                type=\"button\"\n                onClick={() => setConfirmPasswordVisible((prev) => !prev)}\n                className=\"absolute right-3 top-1/2 -translate-y-1/2 text-zinc-500 hover:text-zinc-300 transition-colors\"\n                aria-label={confirmPasswordVisible ? \"Hide password\" : \"Show password\"}\n              >\n                {confirmPasswordVisible ? (\n                  <EyeOff className=\"w-4 h-4\" />\n                ) : (\n                  <Eye className=\"w-4 h-4\" />\n                )}\n              </button>\n            </div>\n          </div>\n\n          <button\n            type=\"submit\"\n            disabled={isLoading}\n            className=\"bg-red-600 hover:bg-red-700 disabled:bg-gray-600 text-white font-semibold px-5 py-2 text-[12px] sm:text-sm rounded transition\"\n          >\n            {isLoading ? \"Changing...\" : \"Change Password\"}\n          </button>\n        </form>\n      </div>\n\n      <div className=\"bg-zinc-900 border border-zinc-800/70 rounded p-4 sm:p-6\">\n        <h2 className=\"text-lg sm:text-xl font-semibold text-white mb-3 sm:mb-4\">\n          Sign out\n        </h2>\n        <p className=\"text-gray-400 text-[12px] sm:text-sm mb-4\">\n          You can sign back in anytime to view your orders and account details.\n        </p>\n        <button\n          type=\"button\"\n          onClick={() => {\n            void handleLogout();\n          }}\n          disabled={isSigningOut}\n          className=\"bg-zinc-800 hover:bg-zinc-700 disabled:bg-zinc-700 text-white font-semibold px-5 py-2 text-[12px] sm:text-sm transition cursor-pointer\"\n        >\n          {isSigningOut ? \"Signing out...\" : \"Logout\"}\n        </button>\n      </div>\n      <Toast\n        open={Boolean(toast)}\n        message={toast?.message ?? \"\"}\n        tone={toast?.tone ?? \"info\"}\n        onClose={() => setToast(null)}\n      />\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\admin\\AdminNotificationCenter.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\admin\\AdminNotificationsDrawer.tsx","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react-hooks/exhaustive-deps').","line":100,"column":5,"severity":1,"nodeType":null,"fix":{"range":[2520,2575],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"\"use client\";\n\nimport { useEffect, useMemo, useRef, useState } from \"react\";\nimport Link from \"next/link\";\nimport { X } from \"lucide-react\";\n\nimport { logError } from \"@/lib/log\";\n\ntype AdminNotification = {\n  id: string;\n  type: \"order_placed\" | \"chat_message\";\n  message: string;\n  created_at: string;\n  read_at: string | null;\n  order_id?: string | null;\n  chat_id?: string | null;\n};\n\nconst formatTime = (value: string) => {\n  const date = new Date(value);\n  if (Number.isNaN(date.getTime())) {\n    return \"\";\n  }\n  return date.toLocaleString(undefined, { dateStyle: \"medium\", timeStyle: \"short\" });\n};\n\nconst getNotificationHref = (n: AdminNotification) => {\n  if (n.type === \"order_placed\" && n.order_id) {\n    return \"/admin/sales\";\n  }\n  if (n.chat_id) {\n    return `/admin/chats?chatId=${n.chat_id}`;\n  }\n  return \"/admin/dashboard\";\n};\n\ntype Props = {\n  isOpen: boolean;\n  onClose: () => void;\n};\n\ntype ListResponse = {\n  notifications: AdminNotification[];\n  unreadCount: number;\n  hasMore: boolean;\n  page: number;\n  limit: number;\n};\n\nfunction emitUnreadCountUpdated(unreadCount: number) {\n  window.dispatchEvent(\n    new CustomEvent(\"adminNotificationsUpdated\", { detail: { unreadCount } }),\n  );\n}\n\nexport function AdminNotificationsDrawer({ isOpen, onClose }: Props) {\n  const [notifications, setNotifications] = useState<AdminNotification[]>([]);\n  const [isLoading, setIsLoading] = useState(false);\n\n  // prevent unread count flash before first load\n  const [unreadCountServer, setUnreadCountServer] = useState<number | null>(null);\n  const loadedOnceRef = useRef(false);\n\n  const unreadCountLocal = useMemo(\n    () => notifications.filter((n) => !n.read_at).length,\n    [notifications],\n  );\n\n  const load = async () => {\n    setIsLoading(true);\n    try {\n      const res = await fetch(`/api/admin/notifications?limit=20&page=1`, {\n        cache: \"no-store\",\n      });\n      if (!res.ok) {\n        return;\n      }\n\n      const data = (await res.json()) as ListResponse;\n      setNotifications(data.notifications ?? []);\n      setUnreadCountServer(\n        typeof data.unreadCount === \"number\" ? data.unreadCount : null,\n      );\n\n      if (typeof data.unreadCount === \"number\") {\n        emitUnreadCountUpdated(data.unreadCount);\n      }\n      loadedOnceRef.current = true;\n    } catch (error) {\n      logError(error, { layer: \"frontend\", event: \"admin_load_notifications_drawer\" });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    if (isOpen) {\n      load();\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isOpen]);\n\n  useEffect(() => {\n    if (!isOpen) {\n      return;\n    }\n    const onKeyDown = (e: KeyboardEvent) => {\n      if (e.key === \"Escape\") {\n        onClose();\n      }\n    };\n    document.addEventListener(\"keydown\", onKeyDown);\n    return () => document.removeEventListener(\"keydown\", onKeyDown);\n  }, [isOpen, onClose]);\n\n  const markRead = async (id: string) => {\n    try {\n      await fetch(\"/api/admin/notifications\", {\n        method: \"PATCH\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ ids: [id] }),\n      });\n\n      setNotifications((prev) =>\n        prev.map((n) => (n.id === id ? { ...n, read_at: new Date().toISOString() } : n)),\n      );\n      setUnreadCountServer((v) => {\n        const next = typeof v === \"number\" ? Math.max(0, v - 1) : v;\n        if (typeof next === \"number\") {\n          emitUnreadCountUpdated(next);\n        }\n        return next;\n      });\n    } catch (error) {\n      logError(error, {\n        layer: \"frontend\",\n        event: \"admin_mark_notification_read_drawer\",\n      });\n    }\n  };\n\n  const markAll = async () => {\n    try {\n      await fetch(\"/api/admin/notifications\", {\n        method: \"PATCH\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ mark_all: true }),\n      });\n\n      setNotifications((prev) =>\n        prev.map((n) => ({ ...n, read_at: n.read_at ?? new Date().toISOString() })),\n      );\n      setUnreadCountServer(0);\n      emitUnreadCountUpdated(0);\n    } catch (error) {\n      logError(error, {\n        layer: \"frontend\",\n        event: \"admin_mark_all_notifications_drawer\",\n      });\n    }\n  };\n\n  if (!isOpen) {\n    return null;\n  }\n\n  const showUnread = unreadCountServer !== null && loadedOnceRef.current;\n\n  return (\n    <div className=\"fixed inset-0 z-50\">\n      <div className=\"absolute inset-0 bg-black/60\" onClick={onClose} />\n\n      <div\n        className=\"absolute inset-x-0 bottom-0 h-[80vh] max-h-[80vh] w-full bg-black border-t border-zinc-800/70 overflow-y-auto rounded-t-2xl\n                      md:rounded-none md:inset-y-0 md:right-0 md:left-auto md:h-auto md:max-h-none md:max-w-md md:border-t-0 md:border-l\"\n      >\n        <div className=\"p-6\">\n          <div className=\"flex items-start justify-between mb-3\">\n            <div>\n              <h2 className=\"text-2xl font-bold text-white\">Notifications</h2>\n              <p className=\"text-xs text-zinc-500 mt-1\">\n                {isLoading && !loadedOnceRef.current\n                  ? \"Loading...\"\n                  : showUnread\n                    ? `Unread: ${unreadCountServer}`\n                    : `Unread: ${unreadCountLocal}`}\n              </p>\n            </div>\n\n            <button\n              onClick={onClose}\n              className=\"text-gray-400 hover:text-white\"\n              aria-label=\"Close\"\n            >\n              <X className=\"w-6 h-6\" />\n            </button>\n          </div>\n\n          <div className=\"flex items-center justify-between border-b border-zinc-800/70 pb-3 mb-4\">\n            <button\n              type=\"button\"\n              onClick={() => {\n                void load();\n              }}\n              className=\"text-xs text-zinc-400 hover:text-white\"\n            >\n              Refresh\n            </button>\n\n            <div className=\"flex items-center gap-4\">\n              <Link\n                href=\"/admin/notifications\"\n                onClick={onClose}\n                className=\"text-xs text-zinc-400 hover:text-white\"\n              >\n                View all notifications\n              </Link>\n\n              <button\n                type=\"button\"\n                onClick={() => {\n                  void markAll();\n                }}\n                className=\"text-xs text-zinc-400 hover:text-white\"\n              >\n                Mark all as read\n              </button>\n            </div>\n          </div>\n\n          {isLoading && !loadedOnceRef.current ? (\n            <div className=\"text-sm text-zinc-500 py-8 text-center\">\n              Loading notifications...\n            </div>\n          ) : notifications.length === 0 ? (\n            <div className=\"text-sm text-zinc-500 py-10 text-center\">\n              No notifications yet.\n            </div>\n          ) : (\n            <div className=\"space-y-2\">\n              {notifications.map((n) => (\n                <Link\n                  key={n.id}\n                  href={getNotificationHref(n)}\n                  onClick={() => {\n                    onClose();\n                    if (!n.read_at) {\n                      markRead(n.id);\n                    }\n                  }}\n                  className={`block min-w-0 border border-zinc-800/70 bg-zinc-950 hover:bg-zinc-900 transition px-4 py-3 rounded-sm ${\n                    n.read_at ? \"text-zinc-400\" : \"text-white\"\n                  }`}\n                  data-testid=\"admin-notification-item\"\n                >\n                  <div className=\"text-sm font-medium break-words whitespace-pre-wrap\">\n                    {n.message}\n                  </div>\n                  <div className=\"text-xs text-zinc-500 mt-1\">\n                    {formatTime(n.created_at)}\n                  </div>\n                </Link>\n              ))}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\admin\\AdminSidebar.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[811,814],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[811,814],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":41,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[884,887],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[884,887],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":183,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":183,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5309,5312],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5309,5312],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/admin/AdminSidebar.tsx\n\"use client\";\n\nimport { createElement, useEffect, useRef, useState } from \"react\";\nimport Link from \"next/link\";\nimport { usePathname } from \"next/navigation\";\nimport {\n  User,\n  Bell,\n  LayoutDashboard,\n  Package,\n  Truck,\n  BarChart3,\n  Settings,\n  MessageCircle,\n  Globe,\n  X,\n  Menu,\n  ChevronDown,\n  ChevronRight,\n  Landmark,\n  Receipt,\n} from \"lucide-react\";\n\nimport { createSupabaseBrowserClient } from \"@/lib/supabase/client\";\nimport { canViewBank } from \"@/config/constants/roles\";\nimport type { ProfileRole } from \"@/config/constants/roles\";\nimport { Tooltip } from \"@/components/ui/Tooltip\";\nimport { AdminNotificationsDrawer } from \"@/components/admin/AdminNotificationsDrawer\";\n\ntype NavLinkItem = {\n  type: \"link\";\n  href: string;\n  label: string;\n  icon: any;\n};\n\ntype NavGroupItem = {\n  type: \"group\";\n  label: string;\n  icon: any;\n  groupKey: \"analytics\" | \"orders\" | \"settings\";\n  isActive: (pathname: string) => boolean;\n  children: Array<{ href: string; label: string }>;\n};\n\nconst navItems: Array<NavLinkItem | NavGroupItem> = [\n  { type: \"link\", href: \"/\", label: \"Website\", icon: Globe },\n  { type: \"link\", href: \"/admin/dashboard\", label: \"Dashboard\", icon: LayoutDashboard },\n  { type: \"link\", href: \"/admin/inventory\", label: \"Inventory\", icon: Package },\n  {\n    type: \"group\",\n    label: \"Analytics\",\n    icon: BarChart3,\n    groupKey: \"analytics\",\n    isActive: (pathname: string) => pathname.startsWith(\"/admin/analytics\"),\n    children: [\n      { href: \"/admin/analytics/traffic\", label: \"Traffic\" },\n      { href: \"/admin/analytics/financials\", label: \"Financials\" },\n    ],\n  },\n  {\n    type: \"group\",\n    label: \"Orders\",\n    icon: Truck,\n    groupKey: \"orders\",\n    isActive: (pathname: string) =>\n      pathname.startsWith(\"/admin/sales\") || pathname.startsWith(\"/admin/shipping\"),\n    children: [\n      { href: \"/admin/sales\", label: \"Sales\" },\n      { href: \"/admin/shipping\", label: \"Shipping\" },\n    ],\n  },\n  { type: \"link\", href: \"/admin/bank\", label: \"Bank\", icon: Landmark },\n  { type: \"link\", href: \"/admin/nexus\", label: \"Tax & Nexus\", icon: Receipt }, // Add this line\n  { type: \"link\", href: \"/admin/catalog\", label: \"Tags\", icon: Package },\n  {\n    type: \"group\",\n    label: \"Settings\",\n    icon: Settings,\n    groupKey: \"settings\",\n    isActive: (pathname: string) => pathname.startsWith(\"/admin/settings\"),\n    children: [\n      { href: \"/admin/settings/shipping\", label: \"Shipping\" },\n      { href: \"/admin/settings/taxes\", label: \"Taxes\" },\n      { href: \"/admin/settings/transfers\", label: \"Bank\" },\n    ],\n  },\n];\n\nexport function AdminSidebar({\n  userEmail: _userEmail,\n  role,\n}: {\n  userEmail?: string | null;\n  role: ProfileRole;\n}) {\n  const [isOpen, setIsOpen] = useState(false);\n  const [chatBadgeCount, setChatBadgeCount] = useState(0);\n  const [notifOpen, setNotifOpen] = useState(false);\n\n  const chatLastSenderRef = useRef(new Map<string, \"customer\" | \"admin\" | \"none\">());\n  const pathname = usePathname();\n\n  const analyticsActive = pathname.startsWith(\"/admin/analytics\");\n  const ordersActive =\n    pathname.startsWith(\"/admin/sales\") || pathname.startsWith(\"/admin/shipping\");\n  const settingsActive = pathname.startsWith(\"/admin/settings\");\n  const [openGroups, setOpenGroups] = useState({\n    analytics: false,\n    orders: false,\n    settings: false,\n  });\n\n  const [notifBadgeCount, setNotifBadgeCount] = useState<number | null>(null);\n\n  useEffect(() => {\n    if (!isOpen) {\n      return;\n    }\n    const prevOverflow = document.body.style.overflow;\n    document.body.style.overflow = \"hidden\";\n    return () => {\n      document.body.style.overflow = prevOverflow;\n    };\n  }, [isOpen]);\n\n  const refreshNotifCount = async () => {\n    try {\n      const res = await fetch(\"/api/admin/notifications/unread-count\", {\n        cache: \"no-store\",\n      });\n      if (!res.ok) {\n        return;\n      }\n      const data = await res.json();\n      if (typeof data.unreadCount === \"number\") {\n        setNotifBadgeCount(data.unreadCount);\n      }\n    } catch {\n      // keep last value; do not force 0\n    }\n  };\n\n  useEffect(() => {\n    refreshNotifCount();\n\n    const onUpdated = (e: Event) => {\n      const evt = e as CustomEvent;\n      const next = evt.detail?.unreadCount;\n      if (typeof next === \"number\") {\n        setNotifBadgeCount(next);\n      }\n    };\n\n    window.addEventListener(\"adminNotificationsUpdated\", onUpdated);\n    return () => window.removeEventListener(\"adminNotificationsUpdated\", onUpdated);\n  }, []);\n\n  // Auto-open group when you're inside it\n  useEffect(() => {\n    if (analyticsActive) {\n      setOpenGroups((prev) => ({ ...prev, analytics: true }));\n    }\n    if (ordersActive) {\n      setOpenGroups((prev) => ({ ...prev, orders: true }));\n    }\n    if (settingsActive) {\n      setOpenGroups((prev) => ({ ...prev, settings: true }));\n    }\n  }, [analyticsActive, ordersActive, settingsActive]);\n\n  useEffect(() => {\n    let isActive = true;\n\n    const loadChatBadge = async () => {\n      try {\n        const response = await fetch(\"/api/chats?status=open\", { cache: \"no-store\" });\n        const data = await response.json();\n        const chats = data.chats ?? [];\n        const nextMap = new Map<string, \"customer\" | \"admin\" | \"none\">();\n\n        chats.forEach((chat: any) => {\n          const lastMessage = chat.messages?.[0];\n          if (!lastMessage) {\n            nextMap.set(chat.id, \"none\");\n            return;\n          }\n          nextMap.set(chat.id, lastMessage.sender_role ?? \"none\");\n        });\n\n        chatLastSenderRef.current = nextMap;\n\n        const count = Array.from(nextMap.values()).filter(\n          (senderRole) => senderRole !== \"admin\",\n        ).length;\n        if (isActive) {\n          setChatBadgeCount(count);\n        }\n      } catch {\n        if (isActive) {\n          setChatBadgeCount(0);\n        }\n      }\n    };\n\n    loadChatBadge();\n\n    const supabase = createSupabaseBrowserClient();\n    const channel = supabase\n      .channel(\"admin-sidebar-chats\")\n      .on(\n        \"postgres_changes\",\n        { event: \"INSERT\", schema: \"public\", table: \"chats\" },\n        (payload) => {\n          const chat = payload.new as { id: string; status?: string | null };\n          if (chat.status && chat.status !== \"open\") {\n            return;\n          }\n          chatLastSenderRef.current.set(chat.id, \"none\");\n\n          if (isActive) {\n            const count = Array.from(chatLastSenderRef.current.values()).filter(\n              (senderRole) => senderRole !== \"admin\",\n            ).length;\n            setChatBadgeCount(count);\n          }\n        },\n      )\n      .on(\n        \"postgres_changes\",\n        { event: \"UPDATE\", schema: \"public\", table: \"chats\" },\n        (payload) => {\n          const chat = payload.new as { id: string; status?: string | null };\n          if (chat.status && chat.status !== \"open\") {\n            chatLastSenderRef.current.delete(chat.id);\n          } else if (!chatLastSenderRef.current.has(chat.id)) {\n            chatLastSenderRef.current.set(chat.id, \"none\");\n          }\n\n          if (isActive) {\n            const count = Array.from(chatLastSenderRef.current.values()).filter(\n              (senderRole) => senderRole !== \"admin\",\n            ).length;\n            setChatBadgeCount(count);\n          }\n        },\n      )\n      .on(\n        \"postgres_changes\",\n        { event: \"INSERT\", schema: \"public\", table: \"chat_messages\" },\n        (payload) => {\n          const message = payload.new as {\n            chat_id: string;\n            sender_role?: \"customer\" | \"admin\";\n          };\n          if (!chatLastSenderRef.current.has(message.chat_id)) {\n            return;\n          }\n\n          chatLastSenderRef.current.set(message.chat_id, message.sender_role ?? \"none\");\n\n          if (isActive) {\n            const count = Array.from(chatLastSenderRef.current.values()).filter(\n              (senderRole) => senderRole !== \"admin\",\n            ).length;\n            setChatBadgeCount(count);\n          }\n        },\n      )\n      .subscribe();\n\n    return () => {\n      isActive = false;\n      supabase.removeChannel(channel);\n    };\n  }, []);\n\n  function SidebarContent() {\n    const canViewBankTab = canViewBank(role);\n    const baseItemClass =\n      \"group flex items-center gap-3 px-4 py-3 border border-transparent bg-transparent \" +\n      \"hover:bg-zinc-950 hover:border-zinc-800/70 transition-colors rounded-sm\";\n\n    const activeItemClass = \"bg-zinc-950 border-zinc-800/70 text-white\";\n    const inactiveItemClass = \"text-gray-400\";\n\n    const inAdmin = pathname.startsWith(\"/admin\");\n\n    const statusBase =\n      \"flex w-full items-center gap-2 px-3 py-2 rounded-sm select-none \" +\n      \"text-[12px] sm:text-[13px] leading-none bg-zinc-950 text-white\";\n\n    const notifLabel =\n      typeof notifBadgeCount === \"number\" && notifBadgeCount > 9\n        ? \"9+\"\n        : String(notifBadgeCount ?? 0);\n\n    // Match notifications style: red text only, no box.\n    const chatLabel = chatBadgeCount > 9 ? \"9+\" : String(chatBadgeCount);\n\n    return (\n      <div className=\"flex flex-col h-full min-h-0 w-full\">\n        <div className=\"flex-1 min-h-0 overflow-y-auto space-y-4 pr-1 admin-sidebar-scroll\">\n          {/* Workspace Indicator (visual only) */}\n          <div className=\"mb-4\">\n            <div className=\"text-[11px] uppercase tracking-wider text-zinc-500 mb-2\">\n              Workspace\n            </div>\n\n            <div className={statusBase} aria-current=\"page\">\n              {inAdmin ? (\n                <>\n                  <LayoutDashboard className=\"w-4 h-4\" />\n                  <span className=\"font-medium\">Admin</span>\n                </>\n              ) : (\n                <>\n                  <Globe className=\"w-4 h-4\" />\n                  <span className=\"font-medium\">Website</span>\n                </>\n              )}\n            </div>\n\n            <div className=\"mt-4 border-t border-zinc-800/70\" />\n          </div>\n\n          <nav className=\"space-y-1\">\n            {navItems.map((item) => {\n              if (item.type === \"link\") {\n                if (item.href === \"/admin/bank\" && !canViewBankTab) {\n                  return null;\n                }\n                const icon = item.icon;\n                const isActive =\n                  item.href === \"/\" ? pathname === \"/\" : pathname.startsWith(item.href);\n\n                return (\n                  <Link\n                    key={item.href}\n                    href={item.href}\n                    onClick={() => setIsOpen(false)}\n                    className={`${baseItemClass} ${isActive ? activeItemClass : inactiveItemClass}`}\n                    data-testid={\n                      item.href === \"/admin/bank\" ? \"admin-nav-bank\" : undefined\n                    }\n                  >\n                    {createElement(icon, { className: \"w-5 h-5\" })}\n                    <span className=\"text-[13px] sm:text-[15px]\">{item.label}</span>\n                  </Link>\n                );\n              }\n\n              // group\n              const icon = item.icon;\n              const isGroupActive = item.isActive(pathname);\n              const isGroupOpen = openGroups[item.groupKey];\n              const chevron = isGroupOpen ? ChevronDown : ChevronRight;\n\n              const filteredChildren = item.children.filter(\n                (child) => child.href !== \"/admin/settings/transfers\" || canViewBankTab,\n              );\n              if (filteredChildren.length === 0) {\n                return null;\n              }\n\n              return (\n                <div key={item.label} className=\"space-y-1\">\n                  <button\n                    type=\"button\"\n                    onClick={() =>\n                      setOpenGroups((prev) => ({\n                        ...prev,\n                        [item.groupKey]: !prev[item.groupKey],\n                      }))\n                    }\n                    className={`${baseItemClass} w-full justify-between ${\n                      isGroupActive ? activeItemClass : inactiveItemClass\n                    }`}\n                    aria-expanded={isGroupOpen}\n                    aria-controls={`admin-${item.groupKey}-subnav`}\n                  >\n                    <span className=\"flex items-center gap-3\">\n                      {createElement(icon, { className: \"w-5 h-5\" })}\n                      <span className=\"text-[13px] sm:text-[15px]\">{item.label}</span>\n                    </span>\n                    {createElement(chevron, { className: \"w-4 h-4 opacity-80\" })}\n                  </button>\n\n                  {isGroupOpen && (\n                    <div\n                      id={`admin-${item.groupKey}-subnav`}\n                      className=\"ml-4 border-l border-zinc-800/70 pl-3 space-y-1\"\n                    >\n                      {filteredChildren.map((child) => {\n                        const isActive = pathname.startsWith(child.href);\n\n                        return (\n                          <Link\n                            key={child.href}\n                            href={child.href}\n                            onClick={() => setIsOpen(false)}\n                            className={`flex items-center px-3 py-2 border border-transparent rounded-sm transition-colors ${\n                              isActive\n                                ? \"bg-red-900/20 text-white border-red-900/30\"\n                                : \"text-gray-400 hover:bg-zinc-950 hover:border-zinc-800/70 hover:text-white\"\n                            }`}\n                          >\n                            <span className=\"text-[12px] sm:text-[14px]\">\n                              {child.label}\n                            </span>\n                          </Link>\n                        );\n                      })}\n                    </div>\n                  )}\n                </div>\n              );\n            })}\n          </nav>\n        </div>\n\n        {/* Bottom dock */}\n        <div className=\"sticky bottom-0 left-0 w-full flex-none self-stretch\">\n          {/* Full-width divider */}\n          <div className=\"-mx-6 w-[calc(100%+3rem)] border-t border-zinc-800/70\" />\n\n          {/* Dock background spans edge-to-edge (cancels parent p-6) */}\n          <div className=\"-mx-6 w-[calc(100%+3rem)] bg-zinc-950 px-6 py-3\">\n            <div className=\"grid w-full grid-cols-3 items-center\">\n              {/* Profile */}\n              <Tooltip label=\"Profile\" side=\"top\">\n                <Link\n                  href=\"/admin/profile\"\n                  onClick={() => setIsOpen(false)}\n                  aria-label=\"Profile\"\n                  className=\"flex h-12 w-full items-center justify-center rounded-sm\n                            hover:bg-zinc-900 transition-colors\n                            focus:outline-none focus-visible:ring-2 focus-visible:ring-red-600/40\"\n                >\n                  <User className=\"w-5 h-5 text-zinc-400 group-hover:text-white transition-colors\" />\n                </Link>\n              </Tooltip>\n\n              {/* Messages */}\n              <Tooltip label=\"Messages\" side=\"top\">\n                <Link\n                  href=\"/admin/chats\"\n                  onClick={() => setIsOpen(false)}\n                  aria-label=\"Messages\"\n                  className=\"flex h-12 w-full items-center justify-center rounded-sm\n                            hover:bg-zinc-900 transition-colors\n                            focus:outline-none focus-visible:ring-2 focus-visible:ring-red-600/40\"\n                >\n                  <span className=\"relative\">\n                    <MessageCircle className=\"w-5 h-5 text-zinc-400 group-hover:text-white transition-colors\" />\n                    {chatBadgeCount > 0 && (\n                      <span className=\"absolute -top-2 -right-2 text-[10px] font-semibold text-red-500\">\n                        {chatLabel}\n                      </span>\n                    )}\n                  </span>\n                </Link>\n              </Tooltip>\n\n              {/* Notifications */}\n              <Tooltip label=\"Notifications\" side=\"top\">\n                <button\n                  type=\"button\"\n                  onClick={() => setNotifOpen(true)}\n                  aria-label=\"Notifications\"\n                  data-testid=\"admin-notifications-toggle\"\n                  className=\"flex h-12 w-full items-center justify-center rounded-sm\n                            hover:bg-zinc-900 transition-colors\n                            focus:outline-none focus-visible:ring-2 focus-visible:ring-red-600/40\"\n                >\n                  <span className=\"relative\">\n                    <Bell className=\"w-5 h-5 text-zinc-400 group-hover:text-white transition-colors\" />\n                    {typeof notifBadgeCount === \"number\" && notifBadgeCount > 0 && (\n                      <span className=\"absolute -top-2 -right-2 text-[10px] font-semibold text-red-500\">\n                        {notifLabel}\n                      </span>\n                    )}\n                  </span>\n                </button>\n              </Tooltip>\n            </div>\n          </div>\n\n          <AdminNotificationsDrawer\n            isOpen={notifOpen}\n            onClose={() => setNotifOpen(false)}\n          />\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <>\n      <button\n        onClick={() => setIsOpen(true)}\n        className=\"md:hidden fixed top-5 right-5 z-40 bg-red-600 text-white p-3 rounded-sm shadow-lg\"\n        aria-label=\"Open admin menu\"\n      >\n        <Menu className=\"w-5 h-5\" />\n      </button>\n\n      {isOpen && (\n        <div className=\"md:hidden fixed inset-0 bg-black z-50 overscroll-contain\">\n          <div className=\"px-6 pt-6 pb-0 h-full flex flex-col\">\n            <div className=\"flex items-center justify-between mb-8\">\n              <h2 className=\"text-2xl font-bold text-white\">Admin Menu</h2>\n              <button\n                onClick={() => setIsOpen(false)}\n                className=\"text-gray-400 hover:text-white\"\n                aria-label=\"Close\"\n              >\n                <X className=\"w-6 h-6\" />\n              </button>\n            </div>\n            <div className=\"flex-1 min-h-0\">\n              <SidebarContent />\n            </div>\n          </div>\n        </div>\n      )}\n\n      <aside className=\"hidden md:block fixed left-0 top-0 w-64 h-screen bg-zinc-900 border-r border-zinc-800/70 p-6 z-40\">\n        <h2 className=\"text-2xl font-bold text-white mb-8\">Admin</h2>\n        <SidebarContent />\n      </aside>\n    </>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\admin\\AdminTopbar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\admin\\charts\\AdminLineChart.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":190,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":190,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4853,4856],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4853,4856],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":191,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":191,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4916,4919],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4916,4919],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":213,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":213,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5590,5593],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5590,5593],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/admin/charts/AdminLineChart.tsx\n\"use client\";\n\nimport React, { useEffect, useMemo, useRef, useState } from \"react\";\nimport { LineChart, Line, CartesianGrid, XAxis, YAxis, Tooltip } from \"recharts\";\n\ntype AdminLineChartProps<T extends Record<string, unknown>> = {\n  data: T[];\n  xKey: keyof T;\n  yKey: keyof T;\n  height?: number;\n  yLabel?: string;\n  seriesName?: string;\n  stroke?: string;\n  valueFormatter?: (value: number) => string;\n  emptyLabel?: string;\n};\n\nfunction toNumber(v: unknown): number {\n  if (typeof v === \"number\") {\n    return Number.isFinite(v) ? v : 0;\n  }\n  if (typeof v === \"string\") {\n    const n = Number(v);\n    return Number.isFinite(n) ? n : 0;\n  }\n  return 0;\n}\n\nfunction formatDateShort(input: unknown) {\n  const s = typeof input === \"string\" ? input : \"\";\n  const d = new Date(s);\n  if (Number.isNaN(d.getTime())) {\n    return s || \"\";\n  }\n  return new Intl.DateTimeFormat(\"en-US\", { month: \"short\", day: \"numeric\" }).format(d);\n}\n\nfunction niceStep(raw: number): number {\n  if (!Number.isFinite(raw) || raw <= 0) {\n    return 1;\n  }\n  const exp = Math.floor(Math.log10(raw));\n  const f = raw / Math.pow(10, exp);\n\n  let nf = 1;\n  if (f <= 1) {\n    nf = 1;\n  } else if (f <= 2) {\n    nf = 2;\n  } else if (f <= 5) {\n    nf = 5;\n  } else {\n    nf = 10;\n  }\n\n  return nf * Math.pow(10, exp);\n}\n\nfunction genTicks(min: number, max: number, step: number) {\n  const out: number[] = [];\n  if (\n    !Number.isFinite(min) ||\n    !Number.isFinite(max) ||\n    !Number.isFinite(step) ||\n    step <= 0\n  ) {\n    return out;\n  }\n\n  const start = Math.floor(min / step) * step;\n  const end = Math.ceil(max / step) * step;\n\n  const MAX_TICKS = 12_000;\n  let count = 0;\n\n  for (let v = start; v <= end + step / 2; v += step) {\n    out.push(Number(v.toFixed(12)));\n    count++;\n    if (count > MAX_TICKS) {\n      break;\n    }\n  }\n\n  return Array.from(new Set(out)).sort((a, b) => a - b);\n}\n\nfunction hasDuplicateLabels(values: number[], fmt: (n: number) => string) {\n  const labels = values.map((v) => fmt(v));\n  return new Set(labels).size !== labels.length;\n}\n\nexport function AdminLineChart<T extends Record<string, unknown>>({\n  data,\n  xKey,\n  yKey,\n  height = 320,\n  yLabel,\n  seriesName,\n  stroke = \"#ef4444\",\n  valueFormatter,\n  emptyLabel = \"No data for this range yet.\",\n}: AdminLineChartProps<T>) {\n  const [isCompact, setIsCompact] = useState(false);\n  const containerRef = useRef<HTMLDivElement | null>(null);\n  const [containerSize, setContainerSize] = useState({ width: 1, height: 1 });\n  const chartHeight = isCompact ? Math.max(220, Math.round(height * 0.8)) : height;\n  const yAxisWidth = isCompact ? 60 : 84;\n  const tickFontSize = isCompact ? 10 : 12;\n  const chartMargin = isCompact\n    ? { top: 8, right: 12, bottom: 6, left: 4 }\n    : { top: 8, right: 18, bottom: 8, left: 12 };\n\n  useEffect(() => {\n    if (typeof window === \"undefined\") {\n      return;\n    }\n    const media = window.matchMedia(\"(max-width: 640px)\");\n    const handleChange = () => setIsCompact(media.matches);\n    handleChange();\n\n    if (media.addEventListener) {\n      media.addEventListener(\"change\", handleChange);\n      return () => media.removeEventListener(\"change\", handleChange);\n    }\n\n    media.addListener(handleChange);\n    return () => media.removeListener(handleChange);\n  }, []);\n\n  useEffect(() => {\n    const el = containerRef.current;\n    if (!el) {\n      return;\n    }\n\n    let raf = 0;\n    const update = () => {\n      if (raf) {\n        cancelAnimationFrame(raf);\n      }\n      raf = requestAnimationFrame(() => {\n        const rect = el.getBoundingClientRect();\n        const parentWidth = el.parentElement?.clientWidth ?? 0;\n        const width = Math.max(\n          1,\n          Math.floor(el.clientWidth || rect.width || parentWidth),\n        );\n        const nextHeight = Math.max(\n          1,\n          Math.floor(el.clientHeight || rect.height || chartHeight),\n        );\n        const next = { width, height: nextHeight };\n        setContainerSize((prev) =>\n          prev.width === next.width && prev.height === next.height ? prev : next,\n        );\n      });\n    };\n\n    update();\n\n    if (typeof ResizeObserver !== \"undefined\") {\n      const observer = new ResizeObserver(update);\n      observer.observe(el);\n      return () => {\n        observer.disconnect();\n        if (raf) {\n          cancelAnimationFrame(raf);\n        }\n      };\n    }\n\n    window.addEventListener(\"resize\", update);\n    return () => {\n      window.removeEventListener(\"resize\", update);\n      if (raf) {\n        cancelAnimationFrame(raf);\n      }\n    };\n  }, [chartHeight, data.length]);\n\n  const normalized = useMemo(() => {\n    return (data || [])\n      .map((row) => ({\n        ...row,\n        __x: row[xKey],\n        __y: toNumber(row[yKey]),\n      }))\n      .sort((a, b) => {\n        const da = new Date(String((a as any).__x)).getTime();\n        const db = new Date(String((b as any).__x)).getTime();\n        if (Number.isNaN(da) || Number.isNaN(db)) {\n          return 0;\n        }\n        return da - db;\n      });\n  }, [data, xKey, yKey]);\n\n  const fmt = valueFormatter ?? ((v: number) => String(v));\n  const displayName = seriesName ?? yLabel ?? \"Value\";\n\n  // IMPORTANT: This hook must run on every render (even when empty)\n  const yAxis = useMemo(() => {\n    // Default axis so hook is safe even when there's no data\n    if (normalized.length === 0) {\n      return {\n        domain: [0, 1] as [number, number],\n        ticks: [0, 1] as number[],\n        allowDecimals: false,\n      };\n    }\n\n    const yVals = normalized.map((r) => toNumber((r as any).__y));\n    const yMinData = yVals.length ? Math.min(...yVals) : 0;\n    const yMaxData = yVals.length ? Math.max(...yVals) : 0;\n\n    const min = Math.min(0, yMinData);\n    const max = Math.max(0, yMaxData);\n\n    // Keep chart readable if all zeros\n    const domainMax = max === 0 ? 1 : max;\n\n    const isIntegerSeries = yVals.every((v) => Number.isInteger(v));\n    const wantIntegers = isIntegerSeries;\n\n    let step: number;\n\n    if (wantIntegers) {\n      if (domainMax <= 12) {\n        step = 1;\n      } else {\n        step = Math.max(1, niceStep((domainMax - min) / 5));\n      }\n    } else {\n      step = niceStep((domainMax - min) / 5);\n    }\n\n    let ticks = genTicks(min, domainMax, step);\n\n    // If formatter collapses values into duplicate labels (ex: 0.2 and 0.4 both show \"0\"),\n    // increase step until labels are unique.\n    let attempts = 0;\n    while (ticks.length > 2 && hasDuplicateLabels(ticks, fmt) && attempts < 8) {\n      step *= 2;\n      ticks = genTicks(min, domainMax, step);\n      attempts++;\n    }\n\n    // Cap tick count for readability\n    const MAX_TICKS_SHOWN = 12;\n    if (ticks.length > MAX_TICKS_SHOWN) {\n      const stride = Math.ceil(ticks.length / MAX_TICKS_SHOWN);\n      ticks = ticks.filter((_, idx) => idx % stride === 0);\n      if (ticks[ticks.length - 1] !== domainMax) {\n        ticks.push(domainMax);\n      }\n    }\n\n    return {\n      domain: [min, domainMax] as [number, number],\n      ticks,\n      allowDecimals: !wantIntegers,\n    };\n  }, [normalized, fmt]);\n\n  // Now it's safe to return early (hooks already ran)\n  if (normalized.length === 0) {\n    return (\n      <div\n        className=\"flex items-center justify-center border border-zinc-800/70 rounded-lg bg-zinc-950/40\"\n        style={{ height: chartHeight }}\n      >\n        <div className=\"text-center space-y-2\">\n          <div className=\"text-white/90 font-medium\">Nothing to chart</div>\n          <div className=\"text-sm text-gray-400\">{emptyLabel}</div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"w-full min-w-0\">\n      <div\n        ref={containerRef}\n        style={{ height: chartHeight, minHeight: chartHeight }}\n        className=\"w-full min-w-0\"\n      >\n        <LineChart\n          width={Math.max(1, containerSize.width)}\n          height={Math.max(1, containerSize.height)}\n          data={normalized}\n          margin={chartMargin}\n        >\n          <CartesianGrid strokeDasharray=\"3 6\" opacity={0.25} />\n          <XAxis\n            dataKey=\"__x\"\n            tickFormatter={formatDateShort}\n            axisLine={false}\n            tickLine={false}\n            minTickGap={18}\n            tick={{ fontSize: tickFontSize }}\n          />\n          <YAxis\n            domain={yAxis.domain}\n            ticks={yAxis.ticks}\n            allowDecimals={yAxis.allowDecimals}\n            tickFormatter={(v) => fmt(toNumber(v))}\n            axisLine={false}\n            tickLine={false}\n            width={yAxisWidth}\n            tick={{ fontSize: tickFontSize }}\n            label={\n              yLabel && !isCompact\n                ? { value: yLabel, angle: -90, position: \"insideLeft\", offset: 6 }\n                : undefined\n            }\n          />\n          <Tooltip\n            formatter={(v) => [fmt(toNumber(v)), displayName]}\n            labelFormatter={(l) => `Date: ${formatDateShort(l)}`}\n            contentStyle={{\n              background: \"rgba(9, 9, 11, 0.92)\",\n              border: \"1px solid rgba(39, 39, 42, 0.7)\",\n              borderRadius: 10,\n            }}\n            itemStyle={{ color: \"rgba(244, 244, 245, 0.9)\" }}\n            labelStyle={{ color: \"rgba(244, 244, 245, 0.9)\" }}\n          />\n          <Line\n            type=\"monotone\"\n            dataKey=\"__y\"\n            name={displayName}\n            stroke={stroke}\n            strokeWidth={2}\n            dot={normalized.length === 1}\n            activeDot={{ r: 4, stroke }}\n          />\n        </LineChart>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\admin\\charts\\SalesChart.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\admin\\charts\\TrafficChart.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\admin\\nexus\\HomeOfficeSetupModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":164,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":164,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4513,4516],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4513,4516],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/admin/nexus/HomeOfficeSetupModal.tsx\n\"use client\";\n\nimport React, { useMemo, useState, useEffect } from \"react\";\nimport { X, Building, AlertTriangle } from \"lucide-react\";\n\nimport { STATE_NAMES } from \"@/config/constants/nexus-thresholds\";\nimport { ModalPortal } from \"@/components/ui/ModalPortal\";\nimport { RdkSelect } from \"@/components/ui/Select\";\n\ntype HomeOfficeSetupModalProps = {\n  onClose: () => void;\n  onSuccess: () => void;\n  title?: string;\n  isConfigured?: boolean;\n};\n\ntype ExistingAddress = {\n  line1: string;\n  line2?: string | null;\n  city: string;\n  state: string;\n  postal_code: string;\n  country: string;\n};\n\ntype OldHomeOfficeAction = {\n  hasPhysicalNexus: boolean;\n  continueCollecting: boolean;\n};\n\nexport default function HomeOfficeSetupModal({\n  onClose,\n  onSuccess,\n  title,\n  isConfigured = false,\n}: HomeOfficeSetupModalProps) {\n  const [formData, setFormData] = useState({\n    stateCode: \"\",\n    businessName: \"\",\n    line1: \"\",\n    line2: \"\",\n    city: \"\",\n    postalCode: \"\",\n  });\n  const [existingAddress, setExistingAddress] = useState<ExistingAddress | null>(null);\n  const [oldHomeState, setOldHomeState] = useState<string | null>(null);\n  const [showOldHomeAction, setShowOldHomeAction] = useState(false);\n  const [oldHomeAction, setOldHomeAction] = useState<OldHomeOfficeAction>({\n    hasPhysicalNexus: true,\n    continueCollecting: true,\n  });\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  const stateOptions = useMemo(\n    () =>\n      Object.entries(STATE_NAMES).map(([code, name]) => ({\n        value: code,\n        label: `${name} (${code})`,\n      })),\n    [],\n  );\n\n  useEffect(() => {\n    if (isConfigured) {\n      fetchExistingAddress();\n    } else {\n      setIsLoading(false);\n    }\n  }, [isConfigured]);\n\n  const fetchExistingAddress = async () => {\n    try {\n      setIsLoading(true);\n      const [addressRes, summaryRes] = await Promise.all([\n        fetch(\"/api/admin/nexus/head-office-address\"),\n        fetch(\"/api/admin/nexus/summary\"),\n      ]);\n\n      if (addressRes.ok) {\n        const { address } = await addressRes.json();\n        if (address) {\n          setExistingAddress(address);\n          setFormData({\n            stateCode: address.state || \"\",\n            businessName: \"\",\n            line1: address.line1 || \"\",\n            line2: address.line2 || \"\",\n            city: address.city || \"\",\n            postalCode: address.postal_code || \"\",\n          });\n        }\n      }\n\n      if (summaryRes.ok) {\n        const summary = await summaryRes.json();\n        setOldHomeState(summary.homeState);\n      }\n    } catch (err) {\n      console.error(\"Failed to fetch existing address:\", err);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError(null);\n\n    if (\n      !formData.stateCode ||\n      !formData.line1 ||\n      !formData.city ||\n      !formData.postalCode\n    ) {\n      setError(\"Please fill in all required fields\");\n      return;\n    }\n\n    // If changing home office and state is different, show old home action dialog\n    if (isConfigured && oldHomeState && formData.stateCode !== oldHomeState) {\n      setShowOldHomeAction(true);\n      return;\n    }\n\n    await submitHomeOffice();\n  };\n\n  const submitHomeOffice = async () => {\n    try {\n      setIsSubmitting(true);\n      const res = await fetch(\"/api/admin/nexus/setup-home\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          stateCode: formData.stateCode,\n          businessName: formData.businessName || undefined,\n          address: {\n            line1: formData.line1,\n            line2: formData.line2 || undefined,\n            city: formData.city,\n            state: formData.stateCode,\n            postalCode: formData.postalCode,\n            country: \"US\",\n          },\n          oldHomeState:\n            isConfigured && oldHomeState !== formData.stateCode\n              ? oldHomeState\n              : undefined,\n          oldHomeAction:\n            isConfigured && oldHomeState !== formData.stateCode\n              ? oldHomeAction\n              : undefined,\n        }),\n      });\n\n      const result = await res.json();\n      if (!res.ok) {\n        throw new Error(result.error || \"Failed to setup home office\");\n      }\n      onSuccess();\n    } catch (err: any) {\n      setError(err.message || \"Failed to setup home office\");\n      setShowOldHomeAction(false);\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  const handleOldHomeActionSubmit = async () => {\n    await submitHomeOffice();\n  };\n\n  if (isLoading) {\n    return (\n      <ModalPortal open={true} onClose={onClose}>\n        <div className=\"w-full max-w-2xl bg-zinc-950 border border-zinc-800/70 rounded-sm shadow-xl p-8\">\n          <div className=\"text-center text-zinc-400\">Loading...</div>\n        </div>\n      </ModalPortal>\n    );\n  }\n\n  if (showOldHomeAction && oldHomeState) {\n    return (\n      <ModalPortal open={true} onClose={() => setShowOldHomeAction(false)}>\n        <div\n          className=\"w-full max-w-xl bg-zinc-950 border border-zinc-800/70 rounded-sm shadow-xl\"\n          onClick={(e) => e.stopPropagation()}\n        >\n          <div className=\"flex items-start justify-between px-6 py-4 border-b border-zinc-800/70\">\n            <div className=\"flex items-center gap-3\">\n              <AlertTriangle className=\"w-6 h-6 text-yellow-500\" />\n              <div>\n                <h2 className=\"text-xl font-semibold text-white\">\n                  Update Previous Home Office\n                </h2>\n                <p className=\"text-sm text-zinc-400 mt-1\">\n                  What should we do with {STATE_NAMES[oldHomeState]} ({oldHomeState})?\n                </p>\n              </div>\n            </div>\n            <button\n              onClick={() => setShowOldHomeAction(false)}\n              className=\"p-2 border border-zinc-800/70 hover:border-zinc-600 rounded-sm\"\n            >\n              <X className=\"w-4 h-4 text-zinc-300\" />\n            </button>\n          </div>\n\n          <div className=\"px-6 py-6 space-y-6\">\n            <div className=\"p-4 bg-yellow-900/20 border border-yellow-500/30 rounded-sm\">\n              <p className=\"text-sm text-yellow-300 mb-2\">\n                You're moving your home office from{\" \"}\n                <strong>{STATE_NAMES[oldHomeState]}</strong> to{\" \"}\n                <strong>{STATE_NAMES[formData.stateCode]}</strong>. Please specify your\n                ongoing relationship with the old state.\n              </p>\n              <p className=\"text-xs text-yellow-200/80 mt-2\">\n                <strong>Important:</strong> Most states require you to continue collecting\n                sales tax through the end of the current tax year even after moving your\n                office location. Consult with a tax professional before disabling\n                collection.\n              </p>\n            </div>\n\n            <div className=\"space-y-4\">\n              <div>\n                <label className=\"block text-sm text-zinc-300 mb-3 font-medium\">\n                  Do you still have physical nexus in {STATE_NAMES[oldHomeState]}?\n                </label>\n                <div className=\"flex gap-3\">\n                  <button\n                    type=\"button\"\n                    onClick={() =>\n                      setOldHomeAction({ ...oldHomeAction, hasPhysicalNexus: true })\n                    }\n                    className={[\n                      \"flex-1 px-4 py-3 rounded-sm text-sm border transition-colors\",\n                      oldHomeAction.hasPhysicalNexus\n                        ? \"bg-red-600 text-white border-red-600\"\n                        : \"bg-zinc-900 text-zinc-300 border-zinc-800/70 hover:bg-zinc-800\",\n                    ].join(\" \")}\n                  >\n                    Yes, I have physical presence\n                  </button>\n                  <button\n                    type=\"button\"\n                    onClick={() =>\n                      setOldHomeAction({ ...oldHomeAction, hasPhysicalNexus: false })\n                    }\n                    className={[\n                      \"flex-1 px-4 py-3 rounded-sm text-sm border transition-colors\",\n                      !oldHomeAction.hasPhysicalNexus\n                        ? \"bg-red-600 text-white border-red-600\"\n                        : \"bg-zinc-900 text-zinc-300 border-zinc-800/70 hover:bg-zinc-800\",\n                    ].join(\" \")}\n                  >\n                    No, only economic nexus\n                  </button>\n                </div>\n              </div>\n\n              <div>\n                <label className=\"block text-sm text-zinc-300 mb-3 font-medium\">\n                  Should we continue collecting tax in {STATE_NAMES[oldHomeState]}?\n                </label>\n                <p className=\"text-xs text-zinc-400 mb-3\">\n                  Most states require you to continue collecting through the end of the\n                  current tax year. Only select \"No\" if you've confirmed with your state's\n                  tax authority or a tax professional.\n                </p>\n                <div className=\"flex gap-3\">\n                  <button\n                    type=\"button\"\n                    onClick={() =>\n                      setOldHomeAction({ ...oldHomeAction, continueCollecting: true })\n                    }\n                    className={[\n                      \"flex-1 px-4 py-3 rounded-sm text-sm border transition-colors\",\n                      oldHomeAction.continueCollecting\n                        ? \"bg-red-600 text-white border-red-600\"\n                        : \"bg-zinc-900 text-zinc-300 border-zinc-800/70 hover:bg-zinc-800\",\n                    ].join(\" \")}\n                  >\n                    Yes, keep collecting tax (Recommended)\n                  </button>\n                  <button\n                    type=\"button\"\n                    onClick={() =>\n                      setOldHomeAction({ ...oldHomeAction, continueCollecting: false })\n                    }\n                    className={[\n                      \"flex-1 px-4 py-3 rounded-sm text-sm border transition-colors\",\n                      !oldHomeAction.continueCollecting\n                        ? \"bg-red-600 text-white border-red-600\"\n                        : \"bg-zinc-900 text-zinc-300 border-zinc-800/70 hover:bg-zinc-800\",\n                    ].join(\" \")}\n                  >\n                    No, stop collecting tax\n                  </button>\n                </div>\n              </div>\n            </div>\n\n            {error && (\n              <div className=\"p-3 bg-red-900/20 border border-red-800/50 rounded-sm text-red-300 text-sm\">\n                {error}\n              </div>\n            )}\n\n            <div className=\"flex gap-3 pt-2\">\n              <button\n                onClick={() => {\n                  void handleOldHomeActionSubmit();\n                }}\n                disabled={isSubmitting}\n                className=\"flex-1 px-4 py-2.5 bg-red-600 hover:bg-red-500 text-white rounded-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                {isSubmitting ? \"Updating...\" : \"Confirm Changes\"}\n              </button>\n              <button\n                type=\"button\"\n                onClick={() => setShowOldHomeAction(false)}\n                className=\"px-4 py-2.5 bg-zinc-900 hover:bg-zinc-800 text-white rounded-sm border border-zinc-800/70\"\n              >\n                Cancel\n              </button>\n            </div>\n          </div>\n        </div>\n      </ModalPortal>\n    );\n  }\n\n  return (\n    <ModalPortal open={true} onClose={onClose}>\n      <div\n        className=\"w-full max-w-2xl max-h-[92vh] overflow-y-auto bg-zinc-950 border border-zinc-800/70 rounded-sm shadow-xl\"\n        onClick={(e) => e.stopPropagation()}\n      >\n        <div className=\"flex items-start justify-between px-6 py-4 border-b border-zinc-800/70\">\n          <div className=\"flex items-center gap-3\">\n            <Building className=\"w-6 h-6 text-red-500\" />\n            <div>\n              <h2 className=\"text-xl font-semibold text-white\">\n                {title ?? (isConfigured ? \"Change Office Location\" : \"Setup Home Office\")}\n              </h2>\n              <p className=\"text-sm text-zinc-400 mt-1\">\n                {isConfigured\n                  ? \"Update your business address for tax registrations\"\n                  : \"Configure your business address to enable tax registrations\"}\n              </p>\n            </div>\n          </div>\n\n          <button\n            onClick={onClose}\n            className=\"p-2 border border-zinc-800/70 hover:border-zinc-600 rounded-sm\"\n          >\n            <X className=\"w-4 h-4 text-zinc-300\" />\n          </button>\n        </div>\n\n        <div className=\"px-6 py-6\">\n          {existingAddress && (\n            <div className=\"mb-6 p-4 bg-zinc-900 border border-zinc-800/70 rounded-sm\">\n              <div className=\"text-sm text-zinc-300 font-semibold mb-2\">\n                Current Address\n              </div>\n              <div className=\"text-sm text-zinc-400 space-y-1\">\n                <div>{existingAddress.line1}</div>\n                {existingAddress.line2 && <div>{existingAddress.line2}</div>}\n                <div>\n                  {existingAddress.city}, {existingAddress.state}{\" \"}\n                  {existingAddress.postal_code}\n                </div>\n              </div>\n            </div>\n          )}\n\n          {error && (\n            <div className=\"mb-4 p-3 bg-red-900/20 border border-red-800/50 rounded-sm text-red-300 text-sm\">\n              {error}\n            </div>\n          )}\n\n          <form\n            onSubmit={(event) => {\n              void handleSubmit(event);\n            }}\n            className=\"space-y-4\"\n          >\n            <div>\n              <label className=\"block text-sm text-zinc-300 mb-2\">\n                Business Name (Optional)\n              </label>\n              <input\n                type=\"text\"\n                value={formData.businessName}\n                onChange={(e) =>\n                  setFormData({ ...formData, businessName: e.target.value })\n                }\n                className=\"w-full px-4 py-2.5 bg-zinc-950 text-white rounded-sm border border-zinc-800/70 focus:outline-none focus:ring-2 focus:ring-red-600\"\n                placeholder=\"Your Business Name\"\n              />\n            </div>\n\n            <div>\n              <label className=\"block text-sm text-zinc-300 mb-2\">\n                Home State <span className=\"text-red-500\">*</span>\n              </label>\n              <RdkSelect\n                value={formData.stateCode}\n                onChange={(v) => setFormData({ ...formData, stateCode: v })}\n                options={stateOptions}\n                placeholder=\"Select\"\n              />\n            </div>\n\n            <div>\n              <label className=\"block text-sm text-zinc-300 mb-2\">\n                Address Line 1 <span className=\"text-red-500\">*</span>\n              </label>\n              <input\n                type=\"text\"\n                value={formData.line1}\n                onChange={(e) => setFormData({ ...formData, line1: e.target.value })}\n                className=\"w-full px-4 py-2.5 bg-zinc-950 text-white rounded-sm border border-zinc-800/70 focus:outline-none focus:ring-2 focus:ring-red-600\"\n                placeholder=\"123 Main Street\"\n                required\n              />\n            </div>\n\n            <div>\n              <label className=\"block text-sm text-zinc-300 mb-2\">Address Line 2</label>\n              <input\n                type=\"text\"\n                value={formData.line2}\n                onChange={(e) => setFormData({ ...formData, line2: e.target.value })}\n                className=\"w-full px-4 py-2.5 bg-zinc-950 text-white rounded-sm border border-zinc-800/70 focus:outline-none focus:ring-2 focus:ring-red-600\"\n                placeholder=\"Suite 100\"\n              />\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <label className=\"block text-sm text-zinc-300 mb-2\">\n                  City <span className=\"text-red-500\">*</span>\n                </label>\n                <input\n                  type=\"text\"\n                  value={formData.city}\n                  onChange={(e) => setFormData({ ...formData, city: e.target.value })}\n                  className=\"w-full px-4 py-2.5 bg-zinc-950 text-white rounded-sm border border-zinc-800/70 focus:outline-none focus:ring-2 focus:ring-red-600\"\n                  placeholder=\"Charleston\"\n                  required\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm text-zinc-300 mb-2\">\n                  Postal Code <span className=\"text-red-500\">*</span>\n                </label>\n                <input\n                  type=\"text\"\n                  value={formData.postalCode}\n                  onChange={(e) =>\n                    setFormData({ ...formData, postalCode: e.target.value })\n                  }\n                  className=\"w-full px-4 py-2.5 bg-zinc-950 text-white rounded-sm border border-zinc-800/70 focus:outline-none focus:ring-2 focus:ring-red-600\"\n                  placeholder=\"29401\"\n                  required\n                />\n              </div>\n            </div>\n\n            <div className=\"flex gap-3 pt-2\">\n              <button\n                type=\"submit\"\n                disabled={isSubmitting}\n                className=\"flex-1 px-4 py-2.5 bg-red-600 hover:bg-red-500 text-white rounded-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                {isSubmitting\n                  ? \"Saving...\"\n                  : isConfigured\n                    ? \"Update Home Office\"\n                    : \"Setup Home Office\"}\n              </button>\n              <button\n                type=\"button\"\n                onClick={onClose}\n                className=\"px-4 py-2.5 bg-zinc-900 hover:bg-zinc-800 text-white rounded-sm border border-zinc-800/70\"\n              >\n                Cancel\n              </button>\n            </div>\n          </form>\n\n          <div className=\"mt-6 p-4 bg-zinc-900 border border-zinc-800/70 rounded-sm\">\n            <p className=\"text-sm text-zinc-400\">\n              <strong className=\"text-zinc-200\">Note:</strong> This address will be used\n              as your tax registration headquarters with Stripe Tax.{\" \"}\n              {!isConfigured && \"It will mark your home state for physical nexus.\"}\n            </p>\n          </div>\n        </div>\n      </div>\n    </ModalPortal>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\admin\\nexus\\NexusMap.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":110,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2728,2731],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2728,2731],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":216,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":216,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5308,5311],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5308,5311],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/admin/nexus/NexusMap.tsx\n\"use client\";\n\nimport { useEffect, useMemo, useRef, useState, useCallback } from \"react\";\nimport { ComposableMap, Geographies, Geography } from \"@vnedyalk0v/react19-simple-maps\";\n\nimport type { StateSummary } from \"@/types/domain/nexus\";\n\ntype NexusMapProps = {\n  states: StateSummary[];\n  onStateClick: (state: StateSummary) => void;\n  getStateColor: (state: StateSummary | undefined) => string;\n  formatCurrency: (val: number) => string;\n  // NEW: provide legend items so the key can live inside this card\n  legendItems: Array<{ label: string; color: string }>;\n};\n\nconst STATE_NAME_TO_CODE: Record<string, string> = {\n  Alabama: \"AL\",\n  Alaska: \"AK\",\n  Arizona: \"AZ\",\n  Arkansas: \"AR\",\n  California: \"CA\",\n  Colorado: \"CO\",\n  Connecticut: \"CT\",\n  Delaware: \"DE\",\n  Florida: \"FL\",\n  Georgia: \"GA\",\n  Hawaii: \"HI\",\n  Idaho: \"ID\",\n  Illinois: \"IL\",\n  Indiana: \"IN\",\n  Iowa: \"IA\",\n  Kansas: \"KS\",\n  Kentucky: \"KY\",\n  Louisiana: \"LA\",\n  Maine: \"ME\",\n  Maryland: \"MD\",\n  Massachusetts: \"MA\",\n  Michigan: \"MI\",\n  Minnesota: \"MN\",\n  Mississippi: \"MS\",\n  Missouri: \"MO\",\n  Montana: \"MT\",\n  Nebraska: \"NE\",\n  Nevada: \"NV\",\n  \"New Hampshire\": \"NH\",\n  \"New Jersey\": \"NJ\",\n  \"New Mexico\": \"NM\",\n  \"New York\": \"NY\",\n  \"North Carolina\": \"NC\",\n  \"North Dakota\": \"ND\",\n  Ohio: \"OH\",\n  Oklahoma: \"OK\",\n  Oregon: \"OR\",\n  Pennsylvania: \"PA\",\n  \"Rhode Island\": \"RI\",\n  \"South Carolina\": \"SC\",\n  \"South Dakota\": \"SD\",\n  Tennessee: \"TN\",\n  Texas: \"TX\",\n  Utah: \"UT\",\n  Vermont: \"VT\",\n  Virginia: \"VA\",\n  Washington: \"WA\",\n  \"West Virginia\": \"WV\",\n  Wisconsin: \"WI\",\n  Wyoming: \"WY\",\n  \"District of Columbia\": \"DC\",\n};\n\ntype Point = { x: number; y: number };\n\nfunction svgPointToContainer(\n  svgEl: SVGSVGElement,\n  containerEl: HTMLElement,\n  svgX: number,\n  svgY: number,\n): Point {\n  const pt = svgEl.createSVGPoint();\n  pt.x = svgX;\n  pt.y = svgY;\n\n  const ctm = svgEl.getScreenCTM();\n  if (!ctm) {\n    return { x: 0, y: 0 };\n  }\n\n  const screen = pt.matrixTransform(ctm);\n  const containerRect = containerEl.getBoundingClientRect();\n\n  return { x: screen.x - containerRect.left, y: screen.y - containerRect.top };\n}\n\nexport default function NexusMap({\n  states,\n  onStateClick,\n  getStateColor,\n  formatCurrency,\n  legendItems,\n}: NexusMapProps) {\n  const containerRef = useRef<HTMLDivElement | null>(null);\n  const svgRef = useRef<SVGSVGElement | null>(null);\n\n  const [hoveredState, setHoveredState] = useState<string | null>(null);\n  const [anchor, setAnchor] = useState<Point | null>(null);\n\n  const stateMap = useMemo(() => new Map(states.map((s) => [s.stateCode, s])), [states]);\n  const hoveredData = hoveredState ? stateMap.get(hoveredState) : null;\n  const [topology, setTopology] = useState<any>(null);\n\n  useEffect(() => {\n    let alive = true;\n\n    fetch(\"/api/maps/us-states\", { cache: \"force-cache\" })\n      .then((r) => {\n        if (!r.ok) {\n          throw new Error(`Map fetch failed: ${r.status}`);\n        }\n        return r.json();\n      })\n      .then((json) => {\n        if (alive) {\n          setTopology(json);\n        }\n      })\n      .catch((err) => {\n        console.error(\"Failed to load map topology:\", err);\n      });\n\n    return () => {\n      alive = false;\n    };\n  }, []);\n\n  const clearHover = useCallback(() => {\n    setHoveredState(null);\n    setAnchor(null);\n  }, []);\n\n  const setAnchorFromPath = useCallback((pathEl: SVGPathElement | null) => {\n    const container = containerRef.current;\n    const svg = svgRef.current;\n    if (!container || !svg || !pathEl) {\n      return;\n    }\n\n    const bbox = pathEl.getBBox();\n    const cx = bbox.x + bbox.width / 2;\n    const cy = bbox.y + bbox.height / 2;\n\n    setAnchor(svgPointToContainer(svg, container, cx, cy));\n  }, []);\n\n  // Tooltip sizing/position\n  const tooltipWidth = 280;\n\n  const tooltipPos = useMemo(() => {\n    if (!anchor) {\n      return null;\n    }\n    const container = containerRef.current;\n    if (!container) {\n      return null;\n    }\n\n    const rect = container.getBoundingClientRect();\n    const padding = 12;\n\n    // Prefer right side; clamp inside container\n    let left = anchor.x + 18;\n    let top = anchor.y - 140;\n\n    if (left + tooltipWidth + padding > rect.width) {\n      left = Math.max(padding, anchor.x - tooltipWidth - 18);\n    }\n    if (left < padding) {\n      left = padding;\n    }\n\n    if (top < padding) {\n      top = padding;\n    }\n    if (top > rect.height - 190) {\n      top = rect.height - 190;\n    }\n\n    return { left, top };\n  }, [anchor]);\n\n  return (\n    <div className=\"bg-zinc-900 border border-zinc-800 rounded-lg p-6 relative\">\n      <div className=\"flex items-center justify-between mb-4\">\n        <h2 className=\"text-lg font-bold text-white\">United States Nexus Map</h2>\n      </div>\n\n      <div\n        ref={containerRef}\n        className=\"relative\"\n        onMouseMove={(e) => {\n          if (!hoveredState) {\n            return;\n          }\n          const t = e.target as Element | null;\n          if (t?.tagName?.toLowerCase() !== \"path\") {\n            clearHover();\n          }\n        }}\n        onMouseLeave={clearHover}\n      >\n        <ComposableMap\n          projection=\"geoAlbersUsa\"\n          projectionConfig={{ scale: 1000 }}\n          className=\"w-full h-full\"\n          style={{ maxHeight: \"560px\" }}\n          ref={(node: any) => {\n            svgRef.current = node as SVGSVGElement | null;\n          }}\n        >\n          <Geographies geography={topology}>\n            {({ geographies }) =>\n              geographies.map((geo) => {\n                const stateName = geo.properties.name as string;\n                const stateCode = STATE_NAME_TO_CODE[stateName];\n                const stateData = stateCode ? stateMap.get(stateCode) : undefined;\n\n                return (\n                  <Geography\n                    key={`${geo.rsmKey}-${geo.id ?? stateName}`}\n                    geography={geo}\n                    fill={getStateColor(stateData)}\n                    stroke=\"#1f2937\"\n                    strokeWidth={0.6}\n                    style={{\n                      default: {\n                        outline: \"none\",\n                        transition:\n                          \"transform 160ms ease, filter 160ms ease, opacity 160ms ease\",\n                        transformBox: \"fill-box\",\n                        transformOrigin: \"center\",\n                        transform: \"scale(1)\",\n                        opacity: 1,\n                      },\n                      hover: {\n                        outline: \"none\",\n                        cursor: stateData ? \"pointer\" : \"default\",\n                        transformBox: \"fill-box\",\n                        transformOrigin: \"center\",\n                        transform: \"scale(1.045)\",\n                        filter: \"drop-shadow(0px 3px 8px rgba(0,0,0,0.55))\",\n                        opacity: 0.96,\n                      },\n                      pressed: { outline: \"none\" },\n                    }}\n                    onMouseEnter={(e) => {\n                      if (!stateCode) {\n                        return;\n                      }\n                      setHoveredState(stateCode);\n                      setAnchorFromPath(e.currentTarget as unknown as SVGPathElement);\n                    }}\n                    onMouseLeave={clearHover}\n                    onClick={() => {\n                      if (stateData) {\n                        onStateClick(stateData);\n                      }\n                    }}\n                  />\n                );\n              })\n            }\n          </Geographies>\n        </ComposableMap>\n\n        {/* Tooltip */}\n        {hoveredData && anchor && tooltipPos && (\n          <div className=\"pointer-events-none absolute inset-0 z-50\">\n            <div\n              className=\"absolute rounded-full border border-white/70 bg-white/20 shadow-sm\"\n              style={{ left: anchor.x - 4, top: anchor.y - 4, width: 8, height: 8 }}\n            />\n\n            <div\n              className=\"absolute transition-all duration-150 ease-out\"\n              style={{ left: tooltipPos.left, top: tooltipPos.top, width: tooltipWidth }}\n            >\n              <div className=\"bg-zinc-900 border border-zinc-700 rounded-lg p-4 shadow-xl\">\n                <div className=\"font-bold mb-2 text-white text-lg\">\n                  {hoveredData.stateName} ({hoveredData.stateCode})\n                </div>\n\n                <div className=\"text-sm space-y-1 text-gray-300\">\n                  <div>Sales: {formatCurrency(hoveredData.relevantSales)}</div>\n                  <div>Threshold: {formatCurrency(hoveredData.threshold)}</div>\n                  <div className=\"font-semibold text-white pt-1\">\n                    {hoveredData.percentageToThreshold.toFixed(1)}% to threshold\n                  </div>\n\n                  {hoveredData.isRegistered && (\n                    <div className=\"text-green-400 text-xs pt-1\">Registered</div>\n                  )}\n                  {hoveredData.isHomeState && (\n                    <div className=\"text-blue-400 text-xs pt-1\">Home Office State</div>\n                  )}\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* Legend ALWAYS at bottom (never inside tooltip) */}\n        <div className=\"mt-2 grid grid-cols-3 gap-x-2 gap-y-1 sm:flex sm:flex-nowrap sm:items-center sm:gap-2\">\n          {legendItems.map((it) => (\n            <div key={it.label} className=\"flex items-center gap-1.5 min-w-0\">\n              <div\n                className=\"w-2 h-2 rounded shrink-0\"\n                style={{ backgroundColor: it.color }}\n              />\n              <span className=\"text-[9px] leading-none tracking-tight text-gray-400 whitespace-nowrap\">\n                {it.label}\n              </span>\n            </div>\n          ))}\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\admin\\nexus\\NexusTrackerClient.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":197,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":197,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5526,5529],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5526,5529],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/admin/nexus/NexusTrackerClient.tsx (UPDATED)\n\"use client\";\n\nimport React, { useState, useEffect, useMemo } from \"react\";\nimport Link from \"next/link\";\nimport {\n  AlertCircle,\n  CheckCircle,\n  AlertTriangle,\n  Search,\n  Download,\n  Home,\n} from \"lucide-react\";\n\nimport { RdkSelect } from \"@/components/ui/Select\";\nimport type { NexusData, StateSummary } from \"@/types/domain/nexus\";\n\nimport NexusMap from \"./NexusMap\";\nimport StateDetailModal from \"./StateDetailModal\";\nimport HomeOfficeSetupModal from \"./HomeOfficeSetupModal\";\n\nexport default function NexusTrackerClient() {\n  const [data, setData] = useState<NexusData | null>(null);\n  const [selectedState, setSelectedState] = useState<StateSummary | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [isUpdating, setIsUpdating] = useState(false);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [sortField, setSortField] = useState<keyof StateSummary>(\"percentageToThreshold\");\n  const [sortDirection, setSortDirection] = useState<\"asc\" | \"desc\">(\"desc\");\n  const [filterRegistered, setFilterRegistered] = useState<\n    \"all\" | \"registered\" | \"unregistered\"\n  >(\"all\");\n  const [filterNexusType, setFilterNexusType] = useState<\"all\" | \"physical\" | \"economic\">(\n    \"all\",\n  );\n  const [filterWindow, setFilterWindow] = useState<\"all\" | \"calendar\" | \"rolling\">(\"all\");\n  const [filterNeedsAction, setFilterNeedsAction] = useState(false);\n  const [showHomeSetup, setShowHomeSetup] = useState(false);\n  const [isHomeOfficeConfigured, setIsHomeOfficeConfigured] = useState(false);\n\n  useEffect(() => {\n    fetchNexusData();\n    checkHomeOfficeStatus();\n  }, []);\n\n  const fetchNexusData = async () => {\n    try {\n      setLoading(true);\n      const res = await fetch(\"/api/admin/nexus/summary\", { cache: \"no-store\" });\n\n      if (!res.ok) {\n        throw new Error(`Failed: ${res.status}`);\n      }\n\n      const json = await res.json();\n      setData(json as NexusData);\n    } catch (err) {\n      console.error(\"Failed to fetch nexus data:\", err);\n      setData(null);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const checkHomeOfficeStatus = async () => {\n    try {\n      const res = await fetch(\"/api/admin/nexus/home-office-status\");\n      if (res.ok) {\n        const { configured } = await res.json();\n        setIsHomeOfficeConfigured(configured);\n      }\n    } catch (err) {\n      console.error(\"Failed to check home office status:\", err);\n    }\n  };\n\n  const filterRegisteredOptions = useMemo(\n    () => [\n      { value: \"all\", label: \"All States\" },\n      { value: \"registered\", label: \"Registered Only\" },\n      { value: \"unregistered\", label: \"Unregistered Only\" },\n    ],\n    [],\n  );\n\n  const nexusTypeOptions = useMemo(\n    () => [\n      { value: \"all\", label: \"All Nexus Types\" },\n      { value: \"physical\", label: \"Physical\" },\n      { value: \"economic\", label: \"Economic\" },\n    ],\n    [],\n  );\n\n  const windowOptions = useMemo(\n    () => [\n      { value: \"all\", label: \"All Windows\" },\n      { value: \"calendar\", label: \"Calendar Year\" },\n      { value: \"rolling\", label: \"Rolling 12 Months\" },\n    ],\n    [],\n  );\n\n  const handleDownloadTaxDocs = () => {\n    window.open(\"https://dashboard.stripe.com/tax/reports\", \"_blank\");\n  };\n\n  const getStateColor = (state: StateSummary | undefined) => {\n    if (!state) {\n      return \"#374151\";\n    }\n    if (state.thresholdType === \"none\" || state.threshold <= 0) {\n      return \"#374151\";\n    }\n\n    if (state.isRegistered) {\n      return \"#22c55e\";\n    }\n\n    const pct = state.percentageToThreshold;\n\n    if (pct < 50) {\n      return \"#374151\";\n    }\n    if (pct < 70) {\n      return \"#facc15\";\n    }\n    if (pct < 85) {\n      return \"#f59e0b\";\n    }\n    if (pct < 95) {\n      return \"#f97316\";\n    }\n    return \"#ef4444\";\n  };\n\n  const legendItems = useMemo(\n    () => [\n      { label: \"Registered\", color: \"#22c55e\" },\n      { label: \"< 50%\", color: \"#374151\" },\n      { label: \"50-70%\", color: \"#facc15\" },\n      { label: \"70-85%\", color: \"#f59e0b\" },\n      { label: \"85-95%\", color: \"#f97316\" },\n      { label: \"> 95%\", color: \"#ef4444\" },\n    ],\n    [],\n  );\n\n  const formatCurrency = (val: number) =>\n    new Intl.NumberFormat(\"en-US\", {\n      style: \"currency\",\n      currency: \"USD\",\n      maximumFractionDigits: 0,\n    }).format(val);\n\n  const handleRegisterToggle = async (\n    stateCode: string,\n    currentRegistered: boolean,\n    nexusType: \"physical\" | \"economic\",\n  ) => {\n    if (!isHomeOfficeConfigured && !currentRegistered) {\n      setShowHomeSetup(true);\n      return;\n    }\n\n    try {\n      setIsUpdating(true);\n      const res = await fetch(\"/api/admin/nexus/register\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          stateCode,\n          registrationType: nexusType,\n          isRegistered: !currentRegistered,\n        }),\n      });\n\n      const result = await res.json();\n\n      if (!res.ok) {\n        if (result.error && result.error.includes(\"head office\")) {\n          setShowHomeSetup(true);\n          alert(\"Please set up your home office address first.\");\n          return;\n        }\n        throw new Error(result.error);\n      }\n\n      await fetchNexusData();\n\n      if (selectedState?.stateCode === stateCode) {\n        const updatedState = data?.states.find((s) => s.stateCode === stateCode);\n        if (updatedState) {\n          setSelectedState({ ...updatedState, isRegistered: !currentRegistered });\n        }\n      }\n    } catch (err: any) {\n      console.error(\"Failed to toggle registration:\", err);\n      alert(err.message || \"Failed to update registration\");\n    } finally {\n      setIsUpdating(false);\n    }\n  };\n\n  const handleNexusTypeChange = async (\n    stateCode: string,\n    newType: \"physical\" | \"economic\",\n  ) => {\n    try {\n      setIsUpdating(true);\n\n      // Just update the nexus type, don't auto-register\n      const res = await fetch(\"/api/admin/nexus/nexus-type\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          stateCode,\n          nexusType: newType,\n        }),\n      });\n\n      if (!res.ok) {\n        const result = await res.json();\n        throw new Error(result.error || \"Failed to update nexus type\");\n      }\n\n      await fetchNexusData();\n\n      if (selectedState?.stateCode === stateCode) {\n        const updatedState = data?.states.find((s) => s.stateCode === stateCode);\n        if (updatedState) {\n          setSelectedState({ ...updatedState, nexusType: newType });\n        }\n      }\n    } catch (err) {\n      console.error(\"Failed to change nexus type:\", err);\n    } finally {\n      setIsUpdating(false);\n    }\n  };\n\n  const handleSort = (field: keyof StateSummary) => {\n    if (sortField === field) {\n      setSortDirection(sortDirection === \"asc\" ? \"desc\" : \"asc\");\n    } else {\n      setSortField(field);\n      setSortDirection(field === \"percentageToThreshold\" ? \"desc\" : \"asc\");\n    }\n  };\n\n  const sortIndicator = (field: keyof StateSummary) =>\n    sortField === field ? (sortDirection === \"asc\" ? \"^\" : \"v\") : \"\";\n\n  const filteredAndSortedStates = useMemo(() => {\n    if (!data) {\n      return [];\n    }\n\n    let filtered = data.states.filter((state) => {\n      if (searchQuery) {\n        const query = searchQuery.toLowerCase();\n        if (\n          !state.stateName.toLowerCase().includes(query) &&\n          !state.stateCode.toLowerCase().includes(query)\n        ) {\n          return false;\n        }\n      }\n\n      if (filterRegistered === \"registered\" && !state.isRegistered) {\n        return false;\n      }\n      if (filterRegistered === \"unregistered\" && state.isRegistered) {\n        return false;\n      }\n\n      if (filterNexusType === \"physical\" && state.nexusType !== \"physical\") {\n        return false;\n      }\n      if (filterNexusType === \"economic\" && state.nexusType !== \"economic\") {\n        return false;\n      }\n\n      if (filterWindow === \"calendar\" && state.window !== \"calendar\") {\n        return false;\n      }\n      if (filterWindow === \"rolling\" && state.window !== \"rolling 12 months\") {\n        return false;\n      }\n\n      if (filterNeedsAction) {\n        const needsRegistration = state.nexusType === \"physical\" && !state.isRegistered;\n        const atRisk =\n          state.nexusType === \"economic\" &&\n          !state.isRegistered &&\n          state.percentageToThreshold >= 85;\n        if (!needsRegistration && !atRisk) {\n          return false;\n        }\n      }\n\n      return true;\n    });\n\n    filtered.sort((a, b) => {\n      const aVal = a[sortField];\n      const bVal = b[sortField];\n\n      if (typeof aVal === \"number\" && typeof bVal === \"number\") {\n        return sortDirection === \"asc\" ? aVal - bVal : bVal - aVal;\n      }\n\n      if (typeof aVal === \"string\" && typeof bVal === \"string\") {\n        return sortDirection === \"asc\"\n          ? aVal.localeCompare(bVal)\n          : bVal.localeCompare(aVal);\n      }\n\n      return 0;\n    });\n\n    return filtered;\n  }, [\n    data,\n    searchQuery,\n    sortField,\n    sortDirection,\n    filterRegistered,\n    filterNexusType,\n    filterWindow,\n    filterNeedsAction,\n  ]);\n\n  if (loading) {\n    return (\n      <div className=\"p-8\">\n        <div className=\"text-white\">Loading nexus data...</div>\n      </div>\n    );\n  }\n\n  if (!data) {\n    return (\n      <div className=\"p-8\">\n        <div className=\"text-white\">Failed to load nexus data</div>\n      </div>\n    );\n  }\n\n  const atRiskStates = data.states.filter(\n    (s) => s.nexusType === \"economic\" && !s.isRegistered && s.percentageToThreshold >= 85,\n  ).length;\n\n  const registeredStates = data.states.filter((s) => s.isRegistered).length;\n\n  const needsRegistrationCount = data.states.filter(\n    (s) => s.nexusType === \"physical\" && !s.isRegistered,\n  ).length;\n\n  const homeStateLabel = data.homeState; // e.g. \"SC\"\n  const taxEnabled = data.taxEnabled;\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex flex-col md:flex-row md:items-start md:justify-between gap-4\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-white mb-2\">Sales Tax Nexus Tracker</h1>\n          <p className=\"text-gray-400\">\n            Monitor your sales tax obligations across all US states\n          </p>\n        </div>\n\n        <div className=\"flex flex-wrap items-center gap-3\">\n          <button\n            onClick={handleDownloadTaxDocs}\n            disabled={!taxEnabled}\n            className={[\n              \"flex items-center gap-2 px-4 py-2 rounded-sm text-white\",\n              taxEnabled\n                ? \"bg-red-600 hover:bg-red-500\"\n                : \"bg-zinc-800 text-zinc-500 cursor-not-allowed\",\n            ].join(\" \")}\n          >\n            <Download className=\"w-4 h-4\" />\n            View Tax Reports in Stripe\n          </button>\n\n          {/* Home state badge next to the home office button */}\n          <div className=\"flex items-center gap-2\">\n            <button\n              onClick={() => setShowHomeSetup(true)}\n              className={`flex items-center gap-2 h-10 px-4 rounded-lg text-white ${\n                isHomeOfficeConfigured\n                  ? \"bg-zinc-800 hover:bg-zinc-700\"\n                  : \"bg-red-600 hover:bg-red-700\"\n              }`}\n            >\n              <Home className=\"w-4 h-4\" />\n              {isHomeOfficeConfigured ? \"Change Home Office\" : \"Setup Home Office\"}\n            </button>\n\n            {/* Home state pill to the RIGHT of the button */}\n            <div\n              className=\"flex items-center gap-2 h-10 px-3 rounded-lg border border-zinc-800 bg-zinc-900 text-white shadow-sm\"\n              title=\"Registered home state\"\n            >\n              <span className=\"text-[10px] uppercase tracking-wide text-gray-400\">\n                Home\n              </span>\n              <span className=\"text-sm font-bold text-white\">{homeStateLabel}</span>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {!taxEnabled && (\n        <div className=\"bg-yellow-900/20 border border-yellow-500/30 rounded-sm p-4 flex items-start gap-3\">\n          <AlertTriangle className=\"w-5 h-5 text-yellow-400 mt-0.5\" />\n          <div className=\"text-sm text-yellow-100\">\n            Taxes are turned off. Go to{\" \"}\n            <Link\n              href=\"/admin/settings/taxes\"\n              className=\"underline underline-offset-2 text-yellow-200 hover:text-yellow-100\"\n            >\n              Settings &gt; Taxes\n            </Link>{\" \"}\n            to enable tax collection before using the nexus tracker.\n          </div>\n        </div>\n      )}\n\n      {/* Home Office Setup Modal */}\n      {showHomeSetup && (\n        <HomeOfficeSetupModal\n          onClose={() => setShowHomeSetup(false)}\n          onSuccess={() => {\n            setShowHomeSetup(false);\n            setIsHomeOfficeConfigured(true);\n            fetchNexusData();\n          }}\n          isConfigured={isHomeOfficeConfigured}\n        />\n      )}\n\n      {/* Modal for State Details */}\n      {selectedState && (\n        <StateDetailModal\n          state={selectedState}\n          onClose={() => setSelectedState(null)}\n          onRegisterToggle={(stateCode, currentRegistered, nexusType) => {\n            void handleRegisterToggle(stateCode, currentRegistered, nexusType);\n          }}\n          onNexusTypeChange={(stateCode, newType) => {\n            void handleNexusTypeChange(stateCode, newType);\n          }}\n          isUpdating={isUpdating}\n          formatCurrency={formatCurrency}\n          isHomeOfficeConfigured={isHomeOfficeConfigured}\n          onOpenHomeOffice={() => setShowHomeSetup(true)}\n        />\n      )}\n\n      {/* US Map */}\n      <NexusMap\n        states={data.states}\n        onStateClick={setSelectedState}\n        getStateColor={getStateColor}\n        formatCurrency={formatCurrency}\n        legendItems={legendItems}\n      />\n\n      {/* Stats + Filters UNDER the map */}\n      <div className=\"space-y-4\">\n        {/* Stats Cards (3 only, per request) */}\n        <div className=\"grid grid-cols-3 md:grid-cols-3 gap-2 sm:gap-4\">\n          <div className=\"bg-zinc-900 border border-zinc-800 rounded-lg p-3 sm:p-4 flex flex-col\">\n            <p className=\"text-[10px] sm:text-xs text-gray-400 mb-2\">Registered States</p>\n            <div className=\"mt-auto flex items-center justify-between\">\n              <p className=\"text-base sm:text-2xl font-bold text-white\">\n                {registeredStates}\n              </p>\n              <span className=\"inline-flex items-center justify-center w-6 h-6 sm:w-8 sm:h-8 rounded-full bg-green-500/10\">\n                <CheckCircle className=\"w-3.5 h-3.5 sm:w-5 sm:h-5 text-green-500\" />\n              </span>\n            </div>\n          </div>\n\n          <div className=\"bg-zinc-900 border border-zinc-800 rounded-lg p-3 sm:p-4 flex flex-col\">\n            <p className=\"text-[10px] sm:text-xs text-gray-400 mb-2\">At Risk States</p>\n            <div className=\"mt-auto flex items-center justify-between\">\n              <p className=\"text-base sm:text-2xl font-bold text-white\">{atRiskStates}</p>\n              <span className=\"inline-flex items-center justify-center w-6 h-6 sm:w-8 sm:h-8 rounded-full bg-red-500/10\">\n                <AlertCircle className=\"w-3.5 h-3.5 sm:w-5 sm:h-5 text-red-500\" />\n              </span>\n            </div>\n          </div>\n\n          <div className=\"bg-zinc-900 border border-zinc-800 rounded-lg p-3 sm:p-4 flex flex-col\">\n            <p className=\"text-[10px] sm:text-xs text-gray-400 mb-2\">\n              Needs Registration\n            </p>\n            <div className=\"mt-auto flex items-center justify-between\">\n              <p className=\"text-base sm:text-2xl font-bold text-white\">\n                {needsRegistrationCount}\n              </p>\n              <span className=\"inline-flex items-center justify-center w-6 h-6 sm:w-8 sm:h-8 rounded-full bg-yellow-500/10\">\n                <AlertTriangle className=\"w-3.5 h-3.5 sm:w-5 sm:h-5 text-yellow-500\" />\n              </span>\n            </div>\n          </div>\n        </div>\n\n        {/* Filters and Search */}\n        <div className=\"bg-zinc-900 border border-zinc-800 rounded-lg p-3 sm:p-4\">\n          <div className=\"flex flex-wrap gap-3 items-center\">\n            <div className=\"flex-1 min-w-[160px]\">\n              <div className=\"relative\">\n                <Search className=\"absolute left-2.5 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-gray-400\" />\n                <input\n                  type=\"text\"\n                  placeholder=\"Search states...\"\n                  value={searchQuery}\n                  onChange={(e) => setSearchQuery(e.target.value)}\n                  className=\"w-full h-8 pl-8 pr-2.5 py-1 text-[11px] sm:text-sm bg-zinc-950 text-white rounded-sm border border-zinc-800/70 focus:outline-none focus:ring-2 focus:ring-red-600\"\n                />\n              </div>\n            </div>\n\n            <RdkSelect\n              value={filterRegistered}\n              onChange={(v) =>\n                setFilterRegistered(v as \"all\" | \"registered\" | \"unregistered\")\n              }\n              options={filterRegisteredOptions}\n              className=\"min-w-[160px]\"\n              buttonClassName=\"h-8 py-1 text-[11px] sm:text-sm\"\n              menuClassName=\"text-[11px] sm:text-sm\"\n            />\n\n            <RdkSelect\n              value={filterNexusType}\n              onChange={(v) => setFilterNexusType(v as \"all\" | \"physical\" | \"economic\")}\n              options={nexusTypeOptions}\n              className=\"min-w-[160px]\"\n              buttonClassName=\"h-8 py-1 text-[11px] sm:text-sm\"\n              menuClassName=\"text-[11px] sm:text-sm\"\n            />\n\n            <RdkSelect\n              value={filterWindow}\n              onChange={(v) => setFilterWindow(v as \"all\" | \"calendar\" | \"rolling\")}\n              options={windowOptions}\n              className=\"min-w-[160px]\"\n              buttonClassName=\"h-8 py-1 text-[11px] sm:text-sm\"\n              menuClassName=\"text-[11px] sm:text-sm\"\n            />\n\n            <label className=\"flex items-center gap-1.5 text-[11px] sm:text-sm text-white leading-none\">\n              <input\n                type=\"checkbox\"\n                checked={filterNeedsAction}\n                onChange={(e) => setFilterNeedsAction(e.target.checked)}\n                className=\"rdk-checkbox scale-90\"\n              />\n              Needs Action Only\n            </label>\n          </div>\n        </div>\n      </div>\n\n      {/* States Table */}\n      <div className=\"bg-zinc-900 border border-zinc-800 rounded-lg overflow-hidden\">\n        <table className=\"w-full text-[12px] sm:text-sm\">\n          <thead className=\"bg-zinc-800\">\n            <tr>\n              <th\n                className=\"px-3 py-3 text-left font-medium text-white cursor-pointer hover:bg-zinc-700\"\n                onClick={() => handleSort(\"stateName\")}\n              >\n                State {sortIndicator(\"stateName\")}\n              </th>\n              <th\n                className=\"hidden md:table-cell px-3 py-3 text-left font-medium text-white cursor-pointer hover:bg-zinc-700\"\n                onClick={() => handleSort(\"threshold\")}\n              >\n                Threshold {sortIndicator(\"threshold\")}\n              </th>\n              <th\n                className=\"hidden md:table-cell px-3 py-3 text-left font-medium text-white cursor-pointer hover:bg-zinc-700\"\n                onClick={() => handleSort(\"relevantSales\")}\n              >\n                Sales {sortIndicator(\"relevantSales\")}\n              </th>\n              <th\n                className=\"hidden md:table-cell px-3 py-3 text-left font-medium text-white cursor-pointer hover:bg-zinc-700\"\n                onClick={() => handleSort(\"percentageToThreshold\")}\n              >\n                Progress {sortIndicator(\"percentageToThreshold\")}\n              </th>\n              <th className=\"hidden md:table-cell px-3 py-3 text-left font-medium text-white\">\n                Type\n              </th>\n              <th className=\"hidden md:table-cell px-3 py-3 text-left font-medium text-white\">\n                Status\n              </th>\n              <th className=\"px-3 py-3 text-left font-medium text-white\">\n                <span className=\"hidden md:inline\">Actions</span>\n                <span className=\"md:hidden\">Details</span>\n              </th>\n            </tr>\n          </thead>\n\n          <tbody className=\"divide-y divide-zinc-800\">\n            {filteredAndSortedStates.map((state) => (\n              <tr key={state.stateCode} className=\"hover:bg-zinc-800/50\">\n                <td className=\"px-3 py-3\">\n                  <div className=\"flex items-center gap-2\">\n                    <div\n                      className=\"w-3 h-3 rounded\"\n                      style={{ backgroundColor: getStateColor(state) }}\n                    />\n                    <span className=\"font-medium text-white\">{state.stateName}</span>\n                    {state.isHomeState && (\n                      <span className=\"text-xs text-red-400\">(Home)</span>\n                    )}\n                    {state.nexusType === \"physical\" && !state.isRegistered && (\n                      <span\n                        title=\"Physical nexus - needs registration\"\n                        className=\"inline-flex\"\n                      >\n                        <AlertTriangle className=\"w-4 h-4 text-yellow-500\" />\n                      </span>\n                    )}\n                  </div>\n                </td>\n                <td className=\"hidden md:table-cell px-3 py-3 text-gray-300\">\n                  {formatCurrency(state.threshold)}\n                </td>\n                <td className=\"hidden md:table-cell px-3 py-3 text-gray-300\">\n                  {formatCurrency(state.relevantSales)}\n                </td>\n                <td className=\"hidden md:table-cell px-3 py-3\">\n                  <div className=\"flex items-center gap-2\">\n                    <div className=\"flex-1 bg-zinc-800 rounded-full h-2 overflow-hidden\">\n                      <div\n                        className=\"h-full transition-all\"\n                        style={{\n                          width: `${Math.min(state.percentageToThreshold, 100)}%`,\n                          backgroundColor: getStateColor(state),\n                        }}\n                      />\n                    </div>\n                    <span className=\"text-xs text-gray-400 w-12\">\n                      {state.percentageToThreshold.toFixed(0)}%\n                    </span>\n                  </div>\n                </td>\n                <td className=\"hidden md:table-cell px-3 py-3\">\n                  <span className=\"px-2 py-1 bg-zinc-800 text-white rounded text-xs\">\n                    {state.nexusType}\n                  </span>\n                </td>\n                <td className=\"hidden md:table-cell px-3 py-3\">\n                  {state.isRegistered ? (\n                    <div className=\"flex flex-col gap-1\">\n                      <span className=\"flex items-center gap-1 text-sm text-green-400\">\n                        <CheckCircle className=\"w-4 h-4\" />\n                        Registered\n                      </span>\n                      {state.stripeRegistered && (\n                        <span className=\"text-xs text-gray-500\">With Stripe</span>\n                      )}\n                    </div>\n                  ) : (\n                    <span className=\"flex items-center gap-1 text-sm text-gray-400\">\n                      <AlertCircle className=\"w-4 h-4 text-zinc-500\" />\n                      Not Registered\n                    </span>\n                  )}\n                </td>\n                <td className=\"px-3 py-3\">\n                  <button\n                    onClick={() => setSelectedState(state)}\n                    className=\"text-[12px] sm:text-sm text-red-400 hover:text-red-300\"\n                  >\n                    Details\n                  </button>\n                </td>\n              </tr>\n            ))}\n          </tbody>\n        </table>\n\n        {filteredAndSortedStates.length === 0 && (\n          <div className=\"p-8 text-center text-gray-400\">\n            No states match your filters\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\admin\\nexus\\StateDetailModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\admin\\settings\\TaxSettingsPanel.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":104,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":104,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3025,3028],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3025,3028],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":112,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":112,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3305,3308],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3305,3308],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/admin/settings/TaxSettingsPanel.tsx\n\"use client\";\n\nimport { useEffect, useMemo, useState } from \"react\";\n\nimport { ToggleSwitch } from \"@/components/ui/ToggleSwitch\";\nimport { PRODUCT_TAX_CODES } from \"@/config/constants/nexus-thresholds\";\nimport { logError } from \"@/lib/log\";\n\nconst TAX_CATEGORIES = [\n  { key: \"sneakers\", label: \"Sneakers\" },\n  { key: \"clothing\", label: \"Clothing\" },\n  { key: \"accessories\", label: \"Accessories\" },\n  { key: \"electronics\", label: \"Electronics\" },\n];\n\ntype TaxSettingsResponse = {\n  settings?: {\n    taxEnabled?: boolean;\n    taxCodeOverrides?: Record<string, string>;\n  };\n};\n\nconst normalizeTaxCode = (value: string) => value.trim();\n\nexport function TaxSettingsPanel() {\n  const [isLoading, setIsLoading] = useState(true);\n  const [isSaving, setIsSaving] = useState(false);\n  const [message, setMessage] = useState<string | null>(null);\n  const [taxEnabled, setTaxEnabled] = useState(false);\n  const [taxCodeOverrides, setTaxCodeOverrides] = useState<Record<string, string>>({});\n\n  useEffect(() => {\n    const loadSettings = async () => {\n      try {\n        const response = await fetch(\"/api/admin/tax-settings\", { cache: \"no-store\" });\n        const data = (await response.json().catch(() => ({}))) as TaxSettingsResponse;\n        if (data.settings) {\n          setTaxEnabled(data.settings.taxEnabled ?? false);\n          setTaxCodeOverrides(data.settings.taxCodeOverrides ?? {});\n        }\n      } catch (error) {\n        logError(error, { layer: \"frontend\", event: \"admin_tax_settings_load\" });\n      } finally {\n        setIsLoading(false);\n      }\n    };\n\n    loadSettings();\n  }, []);\n\n  const effectiveCodes = useMemo(\n    () =>\n      TAX_CATEGORIES.map((category) => {\n        const override = taxCodeOverrides[category.key];\n        const defaultCode = PRODUCT_TAX_CODES[category.key];\n        return {\n          ...category,\n          override: override ?? \"\",\n          defaultCode,\n          effectiveCode: override ? override : defaultCode,\n        };\n      }),\n    [taxCodeOverrides],\n  );\n\n  const handleCodeChange = (key: string, value: string) => {\n    const cleaned = normalizeTaxCode(value);\n    setTaxCodeOverrides((prev) => {\n      const next = { ...prev };\n      if (!cleaned) {\n        delete next[key];\n      } else {\n        next[key] = cleaned;\n      }\n      return next;\n    });\n  };\n\n  const resetToDefault = (key: string) => {\n    setTaxCodeOverrides((prev) => {\n      const next = { ...prev };\n      delete next[key];\n      return next;\n    });\n  };\n\n  const handleSave = async () => {\n    setIsSaving(true);\n    setMessage(null);\n\n    try {\n      const response = await fetch(\"/api/admin/tax-settings\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          taxEnabled,\n          taxCodeOverrides,\n        }),\n      });\n\n      const data = (await response.json().catch(() => ({}))) as TaxSettingsResponse;\n      if (!response.ok) {\n        throw new Error((data as any)?.error ?? \"Failed to save tax settings.\");\n      }\n\n      if (data.settings) {\n        setTaxEnabled(data.settings.taxEnabled ?? false);\n        setTaxCodeOverrides(data.settings.taxCodeOverrides ?? {});\n      }\n      setMessage(\"Tax settings updated.\");\n    } catch (error: any) {\n      logError(error, { layer: \"frontend\", event: \"admin_tax_settings_save\" });\n      setMessage(error?.message ?? \"Failed to save tax settings.\");\n    } finally {\n      setIsSaving(false);\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"bg-zinc-900 border border-zinc-800 rounded p-4 sm:p-6 text-[12px] sm:text-sm text-gray-400\">\n        Loading tax settings...\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"bg-zinc-900 border border-zinc-800 rounded p-4 sm:p-6 space-y-6\">\n      <div className=\"flex flex-wrap items-start justify-between gap-4\">\n        <div>\n          <h2 className=\"text-base sm:text-lg font-semibold text-white\">\n            Tax collection\n          </h2>\n          <p className=\"text-xs sm:text-sm text-gray-400\">\n            Toggle Stripe Tax calculations and assign category tax codes.\n          </p>\n        </div>\n        <div className=\"flex items-center gap-3\">\n          <span className=\"text-[12px] sm:text-sm text-gray-400\">\n            {taxEnabled ? \"Enabled\" : \"Disabled\"}\n          </span>\n          <ToggleSwitch\n            checked={taxEnabled}\n            onChange={setTaxEnabled}\n            ariaLabel=\"Toggle tax collection\"\n            disabled={isSaving}\n          />\n        </div>\n      </div>\n\n      {!taxEnabled && (\n        <div className=\"bg-yellow-900/20 border border-yellow-500/30 rounded-sm p-3 sm:p-4 text-[12px] sm:text-sm text-yellow-100\">\n          Taxes are turned off. Enable taxes to collect and track nexus activity.\n        </div>\n      )}\n\n      <div className=\"space-y-4\">\n        <div>\n          <h3 className=\"text-sm sm:text-base font-semibold text-white\">\n            Category tax codes\n          </h3>\n          <p className=\"text-xs sm:text-sm text-gray-400\">\n            Stripe Tax uses these codes to determine the correct tax rules per category.\n          </p>\n          <div className=\"mt-2 text-[11px] sm:text-xs text-gray-500\">\n            Tax codes are Stripe identifiers (ex: txcd_30011000) that map to product\n            taxability.{\" \"}\n            <a\n              href=\"https://docs.stripe.com/tax/tax-codes\"\n              target=\"_blank\"\n              rel=\"noreferrer\"\n              className=\"text-red-400 hover:text-red-300 underline underline-offset-2\"\n            >\n              View Stripe tax code list\n            </a>\n            .\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-4\">\n          {effectiveCodes.map((category) => (\n            <div\n              key={category.key}\n              className=\"border border-zinc-800/70 rounded p-4 bg-zinc-950/40 space-y-3\"\n            >\n              <div className=\"flex items-start justify-between gap-3\">\n                <div>\n                  <div className=\"text-[12px] sm:text-sm font-semibold text-white\">\n                    {category.label}\n                  </div>\n                  <div className=\"text-[11px] sm:text-xs text-gray-500\">\n                    Default: {category.defaultCode}\n                  </div>\n                </div>\n                <div className=\"text-[11px] sm:text-xs text-gray-400\">\n                  Effective:{\" \"}\n                  <span className=\"text-gray-200\">{category.effectiveCode}</span>\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-1 sm:grid-cols-[1fr_auto] gap-2\">\n                <input\n                  type=\"text\"\n                  value={category.override}\n                  onChange={(e) => handleCodeChange(category.key, e.target.value)}\n                  disabled={!taxEnabled || isSaving}\n                  placeholder={category.defaultCode}\n                  className=\"w-full bg-zinc-950 text-white px-3 py-1.5 sm:py-2 text-[12px] sm:text-sm border border-zinc-800/70 rounded disabled:opacity-60\"\n                />\n                <button\n                  type=\"button\"\n                  onClick={() => resetToDefault(category.key)}\n                  disabled={!taxEnabled || isSaving || !category.override}\n                  className=\"px-3 py-1.5 sm:py-2 text-[11px] sm:text-xs border border-zinc-800/70 text-gray-300 hover:border-zinc-700 disabled:opacity-50\"\n                >\n                  Use default\n                </button>\n              </div>\n\n              <div className=\"text-[11px] sm:text-xs text-gray-500\">\n                Leave blank to use the default Stripe tax code for this category.\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      <div className=\"flex items-center gap-4\">\n        <button\n          type=\"button\"\n          onClick={() => {\n            void handleSave();\n          }}\n          disabled={isSaving}\n          className=\"px-5 py-2 bg-red-600 hover:bg-red-700 text-white text-[12px] sm:text-sm rounded disabled:bg-gray-600\"\n        >\n          {isSaving ? \"Saving...\" : \"Save tax settings\"}\n        </button>\n        {message && (\n          <span className=\"text-[12px] sm:text-sm text-gray-400\">{message}</span>\n        )}\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\admin\\shipping\\CreateLabelForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":49,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[980,983],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[980,983],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":56,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1162,1165],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1162,1165],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":64,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1333,1336],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1333,1336],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/admin/shipping/CreateLabelForm.tsx\n\"use client\";\n\nimport { useEffect, useMemo, useState } from \"react\";\nimport { X, AlertCircle, CheckCircle2 } from \"lucide-react\";\n\nimport { ModalPortal } from \"@/components/ui/ModalPortal\";\n\ntype ShippingAddressDraft = {\n  name: string;\n  phone: string;\n  line1: string;\n  line2: string;\n  city: string;\n  state: string;\n  postal_code: string;\n  country: string;\n};\n\ntype ParcelDraft = {\n  weight: number;\n  length: number;\n  width: number;\n  height: number;\n};\n\ntype AddressValidationStatus = \"idle\" | \"validating\" | \"valid\" | \"invalid\";\n\ntype AddressErrors = {\n  line1?: string;\n  city?: string;\n  state?: string;\n  postal_code?: string;\n  country?: string;\n};\n\ntype EasyPostRate = {\n  id: string;\n  carrier?: string | null;\n  service?: string | null;\n  rate?: string | null;\n  currency?: string | null;\n  delivery_days?: number | null;\n  estimated_delivery_days?: number | null;\n};\n\ntype Props = {\n  open: boolean;\n  order: any | null;\n  originLine?: string | null;\n  initialPackage?: ParcelDraft | null;\n  onClose: () => void;\n  onSuccess: () => void;\n};\n\nconst resolveShippingAddress = (value: unknown): any | null => {\n  if (!value) {\n    return null;\n  }\n  if (Array.isArray(value)) {\n    return value[0] ?? null;\n  }\n  if (typeof value === \"object\") {\n    return value as any;\n  }\n  return null;\n};\n\nconst clean = (v: unknown) => (typeof v === \"string\" ? v.trim() : \"\");\n\nconst money = (rateStr?: string | null, currency?: string | null) => {\n  const rate = Number(rateStr ?? \"\");\n  if (Number.isFinite(rate)) {\n    return `${currency?.toUpperCase() === \"USD\" || !currency ? \"$\" : \"\"}${rate.toFixed(2)}`;\n  }\n  return rateStr ?? \"-\";\n};\n\nconst formatDeliveryEstimate = (days?: number | null) => {\n  if (!days || days <= 0) {\n    return null;\n  }\n  const businessDays = Math.ceil(days);\n  if (businessDays === 1) {\n    return \"Next business day\";\n  }\n  if (businessDays === 2) {\n    return \"2 business days\";\n  }\n  if (businessDays <= 5) {\n    return `${businessDays} business days`;\n  }\n  const calendarDays = Math.ceil(businessDays * 1.4);\n  return `${calendarDays} days`;\n};\n\n// Client-side address validation\nconst validateAddress = (address: ShippingAddressDraft): AddressErrors => {\n  const errors: AddressErrors = {};\n\n  if (!address.line1 || address.line1.length < 3) {\n    errors.line1 = \"Street address is required\";\n  }\n\n  if (!address.city || address.city.length < 2) {\n    errors.city = \"City is required\";\n  }\n\n  if (!address.state || address.state.length !== 2) {\n    errors.state = \"State must be 2 letters (e.g., CA, NY)\";\n  }\n\n  if (!address.postal_code || !/^\\d{5}(-\\d{4})?$/.test(address.postal_code)) {\n    errors.postal_code = \"ZIP code must be 5 digits or 5+4 format\";\n  }\n\n  if (!address.country || address.country.length !== 2) {\n    errors.country = \"Country must be 2 letters (e.g., US)\";\n  }\n\n  return errors;\n};\n\n// Map API errors to user-friendly messages\nconst getErrorMessage = (error: string): string => {\n  const lowerError = error.toLowerCase();\n\n  if (lowerError.includes(\"address\") && lowerError.includes(\"invalid\")) {\n    return \"The recipient address is invalid. Please check street, city, state, and ZIP code.\";\n  }\n  if (lowerError.includes(\"postal\") || lowerError.includes(\"zip\")) {\n    return \"Invalid ZIP code. Please enter a valid 5-digit ZIP code.\";\n  }\n  if (lowerError.includes(\"carrier\") && lowerError.includes(\"not\")) {\n    return \"No carriers are enabled. Please enable carriers in Shipping Settings.\";\n  }\n  if (lowerError.includes(\"rate\")) {\n    return \"No shipping rates available. This may be due to package dimensions or destination. Try adjusting the package size.\";\n  }\n  if (lowerError.includes(\"origin\")) {\n    return \"Shipping origin address is not configured. Please set it in Shipping Settings.\";\n  }\n  if (lowerError.includes(\"weight\") || lowerError.includes(\"dimension\")) {\n    return \"Invalid package dimensions. Weight must be > 0 oz, dimensions must be > 0 inches.\";\n  }\n  if (lowerError.includes(\"already\")) {\n    return \"A shipping label has already been purchased for this order.\";\n  }\n\n  return error;\n};\n\nexport function CreateLabelForm({\n  open,\n  order,\n  originLine,\n  initialPackage,\n  onClose,\n  onSuccess,\n}: Props) {\n  const orderId = order?.id ?? null;\n\n  const initialRecipient: ShippingAddressDraft = useMemo(() => {\n    const shipping = resolveShippingAddress(order?.shipping);\n    return {\n      name: clean(shipping?.name) || \"\",\n      phone: clean(shipping?.phone) || \"\",\n      line1: clean(shipping?.line1) || \"\",\n      line2: clean(shipping?.line2) || \"\",\n      city: clean(shipping?.city) || \"\",\n      state: clean(shipping?.state) || \"\",\n      postal_code: clean(shipping?.postal_code) || \"\",\n      country: clean(shipping?.country) || \"US\",\n    };\n  }, [order]);\n\n  const initialParcel: ParcelDraft = useMemo(() => {\n    return initialPackage ?? { weight: 16, length: 12, width: 12, height: 12 };\n  }, [initialPackage]);\n\n  const [recipient, setRecipient] = useState<ShippingAddressDraft>(initialRecipient);\n  const [parcel, setParcel] = useState<ParcelDraft>(initialParcel);\n  const [addressErrors, setAddressErrors] = useState<AddressErrors>({});\n  const [validationStatus, setValidationStatus] =\n    useState<AddressValidationStatus>(\"idle\");\n\n  const [weightInput, setWeightInput] = useState<string>(\"16\");\n  const [lengthInput, setLengthInput] = useState<string>(\"12\");\n  const [widthInput, setWidthInput] = useState<string>(\"12\");\n  const [heightInput, setHeightInput] = useState<string>(\"12\");\n\n  const [shipmentId, setShipmentId] = useState<string | null>(null);\n  const [rates, setRates] = useState<EasyPostRate[]>([]);\n  const [selectedRateId, setSelectedRateId] = useState<string | null>(null);\n\n  const [isGettingRates, setIsGettingRates] = useState(false);\n  const [isPurchasing, setIsPurchasing] = useState(false);\n\n  const [error, setError] = useState<string>(\"\");\n  const [success, setSuccess] = useState<string>(\"\");\n\n  useEffect(() => {\n    if (!open) {\n      return;\n    }\n    setRecipient(initialRecipient);\n    setParcel(initialParcel);\n    setAddressErrors({});\n    setValidationStatus(\"idle\");\n\n    setWeightInput(String(initialParcel.weight));\n    setLengthInput(String(initialParcel.length));\n    setWidthInput(String(initialParcel.width));\n    setHeightInput(String(initialParcel.height));\n\n    setShipmentId(null);\n    setRates([]);\n    setSelectedRateId(null);\n    setIsGettingRates(false);\n    setIsPurchasing(false);\n    setError(\"\");\n    setSuccess(\"\");\n  }, [open, initialRecipient, initialParcel]);\n\n  // Validate address on change\n  useEffect(() => {\n    if (validationStatus === \"idle\") {\n      return;\n    }\n\n    const errors = validateAddress(recipient);\n    setAddressErrors(errors);\n\n    if (Object.keys(errors).length === 0) {\n      setValidationStatus(\"valid\");\n    } else {\n      setValidationStatus(\"invalid\");\n    }\n  }, [recipient, validationStatus]);\n\n  if (!open || !order || !orderId) {\n    return null;\n  }\n\n  const setRecipientField = (field: keyof ShippingAddressDraft, value: string) => {\n    setRecipient((prev) => ({ ...prev, [field]: value }));\n    if (validationStatus === \"idle\") {\n      setValidationStatus(\"validating\");\n    }\n  };\n\n  const handleParcelInput = (\n    field: \"weight\" | \"length\" | \"width\" | \"height\",\n    value: string,\n  ) => {\n    const cleaned = value.replace(/[^\\d.]/g, \"\");\n\n    switch (field) {\n      case \"weight\":\n        setWeightInput(cleaned);\n        break;\n      case \"length\":\n        setLengthInput(cleaned);\n        break;\n      case \"width\":\n        setWidthInput(cleaned);\n        break;\n      case \"height\":\n        setHeightInput(cleaned);\n        break;\n    }\n\n    const num = Number(cleaned);\n    if (Number.isFinite(num) && num >= 0) {\n      setParcel((prev) => ({ ...prev, [field]: num }));\n    }\n  };\n\n  const validate = () => {\n    if (!originLine) {\n      return \"Origin address is not set. Set it in Shipping Settings before creating labels.\";\n    }\n\n    const errors = validateAddress(recipient);\n    setAddressErrors(errors);\n    if (Object.keys(errors).length > 0) {\n      setValidationStatus(\"invalid\");\n      return \"Please fix the address errors before continuing.\";\n    }\n\n    if (!Number.isFinite(parcel.weight) || parcel.weight <= 0) {\n      return \"Weight must be greater than 0 oz.\";\n    }\n    if (!Number.isFinite(parcel.length) || parcel.length <= 0) {\n      return \"Length must be greater than 0 inches.\";\n    }\n    if (!Number.isFinite(parcel.width) || parcel.width <= 0) {\n      return \"Width must be greater than 0 inches.\";\n    }\n    if (!Number.isFinite(parcel.height) || parcel.height <= 0) {\n      return \"Height must be greater than 0 inches.\";\n    }\n\n    return null;\n  };\n\n  const getRates = async () => {\n    const v = validate();\n    if (v) {\n      setError(v);\n      return;\n    }\n\n    setError(\"\");\n    setSuccess(\"\");\n    setIsGettingRates(true);\n    setRates([]);\n    setSelectedRateId(null);\n    setShipmentId(null);\n\n    try {\n      const res = await fetch(\"/api/admin/shipping/rates\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          orderId,\n          weight: parcel.weight,\n          length: parcel.length,\n          width: parcel.width,\n          height: parcel.height,\n          recipient: {\n            name: recipient.name || null,\n            phone: recipient.phone || null,\n            line1: recipient.line1,\n            line2: recipient.line2 || null,\n            city: recipient.city,\n            state: recipient.state,\n            postal_code: recipient.postal_code,\n            country: recipient.country,\n          },\n        }),\n      });\n\n      const data = await res.json();\n      if (!res.ok) {\n        setError(getErrorMessage(data?.error || \"Failed to fetch rates.\"));\n        return;\n      }\n\n      const nextShipmentId = data?.shipment?.id ?? null;\n      const nextRates = (data?.shipment?.rates ?? []) as EasyPostRate[];\n\n      if (!nextShipmentId) {\n        setError(\"Rates response missing shipment ID. Please try again.\");\n        return;\n      }\n      if (nextRates.length === 0) {\n        setError(\n          \"No rates available for the enabled carriers. Try different package dimensions or check carrier settings.\",\n        );\n        return;\n      }\n\n      setShipmentId(nextShipmentId);\n      setRates(nextRates);\n\n      const cheapest = [...nextRates].sort(\n        (a, b) => Number(a.rate ?? 999999) - Number(b.rate ?? 999999),\n      )[0];\n      setSelectedRateId(cheapest?.id ?? nextRates[0]?.id ?? null);\n    } catch {\n      setError(\"Network error. Please check your connection and try again.\");\n    } finally {\n      setIsGettingRates(false);\n    }\n  };\n\n  const purchase = async () => {\n    if (!shipmentId || !selectedRateId) {\n      setError(\"Please select a shipping rate before purchasing.\");\n      return;\n    }\n\n    setError(\"\");\n    setSuccess(\"\");\n    setIsPurchasing(true);\n\n    try {\n      const res = await fetch(\"/api/admin/shipping/labels\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ orderId, shipmentId, rateId: selectedRateId }),\n      });\n\n      const data = await res.json();\n\n      if (res.status === 409) {\n        setError(\n          getErrorMessage(data?.error || \"Label already purchased for this order.\"),\n        );\n        return;\n      }\n\n      if (!res.ok) {\n        setError(getErrorMessage(data?.error || \"Failed to purchase label.\"));\n        return;\n      }\n\n      setSuccess(\n        ' Label purchased successfully! The order will move to \"Need to Ship\" automatically.',\n      );\n\n      // Auto-close and refresh after 2 seconds\n      setTimeout(() => {\n        onSuccess();\n      }, 2000);\n    } catch {\n      setError(\"Network error during label purchase. Please try again.\");\n    } finally {\n      setIsPurchasing(false);\n    }\n  };\n\n  const hasAddressErrors = Object.keys(addressErrors).length > 0;\n\n  return (\n    <ModalPortal open={open} onClose={onClose}>\n      <div\n        className=\"w-full max-w-6xl rounded-lg border border-zinc-800/70 bg-zinc-950 max-h-[90vh] overflow-y-auto\"\n        onMouseDown={(e) => e.stopPropagation()}\n      >\n        <div className=\"flex items-start justify-between gap-4 border-b border-zinc-800/70 p-5 sticky top-0 bg-zinc-950 z-10\">\n          <div>\n            <div className=\"text-white text-lg font-semibold\">Create shipping label</div>\n            <div className=\"text-xs text-zinc-500 mt-1\">\n              Order #{String(orderId).slice(0, 8)}\n            </div>\n          </div>\n          <button\n            type=\"button\"\n            onClick={onClose}\n            className=\"text-zinc-400 hover:text-white\"\n          >\n            <X className=\"h-5 w-5\" />\n          </button>\n        </div>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-0\">\n          {/* LEFT: details */}\n          <div className=\"p-5 space-y-6 border-b lg:border-b-0 lg:border-r border-zinc-800/70\">\n            <div className=\"space-y-1\">\n              <div className=\"text-xs uppercase tracking-wide text-zinc-500\">\n                Shipping from\n              </div>\n              <div className=\"text-sm text-zinc-200\">{originLine ?? \"Not set\"}</div>\n              {!originLine && (\n                <div className=\"text-xs text-red-400 mt-1\">\n                   Set origin in Shipping Settings\n                </div>\n              )}\n            </div>\n\n            <div className=\"space-y-3\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"text-xs uppercase tracking-wide text-zinc-500\">\n                  Shipping to\n                </div>\n                {validationStatus === \"valid\" && (\n                  <div className=\"flex items-center gap-1 text-xs text-green-400\">\n                    <CheckCircle2 className=\"w-3 h-3\" />\n                    Valid address\n                  </div>\n                )}\n                {validationStatus === \"invalid\" && hasAddressErrors && (\n                  <div className=\"flex items-center gap-1 text-xs text-red-400\">\n                    <AlertCircle className=\"w-3 h-3\" />\n                    Fix errors below\n                  </div>\n                )}\n              </div>\n\n              <div className=\"grid grid-cols-2 md:grid-cols-2 gap-2 sm:gap-3 text-[11px] sm:text-sm\">\n                <div>\n                  <label className=\"block text-gray-400 mb-0.5\">Name</label>\n                  <input\n                    type=\"text\"\n                    value={recipient.name}\n                    onChange={(e) => setRecipientField(\"name\", e.target.value)}\n                    className=\"w-full bg-zinc-900 border border-zinc-800/70 text-white px-2 py-1.5 text-[12px] sm:text-sm\"\n                  />\n                </div>\n                <div>\n                  <label className=\"block text-gray-400 mb-0.5\">Phone</label>\n                  <input\n                    type=\"text\"\n                    value={recipient.phone}\n                    onChange={(e) => setRecipientField(\"phone\", e.target.value)}\n                    className=\"w-full bg-zinc-900 border border-zinc-800/70 text-white px-2 py-1.5 text-[12px] sm:text-sm\"\n                  />\n                </div>\n\n                <div className=\"md:col-span-2\">\n                  <label className=\"block text-gray-400 mb-0.5\">Address line 1 *</label>\n                  <input\n                    type=\"text\"\n                    value={recipient.line1}\n                    onChange={(e) => setRecipientField(\"line1\", e.target.value)}\n                    className={`w-full bg-zinc-900 border text-white px-2 py-1.5 text-[12px] sm:text-sm ${\n                      addressErrors.line1 ? \"border-red-500\" : \"border-zinc-800/70\"\n                    }`}\n                  />\n                  {addressErrors.line1 && (\n                    <div className=\"text-xs text-red-400 mt-1\">{addressErrors.line1}</div>\n                  )}\n                </div>\n                <div className=\"md:col-span-2\">\n                  <label className=\"block text-gray-400 mb-0.5\">Address line 2</label>\n                  <input\n                    type=\"text\"\n                    value={recipient.line2}\n                    onChange={(e) => setRecipientField(\"line2\", e.target.value)}\n                    className=\"w-full bg-zinc-900 border border-zinc-800/70 text-white px-2 py-1.5 text-[12px] sm:text-sm\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-gray-400 mb-0.5\">City *</label>\n                  <input\n                    type=\"text\"\n                    value={recipient.city}\n                    onChange={(e) => setRecipientField(\"city\", e.target.value)}\n                    className={`w-full bg-zinc-900 border text-white px-2 py-1.5 text-[12px] sm:text-sm ${\n                      addressErrors.city ? \"border-red-500\" : \"border-zinc-800/70\"\n                    }`}\n                  />\n                  {addressErrors.city && (\n                    <div className=\"text-xs text-red-400 mt-1\">{addressErrors.city}</div>\n                  )}\n                </div>\n                <div>\n                  <label className=\"block text-gray-400 mb-0.5\">State *</label>\n                  <input\n                    type=\"text\"\n                    value={recipient.state}\n                    onChange={(e) =>\n                      setRecipientField(\"state\", e.target.value.toUpperCase())\n                    }\n                    maxLength={2}\n                    placeholder=\"CA\"\n                    className={`w-full bg-zinc-900 border text-white px-2 py-1.5 text-[12px] sm:text-sm ${\n                      addressErrors.state ? \"border-red-500\" : \"border-zinc-800/70\"\n                    }`}\n                  />\n                  {addressErrors.state && (\n                    <div className=\"text-xs text-red-400 mt-1\">{addressErrors.state}</div>\n                  )}\n                </div>\n                <div>\n                  <label className=\"block text-gray-400 mb-0.5\">ZIP Code *</label>\n                  <input\n                    type=\"text\"\n                    value={recipient.postal_code}\n                    onChange={(e) => setRecipientField(\"postal_code\", e.target.value)}\n                    placeholder=\"12345\"\n                    className={`w-full bg-zinc-900 border text-white px-2 py-1.5 text-[12px] sm:text-sm ${\n                      addressErrors.postal_code ? \"border-red-500\" : \"border-zinc-800/70\"\n                    }`}\n                  />\n                  {addressErrors.postal_code && (\n                    <div className=\"text-xs text-red-400 mt-1\">\n                      {addressErrors.postal_code}\n                    </div>\n                  )}\n                </div>\n                <div>\n                  <label className=\"block text-gray-400 mb-0.5\">Country *</label>\n                  <input\n                    type=\"text\"\n                    value={recipient.country}\n                    onChange={(e) =>\n                      setRecipientField(\"country\", e.target.value.toUpperCase())\n                    }\n                    maxLength={2}\n                    placeholder=\"US\"\n                    className={`w-full bg-zinc-900 border text-white px-2 py-1.5 text-[12px] sm:text-sm ${\n                      addressErrors.country ? \"border-red-500\" : \"border-zinc-800/70\"\n                    }`}\n                  />\n                  {addressErrors.country && (\n                    <div className=\"text-xs text-red-400 mt-1\">\n                      {addressErrors.country}\n                    </div>\n                  )}\n                </div>\n              </div>\n            </div>\n\n            <div className=\"space-y-3\">\n              <div className=\"text-xs uppercase tracking-wide text-zinc-500\">\n                Package dimensions\n              </div>\n              <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\n                <div>\n                  <label className=\"block text-xs text-zinc-400 mb-1\">Weight (oz)</label>\n                  <input\n                    type=\"text\"\n                    inputMode=\"numeric\"\n                    value={weightInput}\n                    onChange={(e) => handleParcelInput(\"weight\", e.target.value)}\n                    className=\"w-full bg-zinc-900 border border-zinc-800/70 text-white px-3 py-2 text-sm\"\n                  />\n                </div>\n                <div>\n                  <label className=\"block text-xs text-zinc-400 mb-1\">Length (in)</label>\n                  <input\n                    type=\"text\"\n                    inputMode=\"numeric\"\n                    value={lengthInput}\n                    onChange={(e) => handleParcelInput(\"length\", e.target.value)}\n                    className=\"w-full bg-zinc-900 border border-zinc-800/70 text-white px-3 py-2 text-sm\"\n                  />\n                </div>\n                <div>\n                  <label className=\"block text-xs text-zinc-400 mb-1\">Width (in)</label>\n                  <input\n                    type=\"text\"\n                    inputMode=\"numeric\"\n                    value={widthInput}\n                    onChange={(e) => handleParcelInput(\"width\", e.target.value)}\n                    className=\"w-full bg-zinc-900 border border-zinc-800/70 text-white px-3 py-2 text-sm\"\n                  />\n                </div>\n                <div>\n                  <label className=\"block text-xs text-zinc-400 mb-1\">Height (in)</label>\n                  <input\n                    type=\"text\"\n                    inputMode=\"numeric\"\n                    value={heightInput}\n                    onChange={(e) => handleParcelInput(\"height\", e.target.value)}\n                    className=\"w-full bg-zinc-900 border border-zinc-800/70 text-white px-3 py-2 text-sm\"\n                  />\n                </div>\n              </div>\n\n              <button\n                type=\"button\"\n                onClick={() => {\n                  void getRates();\n                }}\n                disabled={isGettingRates || hasAddressErrors}\n                className=\"w-full md:w-auto px-4 py-2 bg-zinc-100 text-black text-sm font-semibold rounded hover:bg-white disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                {isGettingRates ? \"Getting rates...\" : \"Get shipping rates\"}\n              </button>\n\n              {error && (\n                <div className=\"flex items-start gap-2 text-sm text-red-400 bg-red-400/10 border border-red-400/20 rounded p-3\">\n                  <AlertCircle className=\"w-4 h-4 mt-0.5 flex-shrink-0\" />\n                  <div>{error}</div>\n                </div>\n              )}\n              {success && (\n                <div className=\"flex items-start gap-2 text-sm text-green-400 bg-green-400/10 border border-green-400/20 rounded p-3\">\n                  <CheckCircle2 className=\"w-4 h-4 mt-0.5 flex-shrink-0\" />\n                  <div>{success}</div>\n                </div>\n              )}\n            </div>\n          </div>\n\n          {/* RIGHT: rates + purchase */}\n          <div className=\"p-5 space-y-4\">\n            <div>\n              <div className=\"text-xs uppercase tracking-wide text-zinc-500\">\n                Available rates\n              </div>\n              <div className=\"text-sm text-zinc-400 mt-1\">\n                Select a carrier and service, then purchase the label.\n              </div>\n            </div>\n\n            {rates.length === 0 ? (\n              <div className=\"rounded border border-zinc-800/70 bg-zinc-900 p-4 text-sm text-zinc-500\">\n                No rates yet. Enter package details and click{\" \"}\n                <span className=\"text-zinc-200\">Get shipping rates</span>.\n              </div>\n            ) : (\n              <div className=\"space-y-2 max-h-[400px] overflow-y-auto\">\n                {rates.map((r) => {\n                  const selected = selectedRateId === r.id;\n                  const days = r.estimated_delivery_days ?? r.delivery_days ?? null;\n                  const deliveryText = formatDeliveryEstimate(days);\n\n                  return (\n                    <label\n                      key={r.id}\n                      className={`flex items-start gap-3 p-3 rounded border cursor-pointer transition-colors ${\n                        selected\n                          ? \"border-red-600 bg-zinc-900/60\"\n                          : \"border-zinc-800/70 bg-zinc-900 hover:border-zinc-700\"\n                      }`}\n                    >\n                      <input\n                        type=\"radio\"\n                        name=\"rate\"\n                        checked={selected}\n                        onChange={() => setSelectedRateId(r.id)}\n                        className=\"mt-1\"\n                      />\n                      <div className=\"flex-1\">\n                        <div className=\"flex items-center justify-between gap-3\">\n                          <div className=\"text-sm text-white font-semibold\">\n                            {String(r.carrier ?? \"Carrier\")} {\" \"}\n                            {String(r.service ?? \"Service\")}\n                          </div>\n                          <div className=\"text-sm text-white font-bold\">\n                            {money(r.rate, r.currency)}\n                          </div>\n                        </div>\n                        <div className=\"text-xs text-zinc-500 mt-1\">\n                          {deliveryText\n                            ? `Est. delivery: ${deliveryText}`\n                            : \"Delivery estimate unavailable\"}\n                        </div>\n                      </div>\n                    </label>\n                  );\n                })}\n              </div>\n            )}\n\n            <div className=\"pt-2 space-y-3\">\n              <button\n                type=\"button\"\n                onClick={() => {\n                  void purchase();\n                }}\n                disabled={\n                  isPurchasing ||\n                  rates.length === 0 ||\n                  !shipmentId ||\n                  !selectedRateId ||\n                  !!success\n                }\n                className=\"w-full px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm font-semibold rounded disabled:bg-zinc-700 disabled:cursor-not-allowed\"\n              >\n                {isPurchasing ? \"Purchasing label...\" : \"Purchase shipping label\"}\n              </button>\n\n              <div className=\"text-xs text-zinc-500 bg-zinc-900 border border-zinc-800/70 rounded p-3\">\n                <strong className=\"text-zinc-400\">Note:</strong> After purchase, the label\n                will be emailed to the customer and stored in the order. You can reprint\n                it anytime from the order details.\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </ModalPortal>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\admin\\shipping\\OriginModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\admin\\stripe\\BankAccountManagementModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\admin\\stripe\\EmbeddedAccount.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1026,1029],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1026,1029],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":59,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1712,1715],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1712,1715],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":102,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2854,2857],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2854,2857],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/admin/stripe/EmbeddedAccount.tsx\n\"use client\";\n\nimport { useState, useEffect, useMemo } from \"react\";\nimport { Loader2 } from \"lucide-react\";\nimport { loadConnectAndInitialize } from \"@stripe/connect-js\";\nimport {\n  ConnectComponentsProvider,\n  ConnectAccountOnboarding,\n  ConnectAccountManagement,\n  ConnectBalances,\n  ConnectPayouts,\n} from \"@stripe/react-connect-js\";\n\nimport { logError } from \"@/lib/log\";\nimport { connectAppearance } from \"@/lib/stripe/connect-appearance\";\n\ninterface EmbeddedAccountProps {\n  publishableKey: string;\n  showOnboarding?: boolean;\n  showAccountManagement?: boolean;\n  showBalances?: boolean;\n  showPayouts?: boolean;\n  showAccountId?: boolean;\n  variant?: \"card\" | \"plain\";\n}\n\nexport function EmbeddedAccount({\n  publishableKey,\n  showOnboarding = false,\n  showAccountManagement = true,\n  showBalances = true,\n  showPayouts = true,\n  showAccountId = true,\n  variant = \"card\",\n}: EmbeddedAccountProps) {\n  const [stripeConnectInstance, setStripeConnectInstance] = useState<any>(null);\n  const [accountId, setAccountId] = useState<string>(\"\");\n  const [isCompact, setIsCompact] = useState(false);\n\n  useEffect(() => {\n    if (typeof window === \"undefined\") {\n      return;\n    }\n    const media = window.matchMedia(\"(max-width: 640px)\");\n    const handleChange = () => setIsCompact(media.matches);\n    handleChange();\n\n    if (media.addEventListener) {\n      media.addEventListener(\"change\", handleChange);\n      return () => media.removeEventListener(\"change\", handleChange);\n    }\n\n    media.addListener(handleChange);\n    return () => media.removeListener(handleChange);\n  }, []);\n\n  const appearance = useMemo(() => {\n    const base = connectAppearance as any;\n    const variables = { ...(base?.variables ?? {}) };\n\n    if (isCompact) {\n      variables.fontSizeBase = \"11px\";\n      variables.spacingUnit = \"8px\";\n    }\n\n    return { ...base, variables };\n  }, [isCompact]);\n\n  useEffect(() => {\n    let cancelled = false;\n\n    const fetchClientSecret = async () => {\n      const response = await fetch(\"/api/admin/stripe/account-session\", {\n        method: \"POST\",\n      });\n\n      if (!response.ok) {\n        const text = await response.text();\n        throw new Error(`Failed to create account session: ${text}`);\n      }\n\n      const { client_secret: clientSecret, account_id: accountIdValue } =\n        (await response.json()) as { client_secret: string; account_id: string };\n      if (!cancelled) {\n        setAccountId(accountIdValue);\n      }\n      return clientSecret;\n    };\n\n    const initializeStripeConnect = async () => {\n      try {\n        const instance = await loadConnectAndInitialize({\n          publishableKey,\n          fetchClientSecret,\n          appearance,\n        });\n\n        if (!cancelled) {\n          setStripeConnectInstance(instance);\n        }\n      } catch (err: any) {\n        logError(err, { layer: \"frontend\", event: \"stripe_connect_init_failed\" });\n      }\n    };\n\n    if (publishableKey) {\n      initializeStripeConnect();\n    }\n\n    return () => {\n      cancelled = true;\n    };\n  }, [publishableKey, appearance]);\n\n  if (!stripeConnectInstance) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center justify-center py-6\">\n          <Loader2 className=\"w-6 h-6 animate-spin text-red-600\" />\n          <span className=\"ml-3 text-zinc-400 text-sm\">Loading Stripe tools...</span>\n        </div>\n      </div>\n    );\n  }\n\n  const isPlain = variant === \"plain\";\n\n  return (\n    <ConnectComponentsProvider connectInstance={stripeConnectInstance}>\n      <div className={isPlain ? \"space-y-4\" : \"space-y-6\"}>\n        {showOnboarding ? (\n          isPlain ? (\n            <div className=\"min-w-0\">\n              <ConnectAccountOnboarding onExit={() => {}} />\n            </div>\n          ) : (\n            <div className=\"bg-zinc-900 border border-zinc-800/70 rounded-sm p-6\">\n              <h2 className=\"text-lg font-semibold text-white mb-2\">Verification</h2>\n              <p className=\"text-sm text-zinc-400 mb-4\">\n                Stripe collects required details securely to enable payouts.\n              </p>\n              <ConnectAccountOnboarding onExit={() => {}} />\n            </div>\n          )\n        ) : null}\n\n        {showAccountManagement ? (\n          isPlain ? (\n            <div className=\"min-w-0\">\n              <ConnectAccountManagement\n                collectionOptions={{\n                  fields: \"eventually_due\",\n                  futureRequirements: \"include\",\n                }}\n              />\n            </div>\n          ) : (\n            <div className=\"bg-zinc-900 border border-zinc-800/70 rounded-sm p-6\">\n              <h2 className=\"text-lg font-semibold text-white mb-2\">Bank accounts</h2>\n              <p className=\"text-sm text-zinc-400 mb-4\">\n                Add/edit bank accounts for payouts.\n              </p>\n              <ConnectAccountManagement\n                collectionOptions={{\n                  fields: \"eventually_due\",\n                  futureRequirements: \"include\",\n                }}\n              />\n            </div>\n          )\n        ) : null}\n\n        {showBalances ? (\n          isPlain ? (\n            <div className=\"min-w-0\">\n              <ConnectBalances />\n            </div>\n          ) : (\n            <div className=\"bg-zinc-900 border border-zinc-800/70 rounded-sm p-6\">\n              <h2 className=\"text-lg font-semibold text-white mb-2\">\n                Balances & upcoming payout\n              </h2>\n              <p className=\"text-sm text-zinc-400 mb-4\">\n                Pending, available, and upcoming payout details.\n              </p>\n              <ConnectBalances />\n            </div>\n          )\n        ) : null}\n\n        {showPayouts ? (\n          isPlain ? (\n            <div className=\"min-w-0\">\n              <ConnectPayouts />\n            </div>\n          ) : (\n            <div className=\"bg-zinc-900 border border-zinc-800/70 rounded-sm p-6\">\n              <h2 className=\"text-lg font-semibold text-white mb-2\">Payouts</h2>\n              <ConnectPayouts />\n            </div>\n          )\n        ) : null}\n\n        {showAccountId && accountId ? (\n          <div className=\"text-xs text-zinc-600 font-mono\">Account ID: {accountId}</div>\n        ) : null}\n      </div>\n    </ConnectComponentsProvider>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\admin\\stripe\\PayoutsModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\admin\\stripe\\StripeOnboardingModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":31,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[908,911],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[908,911],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":68,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1739,1742],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1739,1742],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/admin/stripe/StripeOnboardingModal.tsx\n\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { Loader2, X } from \"lucide-react\";\nimport {\n  ConnectComponentsProvider,\n  ConnectAccountOnboarding,\n  ConnectNotificationBanner,\n} from \"@stripe/react-connect-js\";\n\nimport { initStripeConnect } from \"@/lib/stripe/connect-client\";\nimport { connectAppearance } from \"@/lib/stripe/connect-appearance\";\nimport { logError } from \"@/lib/log\";\n\ninterface StripeOnboardingModalProps {\n  open: boolean;\n  onClose: () => void;\n  publishableKey: string;\n  onCompleted: () => Promise<void> | void;\n}\n\nexport function StripeOnboardingModal({\n  open,\n  onClose,\n  publishableKey,\n  onCompleted,\n}: StripeOnboardingModalProps) {\n  const [isBooting, setIsBooting] = useState(false);\n  const [bootError, setBootError] = useState<string>(\"\");\n  const [connectInstance, setConnectInstance] = useState<any>(null);\n\n  useEffect(() => {\n    if (!open) {\n      setIsBooting(false);\n      setBootError(\"\");\n      setConnectInstance(null);\n      return;\n    }\n  }, [open]);\n\n  const boot = async () => {\n    if (!publishableKey) {\n      setBootError(\"Stripe publishable key is missing.\");\n      return;\n    }\n\n    setIsBooting(true);\n    setBootError(\"\");\n\n    try {\n      const res = await fetch(\"/api/admin/stripe/account-session\", { method: \"POST\" });\n      if (!res.ok) {\n        throw new Error(await res.text());\n      }\n\n      const { client_secret: clientSecret } = (await res.json()) as {\n        client_secret: string;\n      };\n\n      const instance = await initStripeConnect({\n        publishableKey,\n        clientSecret,\n        appearance: connectAppearance,\n      });\n\n      setConnectInstance(instance);\n    } catch (err: any) {\n      logError(err, { layer: \"frontend\", event: \"stripe_onboarding_boot_failed\" });\n      setBootError(\"Could not start Stripe onboarding. Please try again.\");\n    } finally {\n      setIsBooting(false);\n    }\n  };\n\n  const done = async () => {\n    try {\n      await onCompleted();\n    } finally {\n      onClose();\n    }\n  };\n\n  if (!open) {\n    return null;\n  }\n\n  return (\n    <div className=\"fixed inset-0 z-[9999]\">\n      <div\n        className=\"absolute inset-0 bg-black/80\"\n        onClick={onClose}\n        aria-hidden=\"true\"\n      />\n      <div className=\"absolute inset-0 flex items-center justify-center p-4\">\n        <div className=\"w-full max-w-3xl max-h-[92vh] bg-zinc-950 border border-zinc-800 rounded-sm shadow-xl flex flex-col\">\n          {/* Header */}\n          <div className=\"flex items-center justify-between px-6 py-4 border-b border-zinc-800\">\n            <div>\n              <h2 className=\"text-xl font-semibold text-white\">Complete Verification</h2>\n              <p className=\"text-sm text-zinc-400 mt-1\">\n                Complete all requirements to enable payouts\n              </p>\n            </div>\n            <button\n              type=\"button\"\n              onClick={onClose}\n              className=\"p-2 border border-zinc-800 hover:border-zinc-600 rounded-sm\"\n              aria-label=\"Close\"\n            >\n              <X className=\"w-4 h-4 text-zinc-300\" />\n            </button>\n          </div>\n\n          {/* Content */}\n          <div className=\"px-6 py-6 overflow-y-auto\">\n            {bootError && (\n              <div className=\"mb-4 rounded-sm border border-red-900/70 bg-red-950/20 p-4\">\n                <p className=\"text-sm text-red-400\">{bootError}</p>\n              </div>\n            )}\n\n            {!connectInstance ? (\n              <div className=\"space-y-6\">\n                <div className=\"rounded-sm bg-zinc-900 border border-zinc-800/70 p-6\">\n                  <p className=\"text-sm text-zinc-300 mb-4\">\n                    Stripe will securely collect the information needed to enable payouts\n                    to your bank account.\n                  </p>\n                  <ul className=\"space-y-2 text-sm text-zinc-400\">\n                    <li className=\"flex items-start gap-2\">\n                      <span className=\"text-red-500 mt-0.5\"></span>\n                      <span>Business or personal information</span>\n                    </li>\n                    <li className=\"flex items-start gap-2\">\n                      <span className=\"text-red-500 mt-0.5\"></span>\n                      <span>Bank account details for payouts</span>\n                    </li>\n                    <li className=\"flex items-start gap-2\">\n                      <span className=\"text-red-500 mt-0.5\"></span>\n                      <span>Identity verification documents</span>\n                    </li>\n                  </ul>\n                </div>\n\n                <button\n                  type=\"button\"\n                  onClick={() => {\n                    void boot();\n                  }}\n                  disabled={isBooting}\n                  className=\"w-full px-6 py-3 bg-red-600 text-white text-sm font-medium hover:bg-red-500 disabled:opacity-50 disabled:cursor-not-allowed rounded-sm\"\n                >\n                  {isBooting ? (\n                    <span className=\"inline-flex items-center gap-2 justify-center\">\n                      <Loader2 className=\"w-4 h-4 animate-spin\" />\n                      Loading...\n                    </span>\n                  ) : (\n                    \"Start Verification\"\n                  )}\n                </button>\n              </div>\n            ) : (\n              <ConnectComponentsProvider connectInstance={connectInstance}>\n                <div className=\"space-y-4\">\n                  {/* Notification Banner - Shows outstanding requirements automatically */}\n                  <div className=\"rounded-sm border border-zinc-800 bg-zinc-900 overflow-hidden\">\n                    <ConnectNotificationBanner />\n                  </div>\n\n                  {/* Account Onboarding Component */}\n                  <div className=\"rounded-sm border border-zinc-800 bg-zinc-900 p-4\">\n                    <ConnectAccountOnboarding\n                      onExit={() => {\n                        // User clicked a \"Done\" or similar button in the embedded component\n                        done();\n                      }}\n                    />\n                  </div>\n                </div>\n\n                <div className=\"mt-6 flex justify-end gap-3\">\n                  <button\n                    type=\"button\"\n                    onClick={onClose}\n                    className=\"px-6 py-2.5 bg-zinc-800 text-white text-sm font-medium hover:bg-zinc-700 rounded-sm border border-zinc-700\"\n                  >\n                    Close\n                  </button>\n                  <button\n                    type=\"button\"\n                    onClick={() => {\n                      void done();\n                    }}\n                    className=\"px-6 py-2.5 bg-green-600 text-white text-sm font-medium hover:bg-green-500 rounded-sm\"\n                  >\n                    Save & Continue\n                  </button>\n                </div>\n              </ConnectComponentsProvider>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\auth\\2fa\\ChallengeForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\auth\\2fa\\EnrollmentForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\auth\\2fa\\QRDisplay.tsx","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@next/next/no-img-element').","line":13,"column":10,"severity":1,"nodeType":null,"fix":{"range":[290,346],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"// src/components/auth/2fa/QRDisplay.tsx\n\nexport function QRDisplay({\n  qrCode,\n  copyValue: _copyValue,\n}: {\n  qrCode: string;\n  copyValue?: string | null;\n}) {\n  return (\n    <div className=\"border border-zinc-800 bg-zinc-900/50 p-6\">\n      <div className=\"flex justify-center\">\n        {/* eslint-disable-next-line @next/next/no-img-element */}\n        <img src={qrCode} alt=\"2FA QR Code\" className=\"h-48 w-48 bg-white p-3\" />\n      </div>\n\n      <p className=\"mt-4 text-center text-xs text-zinc-500\">\n        Scan with Google Authenticator or any TOTP app\n      </p>\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\auth\\login\\EmailCodeFlow.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":125,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":125,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3446,3449],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3446,3449],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":148,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":148,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3954,3957],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3954,3957],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/auth/login/EmailCodeFlow.tsx\n\"use client\";\n\nimport Link from \"next/link\";\nimport { useEffect, useState } from \"react\";\n\nimport { authStyles } from \"@/components/auth/ui/AuthStyles\";\nimport { AuthHeader } from \"@/components/auth/ui/AuthHeader\";\n\nimport { SplitCodeInputWithResend } from \"./SplitCodeInputWithResend\";\n\ntype Stage = \"request\" | \"verify\";\n\nexport interface EmailCodeFlowProps {\n  flowId?: string;\n\n  title: string;\n  codeLabel: string;\n  emailLabel?: string;\n  getDescription: (stage: Stage, hasError: boolean) => string;\n\n  initialStage?: Stage;\n  initialEmail?: string;\n  emailReadOnly?: boolean;\n  showEmailInput?: boolean;\n\n  sendButtonLabel?: string;\n  sendButtonSendingLabel?: string;\n  verifyButtonLabel?: string;\n  verifyButtonSubmittingLabel?: string;\n\n  onRequestCode?: (email: string) => Promise<void>;\n  onVerifyCode: (email: string, code: string) => Promise<void>;\n  onResendCode?: (email: string) => Promise<void>;\n\n  initialCooldown?: number;\n  codeLength?: number;\n\n  backLabel?: string;\n  backHref?: string;\n  onBack?: () => void;\n}\n\nexport function EmailCodeFlow({\n  flowId,\n  title,\n  codeLabel,\n  emailLabel = \"Email\",\n  getDescription,\n  initialStage,\n  initialEmail,\n  emailReadOnly,\n  showEmailInput = true,\n  sendButtonLabel = \"Send code\",\n  sendButtonSendingLabel = \"Sending code...\",\n  verifyButtonLabel = \"Verify code\",\n  verifyButtonSubmittingLabel = \"Verifying...\",\n  onRequestCode,\n  onVerifyCode,\n  onResendCode,\n  initialCooldown = 0,\n  codeLength = 6,\n  backLabel,\n  backHref,\n  onBack,\n}: EmailCodeFlowProps) {\n  const [stage, setStage] = useState<Stage>(\n    initialStage ?? (onRequestCode ? \"request\" : \"verify\"),\n  );\n\n  const [email, setEmail] = useState(initialEmail ?? \"\");\n  const [code, setCode] = useState(\"\");\n  const [error, setError] = useState<string | null>(null);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n\n  const [resendCooldown, setResendCooldown] = useState(initialCooldown);\n  const [resendSent, setResendSent] = useState(false);\n  const [resendError, setResendError] = useState<string | null>(null);\n  const [isSendingResend, setIsSendingResend] = useState(false);\n\n  useEffect(() => {\n    if (resendCooldown <= 0) {\n      return;\n    }\n    const id = setTimeout(() => setResendCooldown((c) => c - 1), 1000);\n    return () => clearTimeout(id);\n  }, [resendCooldown]);\n\n  const trimmedEmail = email.trim();\n  const hasError = Boolean(error);\n  const descriptionText = getDescription(stage, hasError);\n\n  const canShowEmailInput = !emailReadOnly && showEmailInput;\n  const effectiveResendHandler = onResendCode ?? onRequestCode ?? null;\n\n  async function handleSubmit(e: React.FormEvent) {\n    e.preventDefault();\n    setError(null);\n    setResendError(null);\n    setIsSubmitting(true);\n\n    try {\n      if (!trimmedEmail) {\n        throw new Error(\"Email is required.\");\n      }\n\n      if (stage === \"request\") {\n        if (!onRequestCode) {\n          throw new Error(\"Requesting a code is not supported for this flow.\");\n        }\n\n        await onRequestCode(trimmedEmail);\n\n        setStage(\"verify\");\n        setResendSent(false);\n        setResendError(null);\n        setResendCooldown(60);\n      } else {\n        if (!code || code.length !== codeLength) {\n          throw new Error(`Please enter the ${codeLength}-digit code from your email.`);\n        }\n\n        await onVerifyCode(trimmedEmail, code.trim());\n      }\n    } catch (err: any) {\n      setError(err?.message ?? \"Something went wrong.\");\n    } finally {\n      setIsSubmitting(false);\n    }\n  }\n\n  async function handleResend() {\n    if (!effectiveResendHandler) {\n      return;\n    }\n    if (!trimmedEmail || isSendingResend || resendCooldown > 0) {\n      return;\n    }\n\n    setError(null);\n    setResendError(null);\n    setIsSendingResend(true);\n\n    try {\n      await effectiveResendHandler(trimmedEmail);\n      setResendSent(true);\n      setResendCooldown(60);\n    } catch (err: any) {\n      const message = err?.message ?? \"Could not resend code.\";\n      setError(message);\n      setResendError(message);\n    } finally {\n      setIsSendingResend(false);\n    }\n  }\n\n  const submitLabel =\n    stage === \"request\"\n      ? isSubmitting\n        ? sendButtonSendingLabel\n        : sendButtonLabel\n      : isSubmitting\n        ? verifyButtonSubmittingLabel\n        : verifyButtonLabel;\n\n  return (\n    <form\n      onSubmit={(event) => {\n        void handleSubmit(event);\n      }}\n      className=\"space-y-6\"\n      data-flow-id={flowId}\n    >\n      <AuthHeader title={title} description={descriptionText} />\n\n      {error && <div className={authStyles.errorBox}>{error}</div>}\n\n      <div className=\"space-y-4\">\n        {canShowEmailInput && (\n          <div className=\"space-y-2\">\n            <label htmlFor=\"email\" className=\"block text-sm font-medium text-zinc-300\">\n              {emailLabel}\n            </label>\n            <input\n              id=\"email\"\n              name=\"email\"\n              type=\"email\"\n              required\n              autoComplete=\"email\"\n              value={email}\n              onChange={(e) => setEmail(e.target.value)}\n              disabled={isSubmitting || stage === \"verify\"}\n              className={stage === \"verify\" ? authStyles.inputDisabled : authStyles.input}\n            />\n          </div>\n        )}\n\n        {emailReadOnly && !canShowEmailInput && (\n          <div className=\"rounded-lg border border-zinc-800 bg-zinc-900/30 px-4 py-3 text-sm text-zinc-400\">\n            {email || \"Unknown email\"}\n          </div>\n        )}\n\n        {stage === \"verify\" && (\n          <SplitCodeInputWithResend\n            id=\"email-code\"\n            label={codeLabel}\n            length={codeLength}\n            value={code}\n            onChange={setCode}\n            onResend={() => {\n              void handleResend();\n            }}\n            isSending={isSendingResend}\n            cooldown={resendCooldown}\n            disabled={isSubmitting}\n            resendSent={resendSent}\n            resendError={resendError}\n          />\n        )}\n      </div>\n\n      <div className=\"space-y-3\">\n        <button\n          type=\"submit\"\n          disabled={isSubmitting}\n          className={authStyles.primaryButton}\n        >\n          {submitLabel}\n        </button>\n\n        {(backHref || onBack) && (\n          <div className=\"flex justify-start\">\n            {backHref ? (\n              <Link href={backHref} className={authStyles.neutralLink}>\n                {backLabel ?? \"Back\"}\n              </Link>\n            ) : (\n              <button type=\"button\" onClick={onBack} className={authStyles.neutralLink}>\n                {backLabel ?? \"Back\"}\n              </button>\n            )}\n          </div>\n        )}\n      </div>\n    </form>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\auth\\login\\ForgotPasswordForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2382,2385],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2382,2385],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":105,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3254,3257],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3254,3257],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":178,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":178,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5324,5327],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5324,5327],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/auth/login/ForgotPasswordForm.tsx\n\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport { useRouter } from \"next/navigation\";\n\nimport { isPasswordValid } from \"@/lib/validation/password\";\nimport { authStyles } from \"@/components/auth/ui/AuthStyles\";\nimport { AuthHeader } from \"@/components/auth/ui/AuthHeader\";\n\nimport { PasswordRequirements } from \"../register/PasswordRequirements\";\n\nimport { SplitCodeInputWithResend } from \"./SplitCodeInputWithResend\";\nimport { PasswordField } from \"./PasswordField\";\n\ninterface ForgotPasswordFormProps {\n  onBackToLogin: () => void;\n}\n\ntype Step = \"request\" | \"reset\";\n\nexport function ForgotPasswordForm({ onBackToLogin }: ForgotPasswordFormProps) {\n  const router = useRouter();\n\n  const [step, setStep] = useState<Step>(\"request\");\n  const [email, setEmail] = useState(\"\");\n  const [code, setCode] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [confirmPassword, setConfirmPassword] = useState(\"\");\n\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [infoMessage, setInfoMessage] = useState<string | null>(null);\n  const [error, setError] = useState<string | null>(null);\n\n  const [resendCooldown, setResendCooldown] = useState(0);\n  const [resendSent, setResendSent] = useState(false);\n  const [resendError, setResendError] = useState<string | null>(null);\n  const [isSendingResend, setIsSendingResend] = useState(false);\n\n  useEffect(() => {\n    if (resendCooldown <= 0) {\n      return;\n    }\n    const id = setTimeout(() => setResendCooldown((c) => c - 1), 1000);\n    return () => clearTimeout(id);\n  }, [resendCooldown]);\n\n  async function handleRequestSubmit(e: React.FormEvent) {\n    e.preventDefault();\n    setError(null);\n    setInfoMessage(null);\n    setIsSubmitting(true);\n\n    try {\n      const res = await fetch(\"/api/auth/forgot-password\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ email: email.trim() }),\n      });\n\n      const json = await res.json();\n\n      if (!res.ok || !json.ok) {\n        throw new Error(json.error ?? \"Could not send reset code.\");\n      }\n\n      setInfoMessage(\"If an account exists for that email, we've sent a reset code.\");\n      setStep(\"reset\");\n\n      setResendSent(false);\n      setResendError(null);\n      setResendCooldown(60);\n    } catch (err: any) {\n      setError(err?.message ?? \"Could not send reset code.\");\n    } finally {\n      setIsSubmitting(false);\n    }\n  }\n\n  async function handleResendResetCode() {\n    if (!email || step !== \"reset\" || isSendingResend || resendCooldown > 0) {\n      return;\n    }\n\n    setError(null);\n    setInfoMessage(null);\n    setIsSendingResend(true);\n    setResendError(null);\n\n    try {\n      const res = await fetch(\"/api/auth/forgot-password\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ email: email.trim() }),\n      });\n\n      const json = await res.json();\n      if (!res.ok || !json.ok) {\n        throw new Error(json.error ?? \"Could not resend reset code.\");\n      }\n\n      setInfoMessage(\"We've sent you a new reset code.\");\n      setResendSent(true);\n      setResendCooldown(60);\n    } catch (err: any) {\n      const message = err?.message ?? \"Could not resend reset code.\";\n      setError(message);\n      setResendError(message);\n    } finally {\n      setIsSendingResend(false);\n    }\n  }\n\n  async function handleResetSubmit(e: React.FormEvent) {\n    e.preventDefault();\n    setError(null);\n    setInfoMessage(null);\n\n    if (!code || code.length !== 6) {\n      setError(\"Please enter the 6-digit reset code from your email.\");\n      return;\n    }\n\n    if (password !== confirmPassword) {\n      setError(\"Passwords do not match.\");\n      return;\n    }\n\n    if (!isPasswordValid(password)) {\n      setError(\"Password does not meet the required criteria.\");\n      return;\n    }\n\n    setIsSubmitting(true);\n\n    try {\n      // Verify code (creates recovery session)\n      const verifyRes = await fetch(\"/api/auth/forgot-password/verify-code\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ email: email.trim(), code: code.trim() }),\n      });\n\n      const verifyJson = await verifyRes.json();\n      if (!verifyRes.ok || !verifyJson.ok) {\n        throw new Error(verifyJson.error ?? \"Invalid or expired code.\");\n      }\n\n      // Check if admin needs 2FA\n      if (verifyJson.requiresTwoFASetup) {\n        router.push(\"/auth/2fa/setup\");\n        return;\n      }\n\n      if (verifyJson.requiresTwoFAChallenge) {\n        router.push(\"/auth/2fa/challenge\");\n        return;\n      }\n\n      // Update password\n      const updateRes = await fetch(\"/api/auth/update-password\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ password }),\n      });\n\n      const updateJson = await updateRes.json();\n      if (!updateRes.ok || !updateJson.ok) {\n        throw new Error(updateJson.error ?? \"Password update failed.\");\n      }\n\n      setInfoMessage(\"Your password has been updated.\");\n\n      // Redirect to admin if they completed 2FA, otherwise to login\n      setTimeout(() => {\n        router.push(\"/auth/login\");\n      }, 1000);\n    } catch (err: any) {\n      setError(err?.message ?? \"Reset failed. Please try again.\");\n    } finally {\n      setIsSubmitting(false);\n    }\n  }\n\n  return (\n    <div className=\"space-y-5\">\n      <AuthHeader\n        title={step === \"request\" ? \"Reset password\" : \"Create new password\"}\n        description={\n          step === \"request\"\n            ? \"Enter your email to receive a reset code.\"\n            : \"Enter the code from your email and choose a new password.\"\n        }\n      />\n\n      {error && <div className={authStyles.errorBox}>{error}</div>}\n      {infoMessage && <div className={authStyles.infoBox}>{infoMessage}</div>}\n\n      {step === \"request\" && (\n        <form\n          onSubmit={(event) => {\n            void handleRequestSubmit(event);\n          }}\n          className=\"space-y-4\"\n        >\n          <div className=\"space-y-1.5\">\n            <label\n              htmlFor=\"forgot-email\"\n              className=\"block text-xs sm:text-sm font-medium text-neutral-700 dark:text-neutral-200\"\n            >\n              Email\n            </label>\n            <input\n              id=\"forgot-email\"\n              type=\"email\"\n              required\n              autoComplete=\"email\"\n              value={email}\n              onChange={(e) => setEmail(e.target.value)}\n              className={authStyles.input}\n            />\n          </div>\n\n          <button\n            type=\"submit\"\n            disabled={isSubmitting}\n            className={authStyles.primaryButton}\n          >\n            {isSubmitting ? \"Sending code...\" : \"Send reset code\"}\n          </button>\n\n          <div className=\"flex justify-start\">\n            <button\n              type=\"button\"\n              onClick={onBackToLogin}\n              className={authStyles.neutralLink}\n            >\n              Back to sign in\n            </button>\n          </div>\n        </form>\n      )}\n\n      {step === \"reset\" && (\n        <form\n          onSubmit={(event) => {\n            void handleResetSubmit(event);\n          }}\n          className=\"space-y-4\"\n        >\n          <div className=\"space-y-1.5\">\n            <label\n              htmlFor=\"reset-email\"\n              className=\"block text-xs sm:text-sm font-medium text-neutral-700 dark:text-neutral-200\"\n            >\n              Email\n            </label>\n            <input\n              id=\"reset-email\"\n              value={email}\n              disabled\n              className={authStyles.inputDisabled}\n            />\n          </div>\n\n          <SplitCodeInputWithResend\n            id=\"reset-code\"\n            label=\"Reset code\"\n            length={6}\n            value={code}\n            onChange={setCode}\n            onResend={() => {\n              void handleResendResetCode();\n            }}\n            isSending={isSendingResend}\n            cooldown={resendCooldown}\n            disabled={isSubmitting}\n            resendSent={resendSent}\n            resendError={resendError}\n          />\n\n          <PasswordField\n            name=\"new-password\"\n            label=\"New password\"\n            value={password}\n            onChange={setPassword}\n            autoComplete=\"new-password\"\n          />\n\n          <PasswordField\n            name=\"confirm-password\"\n            label=\"Confirm password\"\n            value={confirmPassword}\n            onChange={setConfirmPassword}\n            autoComplete=\"new-password\"\n          />\n\n          <PasswordRequirements password={password} />\n\n          <button\n            type=\"submit\"\n            disabled={isSubmitting}\n            className={authStyles.primaryButton}\n          >\n            {isSubmitting ? \"Updating password...\" : \"Update password\"}\n          </button>\n\n          <div className=\"flex justify-start\">\n            <button\n              type=\"button\"\n              onClick={onBackToLogin}\n              className={authStyles.neutralLink}\n            >\n              Back to sign in\n            </button>\n          </div>\n        </form>\n      )}\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\auth\\login\\LoginFormRouter.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\auth\\login\\OtpLoginForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\auth\\login\\PasswordField.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\auth\\login\\PasswordLoginForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":76,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2253,2256],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2253,2256],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/auth/login/PasswordLoginForm.tsx\n\"use client\";\n\nimport { useState } from \"react\";\nimport { useRouter, useSearchParams } from \"next/navigation\";\nimport Link from \"next/link\";\nimport { ArrowLeft } from \"lucide-react\";\n\nimport { AuthHeader } from \"@/components/auth/ui/AuthHeader\";\nimport { authStyles } from \"@/components/auth/ui/AuthStyles\";\n\nimport { SocialButton } from \"../ui/SocialButton\";\n\nimport { PasswordField } from \"./PasswordField\";\n\ninterface PasswordLoginFormProps {\n  onRequiresEmailVerification: (email: string) => void;\n  onSwitchToOtp: () => void;\n  onForgotPassword: () => void;\n}\n\nexport function PasswordLoginForm({\n  onRequiresEmailVerification,\n  onSwitchToOtp,\n  onForgotPassword,\n}: PasswordLoginFormProps) {\n  const router = useRouter();\n  const searchParams = useSearchParams();\n  const [password, setPassword] = useState(\"\");\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  const nextUrl = searchParams.get(\"next\") || \"/\";\n\n  async function handleSubmit(e: React.FormEvent) {\n    e.preventDefault();\n    setError(null);\n    setIsSubmitting(true);\n\n    const form = e.currentTarget as HTMLFormElement;\n    const formData = new FormData(form);\n\n    const email = String(formData.get(\"email\") ?? \"\").trim();\n    const passwordValue = String(formData.get(\"password\") ?? \"\");\n\n    try {\n      const res = await fetch(\"/api/auth/login\", {\n        method: \"POST\",\n        body: JSON.stringify({ email, password: passwordValue }),\n      });\n\n      const json = await res.json();\n\n      if (json.requiresEmailVerification) {\n        onRequiresEmailVerification(email);\n        setIsSubmitting(false);\n        return;\n      }\n\n      if (!json.ok) {\n        setError(json.error ?? \"Login failed\");\n        setIsSubmitting(false);\n        return;\n      }\n\n      if (json.isAdmin && json.requiresTwoFASetup) {\n        return router.push(\"/auth/2fa/setup\");\n      }\n      if (json.isAdmin && json.requiresTwoFAChallenge) {\n        return router.push(\"/auth/2fa/challenge\");\n      }\n\n      // Redirect to where they came from or admin/home\n      const destination = json.isAdmin ? \"/admin\" : nextUrl;\n      router.push(destination);\n    } catch (err: any) {\n      setError(err?.message ?? \"Login failed\");\n      setIsSubmitting(false);\n    }\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Back to shopping link */}\n      <Link\n        href={nextUrl}\n        className=\"inline-flex items-center gap-2 text-sm text-zinc-500 hover:text-white transition-colors\"\n      >\n        <ArrowLeft className=\"w-4 h-4\" />\n        Back to shopping\n      </Link>\n\n      <form\n        onSubmit={(event) => {\n          void handleSubmit(event);\n        }}\n        className=\"space-y-6\"\n      >\n        <AuthHeader title=\"Sign in\" />\n\n        {error && <div className={authStyles.errorBox}>{error}</div>}\n\n        <div className=\"space-y-3\">\n          <SocialButton provider=\"google\" label=\"Continue with Google\" />\n        </div>\n\n        <div className={authStyles.divider}>\n          <div className={authStyles.dividerLine} />\n          <span>or</span>\n          <div className={authStyles.dividerLine} />\n        </div>\n\n        <div className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <label htmlFor=\"email\" className=\"block text-sm font-medium text-white\">\n              Email\n            </label>\n            <input\n              id=\"email\"\n              name=\"email\"\n              type=\"email\"\n              required\n              autoComplete=\"email\"\n              className={authStyles.input}\n              data-testid=\"login-email\"\n            />\n          </div>\n\n          <div>\n            <div className=\"flex items-center justify-between mb-2\">\n              <label htmlFor=\"password\" className=\"block text-sm font-medium text-white\">\n                Password\n              </label>\n              <button\n                type=\"button\"\n                onClick={onForgotPassword}\n                className=\"text-xs text-red-600 hover:text-red-500 transition-colors\"\n              >\n                Forgot?\n              </button>\n            </div>\n            <PasswordField\n              name=\"password\"\n              label=\"\"\n              value={password}\n              onChange={setPassword}\n              autoComplete=\"current-password\"\n              dataTestId=\"login-password\"\n            />\n          </div>\n        </div>\n\n        <div className=\"space-y-3\">\n          <button\n            type=\"submit\"\n            disabled={isSubmitting}\n            className={authStyles.primaryButton}\n            data-testid=\"login-submit\"\n          >\n            {isSubmitting ? \"Signing in...\" : \"Sign in\"}\n          </button>\n\n          <button\n            type=\"button\"\n            onClick={onSwitchToOtp}\n            className=\"w-full text-center text-sm text-zinc-500 hover:text-white transition-colors\"\n          >\n            Sign in with email code instead\n          </button>\n        </div>\n\n        <p className=\"text-sm text-center text-zinc-500\">\n          Don't have an account?{\" \"}\n          <Link\n            href={`/auth/register${nextUrl !== \"/\" ? `?next=${encodeURIComponent(nextUrl)}` : \"\"}`}\n            className={authStyles.inlineAccentLink}\n          >\n            Create one\n          </Link>\n        </p>\n      </form>\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\auth\\login\\SplitCodeInputWithResend.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\auth\\login\\VerifyEmailForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\auth\\register\\PasswordRequirements.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\auth\\register\\RegisterForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":69,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2288,2291],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2288,2291],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/auth/register/RegisterForm.tsx\n\"use client\";\n\nimport { useState } from \"react\";\nimport { useRouter, useSearchParams } from \"next/navigation\";\nimport Link from \"next/link\";\nimport { ArrowLeft } from \"lucide-react\";\n\nimport { isPasswordValid } from \"@/lib/validation/password\";\nimport { AuthHeader } from \"@/components/auth/ui/AuthHeader\";\nimport { authStyles } from \"@/components/auth/ui/AuthStyles\";\n\nimport { SocialButton } from \"../ui/SocialButton\";\nimport { PasswordField } from \"../login/PasswordField\";\n\nimport { PasswordRequirements } from \"./PasswordRequirements\";\n\nexport function RegisterForm() {\n  const router = useRouter();\n  const searchParams = useSearchParams();\n\n  const [error, setError] = useState<string | null>(null);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n\n  const [password, setPassword] = useState(\"\");\n  const [confirmPassword, setConfirmPassword] = useState(\"\");\n  const [updatesOptIn, setUpdatesOptIn] = useState(false);\n\n  const nextUrl = searchParams.get(\"next\") || \"/\";\n\n  async function handleSubmit(e: React.FormEvent<HTMLFormElement>) {\n    e.preventDefault();\n    setError(null);\n\n    const form = e.currentTarget;\n    const formData = new FormData(form);\n\n    const email = String(formData.get(\"email\") ?? \"\").trim();\n    const passwordValue = String(formData.get(\"password\") ?? \"\");\n    const confirmValue = String(formData.get(\"confirmPassword\") ?? \"\");\n\n    if (passwordValue !== confirmValue) {\n      setError(\"Passwords do not match.\");\n      return;\n    }\n\n    if (!isPasswordValid(passwordValue)) {\n      setError(\"Password does not meet minimum requirements.\");\n      return;\n    }\n\n    try {\n      setIsSubmitting(true);\n\n      const res = await fetch(\"/api/auth/register\", {\n        method: \"POST\",\n        body: JSON.stringify({ email, password: passwordValue, updatesOptIn }),\n      });\n\n      const json = await res.json();\n      if (!json.ok) {\n        setError(json.error ?? \"Sign up failed\");\n        return;\n      }\n\n      // Pass the next URL through to the verification flow\n      const verifyUrl = `/auth/login?flow=verify-email&verifyFlow=signup&email=${encodeURIComponent(email)}${nextUrl !== \"/\" ? `&next=${encodeURIComponent(nextUrl)}` : \"\"}`;\n      router.push(verifyUrl);\n    } catch (err: any) {\n      setError(err?.message ?? \"Something went wrong. Please try again.\");\n    } finally {\n      setIsSubmitting(false);\n    }\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Back to shopping link */}\n      <Link\n        href={nextUrl}\n        className=\"inline-flex items-center gap-2 text-sm text-zinc-500 hover:text-white transition-colors\"\n      >\n        <ArrowLeft className=\"w-4 h-4\" />\n        Back to shopping\n      </Link>\n\n      <form\n        onSubmit={(event) => {\n          void handleSubmit(event);\n        }}\n        className=\"space-y-6\"\n      >\n        <AuthHeader\n          title=\"Create account\"\n          description=\"Join thousands of verified buyers\"\n        />\n\n        {error && <div className={authStyles.errorBox}>{error}</div>}\n\n        <div className=\"space-y-3\">\n          <SocialButton provider=\"google\" label=\"Continue with Google\" />\n        </div>\n\n        <div className={authStyles.divider}>\n          <div className={authStyles.dividerLine} />\n          <span>or</span>\n          <div className={authStyles.dividerLine} />\n        </div>\n\n        <div className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <label htmlFor=\"email\" className=\"block text-sm font-medium text-white\">\n              Email\n            </label>\n            <input\n              id=\"email\"\n              name=\"email\"\n              type=\"email\"\n              required\n              autoComplete=\"email\"\n              className={authStyles.input}\n            />\n          </div>\n\n          <PasswordField\n            name=\"password\"\n            label=\"Password\"\n            value={password}\n            onChange={setPassword}\n            autoComplete=\"new-password\"\n          />\n\n          <PasswordField\n            name=\"confirmPassword\"\n            label=\"Confirm password\"\n            value={confirmPassword}\n            onChange={setConfirmPassword}\n            autoComplete=\"new-password\"\n          />\n\n          <PasswordRequirements password={password} />\n        </div>\n\n        <label className=\"flex items-start gap-3 cursor-pointer\">\n          <input\n            type=\"checkbox\"\n            checked={updatesOptIn}\n            onChange={(e) => setUpdatesOptIn(e.target.checked)}\n            className=\"rdk-checkbox mt-0.5\"\n          />\n          <span className=\"text-sm text-zinc-400\">\n            Send me drop alerts and exclusive offers\n          </span>\n        </label>\n\n        <button\n          type=\"submit\"\n          disabled={isSubmitting}\n          className={authStyles.primaryButton}\n        >\n          {isSubmitting ? \"Creating account...\" : \"Create account\"}\n        </button>\n\n        <p className=\"text-xs text-center text-zinc-600\">\n          By signing up, you agree to our{\" \"}\n          <Link href=\"/legal/terms\" className=\"underline hover:text-zinc-400\">\n            Terms\n          </Link>{\" \"}\n          and{\" \"}\n          <Link href=\"/legal/privacy\" className=\"underline hover:text-zinc-400\">\n            Privacy Policy\n          </Link>\n        </p>\n\n        <p className=\"text-sm text-center text-zinc-500\">\n          Already have an account?{\" \"}\n          <Link\n            href={`/auth/login${nextUrl !== \"/\" ? `?next=${encodeURIComponent(nextUrl)}` : \"\"}`}\n            className={authStyles.inlineAccentLink}\n          >\n            Sign in\n          </Link>\n        </p>\n      </form>\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\auth\\ui\\AuthCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\auth\\ui\\AuthHeader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\auth\\ui\\AuthLeftPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\auth\\ui\\AuthShell.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\auth\\ui\\AuthStyles.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\auth\\ui\\Checkbox.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\auth\\ui\\SixDigitCodeField.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\auth\\ui\\SocialButton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\cart\\CartDrawer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\cart\\CartPeekDrawer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\cart\\CartProvider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\chat\\ChatDrawer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\chat\\ChatLauncher.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\checkout\\CheckoutForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":129,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4245,4248],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4245,4248],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":227,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":227,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7685,7688],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7685,7688],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":242,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":242,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8098,8101],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8098,8101],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":256,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":256,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8483,8486],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8483,8486],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/checkout/CheckoutForm.tsx\n\"use client\";\n\nimport { useState } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport {\n  ExpressCheckoutElement,\n  PaymentElement,\n  useStripe,\n  useElements,\n} from \"@stripe/react-stripe-js\";\nimport { Loader2, Lock, Package, TruckIcon } from \"lucide-react\";\nimport Link from \"next/link\";\n\nimport type { CartItem } from \"@/types/domain/cart\";\n\nimport { SavedAddresses } from \"./SavedAddresses\";\n\ninterface CheckoutFormProps {\n  orderId: string;\n  items: CartItem[];\n  total: number;\n  fulfillment: \"ship\" | \"pickup\";\n  shippingAddress: ShippingAddress | null;\n  onShippingAddressChange: (address: ShippingAddress | null) => void;\n  onFulfillmentChange: (fulfillment: \"ship\" | \"pickup\") => void;\n  isUpdatingFulfillment?: boolean;\n  canUseChat?: boolean;\n}\n\nexport interface ShippingAddress {\n  name: string;\n  phone: string;\n  line1: string;\n  line2?: string;\n  city: string;\n  state: string;\n  postalCode: string;\n  country: string;\n}\n\nexport function CheckoutForm({\n  orderId,\n  items,\n  total,\n  fulfillment,\n  shippingAddress,\n  onShippingAddressChange,\n  onFulfillmentChange,\n  isUpdatingFulfillment = false,\n  canUseChat = false,\n}: CheckoutFormProps) {\n  const router = useRouter();\n  const stripe = useStripe();\n  const elements = useElements();\n\n  const [selectedAddressId, setSelectedAddressId] = useState<string | null>(null);\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [paymentComplete, setPaymentComplete] = useState(false);\n  const [paymentElementError, setPaymentElementError] = useState<string | null>(null);\n\n  const canBypassStripe =\n    (process.env.NEXT_PUBLIC_E2E_TEST_MODE === \"1\" || process.env.NODE_ENV === \"test\") &&\n    typeof window !== \"undefined\" &&\n    new URLSearchParams(window.location.search).has(\"e2e_payment_status\");\n  const isStripeReady = Boolean(stripe) || canBypassStripe;\n\n  const toApiShippingAddress = (address: ShippingAddress | null) =>\n    address\n      ? {\n          name: address.name,\n          phone: address.phone,\n          line1: address.line1,\n          line2: address.line2 ?? null,\n          city: address.city,\n          state: address.state.trim().toUpperCase(),\n          postal_code: address.postalCode.trim(),\n          country: address.country.trim().toUpperCase(),\n        }\n      : null;\n\n  const confirmBackendPayment = async (paymentIntentId: string) => {\n    const response = await fetch(\"/api/checkout/confirm-payment\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({\n        orderId,\n        paymentIntentId,\n        fulfillment,\n        shippingAddress:\n          fulfillment === \"ship\" ? toApiShippingAddress(shippingAddress) : null,\n      }),\n    });\n\n    const data = await response.json().catch(() => ({}));\n    if (!response.ok && !data?.processing) {\n      throw new Error(data.error || \"Failed to confirm payment\");\n    }\n  };\n\n  const handlePayment = async (withSubmit: boolean) => {\n    const e2eStatus =\n      process.env.NEXT_PUBLIC_E2E_TEST_MODE === \"1\" || process.env.NODE_ENV === \"test\"\n        ? new URLSearchParams(window.location.search).get(\"e2e_payment_status\")\n        : null;\n\n    if (e2eStatus) {\n      setIsProcessing(true);\n      setError(null);\n      const params = new URLSearchParams(window.location.search);\n      const intentId = params.get(\"e2e_payment_intent_id\") ?? \"pi_test_e2e\";\n      try {\n        if (e2eStatus === \"success\") {\n          await confirmBackendPayment(intentId);\n          router.push(`/checkout/success?orderId=${orderId}&fulfillment=${fulfillment}`);\n          return { ok: true };\n        }\n        if (e2eStatus === \"processing\" || e2eStatus === \"requires_action\") {\n          const statusParam = e2eStatus === \"processing\" ? \"processing\" : \"processing\";\n          router.push(\n            `/checkout/processing?orderId=${orderId}&e2e_status=${statusParam}&fulfillment=${fulfillment}`,\n          );\n          return { ok: true };\n        }\n        if (e2eStatus === \"canceled\" || e2eStatus === \"requires_payment_method\") {\n          throw new Error(\"Payment failed. Please try again.\");\n        }\n      } catch (err: any) {\n        const message = err.message || \"Payment failed. Please try again.\";\n        setError(message);\n        return { ok: false, error: message };\n      } finally {\n        setIsProcessing(false);\n      }\n    }\n\n    if (!stripe || !elements) {\n      setError(\"Stripe is still loading. Please wait a moment.\");\n      return { ok: false, error: \"Stripe not ready\" };\n    }\n\n    if (fulfillment === \"ship\" && !shippingAddress) {\n      const message = \"Please add a shipping address\";\n      setError(message);\n      return { ok: false, error: message };\n    }\n\n    if (withSubmit && !paymentComplete) {\n      const message =\n        paymentElementError ?? \"Please enter your card details to continue.\";\n      setError(message);\n      return { ok: false, error: message };\n    }\n\n    setIsProcessing(true);\n    setError(null);\n\n    try {\n      if (withSubmit) {\n        const { error: submitError } = await elements.submit();\n        if (submitError) {\n          throw new Error(submitError.message);\n        }\n      }\n\n      const { error: confirmError, paymentIntent } = await stripe.confirmPayment({\n        elements,\n        confirmParams: {\n          return_url: `${window.location.origin}/checkout/processing?orderId=${orderId}&fulfillment=${fulfillment}`,\n          shipping:\n            fulfillment === \"ship\" && shippingAddress\n              ? {\n                  name: shippingAddress.name,\n                  phone: shippingAddress.phone,\n                  address: {\n                    line1: shippingAddress.line1,\n                    line2: shippingAddress.line2 || \"\",\n                    city: shippingAddress.city,\n                    state: shippingAddress.state.trim().toUpperCase(),\n                    postal_code: shippingAddress.postalCode.trim(),\n                    country: shippingAddress.country.trim().toUpperCase(),\n                  },\n                }\n              : undefined,\n        },\n        redirect: \"if_required\",\n      });\n\n      if (confirmError) {\n        throw new Error(confirmError.message);\n      }\n\n      if (!paymentIntent) {\n        throw new Error(\"Payment failed. Please try again.\");\n      }\n\n      if (paymentIntent.status === \"succeeded\") {\n        await confirmBackendPayment(paymentIntent.id);\n        router.push(`/checkout/success?orderId=${orderId}&fulfillment=${fulfillment}`);\n        return { ok: true };\n      }\n\n      if (paymentIntent.status === \"processing\") {\n        const secretParam = paymentIntent.client_secret\n          ? `&payment_intent_client_secret=${encodeURIComponent(paymentIntent.client_secret)}`\n          : \"\";\n        const intentParam = paymentIntent.id ? `&payment_intent=${paymentIntent.id}` : \"\";\n        router.push(\n          `/checkout/processing?orderId=${orderId}${intentParam}${secretParam}&fulfillment=${fulfillment}`,\n        );\n        return { ok: true };\n      }\n\n      if (paymentIntent.status === \"requires_action\") {\n        const secretParam = paymentIntent.client_secret\n          ? `&payment_intent_client_secret=${encodeURIComponent(paymentIntent.client_secret)}`\n          : \"\";\n        const intentParam = paymentIntent.id ? `&payment_intent=${paymentIntent.id}` : \"\";\n        router.push(\n          `/checkout/processing?orderId=${orderId}${intentParam}${secretParam}&fulfillment=${fulfillment}`,\n        );\n        return { ok: true };\n      }\n\n      throw new Error(\"Payment failed. Please try again.\");\n    } catch (err: any) {\n      console.error(\"Payment error:\", err);\n      const message = err.message || \"Payment failed. Please try again.\";\n      setError(message);\n      return { ok: false, error: message };\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    await handlePayment(true);\n  };\n\n  const handleExpressConfirm = async (event: any) => {\n    if (isUpdatingFulfillment || isProcessing) {\n      event.paymentFailed({\n        reason: \"fail\",\n        message: \"Please wait a moment and try again.\",\n      });\n      return;\n    }\n    const result = await handlePayment(false);\n    if (!result.ok) {\n      event.paymentFailed({ reason: \"fail\", message: result.error });\n    }\n  };\n\n  const handleExpressClick = (event: any) => {\n    const lineItems = items.map((item) => ({\n      name: item.titleDisplay,\n      amount: item.priceCents * item.quantity,\n    }));\n\n    const totalCents = Math.round(total * 100);\n    const itemsTotalCents = lineItems.reduce((sum, item) => sum + item.amount, 0);\n    const shippingCents = Math.max(totalCents - itemsTotalCents, 0);\n\n    if (fulfillment === \"ship\" && shippingCents > 0) {\n      lineItems.push({ name: \"Shipping\", amount: shippingCents });\n    }\n\n    event.resolve({ lineItems });\n  };\n\n  const handleShippingAddressSelect = (address: ShippingAddress) => {\n    onShippingAddressChange(address);\n  };\n\n  return (\n    <form\n      onSubmit={(event) => {\n        void handleSubmit(event);\n      }}\n      className=\"space-y-6\"\n    >\n      {error && (\n        <div className=\"bg-red-900/20 border border-red-500 text-red-400 p-4 rounded text-sm sm:text-base\">\n          {error}\n        </div>\n      )}\n\n      {/* Fulfillment Method */}\n      <div className=\"bg-zinc-900 border border-zinc-800/70 rounded-lg p-5 sm:p-6\">\n        <h2 className=\"text-base sm:text-lg font-semibold text-white mb-4 flex items-center gap-2\">\n          <Package className=\"w-5 h-5\" />\n          Delivery Method\n        </h2>\n        <div className=\"space-y-3\">\n          <label className=\"flex items-start gap-3 cursor-pointer p-4 border border-zinc-800 rounded hover:border-zinc-700 transition\">\n            <input\n              type=\"radio\"\n              name=\"fulfillment\"\n              value=\"ship\"\n              checked={fulfillment === \"ship\"}\n              onChange={() => onFulfillmentChange(\"ship\")}\n              className=\"rdk-radio mt-1\"\n              disabled={isUpdatingFulfillment || isProcessing}\n              data-testid=\"fulfillment-ship\"\n            />\n            <div className=\"flex-1\">\n              <div className=\"flex items-center gap-2\">\n                <TruckIcon className=\"w-4 h-4 text-gray-400\" />\n                <span className=\"text-white font-medium text-base\">Ship to me</span>\n              </div>\n              <p className=\"text-sm text-gray-400 mt-1\">\n                Standard shipping - calculated based on your items\n              </p>\n            </div>\n          </label>\n\n          <label className=\"flex items-start gap-3 cursor-pointer p-4 border border-zinc-800 rounded hover:border-zinc-700 transition\">\n            <input\n              type=\"radio\"\n              name=\"fulfillment\"\n              value=\"pickup\"\n              checked={fulfillment === \"pickup\"}\n              onChange={() => onFulfillmentChange(\"pickup\")}\n              className=\"rdk-radio mt-1\"\n              disabled={isUpdatingFulfillment || isProcessing}\n              data-testid=\"fulfillment-pickup\"\n            />\n            <div className=\"flex-1\">\n              <div className=\"flex items-center gap-2\">\n                <Package className=\"w-4 h-4 text-gray-400\" />\n                <span className=\"text-white font-medium text-base\">Local pickup</span>\n              </div>\n              <p className=\"text-sm text-gray-400 mt-1\">Free - Pick up at our location</p>\n            </div>\n          </label>\n        </div>\n\n        {fulfillment === \"pickup\" && (\n          <div className=\"mt-4 border border-zinc-800/70 bg-zinc-950/40 rounded p-4 text-sm text-gray-400 space-y-2\">\n            <p className=\"font-medium text-white mb-2\">Pickup Information</p>\n            <p>\n              After purchase, you will receive a pickup email you can reply to for\n              scheduling.\n            </p>\n            <p>\n              You can also DM us on{\" \"}\n              <a\n                href=\"https://instagram.com/realdealkickzllc\"\n                className=\"text-red-400 hover:text-red-300\"\n                target=\"_blank\"\n                rel=\"noreferrer\"\n              >\n                Instagram @realdealkickzllc\n              </a>\n              .\n            </p>\n            {canUseChat && (\n              <p>Signed-in customers can also use the in-app pickup chat.</p>\n            )}\n\n            <div className=\"mt-3 pt-3 border-t border-zinc-800\">\n              <p className=\"font-medium text-white mb-2\">Returns &amp; Refunds</p>\n              <p>\n                All sales are final except as outlined in our Returns &amp; Refunds\n                policy.\n              </p>\n              <div className=\"flex flex-wrap gap-x-4 gap-y-2 mt-2\">\n                <Link\n                  href=\"/refunds\"\n                  className=\"text-red-500 hover:text-red-400 underline\"\n                >\n                  Returns &amp; Refunds Policy\n                </Link>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {fulfillment === \"ship\" && (\n          <div className=\"mt-4 border border-zinc-800/70 bg-zinc-950/40 rounded p-4 text-sm text-gray-400 space-y-2\">\n            <p className=\"font-medium text-white mb-2\">Shipping Information</p>\n            <p>We aim to ship within 24 hours (processing time, not delivery time).</p>\n            <div className=\"flex flex-wrap gap-x-4 gap-y-2 mt-2\">\n              <Link\n                href=\"/shipping\"\n                className=\"text-red-500 hover:text-red-400 underline\"\n              >\n                Shipping Policy\n              </Link>\n            </div>\n\n            <div className=\"mt-3 pt-3 border-t border-zinc-800\">\n              <p className=\"font-medium text-white mb-2\">Returns &amp; Refunds</p>\n              <p>\n                All sales are final except as outlined in our Returns &amp; Refunds\n                policy.\n              </p>\n              <div className=\"flex flex-wrap gap-x-4 gap-y-2 mt-2\">\n                <Link\n                  href=\"/refunds\"\n                  className=\"text-red-500 hover:text-red-400 underline\"\n                >\n                  Returns &amp; Refunds Policy\n                </Link>\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Shipping Address */}\n      {fulfillment === \"ship\" && (\n        <SavedAddresses\n          onSelectAddress={handleShippingAddressSelect}\n          selectedAddressId={selectedAddressId}\n          onSelectAddressId={setSelectedAddressId}\n          isGuest={!canUseChat}\n        />\n      )}\n\n      {/* Payment Method */}\n      <div className=\"bg-zinc-900 border border-zinc-800/70 rounded-lg p-5 sm:p-6\">\n        <h2 className=\"text-base sm:text-lg font-semibold text-white mb-4 flex items-center gap-2\">\n          <Lock className=\"w-5 h-5\" />\n          Payment Information\n        </h2>\n\n        <div className=\"mb-4\">\n          <ExpressCheckoutElement\n            options={{\n              layout: {\n                overflow: \"never\",\n              },\n            }}\n            onConfirm={(event) => {\n              void handleExpressConfirm(event);\n            }}\n            onClick={handleExpressClick}\n          />\n        </div>\n\n        <div className=\"text-xs uppercase tracking-widest text-center text-gray-500 mb-4\">\n          Or pay with card\n        </div>\n\n        <PaymentElement\n          onChange={(event) => {\n            setPaymentComplete(event.complete);\n            if (event.complete) {\n              setPaymentElementError(null);\n            } else if (event.empty) {\n              setPaymentElementError(null);\n            } else {\n              setPaymentElementError(null);\n            }\n          }}\n        />\n\n        <div className=\"mb-4 p-3 bg-zinc-950 border border-zinc-800 rounded text-sm text-gray-400\">\n          <p className=\"flex items-center gap-2\">\n            <Lock className=\"w-4 h-4\" />\n            All payment information is securely processed by Stripe. We never store your\n            card details.\n          </p>\n        </div>\n        {paymentElementError && (\n          <div className=\"mt-3 text-sm text-red-400\">{paymentElementError}</div>\n        )}\n      </div>\n\n      {/* Submit Button */}\n      <button\n        type=\"submit\"\n        disabled={!isStripeReady || isProcessing || isUpdatingFulfillment}\n        className=\"w-full bg-red-600 hover:bg-red-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white font-bold py-4 rounded-lg transition text-base sm:text-lg flex items-center justify-center gap-2\"\n        data-testid=\"checkout-submit\"\n      >\n        {isProcessing ? (\n          <>\n            <Loader2 className=\"w-5 h-5 animate-spin\" />\n            Processing payment...\n          </>\n        ) : (\n          <>\n            <Lock className=\"w-5 h-5\" />\n            Place Order - ${total.toFixed(2)}\n          </>\n        )}\n      </button>\n\n      {/* Legal Agreements */}\n      <div className=\"text-sm text-gray-400 text-center\">\n        <p>\n          By placing your order, you agree to our{\" \"}\n          <Link href=\"/legal/terms\" className=\"text-red-500 hover:text-red-400 underline\">\n            Terms of Service\n          </Link>\n          {\" and \"}\n          <Link\n            href=\"/legal/privacy\"\n            className=\"text-red-500 hover:text-red-400 underline\"\n          >\n            Privacy Policy\n          </Link>\n          .\n        </p>\n      </div>\n    </form>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\checkout\\CheckoutGate.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\checkout\\CheckoutStart.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":391,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":391,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11218,11221],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11218,11221],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":476,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":476,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13254,13257],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13254,13257],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/checkout/CheckoutStart.tsx\n\"use client\";\n\nimport { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\nimport Link from \"next/link\";\nimport { useRouter, useSearchParams } from \"next/navigation\";\nimport { Elements } from \"@stripe/react-stripe-js\";\nimport { loadStripe, type StripeElementsOptions } from \"@stripe/stripe-js\";\nimport { Loader2 } from \"lucide-react\";\n\nimport { useCart } from \"@/components/cart/CartProvider\";\nimport { CheckoutForm, type ShippingAddress } from \"@/components/checkout/CheckoutForm\";\nimport { OrderSummary } from \"@/components/checkout/OrderSummary\";\nimport type { CartItem } from \"@/types/domain/cart\";\nimport {\n  clearIdempotencyKeyFromStorage,\n  generateIdempotencyKey,\n  getIdempotencyKeyFromStorage,\n  setIdempotencyKeyInStorage,\n} from \"@/lib/idempotency\";\nimport { CartSnapshotService } from \"@/services/cart-snapshot-service\";\nimport { clientEnv } from \"@/config/client-env\";\nimport { clearGuestShippingAddress } from \"@/lib/checkout/guest-shipping-address\";\n\nconst guestEnabled = clientEnv.NEXT_PUBLIC_GUEST_CHECKOUT_ENABLED === \"true\";\n\nconst buildCartSignature = (items: CartItem[]) => {\n  const sorted = [...items].sort((a, b) => {\n    const aKey = `${a.productId}:${a.variantId}`;\n    const bKey = `${b.productId}:${b.variantId}`;\n    return aKey.localeCompare(bKey);\n  });\n  return JSON.stringify(\n    sorted.map((item) => ({\n      productId: item.productId,\n      variantId: item.variantId,\n      quantity: item.quantity,\n    })),\n  );\n};\n\nconst stripeAppearance: StripeElementsOptions[\"appearance\"] = {\n  theme: \"night\",\n  variables: {\n    fontFamily: \"Arial, Helvetica, sans-serif\",\n    colorPrimary: \"#dc2626\",\n    colorBackground: \"#09090b\",\n    colorText: \"#ffffff\",\n    colorTextSecondary: \"#a1a1aa\",\n    colorDanger: \"#dc2626\",\n    borderRadius: \"2px\",\n  },\n};\n\ntype ShippingPayload = {\n  name: string;\n  phone?: string | null;\n  line1: string;\n  line2?: string | null;\n  city: string;\n  state: string;\n  postal_code: string;\n  country: string;\n} | null;\n\nexport function CheckoutStart() {\n  const router = useRouter();\n  const searchParams = useSearchParams();\n  const { items, isReady, setCartItems } = useCart();\n\n  const stripePromise = useMemo(\n    () => loadStripe(process.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY!),\n    [],\n  );\n  const snapshotService = useMemo(() => new CartSnapshotService(), []);\n\n  const [idempotencyKey, setIdempotencyKey] = useState<string | null>(null);\n  const [orderId, setOrderId] = useState<string | null>(null);\n  const [clientSecret, setClientSecret] = useState<string | null>(null);\n\n  const [subtotal, setSubtotal] = useState(0);\n  const [shipping, setShipping] = useState(0);\n  const [tax, setTax] = useState(0);\n  const [total, setTotal] = useState(0);\n\n  const [fulfillment, setFulfillment] = useState<\"ship\" | \"pickup\">(\"ship\");\n  const [shippingAddress, setShippingAddress] = useState<ShippingAddress | null>(null);\n\n  const [guestEmail, setGuestEmail] = useState<string | null>(null);\n  const [guestEmailChecked, setGuestEmailChecked] = useState(false);\n  const [isAuthenticated, setIsAuthenticated] = useState<boolean | null>(null);\n\n  const [isRestoring, setIsRestoring] = useState(false);\n  const [isInitializing, setIsInitializing] = useState(false);\n  const [isUpdatingFulfillment, setIsUpdatingFulfillment] = useState(false);\n\n  const [error, setError] = useState<string | null>(null);\n\n  const lastPricingKeyRef = useRef<string | null>(null);\n  const inFlightRef = useRef(false);\n  const abortRef = useRef<AbortController | null>(null);\n\n  const isGuestFlow = searchParams.get(\"guest\") === \"1\";\n\n  useEffect(() => {\n    if (!isGuestFlow) {\n      return;\n    }\n\n    const isReload = () => {\n      try {\n        const nav = performance.getEntriesByType?.(\"navigation\")?.[0] as\n          | PerformanceNavigationTiming\n          | undefined;\n        if (nav) {\n          return nav.type === \"reload\";\n        }\n        return performance.navigation?.type === 1;\n      } catch {\n        return false;\n      }\n    };\n\n    const handleBeforeUnload = () => {\n      if (isReload()) {\n        return;\n      }\n      clearGuestShippingAddress();\n    };\n\n    window.addEventListener(\"beforeunload\", handleBeforeUnload);\n\n    return () => {\n      window.removeEventListener(\"beforeunload\", handleBeforeUnload);\n      clearGuestShippingAddress();\n    };\n  }, [isGuestFlow]);\n\n  useEffect(() => {\n    const loadSession = async () => {\n      try {\n        const response = await fetch(\"/api/auth/session\", { cache: \"no-store\" });\n        const data = await response.json().catch(() => null);\n        setIsAuthenticated(Boolean(data?.user));\n      } catch {\n        setIsAuthenticated(false);\n      }\n    };\n\n    loadSession();\n  }, []);\n\n  useEffect(() => {\n    if (!isReady) {\n      return;\n    }\n\n    if (items.length === 0) {\n      setIsRestoring(true);\n      snapshotService\n        .restoreCart()\n        .then((restored) => {\n          if (restored && restored.length > 0) {\n            setCartItems(restored);\n          } else {\n            router.push(\"/cart\");\n          }\n        })\n        .finally(() => setIsRestoring(false));\n    }\n  }, [isReady, items.length, router, setCartItems, snapshotService]);\n\n  useEffect(() => {\n    if (!isReady || !isGuestFlow) {\n      return;\n    }\n\n    try {\n      const stored = localStorage.getItem(\"rdk_guest_email\");\n      setGuestEmail(stored ? stored.trim() : null);\n    } catch {\n      setGuestEmail(null);\n    } finally {\n      setGuestEmailChecked(true);\n    }\n  }, [isReady, isGuestFlow]);\n\n  useEffect(() => {\n    if (isAuthenticated === null) {\n      return;\n    }\n    if (isAuthenticated) {\n      return;\n    }\n\n    if (!isGuestFlow || !guestEnabled) {\n      router.push(\"/checkout\");\n    }\n  }, [isAuthenticated, isGuestFlow, router]);\n\n  useEffect(() => {\n    if (!isReady) {\n      return;\n    }\n    if (isAuthenticated !== false) {\n      return;\n    }\n    if (!isGuestFlow || !guestEnabled) {\n      return;\n    }\n    if (!guestEmailChecked) {\n      return;\n    }\n    if (!guestEmail) {\n      router.push(\"/checkout\");\n    }\n  }, [guestEmail, guestEmailChecked, isAuthenticated, isGuestFlow, isReady, router]);\n\n  useEffect(() => {\n    if (!isReady || items.length === 0) {\n      return;\n    }\n\n    const signature = buildCartSignature(items);\n    try {\n      const storedSignature = sessionStorage.getItem(\"checkout_cart_signature\");\n      const storedKey = getIdempotencyKeyFromStorage();\n      if (!storedKey || storedSignature !== signature) {\n        const nextKey = generateIdempotencyKey();\n        setIdempotencyKeyInStorage(nextKey);\n        sessionStorage.setItem(\"checkout_cart_signature\", signature);\n\n        setIdempotencyKey(nextKey);\n        setOrderId(null);\n        setClientSecret(null);\n\n        lastPricingKeyRef.current = null;\n        abortRef.current?.abort();\n        inFlightRef.current = false;\n\n        return;\n      }\n      setIdempotencyKey(storedKey);\n    } catch {\n      const fallbackKey = generateIdempotencyKey();\n      setIdempotencyKeyInStorage(fallbackKey);\n      setIdempotencyKey(fallbackKey);\n      setOrderId(null);\n      setClientSecret(null);\n\n      lastPricingKeyRef.current = null;\n      abortRef.current?.abort();\n      inFlightRef.current = false;\n    }\n  }, [isReady, items]);\n\n  const buildShippingPayload = (address: ShippingAddress | null): ShippingPayload =>\n    address\n      ? {\n          name: address.name?.trim() ?? \"\",\n          phone: address.phone?.trim() ? address.phone.trim() : null,\n          line1: address.line1?.trim() ?? \"\",\n          line2: address.line2?.trim() ? address.line2.trim() : null,\n          city: address.city?.trim() ?? \"\",\n          state: address.state?.trim().toUpperCase() ?? \"\",\n          postal_code: address.postalCode?.trim() ?? \"\",\n          country: (address.country?.trim() ?? \"US\").toUpperCase(),\n        }\n      : null;\n\n  const shippingPayload = useMemo(\n    () => buildShippingPayload(shippingAddress),\n    [shippingAddress],\n  );\n\n  const addressKey = useMemo(() => {\n    if (fulfillment !== \"ship\" || !shippingPayload) {\n      return \"pickup\";\n    }\n    return [\n      shippingPayload.line1,\n      shippingPayload.city,\n      shippingPayload.state,\n      shippingPayload.postal_code,\n      shippingPayload.country,\n    ].join(\"|\");\n  }, [\n    fulfillment,\n    shippingPayload?.line1,\n    shippingPayload?.city,\n    shippingPayload?.state,\n    shippingPayload?.postal_code,\n    shippingPayload?.country,\n  ]);\n\n  const cartKey = useMemo(() => buildCartSignature(items), [items]);\n\n  const pricingKey = useMemo(() => {\n    if (!orderId) {\n      return null;\n    }\n    return `${orderId}:${cartKey}:${fulfillment}:${addressKey}`;\n  }, [orderId, cartKey, fulfillment, addressKey]);\n\n  useEffect(() => {\n    if (!isReady || items.length === 0) {\n      return;\n    }\n    if (!idempotencyKey) {\n      return;\n    }\n    if (isAuthenticated === null) {\n      return;\n    }\n    if (!isAuthenticated && !isGuestFlow) {\n      return;\n    }\n    if (!isAuthenticated && !guestEnabled) {\n      return;\n    }\n    if (!isAuthenticated && !guestEmail) {\n      return;\n    }\n    if (clientSecret && orderId) {\n      return;\n    }\n\n    let isActive = true;\n\n    const initializeCheckout = async () => {\n      setIsInitializing(true);\n      setError(null);\n\n      try {\n        const response = await fetch(\"/api/checkout/create-payment-intent\", {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({\n            idempotencyKey,\n            fulfillment,\n            guestEmail: isAuthenticated ? undefined : (guestEmail ?? undefined),\n            shippingAddress: fulfillment === \"ship\" ? shippingPayload : null,\n            items: items.map((item) => ({\n              productId: item.productId,\n              variantId: item.variantId,\n              quantity: item.quantity,\n            })),\n          }),\n        });\n\n        const data = await response.json().catch(() => null);\n        if (!response.ok) {\n          if (\n            data?.code === \"IDEMPOTENCY_KEY_EXPIRED\" ||\n            data?.code === \"CART_MISMATCH\"\n          ) {\n            clearIdempotencyKeyFromStorage();\n          }\n          if (\n            data?.code === \"GUEST_EMAIL_REQUIRED\" ||\n            data?.code === \"GUEST_CHECKOUT_DISABLED\"\n          ) {\n            router.push(\"/checkout\");\n            return;\n          }\n          throw new Error(data?.error || \"Failed to start checkout\");\n        }\n\n        if (!isActive) {\n          return;\n        }\n\n        if (data?.status === \"paid\" && data?.orderId) {\n          router.push(`/checkout/success?orderId=${data.orderId}`);\n          return;\n        }\n\n        if (!data?.clientSecret || !data?.orderId) {\n          throw new Error(\"Checkout is missing payment details.\");\n        }\n\n        setOrderId(data.orderId);\n        setClientSecret(data.clientSecret);\n        setSubtotal(Number(data.subtotal ?? 0));\n        setShipping(Number(data.shipping ?? 0));\n        setTax(Number(data.tax ?? 0));\n        setTotal(Number(data.total ?? 0));\n        setFulfillment(data.fulfillment ?? fulfillment);\n\n        lastPricingKeyRef.current = null;\n      } catch (err: any) {\n        if (!isActive) {\n          return;\n        }\n        setError(err?.message ?? \"Failed to start checkout.\");\n      } finally {\n        if (isActive) {\n          setIsInitializing(false);\n        }\n      }\n    };\n\n    initializeCheckout();\n\n    return () => {\n      isActive = false;\n    };\n  }, [\n    clientSecret,\n    guestEmail,\n    fulfillment,\n    idempotencyKey,\n    isAuthenticated,\n    isGuestFlow,\n    isReady,\n    items,\n    orderId,\n    router,\n    shippingPayload,\n  ]);\n\n  const updatePricing = useCallback(\n    async (\n      nextFulfillment: \"ship\" | \"pickup\",\n      nextShippingAddress: ShippingPayload,\n      dedupeKey?: string | null,\n    ) => {\n      if (!orderId) {\n        return;\n      }\n\n      if (dedupeKey && lastPricingKeyRef.current === dedupeKey) {\n        return;\n      }\n\n      abortRef.current?.abort();\n      const controller = new AbortController();\n      abortRef.current = controller;\n\n      if (inFlightRef.current) {\n        return;\n      }\n      inFlightRef.current = true;\n\n      setIsUpdatingFulfillment(true);\n      setError(null);\n\n      try {\n        const response = await fetch(\"/api/checkout/update-fulfillment\", {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({\n            orderId,\n            fulfillment: nextFulfillment,\n            shippingAddress: nextShippingAddress,\n          }),\n          signal: controller.signal,\n        });\n\n        const data = await response.json().catch(() => null);\n        if (!response.ok) {\n          throw new Error(\n            data?.error || `Failed to update fulfillment (${response.status}).`,\n          );\n        }\n\n        setFulfillment(data.fulfillment ?? nextFulfillment);\n        setSubtotal(Number(data.subtotal ?? 0));\n        setShipping(Number(data.shipping ?? 0));\n        setTax(Number(data.tax ?? 0));\n        setTotal(Number(data.total ?? 0));\n\n        if (dedupeKey) {\n          lastPricingKeyRef.current = dedupeKey;\n        }\n      } catch (err: any) {\n        if (dedupeKey && lastPricingKeyRef.current === dedupeKey) {\n          lastPricingKeyRef.current = null;\n        }\n        if (err?.name !== \"AbortError\") {\n          setError(err?.message ?? \"Failed to update fulfillment.\");\n        }\n      } finally {\n        inFlightRef.current = false;\n        setIsUpdatingFulfillment(false);\n      }\n    },\n    [orderId],\n  );\n\n  useEffect(() => {\n    if (fulfillment !== \"ship\") {\n      return;\n    }\n    if (!orderId || !clientSecret) {\n      return;\n    }\n    if (!pricingKey) {\n      return;\n    }\n    if (isUpdatingFulfillment) {\n      return;\n    }\n\n    if (!shippingPayload) {\n      return;\n    }\n    const valid =\n      shippingPayload.name.trim() !== \"\" &&\n      shippingPayload.line1.trim() !== \"\" &&\n      shippingPayload.city.trim() !== \"\" &&\n      shippingPayload.state.trim() !== \"\" &&\n      shippingPayload.postal_code.trim() !== \"\";\n\n    if (!valid) {\n      return;\n    }\n\n    if (lastPricingKeyRef.current === pricingKey) {\n      return;\n    }\n\n    const t = setTimeout(() => {\n      lastPricingKeyRef.current = pricingKey;\n      updatePricing(\"ship\", shippingPayload, pricingKey);\n    }, 350);\n\n    return () => clearTimeout(t);\n  }, [\n    clientSecret,\n    fulfillment,\n    isUpdatingFulfillment,\n    orderId,\n    pricingKey,\n    shippingPayload,\n    updatePricing,\n  ]);\n\n  const handleFulfillmentChange = async (nextFulfillment: \"ship\" | \"pickup\") => {\n    if (nextFulfillment === fulfillment) {\n      return;\n    }\n\n    lastPricingKeyRef.current = null;\n\n    if (!orderId) {\n      setFulfillment(nextFulfillment);\n      return;\n    }\n\n    const nextKey =\n      nextFulfillment === \"ship\"\n        ? `${orderId}:${cartKey}:ship:${addressKey}`\n        : `${orderId}:${cartKey}:pickup:pickup`;\n\n    await updatePricing(\n      nextFulfillment,\n      nextFulfillment === \"ship\" ? shippingPayload : null,\n      nextKey,\n    );\n  };\n\n  if (!isReady || isRestoring || items.length === 0) {\n    return (\n      <div className=\"max-w-3xl mx-auto px-4 py-20 text-center\">\n        <Loader2 className=\"w-12 h-12 text-red-600 animate-spin mx-auto mb-4\" />\n        <p className=\"text-gray-400\">Preparing your checkout...</p>\n      </div>\n    );\n  }\n\n  if (!clientSecret || !orderId || isInitializing) {\n    if (error) {\n      return (\n        <div className=\"max-w-3xl mx-auto px-4 py-20 text-center\">\n          <div className=\"bg-red-900/20 border border-red-500 text-red-400 p-6 rounded\">\n            <p className=\"text-lg font-semibold mb-2\">Unable to start checkout</p>\n            <p className=\"mb-4\">{error}</p>\n            <button\n              onClick={() => router.push(\"/cart\")}\n              className=\"px-6 py-2 bg-red-600 hover:bg-red-700 text-white rounded transition\"\n            >\n              Return to Cart\n            </button>\n          </div>\n        </div>\n      );\n    }\n\n    return (\n      <div className=\"max-w-3xl mx-auto px-4 py-20 text-center\">\n        <Loader2 className=\"w-12 h-12 text-red-600 animate-spin mx-auto mb-4\" />\n        <p className=\"text-gray-400\">Loading secure checkout...</p>\n      </div>\n    );\n  }\n\n  const elementsOptions: StripeElementsOptions = {\n    clientSecret,\n    appearance: stripeAppearance,\n  };\n\n  return (\n    <div className=\"max-w-6xl mx-auto px-4 pt-0 sm:py-10 pb-28 lg:pb-10\">\n      <div className=\"flex items-center justify-between mb-6 sm:mb-8 pt-2\">\n        <div>\n          <h1 className=\"text-2xl sm:text-3xl font-bold text-white\">Checkout</h1>\n          <p className=\"text-sm sm:text-base text-gray-400\">\n            Secure checkout powered by Stripe\n          </p>\n        </div>\n        <Link href=\"/cart\" className=\"text-sm text-gray-400 hover:text-white transition\">\n          Back to cart\n        </Link>\n      </div>\n\n      {error && (\n        <div className=\"mb-6 bg-red-900/20 border border-red-500 text-red-400 p-4 rounded\">\n          {error}\n        </div>\n      )}\n\n      {!isAuthenticated && guestEmail && (\n        <div className=\"mb-6 bg-zinc-900 border border-zinc-800/70 rounded p-4 text-sm text-gray-400\">\n          Guest checkout as <span className=\"text-white font-medium\">{guestEmail}</span>\n        </div>\n      )}\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n        <div className=\"lg:col-span-2\">\n          <Elements stripe={stripePromise} options={elementsOptions}>\n            <CheckoutForm\n              orderId={orderId}\n              items={items}\n              total={total}\n              fulfillment={fulfillment}\n              shippingAddress={shippingAddress}\n              onShippingAddressChange={(addr) => {\n                lastPricingKeyRef.current = null;\n                setShippingAddress(addr);\n              }}\n              onFulfillmentChange={(next) => {\n                void handleFulfillmentChange(next);\n              }}\n              isUpdatingFulfillment={isUpdatingFulfillment}\n              canUseChat={isAuthenticated === true}\n            />\n          </Elements>\n        </div>\n\n        <div className=\"lg:col-span-1\">\n          <OrderSummary\n            items={items}\n            subtotal={subtotal}\n            shipping={shipping}\n            tax={tax}\n            total={total}\n            fulfillment={fulfillment}\n            isUpdatingShipping={isUpdatingFulfillment}\n          />\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\checkout\\ChevronPuller.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\checkout\\OrderSummary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\checkout\\SavedAddresses.tsx","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react-hooks/exhaustive-deps').","line":129,"column":5,"severity":1,"nodeType":null,"fix":{"range":[3678,3733],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"\"use client\";\n\nimport { useEffect, useRef, useState } from \"react\";\nimport { Check, MapPin, Loader2, Plus } from \"lucide-react\";\n\nimport type { ShippingAddress } from \"./CheckoutForm\";\nimport { ShippingAddressModal } from \"./ShippingAddressModal\";\n\ninterface SavedAddress {\n  id: string;\n  name: string | null;\n  phone: string | null;\n  line1: string | null;\n  line2: string | null;\n  city: string | null;\n  state: string | null;\n  postal_code: string | null;\n  country: string | null;\n}\n\ninterface SavedAddressesProps {\n  onSelectAddress: (address: ShippingAddress) => void;\n  selectedAddressId: string | null;\n  onSelectAddressId: (id: string | null) => void;\n  isGuest?: boolean;\n}\n\nconst GUEST_ADDRESS_STORAGE_KEY = \"rdk_guest_shipping_address_v1\";\n\nfunction toShippingAddress(a: SavedAddress): ShippingAddress {\n  return {\n    name: a.name || \"\",\n    phone: a.phone || \"\",\n    line1: a.line1 || \"\",\n    line2: a.line2 || \"\",\n    city: a.city || \"\",\n    state: a.state || \"\",\n    postalCode: a.postal_code || \"\",\n    country: a.country || \"US\",\n  };\n}\n\nfunction toApiPayload(address: ShippingAddress) {\n  return {\n    name: address.name?.trim() || null,\n    phone: address.phone?.trim() || null,\n    line1: address.line1.trim(),\n    line2: address.line2?.trim() ? address.line2.trim() : null,\n    city: address.city.trim(),\n    state: address.state.trim().toUpperCase(),\n    postal_code: address.postalCode.trim(),\n    country: (address.country || \"US\").trim().toUpperCase(),\n  };\n}\n\nexport function SavedAddresses({\n  onSelectAddress,\n  selectedAddressId,\n  onSelectAddressId,\n  isGuest = false,\n}: SavedAddressesProps) {\n  const [addresses, setAddresses] = useState<SavedAddress[]>([]);\n  const [isLoading, setIsLoading] = useState(!isGuest);\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const [editingAddress, setEditingAddress] = useState<ShippingAddress | null>(null);\n\n  // Guest-only state so we can render a selected card\n  const [guestAddress, setGuestAddress] = useState<ShippingAddress | null>(null);\n\n  //  Prevent Maximum update depth exceeded for guest restore flow\n  const didInitGuestRef = useRef(false);\n\n  useEffect(() => {\n    if (isGuest) {\n      if (didInitGuestRef.current) {\n        return;\n      }\n      didInitGuestRef.current = true;\n\n      try {\n        const raw = sessionStorage.getItem(GUEST_ADDRESS_STORAGE_KEY);\n        if (raw) {\n          const parsed = JSON.parse(raw) as ShippingAddress;\n\n          // Only update if it actually changes\n          setGuestAddress((prev) => {\n            const prevSig = prev ? JSON.stringify(prev) : \"\";\n            const nextSig = JSON.stringify(parsed);\n            return prevSig === nextSig ? prev : parsed;\n          });\n\n          // Only select if not already selected\n          if (selectedAddressId !== \"guest-address\") {\n            onSelectAddressId(\"guest-address\");\n            onSelectAddress(parsed);\n          }\n        }\n      } catch {\n        // ignore\n      }\n\n      setIsLoading(false);\n      return;\n    }\n\n    // Logged-in: fetch addresses\n    const controller = new AbortController();\n\n    (async () => {\n      setIsLoading(true);\n      try {\n        const response = await fetch(\"/api/account/addresses\", {\n          cache: \"no-store\",\n          signal: controller.signal,\n        });\n        if (response.ok) {\n          const data = await response.json().catch(() => null);\n          setAddresses(data?.addresses || []);\n        }\n      } catch {\n        // ignore\n      } finally {\n        setIsLoading(false);\n      }\n    })();\n\n    return () => controller.abort();\n    // Intentionally NOT including callbacks here; they are often unstable from parent\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isGuest]);\n\n  const handleSelectAddress = (address: SavedAddress) => {\n    onSelectAddressId(address.id);\n    onSelectAddress(toShippingAddress(address));\n  };\n\n  const handleSelectGuestAddress = () => {\n    if (!guestAddress) {\n      return;\n    }\n    onSelectAddressId(\"guest-address\");\n    onSelectAddress(guestAddress);\n  };\n\n  const handleAddNewAddress = () => {\n    // Guest: prefill if they already have one so Add acts like Edit\n    if (isGuest) {\n      setEditingAddress(guestAddress);\n    } else {\n      setEditingAddress(null);\n    }\n    setIsModalOpen(true);\n  };\n\n  const handleSaveAddress = async (address: ShippingAddress) => {\n    //  Guest: store locally + select + render\n    if (isGuest) {\n      setGuestAddress(address);\n      onSelectAddressId(\"guest-address\");\n      onSelectAddress(address);\n      try {\n        sessionStorage.setItem(GUEST_ADDRESS_STORAGE_KEY, JSON.stringify(address));\n      } catch {\n        // ignore\n      }\n      return;\n    }\n\n    //  Logged-in: persist to DB via your existing route\n    setIsLoading(true);\n    try {\n      const response = await fetch(\"/api/account/addresses\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(toApiPayload(address)),\n      });\n\n      const data = await response.json().catch(() => null);\n      if (!response.ok) {\n        throw new Error(data?.error || \"Failed to save address\");\n      }\n\n      const nextAddresses: SavedAddress[] = data?.addresses || [];\n      setAddresses(nextAddresses);\n\n      // Select the saved address (match by line1 + postal_code)\n      const saved = nextAddresses.find(\n        (a) =>\n          (a.line1 || \"\").trim().toLowerCase() === address.line1.trim().toLowerCase() &&\n          (a.postal_code || \"\").trim() === address.postalCode.trim(),\n      );\n\n      if (saved) {\n        onSelectAddressId(saved.id);\n        onSelectAddress(toShippingAddress(saved));\n      } else {\n        // fallback: select first result if exists\n        if (nextAddresses[0]) {\n          onSelectAddressId(nextAddresses[0].id);\n          onSelectAddress(toShippingAddress(nextAddresses[0]));\n        }\n      }\n    } catch (e) {\n      // You can surface this via toast/error UI if you want\n      console.error(e);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"bg-zinc-900 border border-zinc-800/70 rounded-lg p-5 sm:p-6\">\n        <div className=\"flex items-center justify-center py-4\">\n          <Loader2 className=\"w-6 h-6 text-gray-400 animate-spin\" />\n        </div>\n      </div>\n    );\n  }\n\n  const guestSelected = isGuest && selectedAddressId === \"guest-address\";\n\n  return (\n    <>\n      <div className=\"bg-zinc-900 border border-zinc-800/70 rounded-lg p-5 sm:p-6\">\n        <h2 className=\"text-base sm:text-lg font-semibold text-white mb-4 flex items-center gap-2\">\n          <MapPin className=\"w-5 h-5\" />\n          {isGuest ? \"Shipping Address\" : \"Saved Addresses\"}\n        </h2>\n\n        <div className=\"space-y-3\">\n          {/* Guest selected address card */}\n          {isGuest && guestAddress && (\n            <button\n              type=\"button\"\n              onClick={handleSelectGuestAddress}\n              className={`w-full text-left p-4 rounded border transition ${\n                guestSelected\n                  ? \"border-red-600 bg-red-600/10\"\n                  : \"border-zinc-800 hover:border-zinc-700\"\n              }`}\n            >\n              <div className=\"flex items-start gap-3\">\n                <div\n                  className={`flex-shrink-0 w-5 h-5 rounded-full border-2 flex items-center justify-center mt-0.5 ${\n                    guestSelected ? \"border-red-600 bg-red-600\" : \"border-zinc-600\"\n                  }`}\n                >\n                  {guestSelected && <Check className=\"w-3 h-3 text-white\" />}\n                </div>\n\n                <div className=\"flex-1 min-w-0\">\n                  <p className=\"text-white font-medium\">{guestAddress.name}</p>\n                  <p className=\"text-sm text-gray-400\">{guestAddress.line1}</p>\n                  {guestAddress.line2 && (\n                    <p className=\"text-sm text-gray-400\">{guestAddress.line2}</p>\n                  )}\n                  <p className=\"text-sm text-gray-400\">\n                    {guestAddress.city}, {guestAddress.state} {guestAddress.postalCode}\n                  </p>\n                  {guestAddress.phone && (\n                    <p className=\"text-sm text-gray-500 mt-1\">{guestAddress.phone}</p>\n                  )}\n                </div>\n              </div>\n            </button>\n          )}\n\n          {/* Logged-in saved addresses */}\n          {!isGuest &&\n            addresses.map((address) => (\n              <button\n                key={address.id}\n                type=\"button\"\n                onClick={() => handleSelectAddress(address)}\n                className={`w-full text-left p-4 rounded border transition ${\n                  selectedAddressId === address.id\n                    ? \"border-red-600 bg-red-600/10\"\n                    : \"border-zinc-800 hover:border-zinc-700\"\n                }`}\n              >\n                <div className=\"flex items-start gap-3\">\n                  <div\n                    className={`flex-shrink-0 w-5 h-5 rounded-full border-2 flex items-center justify-center mt-0.5 ${\n                      selectedAddressId === address.id\n                        ? \"border-red-600 bg-red-600\"\n                        : \"border-zinc-600\"\n                    }`}\n                  >\n                    {selectedAddressId === address.id && (\n                      <Check className=\"w-3 h-3 text-white\" />\n                    )}\n                  </div>\n\n                  <div className=\"flex-1 min-w-0\">\n                    <p className=\"text-white font-medium\">{address.name}</p>\n                    <p className=\"text-sm text-gray-400\">{address.line1}</p>\n                    {address.line2 && (\n                      <p className=\"text-sm text-gray-400\">{address.line2}</p>\n                    )}\n                    <p className=\"text-sm text-gray-400\">\n                      {address.city}, {address.state} {address.postal_code}\n                    </p>\n                    {address.phone && (\n                      <p className=\"text-sm text-gray-500 mt-1\">{address.phone}</p>\n                    )}\n                  </div>\n                </div>\n              </button>\n            ))}\n\n          <button\n            type=\"button\"\n            onClick={handleAddNewAddress}\n            className=\"w-full p-4 rounded border border-dashed border-zinc-700 hover:border-red-600 hover:bg-red-600/5 transition flex items-center justify-center gap-2 text-gray-400 hover:text-red-400\"\n          >\n            <Plus className=\"w-5 h-5\" />\n            <span className=\"font-medium\">\n              {isGuest\n                ? guestAddress\n                  ? \"Edit shipping address\"\n                  : \"Add shipping address\"\n                : addresses.length > 0\n                  ? \"Add another shipping address\"\n                  : \"Add a shipping address\"}\n            </span>\n          </button>\n        </div>\n      </div>\n\n      <ShippingAddressModal\n        isOpen={isModalOpen}\n        onClose={() => setIsModalOpen(false)}\n        onSave={(address) => {\n          void handleSaveAddress(address);\n        }}\n        initialAddress={editingAddress}\n      />\n    </>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\checkout\\ShippingAddressModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\contact\\ContactForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\inventory\\ProductForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":310,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":310,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9137,9140],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9137,9140],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":340,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":340,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9951,9954],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9951,9954],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":394,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":394,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11419,11422],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11419,11422],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@next/next/no-img-element').","line":1168,"column":23,"severity":1,"nodeType":null,"fix":{"range":[38034,38087],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":1,"source":"// src/components/inventory/ProductForm.tsx\n\"use client\";\n\nimport { useState, useEffect, useMemo, useRef } from \"react\";\nimport { ImagePlus, Plus, Trash2, X } from \"lucide-react\";\n\nimport { SHOE_SIZES, CLOTHING_SIZES } from \"@/config/constants/sizes\";\nimport type { Category, Condition, SizeType } from \"@/types/domain/product\";\nimport type { ProductCreateInput } from \"@/services/product-service\";\nimport { logError } from \"@/lib/log\";\nimport { Toast } from \"@/components/ui/Toast\";\nimport { RdkSelect } from \"@/components/ui/Select\";\n\nimport { TagInput, type TagChip } from \"./TagInput\";\n\ninterface ProductFormProps {\n  initialData?: Partial<ProductCreateInput> & { id?: string };\n  onSubmit: (data: ProductCreateInput) => Promise<void>;\n  onCancel: () => void;\n}\n\ntype VariantDraft = {\n  size_label: string;\n  price: string;\n  cost: string;\n  stock: string;\n};\n\ntype ImageDraft = ProductCreateInput[\"images\"][number];\n\ntype CatalogOption = {\n  id: string;\n  label: string;\n  groupKey?: string | null;\n};\n\ntype TitleParseResult = {\n  titleRaw: string;\n  titleDisplay: string;\n  brand: {\n    id: string | null;\n    label: string;\n    groupKey?: string | null;\n    isVerified: boolean;\n  };\n  model: {\n    id: string | null;\n    label: string | null;\n    isVerified: boolean;\n  };\n  name: string;\n  suggestions?: {\n    brand?: { id: string; label: string; confidence: number };\n    model?: { id: string; label: string; confidence: number };\n  };\n};\n\nconst normalizeImages = (items: ImageDraft[]) => {\n  const hasPrimary = items.some((item) => item.is_primary);\n  return items.map((item, index) => ({\n    ...item,\n    sort_order: index,\n    is_primary: hasPrimary ? item.is_primary : index === 0,\n  }));\n};\n\nconst formatMoney = (value: number) => value.toFixed(2);\n\nconst AUTO_TAG_GROUP_KEYS = new Set([\n  \"brand\",\n  \"model\",\n  \"category\",\n  \"condition\",\n  \"designer_brand\",\n  \"size_shoe\",\n  \"size_clothing\",\n  \"size_custom\",\n]);\n\nconst getSizeTypeForCategory = (category: Category): SizeType => {\n  if (category === \"sneakers\") {\n    return \"shoe\";\n  }\n  if (category === \"clothing\") {\n    return \"clothing\";\n  }\n  if (category === \"accessories\") {\n    return \"custom\";\n  }\n  return \"none\";\n};\n\nconst getTagKey = (tag: { label: string; group_key: string }) =>\n  `${tag.group_key}:${tag.label}`;\n\nfunction RequiredMark() {\n  return <span className=\"text-red-500\">*</span>;\n}\n\nexport function ProductForm({ initialData, onSubmit, onCancel }: ProductFormProps) {\n  const [isLoading, setIsLoading] = useState(false);\n\n  const initialTitle = initialData?.title_raw ?? \"\";\n  const [titleRaw, setTitleRaw] = useState(initialTitle);\n\n  const [parseResult, setParseResult] = useState<TitleParseResult | null>(null);\n  const [parseStatus, setParseStatus] = useState<\"idle\" | \"loading\" | \"error\">(\"idle\");\n\n  const [brandOverrideId, setBrandOverrideId] = useState<string | null>(null);\n  const [brandOverrideInput, setBrandOverrideInput] = useState(\"\");\n  const [modelOverrideId, setModelOverrideId] = useState<string | null>(null);\n  const [modelOverrideInput, setModelOverrideInput] = useState(\"\");\n\n  const [brandOptions, setBrandOptions] = useState<CatalogOption[]>([]);\n  const [modelOptions, setModelOptions] = useState<CatalogOption[]>([]);\n\n  const [category, setCategory] = useState<Category>(initialData?.category || \"sneakers\");\n  const [condition, setCondition] = useState<Condition>(initialData?.condition || \"new\");\n  const [conditionNote, setConditionNote] = useState(initialData?.condition_note || \"\");\n  const [description, setDescription] = useState(initialData?.description || \"\");\n\n  const [shippingPrice, setShippingPrice] = useState(() => {\n    const shippingOverrideCents = initialData?.shipping_override_cents;\n    if (shippingOverrideCents !== null && shippingOverrideCents !== undefined) {\n      return formatMoney(shippingOverrideCents / 100);\n    }\n    return \"\";\n  });\n\n  const [shippingDefaults, setShippingDefaults] = useState<Record<string, number>>({});\n  const [shippingDefaultsStatus, setShippingDefaultsStatus] = useState<\n    \"loading\" | \"ready\" | \"error\"\n  >(\"loading\");\n\n  const [customTags, setCustomTags] = useState<TagChip[]>(() => {\n    const tags = initialData?.tags ?? [];\n    return tags\n      .filter((tag) => !AUTO_TAG_GROUP_KEYS.has(tag.group_key))\n      .map((tag) => ({\n        label: tag.label,\n        group_key: tag.group_key,\n        source: \"custom\",\n      }));\n  });\n\n  const [excludedAutoTagKeys, setExcludedAutoTagKeys] = useState<string[]>([]);\n  const hasInitializedTags = useRef(false);\n  const hasInitializedVariants = useRef(false);\n\n  const [variants, setVariants] = useState<VariantDraft[]>(() => {\n    const sizeType = getSizeTypeForCategory(initialData?.category || \"sneakers\");\n    const mapped = initialData?.variants?.map((variant) => ({\n      size_label: variant.size_label,\n      price: formatMoney(variant.price_cents / 100),\n      cost: formatMoney((variant.cost_cents ?? 0) / 100),\n      stock: String(variant.stock ?? 0),\n    }));\n\n    return (\n      mapped || [\n        {\n          size_label: sizeType === \"none\" ? \"N/A\" : \"\",\n          price: \"\",\n          cost: \"\",\n          stock: \"1\",\n        },\n      ]\n    );\n  });\n\n  const [images, setImages] = useState<ImageDraft[]>(() =>\n    normalizeImages(initialData?.images ?? []),\n  );\n\n  const [isDragging, setIsDragging] = useState(false);\n  const fileInputRef = useRef<HTMLInputElement | null>(null);\n  const [toast, setToast] = useState<{\n    message: string;\n    tone: \"success\" | \"error\" | \"info\";\n  } | null>(null);\n\n  const sizeType = useMemo(() => getSizeTypeForCategory(category), [category]);\n  const defaultShippingPrice = shippingDefaults[category] ?? 0;\n\n  const parsedBrandLabel = parseResult?.brand?.label?.trim() ?? \"\";\n  const parsedBrandGroup = parseResult?.brand?.groupKey ?? null;\n  const parsedModelLabel = parseResult?.model?.label?.trim() ?? \"\";\n\n  const autoTags = useMemo<TagChip[]>(() => {\n    const tags: TagChip[] = [];\n    const seen = new Set<string>();\n\n    const addTag = (label: string, group_key: string) => {\n      const trimmed = label.trim();\n      if (!trimmed) {\n        return;\n      }\n      const key = `${group_key}:${trimmed}`;\n      if (seen.has(key)) {\n        return;\n      }\n      seen.add(key);\n      tags.push({ label: trimmed, group_key, source: \"auto\" });\n    };\n\n    if (parsedBrandLabel) {\n      addTag(parsedBrandLabel, \"brand\");\n      if (parsedBrandGroup === \"designer\") {\n        addTag(parsedBrandLabel, \"designer_brand\");\n      }\n    }\n\n    if (parsedModelLabel && category === \"sneakers\") {\n      addTag(parsedModelLabel, \"model\");\n    }\n\n    if (category) {\n      addTag(category, \"category\");\n    }\n    if (condition) {\n      addTag(condition, \"condition\");\n    }\n\n    if (sizeType !== \"none\") {\n      const groupKey =\n        sizeType === \"shoe\"\n          ? \"size_shoe\"\n          : sizeType === \"clothing\"\n            ? \"size_clothing\"\n            : \"size_custom\";\n\n      variants.forEach((variant) => {\n        const stockCount = Number.parseInt(variant.stock, 10);\n        if (!Number.isFinite(stockCount) || stockCount <= 0) {\n          return;\n        }\n        addTag(variant.size_label, groupKey);\n      });\n    }\n\n    return tags;\n  }, [\n    parsedBrandLabel,\n    parsedBrandGroup,\n    parsedModelLabel,\n    category,\n    condition,\n    sizeType,\n    variants,\n  ]);\n\n  const visibleAutoTags = useMemo(\n    () => autoTags.filter((tag) => !excludedAutoTagKeys.includes(getTagKey(tag))),\n    [autoTags, excludedAutoTagKeys],\n  );\n\n  const allTags = useMemo(() => {\n    const merged = [...visibleAutoTags, ...customTags];\n    const seen = new Set<string>();\n    return merged.filter((tag) => {\n      const key = getTagKey(tag);\n      if (seen.has(key)) {\n        return false;\n      }\n      seen.add(key);\n      return true;\n    });\n  }, [visibleAutoTags, customTags]);\n\n  useEffect(() => {\n    const loadDefaults = async () => {\n      setShippingDefaultsStatus(\"loading\");\n      try {\n        const response = await fetch(\"/api/admin/shipping/defaults\");\n        const data = await response.json();\n\n        if (response.ok && data?.defaults) {\n          const map: Record<string, number> = {};\n          for (const entry of data.defaults) {\n            const cents =\n              Number(\n                entry.shipping_cost_cents ??\n                  entry.default_price_cents ??\n                  entry.default_price ??\n                  0,\n              ) || 0;\n            map[entry.category] = cents / 100;\n          }\n          setShippingDefaults(map);\n          setShippingDefaultsStatus(\"ready\");\n          return;\n        }\n\n        setShippingDefaultsStatus(\"error\");\n      } catch (error) {\n        logError(error, { layer: \"frontend\", event: \"inventory_load_shipping_defaults\" });\n        setShippingDefaultsStatus(\"error\");\n      }\n    };\n\n    loadDefaults();\n  }, []);\n\n  useEffect(() => {\n    const loadBrands = async () => {\n      try {\n        const response = await fetch(\"/api/admin/catalog/brands\");\n        const data = await response.json();\n        if (response.ok) {\n          const options = (data.brands || []).map((brand: any) => ({\n            id: brand.id,\n            label: brand.canonical_label,\n            groupKey: brand.group?.key ?? null,\n          }));\n          setBrandOptions(options);\n        }\n      } catch (error) {\n        logError(error, { layer: \"frontend\", event: \"inventory_load_brand_catalog\" });\n      }\n    };\n\n    loadBrands();\n  }, []);\n\n  const effectiveBrandId = brandOverrideId ?? parseResult?.brand?.id ?? null;\n\n  useEffect(() => {\n    if (!effectiveBrandId) {\n      setModelOptions([]);\n      return;\n    }\n\n    const loadModels = async () => {\n      try {\n        const response = await fetch(\n          `/api/admin/catalog/models?brandId=${effectiveBrandId}`,\n        );\n        const data = await response.json();\n        if (response.ok) {\n          const options = (data.models || []).map((model: any) => ({\n            id: model.id,\n            label: model.canonical_label,\n          }));\n          setModelOptions(options);\n        }\n      } catch (error) {\n        logError(error, { layer: \"frontend\", event: \"inventory_load_model_catalog\" });\n      }\n    };\n\n    loadModels();\n  }, [effectiveBrandId]);\n\n  useEffect(() => {\n    if (!modelOverrideId) {\n      return;\n    }\n    const stillValid = modelOptions.some((option) => option.id === modelOverrideId);\n    if (!stillValid) {\n      setModelOverrideId(null);\n      setModelOverrideInput(\"\");\n    }\n  }, [modelOptions, modelOverrideId]);\n\n  useEffect(() => {\n    if (!titleRaw.trim()) {\n      setParseResult(null);\n      setParseStatus(\"idle\");\n      return;\n    }\n\n    const controller = new AbortController();\n    const parseTitle = async () => {\n      setParseStatus(\"loading\");\n      try {\n        const response = await fetch(\"/api/admin/catalog/parse-title\", {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({\n            titleRaw,\n            category,\n            brandOverrideId,\n            modelOverrideId,\n          }),\n          signal: controller.signal,\n        });\n        const data = await response.json();\n        if (!response.ok) {\n          throw new Error(data?.error || \"Failed to parse title.\");\n        }\n        setParseResult(data);\n        setParseStatus(\"idle\");\n      } catch (error) {\n        if ((error as any)?.name === \"AbortError\") {\n          return;\n        }\n        logError(error, { layer: \"frontend\", event: \"inventory_parse_title\" });\n        setParseStatus(\"error\");\n      }\n    };\n    const timeout = setTimeout(() => {\n      void parseTitle();\n    }, 250);\n\n    return () => {\n      controller.abort();\n      clearTimeout(timeout);\n    };\n  }, [titleRaw, category, brandOverrideId, modelOverrideId]);\n\n  useEffect(() => {\n    if (!hasInitializedVariants.current) {\n      hasInitializedVariants.current = true;\n      return;\n    }\n\n    setVariants((current) =>\n      current.map((variant) => {\n        if (sizeType === \"none\") {\n          return { ...variant, size_label: \"N/A\" };\n        }\n        if (sizeType === \"custom\") {\n          return variant.size_label === \"N/A\" ? { ...variant, size_label: \"\" } : variant;\n        }\n        return { ...variant, size_label: \"\" };\n      }),\n    );\n  }, [sizeType]);\n\n  useEffect(() => {\n    if (hasInitializedTags.current || !initialData?.tags) {\n      return;\n    }\n\n    const existingKeys = new Set(initialData.tags.map(getTagKey));\n    const missing = autoTags.map(getTagKey).filter((key) => !existingKeys.has(key));\n\n    setExcludedAutoTagKeys(missing);\n    hasInitializedTags.current = true;\n  }, [autoTags, initialData?.tags]);\n\n  const addVariant = () => {\n    setVariants([\n      ...variants,\n      {\n        size_label: sizeType === \"none\" ? \"N/A\" : \"\",\n        price: \"\",\n        cost: \"\",\n        stock: \"1\",\n      },\n    ]);\n  };\n\n  const removeVariant = (index: number) => {\n    if (variants.length > 1) {\n      setVariants(variants.filter((_, i) => i !== index));\n    }\n  };\n\n  const updateVariant = (index: number, field: keyof VariantDraft, value: string) => {\n    const updated = [...variants];\n    updated[index] = { ...updated[index], [field]: value };\n    setVariants(updated);\n  };\n\n  const addImageEntry = (url: string) => {\n    const trimmed = url.trim();\n    if (!trimmed) {\n      return;\n    }\n    setImages((current) =>\n      normalizeImages([\n        ...current,\n        {\n          url: trimmed,\n          sort_order: current.length,\n          is_primary: current.length === 0,\n        },\n      ]),\n    );\n  };\n\n  const removeImage = (index: number) => {\n    setImages((current) => normalizeImages(current.filter((_, i) => i !== index)));\n  };\n\n  const setPrimaryImage = (index: number) => {\n    setImages((current) =>\n      normalizeImages(\n        current.map((image, i) => ({\n          ...image,\n          is_primary: i === index,\n        })),\n      ),\n    );\n  };\n\n  const handleUploadFiles = async (files: FileList | null) => {\n    if (!files || files.length === 0) {\n      return;\n    }\n\n    const uploads = Array.from(files).filter((file) => file.type.startsWith(\"image/\"));\n    if (uploads.length === 0) {\n      return;\n    }\n\n    try {\n      // Upload sequentially (simpler, avoids overwhelming local stack)\n      for (const file of uploads) {\n        const fd = new FormData();\n        fd.append(\"file\", file);\n\n        // If editing an existing product, you can pass productId for folder placement:\n        if (initialData?.id) {\n          fd.append(\"productId\", initialData.id);\n        }\n\n        const res = await fetch(\"/api/admin/uploads/product-image\", {\n          method: \"POST\",\n          body: fd,\n        });\n\n        const json = await res.json().catch(() => ({}));\n\n        if (!res.ok) {\n          throw new Error(json?.error || \"Image upload failed\");\n        }\n\n        // IMPORTANT: store the returned Storage URL, not base64\n        addImageEntry(String(json.url || \"\"));\n      }\n    } catch (error) {\n      logError(error, { layer: \"frontend\", event: \"inventory_image_upload\" });\n      const message = error instanceof Error ? error.message : \"Failed to upload image\";\n      setToast({ message, tone: \"error\" });\n    } finally {\n      if (fileInputRef.current) {\n        fileInputRef.current.value = \"\";\n      }\n      setIsDragging(false);\n    }\n  };\n\n  const handleDragOver = (event: React.DragEvent<HTMLDivElement>) => {\n    event.preventDefault();\n    setIsDragging(true);\n  };\n\n  const handleDragLeave = () => setIsDragging(false);\n\n  const handleDrop = (event: React.DragEvent<HTMLDivElement>) => {\n    event.preventDefault();\n    setIsDragging(false);\n    handleUploadFiles(event.dataTransfer.files);\n  };\n\n  const handleAddTag = (label: string) => {\n    const trimmed = label.trim();\n    if (!trimmed) {\n      return;\n    }\n\n    const newTag: TagChip = {\n      label: trimmed,\n      group_key: \"custom\",\n      source: \"custom\",\n    };\n\n    const existingKeys = new Set(allTags.map(getTagKey));\n    if (existingKeys.has(getTagKey(newTag))) {\n      return;\n    }\n\n    setCustomTags([...customTags, newTag]);\n  };\n\n  const applyBrandOverride = (option: CatalogOption | null) => {\n    setBrandOverrideId(option?.id ?? null);\n    setBrandOverrideInput(option?.label ?? \"\");\n    setModelOverrideId(null);\n    setModelOverrideInput(\"\");\n  };\n\n  const applyModelOverride = (option: CatalogOption | null) => {\n    setModelOverrideId(option?.id ?? null);\n    setModelOverrideInput(option?.label ?? \"\");\n  };\n\n  const handleBrandOverrideChange = (value: string) => {\n    setBrandOverrideInput(value);\n    const match = brandOptions.find(\n      (option) => option.label.toLowerCase() === value.trim().toLowerCase(),\n    );\n    if (match) {\n      applyBrandOverride(match);\n    } else {\n      setBrandOverrideId(null);\n      setModelOverrideId(null);\n      setModelOverrideInput(\"\");\n    }\n  };\n\n  const handleModelOverrideChange = (value: string) => {\n    setModelOverrideInput(value);\n    const match = modelOptions.find(\n      (option) => option.label.toLowerCase() === value.trim().toLowerCase(),\n    );\n    if (match) {\n      applyModelOverride(match);\n    } else {\n      setModelOverrideId(null);\n    }\n  };\n\n  const brandSuggestion = parseResult?.suggestions?.brand;\n  const modelSuggestion = parseResult?.suggestions?.model;\n\n  const applyBrandSuggestion = () => {\n    if (!brandSuggestion) {\n      return;\n    }\n    const match = brandOptions.find((option) => option.id === brandSuggestion.id);\n    if (match) {\n      applyBrandOverride(match);\n    }\n  };\n\n  const applyModelSuggestion = () => {\n    if (!modelSuggestion) {\n      return;\n    }\n    const match = modelOptions.find((option) => option.id === modelSuggestion.id);\n    if (match) {\n      applyModelOverride(match);\n    }\n  };\n\n  const handleRemoveTag = (tag: TagChip) => {\n    if (tag.source === \"auto\") {\n      const key = getTagKey(tag);\n      setExcludedAutoTagKeys((prev) => (prev.includes(key) ? prev : [...prev, key]));\n      return;\n    }\n\n    setCustomTags(customTags.filter((item) => getTagKey(item) !== getTagKey(tag)));\n  };\n\n  const parseMoneyToCents = (value: string) => {\n    const trimmed = value.trim();\n    if (!trimmed) {\n      return null;\n    }\n    const parsed = Number.parseFloat(trimmed);\n    if (!Number.isFinite(parsed)) {\n      return null;\n    }\n    return Math.round(parsed * 100);\n  };\n\n  const parseStockCount = (value: string) => {\n    const parsed = Number.parseInt(value, 10);\n    if (!Number.isFinite(parsed)) {\n      return null;\n    }\n    return Math.max(parsed, 0);\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsLoading(true);\n\n    try {\n      const trimmedTitle = titleRaw.trim();\n      if (!trimmedTitle) {\n        throw new Error(\"Full title is required.\");\n      }\n\n      const trimmedShipping = shippingPrice.trim();\n      const shippingCents = trimmedShipping ? parseMoneyToCents(trimmedShipping) : null;\n      if (trimmedShipping && shippingCents === null) {\n        throw new Error(\"Please enter a valid shipping price.\");\n      }\n\n      const preparedVariants = variants.map((variant, index) => {\n        const priceCents = parseMoneyToCents(variant.price);\n        if (priceCents === null) {\n          throw new Error(`Variant ${index + 1} price is invalid.`);\n        }\n\n        const costCents = parseMoneyToCents(variant.cost);\n        if (costCents === null) {\n          throw new Error(`Variant ${index + 1} cost is invalid.`);\n        }\n\n        const stockCount = parseStockCount(variant.stock);\n        if (stockCount === null) {\n          throw new Error(`Variant ${index + 1} stock is invalid.`);\n        }\n\n        const sizeLabel = sizeType === \"none\" ? \"N/A\" : variant.size_label.trim();\n        if (sizeType !== \"none\" && !sizeLabel) {\n          throw new Error(`Variant ${index + 1} size is required.`);\n        }\n\n        return {\n          size_type: sizeType,\n          size_label: sizeLabel,\n          price_cents: priceCents,\n          cost_cents: costCents,\n          stock: stockCount,\n        };\n      });\n\n      const preparedImages = normalizeImages(images)\n        .map((image) => ({ ...image, url: image.url.trim() }))\n        .filter((image) => image.url);\n\n      if (preparedImages.length === 0) {\n        throw new Error(\"Please add at least one product image.\");\n      }\n\n      const data: ProductCreateInput = {\n        title_raw: trimmedTitle,\n        brand_override_id: brandOverrideId ?? undefined,\n        model_override_id: modelOverrideId ?? undefined,\n        category,\n        condition,\n        condition_note: conditionNote || undefined,\n        description: description || undefined,\n        shipping_override_cents: shippingCents ?? undefined,\n        variants: preparedVariants,\n        images: preparedImages,\n        tags: allTags.map((tag) => ({ label: tag.label, group_key: tag.group_key })),\n      };\n\n      await onSubmit(data);\n    } catch (error) {\n      logError(error, { layer: \"frontend\", event: \"inventory_form_submit\" });\n      const message = error instanceof Error ? error.message : \"Failed to save product\";\n      setToast({ message, tone: \"error\" });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <form\n      onSubmit={(event) => {\n        void handleSubmit(event);\n      }}\n      className=\"space-y-6\"\n    >\n      {/* Basic Info */}\n      <div className=\"bg-zinc-900 border border-zinc-800/70 rounded p-6\">\n        <h2 className=\"text-xl font-semibold text-white mb-4\">Basic Information</h2>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          <div className=\"md:col-span-2\">\n            <label className=\"block text-gray-400 text-sm mb-1\">\n              Full Title <RequiredMark />\n            </label>\n            <input\n              type=\"text\"\n              value={titleRaw}\n              onChange={(e) => setTitleRaw(e.target.value)}\n              required\n              className=\"w-full bg-zinc-800 text-white px-4 py-2 rounded border border-zinc-800/70 focus:outline-none focus:ring-2 focus:ring-red-600\"\n            />\n            <p className=\"text-xs text-gray-500 mt-2\">\n              One input only. We parse brand, model (sneakers), and name automatically.\n            </p>\n          </div>\n\n          <div>\n            <label className=\"block text-gray-400 text-sm mb-1\">\n              Category <RequiredMark />\n            </label>\n            <RdkSelect\n              value={category}\n              onChange={(v) => setCategory(v as Category)}\n              options={[\n                { value: \"sneakers\", label: \"Sneakers\" },\n                { value: \"clothing\", label: \"Clothing\" },\n                { value: \"accessories\", label: \"Accessories\" },\n                { value: \"electronics\", label: \"Electronics\" },\n              ]}\n              buttonClassName=\"bg-zinc-800\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-gray-400 text-sm mb-1\">\n              Condition <RequiredMark />\n            </label>\n            <RdkSelect\n              value={condition}\n              onChange={(v) => setCondition(v as Condition)}\n              options={[\n                { value: \"new\", label: \"New\" },\n                { value: \"used\", label: \"Used\" },\n              ]}\n              buttonClassName=\"bg-zinc-800\"\n            />\n          </div>\n        </div>\n\n        <div className=\"mt-4 bg-zinc-950/40 border border-zinc-800/70 rounded p-4 space-y-3\">\n          <div className=\"flex items-center justify-between\">\n            <h3 className=\"text-sm text-gray-300 font-semibold\">Parsed Preview</h3>\n            {parseStatus === \"loading\" && (\n              <span className=\"text-xs text-gray-500\">Parsing...</span>\n            )}\n            {parseStatus === \"error\" && (\n              <span className=\"text-xs text-red-400\">Unable to parse title</span>\n            )}\n          </div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3 text-sm\">\n            <div className=\"text-gray-400\">\n              <span className=\"block text-xs uppercase text-gray-500\">Brand</span>\n              <span className=\"text-white\">{parseResult?.brand?.label || \"-\"}</span>\n            </div>\n            {category === \"sneakers\" && (\n              <div className=\"text-gray-400\">\n                <span className=\"block text-xs uppercase text-gray-500\">Model</span>\n                <span className=\"text-white\">{parseResult?.model?.label || \"-\"}</span>\n              </div>\n            )}\n            <div className=\"text-gray-400\">\n              <span className=\"block text-xs uppercase text-gray-500\">Name</span>\n              <span className=\"text-white\">{parseResult?.name || \"-\"}</span>\n            </div>\n          </div>\n\n          {parseResult?.titleDisplay && (\n            <div className=\"text-xs text-gray-500\">\n              Display: <span className=\"text-gray-200\">{parseResult.titleDisplay}</span>\n            </div>\n          )}\n\n          {(brandSuggestion || modelSuggestion) && (\n            <div className=\"flex flex-wrap gap-2\">\n              {brandSuggestion && (\n                <button\n                  type=\"button\"\n                  onClick={applyBrandSuggestion}\n                  className=\"text-xs px-3 py-1 rounded-full border border-zinc-700/70 text-red-200 hover:bg-red-900/30\"\n                >\n                  Did you mean {brandSuggestion.label}?\n                </button>\n              )}\n              {category === \"sneakers\" && modelSuggestion && (\n                <button\n                  type=\"button\"\n                  onClick={applyModelSuggestion}\n                  className=\"text-xs px-3 py-1 rounded-full border border-zinc-700/70 text-red-200 hover:bg-red-900/30\"\n                >\n                  Did you mean {modelSuggestion.label}?\n                </button>\n              )}\n            </div>\n          )}\n        </div>\n\n        <div className=\"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4\">\n          <div>\n            <label className=\"block text-gray-400 text-sm mb-1\">Override Brand</label>\n            <input\n              type=\"text\"\n              list=\"brand-options\"\n              value={brandOverrideInput}\n              onChange={(e) => handleBrandOverrideChange(e.target.value)}\n              placeholder=\"Search brands...\"\n              className=\"w-full bg-zinc-800 text-white px-4 py-2 rounded border border-zinc-800/70 focus:outline-none focus:ring-2 focus:ring-zinc-700/40\"\n            />\n            <datalist id=\"brand-options\">\n              {brandOptions.map((brand) => (\n                <option key={brand.id} value={brand.label} />\n              ))}\n            </datalist>\n            {brandOverrideId && (\n              <button\n                type=\"button\"\n                onClick={() => applyBrandOverride(null)}\n                className=\"text-xs text-gray-500 mt-2 hover:text-white\"\n              >\n                Clear override\n              </button>\n            )}\n          </div>\n\n          {category === \"sneakers\" && (\n            <div>\n              <label className=\"block text-gray-400 text-sm mb-1\">Override Model</label>\n              <input\n                type=\"text\"\n                list=\"model-options\"\n                value={modelOverrideInput}\n                onChange={(e) => handleModelOverrideChange(e.target.value)}\n                placeholder={\n                  effectiveBrandId ? \"Search models...\" : \"Select a brand first\"\n                }\n                disabled={!effectiveBrandId}\n                className=\"w-full bg-zinc-800 text-white px-4 py-2 rounded border border-zinc-800/70 disabled:text-gray-500 focus:outline-none focus:ring-2 focus:ring-zinc-700/40\"\n              />\n              <datalist id=\"model-options\">\n                {modelOptions.map((model) => (\n                  <option key={model.id} value={model.label} />\n                ))}\n              </datalist>\n              {modelOverrideId && (\n                <button\n                  type=\"button\"\n                  onClick={() => applyModelOverride(null)}\n                  className=\"text-xs text-gray-500 mt-2 hover:text-white\"\n                >\n                  Clear override\n                </button>\n              )}\n            </div>\n          )}\n        </div>\n\n        {condition === \"used\" && (\n          <div className=\"mt-4\">\n            <label className=\"block text-gray-400 text-sm mb-1\">Condition Note</label>\n            <textarea\n              value={conditionNote}\n              onChange={(e) => setConditionNote(e.target.value)}\n              rows={2}\n              className=\"w-full bg-zinc-800 text-white px-4 py-2 rounded border border-zinc-800/70 focus:outline-none focus:ring-2 focus:ring-red-600\"\n            />\n          </div>\n        )}\n\n        <div className=\"mt-4\">\n          <label className=\"block text-gray-400 text-sm mb-1\">Description</label>\n          <textarea\n            value={description}\n            onChange={(e) => setDescription(e.target.value)}\n            rows={4}\n            className=\"w-full bg-zinc-800 text-white px-4 py-2 rounded border border-zinc-800/70 focus:outline-none focus:ring-2 focus:ring-red-600\"\n          />\n        </div>\n      </div>\n\n      {/* Variants */}\n      <div className=\"bg-zinc-900 border border-zinc-800/70 rounded p-6\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <h2 className=\"text-xl font-semibold text-white\">Variants</h2>\n          <button\n            type=\"button\"\n            onClick={addVariant}\n            className=\"flex items-center gap-2 bg-red-600 hover:bg-red-700 text-white px-3 py-2 rounded text-sm transition\"\n          >\n            <Plus className=\"w-4 h-4\" />\n            Add Variant\n          </button>\n        </div>\n\n        <div className=\"space-y-4\">\n          {variants.map((variant, index) => (\n            <div key={index} className=\"bg-zinc-800 p-4 rounded flex gap-4\">\n              <div className=\"flex-1 grid grid-cols-1 md:grid-cols-4 gap-4\">\n                <div>\n                  <label className=\"block text-gray-400 text-xs mb-1\">\n                    Size <RequiredMark />\n                  </label>\n\n                  {sizeType === \"shoe\" && (\n                    <RdkSelect\n                      value={variant.size_label}\n                      onChange={(v) => updateVariant(index, \"size_label\", v)}\n                      placeholder=\"Select\"\n                      options={[\n                        { value: \"\", label: \"Select\" },\n                        ...SHOE_SIZES.map((size) => ({ value: size, label: size })),\n                      ]}\n                      buttonClassName=\"bg-zinc-900\"\n                    />\n                  )}\n\n                  {sizeType === \"clothing\" && (\n                    <RdkSelect\n                      value={variant.size_label}\n                      onChange={(v) => updateVariant(index, \"size_label\", v)}\n                      placeholder=\"Select\"\n                      options={[\n                        { value: \"\", label: \"Select\" },\n                        ...CLOTHING_SIZES.map((size) => ({ value: size, label: size })),\n                      ]}\n                      buttonClassName=\"bg-zinc-900\"\n                    />\n                  )}\n\n                  {sizeType === \"custom\" && (\n                    <input\n                      type=\"text\"\n                      value={variant.size_label}\n                      onChange={(e) => updateVariant(index, \"size_label\", e.target.value)}\n                      required\n                      placeholder=\"e.g., One Size\"\n                      className=\"w-full bg-zinc-900 text-white px-3 py-2 rounded text-sm border border-zinc-800/70 focus:outline-none focus:ring-2 focus:ring-red-600\"\n                    />\n                  )}\n\n                  {sizeType === \"none\" && (\n                    <input\n                      type=\"text\"\n                      value=\"N/A\"\n                      disabled\n                      className=\"w-full bg-zinc-900 text-gray-500 px-3 py-2 rounded text-sm border border-zinc-800/70\"\n                    />\n                  )}\n                </div>\n\n                <div>\n                  <label className=\"block text-gray-400 text-xs mb-1\">\n                    Selling for Price ($) <RequiredMark />\n                  </label>\n                  <input\n                    type=\"text\"\n                    inputMode=\"decimal\"\n                    value={variant.price}\n                    onChange={(e) => updateVariant(index, \"price\", e.target.value)}\n                    required\n                    className=\"w-full bg-zinc-900 text-white px-3 py-2 rounded text-sm border border-zinc-800/70 focus:outline-none focus:ring-2 focus:ring-red-600\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-gray-400 text-xs mb-1\">\n                    Bought for Price ($) <RequiredMark />\n                  </label>\n                  <input\n                    type=\"text\"\n                    inputMode=\"decimal\"\n                    value={variant.cost}\n                    onChange={(e) => updateVariant(index, \"cost\", e.target.value)}\n                    required\n                    className=\"w-full bg-zinc-900 text-white px-3 py-2 rounded text-sm border border-zinc-800/70 focus:outline-none focus:ring-2 focus:ring-red-600\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-gray-400 text-xs mb-1\">\n                    Stock <RequiredMark />\n                  </label>\n                  <input\n                    type=\"text\"\n                    inputMode=\"numeric\"\n                    value={variant.stock}\n                    onChange={(e) => updateVariant(index, \"stock\", e.target.value)}\n                    required\n                    className=\"w-full bg-zinc-900 text-white px-3 py-2 rounded text-sm border border-zinc-800/70 focus:outline-none focus:ring-2 focus:ring-red-600\"\n                  />\n                </div>\n              </div>\n\n              {variants.length > 1 && (\n                <button\n                  type=\"button\"\n                  onClick={() => removeVariant(index)}\n                  className=\"text-red-500 hover:text-red-400 p-2 rounded hover:bg-zinc-900\"\n                  aria-label=\"Remove variant\"\n                >\n                  <Trash2 className=\"w-4 h-4\" />\n                </button>\n              )}\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* Images */}\n      <div className=\"bg-zinc-900 border border-zinc-800/70 rounded p-6\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <h2 className=\"text-xl font-semibold text-white\">\n            Images <RequiredMark />\n          </h2>\n          <span className=\"text-xs text-gray-500\">{images.length} total</span>\n        </div>\n\n        <input\n          ref={fileInputRef}\n          type=\"file\"\n          accept=\"image/*\"\n          multiple\n          onChange={(e) => {\n            void handleUploadFiles(e.target.files);\n          }}\n          className=\"hidden\"\n        />\n\n        {/* Full-width Dropzone */}\n        <div\n          onClick={() => fileInputRef.current?.click()}\n          onDragOver={handleDragOver}\n          onDragLeave={handleDragLeave}\n          onDrop={handleDrop}\n          className={[\n            \"w-full h-44 border border-dashed cursor-pointer transition\",\n            \"rounded\",\n            \"px-4 py-3 flex items-center gap-3\",\n            isDragging\n              ? \"border-red-500 bg-red-900/10\"\n              : \"border-zinc-800/70 bg-zinc-950/30 hover:bg-zinc-950/50\",\n          ].join(\" \")}\n        >\n          <div className=\"h-10 w-10 bg-zinc-900 border border-zinc-800/70 flex items-center justify-center shrink-0 rounded\">\n            <ImagePlus className=\"w-5 h-5 text-gray-400\" />\n          </div>\n\n          <div className=\"min-w-0 flex-1\">\n            <p className=\"text-sm text-white font-semibold truncate\">\n              Drag & drop images\n            </p>\n            <p className=\"text-xs text-gray-500 mt-1\">\n              Or click to browse. PNG, JPG, WEBP.\n            </p>\n            <p className=\"text-xs text-gray-500 mt-1\">\n              First image becomes primary (you can change it below).\n            </p>\n          </div>\n\n          <button\n            type=\"button\"\n            onClick={(event) => {\n              event.stopPropagation();\n              fileInputRef.current?.click();\n            }}\n            className=\"text-xs font-semibold bg-zinc-900 border border-zinc-800/70 px-3 py-2 rounded hover:bg-zinc-800\"\n          >\n            Browse\n          </button>\n        </div>\n\n        {/* Thumbnails BELOW primary */}\n        <div className=\"mt-4\">\n          {images.length === 0 ? (\n            <div className=\"text-gray-500 text-sm\">No images yet.</div>\n          ) : (\n            <div className=\"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 gap-3\">\n              {images.map((image, index) => (\n                <div\n                  key={index}\n                  role=\"button\"\n                  tabIndex={0}\n                  onClick={() => setPrimaryImage(index)}\n                  onKeyDown={(e) => {\n                    if (e.key === \"Enter\" || e.key === \" \") {\n                      e.preventDefault();\n                      setPrimaryImage(index);\n                    }\n                  }}\n                  className={[\n                    \"group relative text-left border overflow-hidden transition\",\n                    \"rounded cursor-pointer select-none\",\n                    image.is_primary\n                      ? \"border-red-500\"\n                      : \"border-zinc-800/70 hover:border-zinc-700\",\n                  ].join(\" \")}\n                  title=\"Click to set primary\"\n                >\n                  <div className=\"aspect-square bg-zinc-900 overflow-hidden\">\n                    {image.url ? (\n                      // eslint-disable-next-line @next/next/no-img-element\n                      <img\n                        src={image.url}\n                        alt=\"Preview\"\n                        className=\"w-full h-full object-cover\"\n                      />\n                    ) : (\n                      <div className=\"w-full h-full flex items-center justify-center text-gray-500 text-xs\">\n                        Missing\n                      </div>\n                    )}\n                  </div>\n\n                  <div className=\"absolute top-1 left-1\">\n                    <span\n                      className={[\n                        \"text-[10px] px-2 py-0.5 border\",\n                        \"rounded\",\n                        image.is_primary\n                          ? \"bg-red-600 border-red-500 text-white\"\n                          : \"bg-black/50 border-white/10 text-gray-200\",\n                      ].join(\" \")}\n                    >\n                      {image.is_primary ? \"Primary\" : \"Thumb\"}\n                    </span>\n                  </div>\n\n                  <div className=\"absolute top-1 right-1 opacity-0 group-hover:opacity-100 transition\">\n                    <button\n                      type=\"button\"\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        removeImage(index);\n                      }}\n                      className=\"bg-black/60 hover:bg-black/80 text-white p-1.5 rounded\"\n                      aria-label=\"Remove image\"\n                    >\n                      <X className=\"w-3.5 h-3.5\" />\n                    </button>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n\n        <div className=\"mt-3 text-xs text-gray-500\">\n          Add at least one image. Click any thumbnail to promote it to primary.\n        </div>\n      </div>\n\n      {/* Pricing & Shipping */}\n      <div className=\"bg-zinc-900 border border-zinc-800/70 rounded p-6\">\n        <h2 className=\"text-xl font-semibold text-white mb-4\">Pricing & Shipping</h2>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          <div>\n            <label className=\"block text-gray-400 text-sm mb-1\">Shipping Price ($)</label>\n            <input\n              type=\"text\"\n              inputMode=\"decimal\"\n              value={shippingPrice}\n              onChange={(e) => setShippingPrice(e.target.value)}\n              className=\"w-full bg-zinc-800 text-white px-4 py-2 rounded border border-zinc-800/70 focus:outline-none focus:ring-2 focus:ring-red-600\"\n            />\n\n            {shippingDefaultsStatus === \"loading\" ? (\n              <p className=\"text-gray-500 text-xs mt-1\">\n                Loading default shipping prices\n              </p>\n            ) : shippingDefaultsStatus === \"error\" ? (\n              <p className=\"text-red-400 text-xs mt-1\">\n                Could not load default shipping prices. (You can still set an override.)\n              </p>\n            ) : (\n              <p className=\"text-gray-500 text-xs mt-1\">\n                Leave blank to use the {category} default:{\" \"}\n                <span className=\"text-gray-200\">\n                  ${formatMoney(defaultShippingPrice)}\n                </span>\n                .\n              </p>\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* Tags */}\n      <div className=\"bg-zinc-900 border border-zinc-800/70 rounded p-6\">\n        <h2 className=\"text-xl font-semibold text-white mb-4\">Tags</h2>\n        <TagInput tags={allTags} onAddTag={handleAddTag} onRemoveTag={handleRemoveTag} />\n      </div>\n\n      {/* Actions */}\n      <div className=\"flex gap-4\">\n        <button\n          type=\"submit\"\n          disabled={isLoading}\n          className=\"flex-1 bg-red-600 hover:bg-red-700 disabled:bg-gray-600 text-white font-semibold py-3 rounded transition\"\n        >\n          {isLoading\n            ? \"Saving...\"\n            : initialData?.id\n              ? \"Update Product\"\n              : \"Create Product\"}\n        </button>\n        <button\n          type=\"button\"\n          onClick={onCancel}\n          className=\"px-6 bg-zinc-700 hover:bg-zinc-600 text-white font-semibold py-3 rounded transition\"\n        >\n          Cancel\n        </button>\n      </div>\n\n      <Toast\n        open={Boolean(toast)}\n        message={toast?.message ?? \"\"}\n        tone={toast?.tone ?? \"info\"}\n        onClose={() => setToast(null)}\n      />\n    </form>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\inventory\\TagInput.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\orders\\OrderStatusView.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\search\\SearchOverlay.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[524,527],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[524,527],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/components/search/SearchOverlay.tsx\n\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport { X, Search } from \"lucide-react\";\nimport { useRouter } from \"next/navigation\";\nimport Image from \"next/image\";\n\nimport { logError } from \"@/lib/log\";\n\ninterface SearchOverlayProps {\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nexport function SearchOverlay({ isOpen, onClose }: SearchOverlayProps) {\n  const router = useRouter();\n  const [query, setQuery] = useState(\"\");\n  const [results, setResults] = useState<any[]>([]);\n  const [isLoading, setIsLoading] = useState(false);\n\n  useEffect(() => {\n    if (!query.trim()) {\n      setResults([]);\n      return;\n    }\n\n    const runSearch = async () => {\n      setIsLoading(true);\n      try {\n        const response = await fetch(\n          `/api/store/products?q=${encodeURIComponent(query)}&limit=5`,\n        );\n        const data = await response.json();\n        setResults(data.products || []);\n      } catch (error) {\n        logError(error, { layer: \"frontend\", event: \"search_overlay_error\" });\n      } finally {\n        setIsLoading(false);\n      }\n    };\n\n    const timer = setTimeout(() => {\n      void runSearch();\n    }, 300);\n\n    return () => clearTimeout(timer);\n  }, [query]);\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (query.trim()) {\n      router.push(`/store?q=${encodeURIComponent(query)}`);\n      onClose();\n    }\n  };\n\n  if (!isOpen) {\n    return null;\n  }\n\n  return (\n    <div className=\"fixed inset-0 z-50 bg-black/95\">\n      <div className=\"max-w-3xl mx-auto px-4 py-8\">\n        <div className=\"flex items-center justify-between mb-8\">\n          <h2 className=\"text-2xl font-bold text-white\">Search</h2>\n          <button onClick={onClose} className=\"text-gray-400 hover:text-white\">\n            <X className=\"w-6 h-6\" />\n          </button>\n        </div>\n\n        <form onSubmit={handleSubmit} className=\"mb-6\">\n          <div className=\"relative\">\n            <input\n              type=\"text\"\n              value={query}\n              onChange={(e) => setQuery(e.target.value)}\n              placeholder=\"Search for sneakers, brands...\"\n              className=\"w-full bg-zinc-900 text-white px-4 py-3 rounded-lg pr-12 focus:outline-none focus:ring-2 focus:ring-red-600\"\n              autoFocus\n            />\n            <button\n              type=\"submit\"\n              className=\"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-white\"\n            >\n              <Search className=\"w-5 h-5\" />\n            </button>\n          </div>\n        </form>\n\n        {isLoading && <p className=\"text-gray-400 text-center\">Searching...</p>}\n\n        {results.length > 0 && (\n          <div className=\"space-y-2\">\n            <p className=\"text-gray-400 text-sm mb-3\">Likely matches</p>\n            {results.map((product) => (\n              <button\n                key={product.id}\n                onClick={() => {\n                  router.push(`/store/${product.id}`);\n                  onClose();\n                }}\n                className=\"w-full flex items-center gap-4 bg-zinc-900 hover:bg-zinc-800 p-3 rounded transition text-left\"\n              >\n                <div className=\"w-16 h-16 relative flex-shrink-0\">\n                  <Image\n                    src={product.images[0]?.url || \"/placeholder.png\"}\n                    alt={product.title_display ?? product.name}\n                    fill\n                    sizes=\"64px\"\n                    loading=\"lazy\"\n                    className=\"object-cover rounded\"\n                  />\n                </div>\n                <div className=\"flex-1 min-w-0\">\n                  <h3 className=\"text-white font-semibold truncate\">\n                    {product.title_display ?? `${product.brand} ${product.name}`.trim()}\n                  </h3>\n                </div>\n                <div className=\"text-white font-bold\">\n                  ${(product.variants[0]?.price_cents / 100).toFixed(2)}\n                </div>\n              </button>\n            ))}\n          </div>\n        )}\n\n        {query && !isLoading && results.length === 0 && (\n          <p className=\"text-gray-400 text-center\">No matches found</p>\n        )}\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\shell\\ClientShell.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\shell\\Footer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\shell\\MobileBottomNav.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\shell\\Navbar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\shell\\ScrollHeader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\store\\FilterPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\store\\ProductCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\store\\ProductDetail.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\store\\ProductGrid.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\store\\StoreControls.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\ui\\Accordion.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\ui\\ConfirmDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\ui\\Dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\ui\\Drawer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\ui\\ModalPortal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\ui\\Select.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\ui\\Toast.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\ui\\ToggleSwitch.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\components\\ui\\Tooltip.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\config\\ci-env.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\config\\client-env.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\config\\constants\\brand.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\config\\constants\\contact.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\config\\constants\\email.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\config\\constants\\nexus-thresholds.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\config\\constants\\roles.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\config\\constants\\shipping.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\config\\constants\\sizes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\config\\constants\\stripe.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\config\\constants\\uploads.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\config\\env.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\config\\pickup.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\config\\security.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\jobs\\stripe-order-job.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\auth\\session.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\auth\\tenant.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\cart\\snapshot.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\checkout\\guest-shipping-address.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\crypto.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\email\\account\\password-updated.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\email\\chat\\notification.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\email\\contact.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\email\\footer.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\email\\mailer.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\email\\orders\\admin-order-placed.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\email\\orders\\confirmation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\email\\orders\\delivered.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\email\\orders\\in-transit.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\email\\orders\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\email\\orders\\label-created.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\email\\orders\\pickup-instructions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\email\\orders\\refunded.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\email\\orders\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\email\\subscription.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\email\\template.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\email\\theme.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\http\\admin-session-cookie.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\http\\admin-session.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\http\\request-id.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\idempotency.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\log.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":38,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[813,816],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[813,816],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\stripe\\connect-appearance.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\stripe\\connect-client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\stripe\\stripe-server.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\supabase\\client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\supabase\\public.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\supabase\\server.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\supabase\\service-role.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\supabase\\session-refresh.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\validation\\admin.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\validation\\analytics.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\validation\\auth.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\validation\\cart.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\validation\\chat.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\validation\\checkout.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\validation\\email.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\validation\\password.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\validation\\product.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\validation\\storefront.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\validation\\stripe.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\lib\\validation\\webhooks.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\proxy\\auth.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\proxy\\bot.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\proxy\\canonicalize.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\proxy\\csrf.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\proxy\\finalize.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\proxy\\rate-limit.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\proxy\\security-headers.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\repositories\\addresses-repo.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\repositories\\admin-invites-repo.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\repositories\\admin-notifications-repo.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\repositories\\catalog-repo.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\repositories\\chat-messages-repo.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\repositories\\chats-repo.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\repositories\\contact-messages-repo.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\repositories\\email-subscriber-repo.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\repositories\\email-subscription-token-repo.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\repositories\\nexus-repo.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\repositories\\order-access-tokens-repo.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\repositories\\order-events-repo.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\repositories\\orders-repo.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\repositories\\payout-settings-repo.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\repositories\\product-repo.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\repositories\\profile-repo.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\repositories\\shipping-carriers-repo.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\repositories\\shipping-defaults-repo.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\repositories\\shipping-origins-repo.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\repositories\\shipping-repo.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\repositories\\site-pageviews-repo.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\repositories\\storage-repo.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\repositories\\stripe-events-repo.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\repositories\\tax-settings-repo.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\repositories\\tenant-repo.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\services\\admin-auth-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\services\\admin-invite-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\services\\admin-notification-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\services\\admin-order-email-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\services\\admin-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\services\\analytics-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\services\\auth-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\services\\cart-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\services\\cart-snapshot-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\services\\catalog-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\services\\chat-email-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\services\\chat-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\services\\checkout-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\services\\contact-attachment-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\services\\email-subscription-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\services\\mfa-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\services\\nexus-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\services\\order-access-token-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\services\\order-email-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\services\\orders-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\services\\product-image-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\services\\product-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\services\\product-title-parser-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\services\\product-title-parser.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\services\\refund-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\services\\shipping-carriers-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\services\\shipping-defaults-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\services\\shipping-label-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\services\\shipping-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\services\\storefront-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\services\\stripe-admin-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\services\\stripe-tax-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\services\\tag-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\services\\tenant-context-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\services\\tenant-service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\types\\db\\database.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\types\\domain\\cart.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\types\\domain\\chat.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\types\\domain\\checkout.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\types\\domain\\email.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\types\\domain\\nexus.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\types\\domain\\product.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\src\\types\\domain\\shipping.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]},{"filePath":"C:\\sneaker-eco\\rdk\\tailwind.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-return-await","replacedBy":[],"info":{"message":"The original assumption of the rule no longer holds true because of engine optimization.","deprecatedSince":"8.46.0","availableUntil":null,"replacedBy":[]}}]}]